<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LithoSphere Demo</title>

        <script src="../dist/lithosphere.js"></script>
        <style>
            html,
            body {
                width: 100%;
                height: 100%;
                margin: 0;
                background: black;
            }
            #container {
                width: 100%;
                height: 100%;
                overflow: hidden;
            }
            #myCustomCoordDiv {
                position: absolute;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: white;
                color: black;
                padding: 2px 4px;
            }
        </style>
    </head>
    <body>
        <div id="container"></div>
        <!--<div id="myCustomCoordDiv"></div>-->
        <script>
            const Litho = new LithoSphere.default('container', {
                /*
                initialView: {
                    lng: 137.358048, // default 0
                    lat: -4.673226,
                    zoom: 16,
                },
                */
                initialView: {
                    lng: 137.3650974531451,
                    lat: -4.71480304282526,
                    zoom: 16,
                },
                initialCamera: {
                    position: {
                        x: 274.50893509606396,
                        y: 4258.156814585879,
                        z: -1108.3356496526244,
                    },
                    target: {
                        x: 0,
                        y: 4293.083639767021,
                        z: 0,
                    },
                },
                majorRadius: 3396190,
                loadingScreen: true, // default true
                customParsers: {
                    All500: (tilePath, layerObj) => {
                        return new Promise((resolve, reject) => {
                            const tileDimension = 32
                            resolve(
                                new Array(tileDimension * tileDimension).fill(
                                    500
                                )
                            )
                        })
                    },
                },
                // opt
                demFallback: {
                    demPath:
                        'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/Gale_HiRISE/MSL_Gale_DEM_Mosaic_1m_v3/MSL_Gale_DEM_Mosaic_1m_v3/{z}/{x}/{y}.png',
                    format: 'tms',
                    parserType: 'rgba',
                },
                //opt
                tileMapResource: {
                    bounds: [0, 0, 0, 0],
                    origin: [0, 0],
                    proj: null, // proj4 string describing the global tileset projection: string (opt) | default wgs84
                    resunitsperpixel: 34,
                    reszoomlevel: 0,
                },
                radiusOfTiles: 4, //default 4
                //wireframeMode: true,
                //exaggeration: 1, //default 1
                showAxes: true,
                useLOD: true,
                renderOnlyWhenOpen: true, // default true
                starsphere: {
                    url:
                        'https://miplmmgis.jpl.nasa.gov/public/images/eso0932a.jpg',
                    color: '#666666',
                },
                atmosphere: {
                    color: '#111111',
                },
                canBecomeHighlighted: true, // default true
                highlightColor: 'yellow', //css color for vector hover highlights | default 'yellow'
                canBecomeActive: true, // default true
                activeColor: 'red', //css color for active vector features | default 'red'
            })

            console.log(Litho)

            Litho.addLayer('tile', {
                name: 'Aeolis',
                order: 1, //Orders are ordered only within the layer type
                on: true,
                path:
                    'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/Gale_Aeolis_Palus/Gale_Aeolis_Palus/{z}/{x}/{y}.png',
                demPath:
                    'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/MSL_CTX_DEM_mosaic_20m/{z}/{x}/{y}.png',
                //parser: 'All500',
                // TODO: Implement format
                format: 'tms', // 'wmts' || 'wms'
                formatOptions: {},
                demFormat: 'tms', //
                demFormatOptions: {},
                opacity: 1,
                minZoom: 10,
                maxZoom: 17,
                filters: {
                    brightness: 1,
                    contrast: 1,
                    saturation: 1,
                    blendCode: 0, //0 = none, 1 = overlay - caveat - tile zooms for all layers should line up,
                    blend: 0,
                },
                boundingBox: [
                    137.09995782300004,
                    -5.10494553812677,
                    137.69994902819656,
                    -4.12495782349,
                ],
            })

            //Litho.removeLayer('Aeolis')

            Litho.addLayer('tile', {
                name: 'HiRISE',
                order: 2,
                on: true,
                path:
                    'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/Gale_HiRISE/Gale_HiRISE/{z}/{x}/{y}.png',
                demPath:
                    'https://miplmmgis.jpl.nasa.gov/Missions/MSL/LayersBAD/Gale_HiRISE/MSL_Gale_DEM_Mosaic_1m_v3/MSL_Gale_DEM_Mosaic_1m_v3/{z}/{x}/{y}.png',
                format: 'tms', // 'wmts' || 'wms'
                demFormat: 'tms', //
                opacity: 1,
                minZoom: 11,
                maxZoom: 18,
                boundingBox: [
                    137.3250006349,
                    -4.72500217818315,
                    137.42500036372522,
                    -4.62500251269999,
                ],
                noDataValue: 0, //opt (number) - no data dem value //unused
            })
            Litho.setLayerFilterEffect('HiRISE', 'blendCode', 1)
            //Litho.options.radiusOfTiles = 10

            Litho.addLayer('tile3d', {
                name: '3dTileExample',
                order: 3,
                on: true,
                path:
                    'https://raw.githubusercontent.com/NASA-AMMOS/3DTilesSampleData/master/msl-dingo-gap/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize_tileset.json', // path to tileset.json
                opacity: 0.6,
                minZoom: 11,
                maxZoom: 18,
                position: {
                    longitude: 137.4071927368641, // default 0
                    latitude: -4.626571631163808, // default 0
                    elevation: -4480, // default 0
                },
                scale: 1, // default 1
                rotation: {
                    x: Math.PI / 2, // in radians | default 0
                    y: -Math.PI / 2, // default 0
                    z: 0, // default 0
                    order: 'YXZ', //default 'YXZ'
                },
            })
            //Litho.removeLayer('3dTileExample')

            Litho.addLayer(
                'clamped',
                {
                    name: 'clampedWaypoints',
                    order: 4,
                    on: true,
                    // GeoJSON or path to geojson
                    geojsonPath:
                        'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/Waypoints/MSL_waypoints_sol1489_m.json',
                    style: {
                        // Prefer feature[f].properties.style values
                        letPropertiesStyleOverride: true, // default false
                        default: {
                            fillColor: '#444444', //Use only rgb and hex. No css color names
                            fillOpacity: 1,
                            color: 'black',
                            weight: 2,
                            radius: 'prop=radius',
                        },
                        point: {
                            radius: 8,
                        },
                        line: {},
                        polygon: {},
                        byProp: {
                            'prop=images.0.test:blue': {},
                        },
                        bearing: {
                            angleProp: 'yaw_rad',
                            angleUnit: 'rad',
                            color: 'lime',
                        },
                    },
                    opacity: 1,
                    minZoom: 11,
                    maxZoom: 18,
                    boundingBox: [
                        137.3250006349,
                        -4.72500217818315,
                        137.42500036372522,
                        -4.62500251269999,
                    ],
                    //preDrawn?: boolean //override all clamped tiles with pre drawn tiles
                    //data?: { {z}: { {x}: { {y}: { pre_drawn_tile_canvas_data } }}} if preDrawn, use these tiles.
                },
                () => {
                    //Litho.removeLayer('clampedWaypoints')
                }
            )

            Litho.addLayer(
                'clamped',
                {
                    name: 'styledFeatures',
                    on: true,
                    geojson: {
                        type: 'FeatureCollection',
                        features: [
                            {
                                type: 'Feature',
                                geometry: {
                                    type: 'Polygon',
                                    coordinates: [
                                        [
                                            [137.358048, -4.673226],
                                            [137.362189, -4.673632],
                                            [137.36176, -4.675279],
                                            [137.357833, -4.674638],
                                            [137.358048, -4.673226],
                                        ],
                                    ],
                                },
                                properties: {
                                    style: {
                                        color: 'rgb(194, 28, 190)',
                                        dashArray: '',
                                        fillColor: 'rgb(104, 28, 190)',
                                        fillOpacity: 0.2,
                                        opacity: 1,
                                        radius: 2,
                                        symbol: '',
                                    },
                                },
                            },
                        ],
                    },
                    opacity: 1,
                    minZoom: 0,
                    maxZoom: 30,
                    style: {
                        // Prefer feature[f].properties.style values
                        letPropertiesStyleOverride: true,
                    },
                },
                () => {
                    //console.log('loaded')
                    setTimeout(() => {
                        //console.log('removing')
                        //Litho.removeLayer('styledFeatures')
                    }, 10000)
                }
            )

            /*
            Litho.addLayer('clamped', {
                name: 'clampedCCam',
                order: 5,
                on: true,
                // GeoJSON or path to geojson
                geojsonPath:
                    'https://miplmmgis.jpl.nasa.gov/Missions/MSL/Layers/ChemCam/MSL_CHEMCAM_Targets_sol1480.json',
                style: {
                    // Prefer feature[f].properties.style values
                    letPropertiesStyleOverride: true, // default false
                    default: {
                        fillColor: '#9c1', //Use only rgb and hex. No css color names
                        fillOpacity: 1,
                        color: 'black',
                        weight: 2,
                        radius: 4,
                    },
                    point: {},
                    line: {},
                    polygon: {},
                    byProp: {
                        'prop=images.0.test:blue': {},
                    },
                },
                opacity: 1,
                minZoom: 11,
                maxZoom: 18,
                boundingBox: [
                    137.3250006349,
                    -4.72500217818315,
                    137.42500036372522,
                    -4.62500251269999,
                ],
                //preDrawn?: boolean //override all clamped tiles with pre drawn tiles
                //data?: { {z}: { {x}: { {y}: { pre_drawn_tile_canvas_data } }}} if preDrawn, use these tiles.
            })
            */

            Litho.addLayer('clamped', {
                name: 'clampedPoly',
                order: 4,
                on: true,
                // GeoJSON or path to geojson
                geojson: {
                    type: 'FeatureCollection',
                    features: [
                        {
                            type: 'Feature',
                            properties: {
                                test: { val: 5 },
                                Id: 0,
                                Name: 'SM',
                                TerrainMIN: 1,
                                TerrainMAX: 3,
                                Color: 2,
                            },
                            geometry: {
                                type: 'Polygon',
                                coordinates: [
                                    [
                                        [137.369142, -4.660629],
                                        [137.36558, -4.663731],
                                        [137.368755, -4.664565],
                                        [137.369142, -4.660629],
                                    ],
                                ],
                            },
                        },
                    ],
                },
                onClick: function (feature, lnglat, layer) {
                    console.log(feature, lnglat, layer)
                },
                useKeyAsHoverName: 'test.val', // string (dot-notated) of key path in feature properties to show on hover
                style: {
                    // Prefer feature[f].properties.style values
                    letPropertiesStyleOverride: false, // default false
                    default: {
                        fillColor: 'cyan', //Use only rgb and hex. No css color names
                        fillOpacity: 0.4,
                        color: 'black',
                        weight: 2,
                        radius: 'prop=radius',
                    },
                    point: {},
                    line: {},
                    polygon: {
                        canBecomeHighlighted: false, //default true
                        canBecomeActive: false, //default true
                    },
                    byProp: {
                        'prop=images.0.test:blue': {},
                    },
                },
                opacity: 1,
                minZoom: 11,
                maxZoom: 18,
                boundingBox: [
                    137.3250006349,
                    -4.72500217818315,
                    137.42500036372522,
                    -4.62500251269999,
                ],
                //preDrawn?: boolean //override all clamped tiles with pre drawn tiles
                //data?: { {z}: { {x}: { {y}: { pre_drawn_tile_canvas_data } }}} if preDrawn, use these tiles.
            })

            Litho.addLayer('vector', {
                name: 'vectorLine',
                order: 1,
                on: true,
                // GeoJSON or path to geojson
                // [lng, lat, elev?]
                geojson: {
                    type: 'FeatureCollection',
                    features: [
                        {
                            type: 'Feature',
                            properties: { SOL: 0, Site: 0, length: 25.99 },
                            geometry: {
                                type: 'LineString',
                                coordinates: [
                                    [137.36637024, -4.67291534, -4420],
                                    [137.3652909, -4.67169839, -4420],
                                ],
                            },
                        },
                    ],
                },
                //swapLL: false //swap the default long lat order to lat long
                useKeyAsHoverName: 'length',
                style: {
                    // Prefer feature[f].properties.style values
                    letPropertiesStyleOverride: false, // default false
                    default: {
                        fillColor: 'cyan', //Use only rgb and hex. No css color names
                        fillOpacity: 1,
                        color: 'white', //Not relevant for lines because fillColor is the primary color
                        weight: 6,
                        radius: 'prop=radius',
                    },
                    point: {},
                    line: {},
                    lineType: 'thick', // 'thin' || '<any_else_for_default>/thick' //note: only thick lines can be raytraced
                    polygon: {},
                    byProp: {
                        'prop=images.0.test:blue': {},
                    },
                },
                opacity: 1,
                minZoom: 11,
                maxZoom: 18,
            })
            //Litho.removeLayer('vectorLine')

            Litho.addLayer('vector', {
                name: 'vectorPoint',
                order: 2,
                on: true,
                // GeoJSON or path to geojson
                // [lng, lat, elev?]
                geojson: {
                    type: 'FeatureCollection',
                    features: [
                        {
                            type: 'Feature',
                            properties: { SOL: 0, Site: 0 },
                            geometry: {
                                type: 'Point',
                                coordinates: [
                                    137.3816330002655,
                                    -4.679466999693029,
                                    -4400.97070313,
                                ],
                            },
                        },
                        {
                            type: 'Feature',
                            properties: { SOL: 1, Site: 0 },
                            geometry: {
                                type: 'Point',
                                coordinates: [
                                    137.3796330002655,
                                    -4.676466999693029,
                                    -4399.37070313,
                                ],
                            },
                        },
                    ],
                },
                onClick: function (feature, lnglat, layer) {
                    console.log(feature, lnglat, layer)
                },
                useKeyAsHoverName: 'SOL',
                //swapLL: false //swap the default long lat order to lat long
                style: {
                    // Prefer feature[f].properties.style values
                    letPropertiesStyleOverride: false, // default false
                    default: {
                        fillColor: 'lime', //Use only rgb and hex. No css color names
                        fillOpacity: 1,
                        color: 'white',
                        weight: 2,
                        radius: 'prop=radius',
                    },
                    point: {
                        radius: 10,
                    },
                    line: {},
                    lineType: 'thick', // 'thick' || '<any_else_for_default>'
                    polygon: {},
                    byProp: {
                        'prop=images.0.test:blue': {},
                    },
                },
                opacity: 1,
                minZoom: 11,
                maxZoom: 18,
            })
            //Litho.removeLayer('vectorPoint')

            // "Curtains" are vertical 2D images draped from a line
            Litho.addLayer(
                'curtain',
                {
                    name: 'GroundPenetratingRadar',
                    on: true,
                    opacity: 1,
                    imagePath:
                        'http://localhost:8888/Missions/MTTT/Layers/GPR/ARIMFAX_0285_XM1_0285-profile-noaxis.png',
                    // depth of image in meters
                    depth: 10,
                    // length of image in meters
                    length: 62.35,
                    options: {
                        // optional
                        verticalExaggeration: 1, // default 1x
                        verticalOffset: 0, // default 0
                    },
                    // GeoJSON feature geometry that corresponds to the top of the curtain/image
                    lineGeometry: {
                        type: 'LineString',
                        coordinates: [
                            [137.36637024, -4.67291534, -4427],
                            [137.3652909, -4.67169839, -4427],
                        ],
                    },
                    onMouseMove: function (
                        e,
                        layer,
                        mesh,
                        intersection,
                        intersectedLngLat,
                        intersectionXYZ
                    ) {
                        // intersection.uv gives mouse's texture coords
                        //console.log(intersection.uv)
                    },
                },
                () => {
                    /*
                    console.log('Curtain loaded')
                    let exag = 1
                    setInterval(() => {
                        exag += 0.01
                        Litho.setLayerSpecificOptions(
                            'GroundPenetratingRadar',
                            {
                                verticalExaggeration: exag,
                                //verticalOffset: exag,
                            }
                        )
                    }, 100)
                    */
                }
            )

            /*
            Litho.addLayer(
                'model',
                {
                    name: 'roverGLTF',
                    order: 1,
                    on: true,
                    path:
                        'http://localhost:8888/Missions/MSL/Data/models/Perseverance.glb',
                    opacity: 0.5,
                    isArrayed: false, // default false // if true, position, scale and rotation are arrays for a series of models
                    position: {
                        longitude: 137.3572927368641, // default 0
                        latitude: -4.674971631163808, // default 0
                        elevation: -4443.613, // default 0
                    },
                    scale: 10, // default 1
                    rotation: {
                        // y-up is away from planet center. x is pitch, y is yaw, z is roll
                        x: Math.PI / 12, // in radians | default 0
                        y: Math.PI / 2, // default 0
                        z: 0, // default 0
                        order: 'YXZ', //default YXZ
                    },
                    cache: false, // default true // If true, uses cloned meshes from the first download
                },
                () => {
                    console.log('Rover loaded')
                    //Litho.setLayerOpacity('roverGLTF', 0.25)
                    //Litho.removeLayer('roverGLTF')
                    
                    //Litho.toggleLayer('roverGLTF', false)
                    //setTimeout(() => {
                    //    Litho.toggleLayer('roverGLTF', true)
                    //}, 10000)
                    
                }
            )
            */
            /*
            Litho.addLayer(
                'model',
                {
                    name: 'roverGLTFArrays',
                    order: 1,
                    on: true,
                    path:
                        'http://localhost:8888/Missions/MSL/Data/models/Perseverance.glb',
                    opacity: 0.5,
                    isArrayed: true, // default false // if true, position, scale and rotation can be arrays for a series of models layer (at least position must be an array now, performance may suffer)
                    position: Array.from({ length: 4 }, (v, i) => {
                        return {
                            longitude: 137.3572927368641 + (i % 3) * 0.001, // default 0
                            latitude:
                                -4.674971631163808 + Math.floor(i / 3) * 0.001, // default 0
                            elevation: -4435, // default 0
                        }
                    }),
                    
                    //[ 
                    //    {
                    //        longitude: 137.3572927368641, // default 0
                    //        latitude: -4.674971631163808, // default 0
                    //        elevation: -4300, // default 0
                    //    },
                    //    {
                    //        longitude: 137.3592927368641, // default 0
                    //        latitude: -4.674971631163808, // default 0
                    //        elevation: -4300, // default 0
                    //    },
                    //    {
                    //        longitude: 137.3612927368641, // default 0
                    //        latitude: -4.674971631163808, // default 0
                    //        elevation: -4443.613, // default 0
                    //    },
                    //],
                    
                    scale: 10, // default 1
                    rotation: {
                        // y-up is away from planet center. x is pitch, y is yaw, z is roll
                        x: Math.PI / 12, // in radians | default 0
                        y: Math.PI / 2, // default 0
                        z: 0, // default 0
                        order: 'YXZ', //default YXZ
                    },
                    cache: true, // default true // If true, uses cloned meshes from the first download
                },
                () => {
                    console.log('Rover Array loaded')
                    //Litho.setLayerOpacity('roverGLTF', 0.25)
                    //Litho.removeLayer('roverGLTF')
                    
                    //Litho.toggleLayer('roverGLTF', false)
                    //setTimeout(() => {
                        //Litho.toggleLayer('roverGLTF', true)
                    //}, 10000)
                    
                }
            )
            */
            /*
            Litho.addLayer('model', {
                name: 'moonOBJ',
                order: 1,
                on: true,
                path:
                    'http://localhost:8888/Missions/MSL/Data/models/moon/moon.obj',
                mtlPath:
                    'http://localhost:8888/Missions/MSL/Data/models/moon/moon.mtl',
                opacity: 1,
                position: {
                    longitude: 137.3572927368641, // default 0
                    latitude: -4.674971631163808, // default 0
                    elevation: -4000, // default 0
                },
                scale: 1, // default 1
                rotation: {
                    x: 0, // in radians | default 0
                    y: 0, // default 0
                    z: 0, // default 0
                },
            })
            Litho.addLayer('model', {
                name: 'whaleDAE',
                order: 1,
                on: true,
                path:
                    'http://localhost:8888/Missions/MSL/Data/models/Killer_Whale.dae',
                opacity: 1,
                position: {
                    longitude: 137.3582927368641, // default 0
                    latitude: -4.674971631163808, // default 0
                    elevation: -4420, // default 0
                },
                scale: 4, // default 1
                rotation: {
                    x: -Math.PI / 2, // in radians | default 0
                    y: 0, // default 0
                    z: 0, // default 0
                },
            })
            */

            Litho.addControl('myHome', Litho.controls.home)
            Litho.addControl('myExaggerate', Litho.controls.exaggerate)
            Litho.addControl('myNavigation', Litho.controls.navigation)
            Litho.addControl('myLayers', Litho.controls.layers)
            Litho.addControl('myObserve', Litho.controls.observe)
            Litho.addControl('myWalk', Litho.controls.walk)
            Litho.addControl('myCompass', Litho.controls.compass)
            Litho.addControl('myCoords', Litho.controls.coordinates, {
                existingDivId: 'myCustomCoordDiv',
            })
            const myLink = Litho.addControl('myLink', Litho.controls.link, {
                initiallyLinked: true,
                // callbacks
                onMove: (lng, lat, height) => {
                    /*React to globe move*/
                    //L_.Map_.resetView([lat, lng], true)
                },
                onMouseMove: (lng, lat, height) => {
                    //L_.Map_.setPlayerLookat(lng, lat)
                },
                onMouseOut: () => {
                    //L_.Map_.hidePlayer()
                },
                onToggle: (isLinked) => {},
                onFirstPersonUpdate: () => {
                    /*
                        const playerll = Litho.getCenter()
                        L_.Map_.setPlayerArrow(
                            playerll.lon,
                            playerll.lat,
                            (Litho.cameras.firstPerson.controls.getObject().rotation.y % (Math.PI * 2)) +
                                Math.PI
                        )
                        L_.Map_.setPlayerLookat(Globe_.mouseLngLat.Lng, Globe_.mouseLngLat.Lat)
                        */
                },
                onOrbitalUpdate: () => {
                    //L_.Map_.hidePlayer()
                },
            })
            /*
                Map_.map.on('move', (e) => {
                    const c = Map_.map.getCenter()
                    myLink.linkMove(c.lng, c.lat)
                })
                Map_.map.on('mousemove', (e) => {
                    myLink.linkMouseMove(e.latlng.lng, e.latlng.lat)
                })
                Map_.map.on('mouseout', (e) => {
                    myLink.linkMouseOut()
                })
                */
        </script>
    </body>
</html>
