!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LithoSphere",[],t):"object"==typeof exports?exports.LithoSphere=t():e.LithoSphere=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="C:\\Users\\tsoliman\\Documents\\Projects\\LithoSphere\\public/",n(n.s=16)}([function(e,t,n){"use strict";n.r(t),n.d(t,"earthRadius",(function(){return r})),n.d(t,"factors",(function(){return i})),n.d(t,"unitsFactors",(function(){return o})),n.d(t,"areaFactors",(function(){return a})),n.d(t,"feature",(function(){return s})),n.d(t,"geometry",(function(){return l})),n.d(t,"point",(function(){return c})),n.d(t,"points",(function(){return u})),n.d(t,"polygon",(function(){return h})),n.d(t,"polygons",(function(){return d})),n.d(t,"lineString",(function(){return f})),n.d(t,"lineStrings",(function(){return p})),n.d(t,"featureCollection",(function(){return m})),n.d(t,"multiLineString",(function(){return g})),n.d(t,"multiPoint",(function(){return v})),n.d(t,"multiPolygon",(function(){return y})),n.d(t,"geometryCollection",(function(){return b})),n.d(t,"round",(function(){return _})),n.d(t,"radiansToLength",(function(){return x})),n.d(t,"lengthToRadians",(function(){return w})),n.d(t,"lengthToDegrees",(function(){return M})),n.d(t,"bearingToAzimuth",(function(){return S})),n.d(t,"radiansToDegrees",(function(){return E})),n.d(t,"degreesToRadians",(function(){return T})),n.d(t,"convertLength",(function(){return C})),n.d(t,"convertArea",(function(){return A})),n.d(t,"isNumber",(function(){return L})),n.d(t,"isObject",(function(){return P})),n.d(t,"validateBBox",(function(){return R})),n.d(t,"validateId",(function(){return O}));var r=6371008.8,i={centimeters:100*r,centimetres:100*r,degrees:r/111325,feet:3.28084*r,inches:39.37*r,kilometers:r/1e3,kilometres:r/1e3,meters:r,metres:r,miles:r/1609.344,millimeters:1e3*r,millimetres:1e3*r,nauticalmiles:r/1852,radians:1,yards:r/1.0936},o={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r,yards:1/1.0936},a={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function s(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function l(e,t,n){switch(void 0===n&&(n={}),e){case"Point":return c(t).geometry;case"LineString":return f(t).geometry;case"Polygon":return h(t).geometry;case"MultiPoint":return v(t).geometry;case"MultiLineString":return g(t).geometry;case"MultiPolygon":return y(t).geometry;default:throw new Error(e+" is invalid")}}function c(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!L(e[0])||!L(e[1]))throw new Error("coordinates must contain numbers");return s({type:"Point",coordinates:e},t,n)}function u(e,t,n){return void 0===n&&(n={}),m(e.map((function(e){return c(e,t)})),n)}function h(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:e},t,n)}function d(e,t,n){return void 0===n&&(n={}),m(e.map((function(e){return h(e,t)})),n)}function f(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:e},t,n)}function p(e,t,n){return void 0===n&&(n={}),m(e.map((function(e){return f(e,t)})),n)}function m(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function g(e,t,n){return void 0===n&&(n={}),s({type:"MultiLineString",coordinates:e},t,n)}function v(e,t,n){return void 0===n&&(n={}),s({type:"MultiPoint",coordinates:e},t,n)}function y(e,t,n){return void 0===n&&(n={}),s({type:"MultiPolygon",coordinates:e},t,n)}function b(e,t,n){return void 0===n&&(n={}),s({type:"GeometryCollection",geometries:e},t,n)}function _(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function x(e,t){void 0===t&&(t="kilometers");var n=i[t];if(!n)throw new Error(t+" units is invalid");return e*n}function w(e,t){void 0===t&&(t="kilometers");var n=i[t];if(!n)throw new Error(t+" units is invalid");return e/n}function M(e,t){return E(w(e,t))}function S(e){var t=e%360;return t<0&&(t+=360),t}function E(e){return 180*(e%(2*Math.PI))/Math.PI}function T(e){return e%360*Math.PI/180}function C(e,t,n){if(void 0===t&&(t="kilometers"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return x(w(e,t),n)}function A(e,t,n){if(void 0===t&&(t="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=a[t];if(!r)throw new Error("invalid original units");var i=a[n];if(!i)throw new Error("invalid final units");return e/r*i}function L(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function P(e){return!!e&&e.constructor===Object}function R(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!L(e))throw new Error("bbox must only contain numbers")}))}function O(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}},function(e,t,n){"use strict";n.r(t),n.d(t,"coordEach",(function(){return i})),n.d(t,"coordReduce",(function(){return o})),n.d(t,"propEach",(function(){return a})),n.d(t,"propReduce",(function(){return s})),n.d(t,"featureEach",(function(){return l})),n.d(t,"featureReduce",(function(){return c})),n.d(t,"coordAll",(function(){return u})),n.d(t,"geomEach",(function(){return h})),n.d(t,"geomReduce",(function(){return d})),n.d(t,"flattenEach",(function(){return f})),n.d(t,"flattenReduce",(function(){return p})),n.d(t,"segmentEach",(function(){return m})),n.d(t,"segmentReduce",(function(){return g})),n.d(t,"lineEach",(function(){return v})),n.d(t,"lineReduce",(function(){return y})),n.d(t,"findSegment",(function(){return b})),n.d(t,"findPoint",(function(){return _}));var r=n(0);function i(e,t,n){if(null!==e)for(var r,o,a,s,l,c,u,h,d=0,f=0,p=e.type,m="FeatureCollection"===p,g="Feature"===p,v=m?e.features.length:1,y=0;y<v;y++){l=(h=!!(u=m?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var b=0;b<l;b++){var _=0,x=0;if(null!==(s=h?u.geometries[b]:u)){c=s.coordinates;var w=s.type;switch(d=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(c,f,y,_,x))return!1;f++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(!1===t(c[r],f,y,_,x))return!1;f++,"MultiPoint"===w&&_++}"LineString"===w&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(o=0;o<c[r].length-d;o++){if(!1===t(c[r][o],f,y,_,x))return!1;f++}"MultiLineString"===w&&_++,"Polygon"===w&&x++}"Polygon"===w&&_++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(x=0,o=0;o<c[r].length;o++){for(a=0;a<c[r][o].length-d;a++){if(!1===t(c[r][o][a],f,y,_,x))return!1;f++}x++}_++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t,n,r){var o=n;return i(e,(function(e,r,i,a,s){o=0===r&&void 0===n?e:t(o,e,r,i,a,s)}),r),o}function a(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&!1!==t(e.features[n].properties,n);n++);break;case"Feature":t(e.properties,0)}}function s(e,t,n){var r=n;return a(e,(function(e,i){r=0===i&&void 0===n?e:t(r,e,i)})),r}function l(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function c(e,t,n){var r=n;return l(e,(function(e,i){r=0===i&&void 0===n?e:t(r,e,i)})),r}function u(e){var t=[];return i(e,(function(e){t.push(e)})),t}function h(e,t){var n,r,i,o,a,s,l,c,u,h,d=0,f="FeatureCollection"===e.type,p="Feature"===e.type,m=f?e.features.length:1;for(n=0;n<m;n++){for(s=f?e.features[n].geometry:p?e.geometry:e,c=f?e.features[n].properties:p?e.properties:{},u=f?e.features[n].bbox:p?e.bbox:void 0,h=f?e.features[n].id:p?e.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=l?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function d(e,t,n){var r=n;return h(e,(function(e,i,o,a,s){r=0===i&&void 0===n?e:t(r,e,i,o,a,s)})),r}function f(e,t){h(e,(function(e,n,i,o,a){var s,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Object(r.feature)(e,i,{bbox:o,id:a}),n,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u={type:s,coordinates:e.coordinates[c]};if(!1===t(Object(r.feature)(u,i),n,c))return!1}}))}function p(e,t,n){var r=n;return f(e,(function(e,i,o){r=0===i&&0===o&&void 0===n?e:t(r,e,i,o)})),r}function m(e,t){f(e,(function(e,n,o){var a=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var l,c=0,u=0,h=0;return!1!==i(e,(function(i,s,d,f,p){if(void 0===l||n>c||f>u||p>h)return l=i,c=n,u=f,h=p,void(a=0);var m=Object(r.lineString)([l,i],e.properties);if(!1===t(m,n,o,p,a))return!1;a++,l=i}))&&void 0}}}))}function g(e,t,n){var r=n,i=!1;return m(e,(function(e,o,a,s,l){r=!1===i&&void 0===n?e:t(r,e,o,a,s,l),i=!0})),r}function v(e,t){if(!e)throw new Error("geojson is required");f(e,(function(e,n,i){if(null!==e.geometry){var o=e.geometry.type,a=e.geometry.coordinates;switch(o){case"LineString":if(!1===t(e,n,i,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===t(Object(r.lineString)(a[s],e.properties),n,i,s))return!1}}}))}function y(e,t,n){var r=n;return v(e,(function(e,i,o,a){r=0===i&&void 0===n?e:t(r,e,i,o,a)})),r}function b(e,t){if(t=t||{},!Object(r.isObject)(t))throw new Error("options is invalid");var n,i=t.featureIndex||0,o=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.segmentIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),l=l||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":l=l||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var c=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=c.length+s-1),Object(r.lineString)([c[s],c[s+1]],l,t);case"Polygon":return a<0&&(a=c.length+a),s<0&&(s=c[a].length+s-1),Object(r.lineString)([c[a][s],c[a][s+1]],l,t);case"MultiLineString":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s-1),Object(r.lineString)([c[o][s],c[o][s+1]],l,t);case"MultiPolygon":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),s<0&&(s=c[o][a].length-s-1),Object(r.lineString)([c[o][a][s],c[o][a][s+1]],l,t)}throw new Error("geojson is invalid")}function _(e,t){if(t=t||{},!Object(r.isObject)(t))throw new Error("options is invalid");var n,i=t.featureIndex||0,o=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.coordIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),l=l||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":l=l||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var c=n.coordinates;switch(n.type){case"Point":return Object(r.point)(c,l,t);case"MultiPoint":return o<0&&(o=c.length+o),Object(r.point)(c[o],l,t);case"LineString":return s<0&&(s=c.length+s),Object(r.point)(c[s],l,t);case"Polygon":return a<0&&(a=c.length+a),s<0&&(s=c[a].length+s),Object(r.point)(c[a][s],l,t);case"MultiLineString":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),Object(r.point)(c[o][s],l,t);case"MultiPolygon":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),s<0&&(s=c[o][a].length-s),Object(r.point)(c[o][a][s],l,t)}throw new Error("geojson is invalid")}},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,i="/"===a.charAt(0))}return(i?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),a="/"===i(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&a&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),a=Math.min(i.length,o.length),s=a,l=0;l<a;l++)if(i[l]!==o[l]){s=l;break}var c=[];for(l=s;l<i.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===r&&(i=!1,r=a+1),46===s?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){n=a+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(11))},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,n){"use strict";var r,i=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),a=[];function s(e){for(var t=-1,n=0;n<a.length;n++)if(a[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},r=[],i=0;i<e.length;i++){var o=e[i],l=t.base?o[0]+t.base:o[0],c=n[l]||0,u="".concat(l," ").concat(c);n[l]=c+1;var h=s(u),d={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(a[h].references++,a[h].updater(d)):a.push({identifier:u,updater:g(d,t),references:1}),r.push(u)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=o(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,h=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=h(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function f(e,t,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var p=null,m=0;function g(e,t){var n,r,i;if(t.singleton){var o=m++;n=p||(p=c(t)),r=d.bind(null,n,o,!1),i=d.bind(null,n,o,!0)}else n=c(t),r=f.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=i());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var i=s(n[r]);a[i].references--}for(var o=l(e,t),c=0;c<n.length;c++){var u=s(n[c]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}n=o}}}},function(e,t,n){parcelRequire=function(t,r,i,o){var a,s="function"==typeof parcelRequire&&parcelRequire;function l(e,i){if(!r[e]){if(!t[e]){var o="function"==typeof parcelRequire&&parcelRequire;if(!i&&o)return o(e,!0);if(s)return s(e,!0);if("string"==typeof e)return n(7)(e);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}u.resolve=function(n){return t[e][1][n]||n},u.cache={};var c=r[e]=new l.Module(e);t[e][0].call(c.exports,u,c,c.exports,this)}return r[e].exports;function u(e){return l(u.resolve(e))}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=t,l.cache=r,l.parent=s,l.register=function(e,n){t[e]=[function(e,t){t.exports=n},{}]};for(var c=0;c<i.length;c++)try{l(i[c])}catch(t){a||(a=t)}if(i.length){var u=l(i[i.length-1]);e.exports=u}if(parcelRequire=l,a)throw a;return l}({QVnC:[function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),a=new C(r||[]);return o._invoke=function(e,t,n){var r=u;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw o;return L()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var l=c(e,t,n);if("normal"===l.type){if(r=n.done?f:h,l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=f,n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u="suspendedStart",h="suspendedYield",d="executing",f="completed",p={};function m(){}function g(){}function v(){}var y={};y[o]=function(){return this};var b=Object.getPrototypeOf,_=b&&b(b(A([])));_&&_!==n&&r.call(_,o)&&(y=_);var x=v.prototype=m.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function M(e,t){var n;this._invoke=function(i,o){function a(){return new t((function(n,a){!function n(i,o,a,s){var l=c(e[i],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:L}}function L(){return{value:t,done:!0}}return g.prototype=x.constructor=v,v.constructor=g,v[s]=g.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},w(M.prototype),M.prototype[a]=function(){return this},e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(x),x[s]="Generator",x[o]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},{}],PMvg:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":"QVnC"}],IxO8:[function(e,t,n){t.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},{}],OUZ9:[function(e,t,n){t.exports=function(e){if(Array.isArray(e))return e}},{}],vKPt:[function(e,t,n){t.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},{}],NVR6:[function(e,t,n){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},{}],UyFj:[function(e,t,n){var r=e("./arrayLikeToArray");t.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},{"./arrayLikeToArray":"NVR6"}],Rom6:[function(e,t,n){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],HETk:[function(e,t,n){var r=e("./arrayWithHoles"),i=e("./iterableToArrayLimit"),o=e("./unsupportedIterableToArray"),a=e("./nonIterableRest");t.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()}},{"./arrayWithHoles":"OUZ9","./iterableToArrayLimit":"vKPt","./unsupportedIterableToArray":"UyFj","./nonIterableRest":"Rom6"}],agGE:[function(e,t,n){function r(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}t.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,l,"next",e)}function l(e){r(a,i,o,s,l,"throw",e)}s(void 0)}))}}},{}],P8NW:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},{}],AkAO:[function(e,t,n){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,n)}t.exports=r},{}],d4H2:[function(e,t,n){var r=e("./setPrototypeOf");t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},{"./setPrototypeOf":"AkAO"}],b9XL:[function(e,t,n){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r},{}],E7HD:[function(e,t,n){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},{}],pxk2:[function(e,t,n){var r=e("../helpers/typeof"),i=e("./assertThisInitialized");t.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},{"../helpers/typeof":"b9XL","./assertThisInitialized":"E7HD"}],UJE0:[function(e,t,n){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r},{}],vNP7:[function(e,t,n){t.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},{}],QFb6:[function(e,t,n){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}},{}],dJhE:[function(e,t,n){var r=e("./setPrototypeOf"),i=e("./isNativeReflectConstruct");function o(e,n,a){return i()?t.exports=o=Reflect.construct:t.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}t.exports=o},{"./setPrototypeOf":"AkAO","./isNativeReflectConstruct":"QFb6"}],ozpi:[function(e,t,n){var r=e("./getPrototypeOf"),i=e("./setPrototypeOf"),o=e("./isNativeFunction"),a=e("./construct");function s(e){var n="function"==typeof Map?new Map:void 0;return t.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},s(e)}t.exports=s},{"./getPrototypeOf":"UJE0","./setPrototypeOf":"AkAO","./isNativeFunction":"vNP7","./construct":"dJhE"}],fcMS:[function(e,t,n){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],GG94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.roundToFloat16Bits=function(e){i[0]=e;const t=o[0],n=t>>23&511;return a[n]+((8388607&t)>>s[n])},n.convertToNumber=function(e){const t=e>>10;return o[0]=l[u[t]+(1023&e)]+c[t],i[0]};const r=new ArrayBuffer(4),i=new Float32Array(r),o=new Uint32Array(r),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):t<-14?(a[0|e]=1024>>-t-14,a[256|e]=1024>>-t-14|32768,s[0|e]=-t-1,s[256|e]=-t-1):t<=15?(a[0|e]=t+15<<10,a[256|e]=t+15<<10|32768,s[0|e]=13,s[256|e]=13):t<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}const l=new Uint32Array(2048),c=new Uint32Array(64),u=new Uint32Array(64);l[0]=0;for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;t&=-8388609,n+=947912704,l[e]=t|n}for(let e=1024;e<2048;++e)l[e]=939524096+(e-1024<<13);c[0]=0;for(let e=1;e<31;++e)c[e]=e<<23;c[31]=1199570944,c[32]=2147483648;for(let e=33;e<63;++e)c[e]=2147483648+(e-32<<23);c[63]=3347054592,u[0]=0;for(let e=1;e<64;++e)u[e]=32===e?0:1024},{}],G4sf:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;const t=(0,r.roundToFloat16Bits)(e);return(0,r.convertToNumber)(t)};var r=e("./lib")},{"./lib":"GG94"}],xQUP:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToInteger=function(e){return"number"!=typeof e&&(e=Number(e)),Number.isNaN(e)&&(e=0),Math.trunc(e)},n.defaultCompareFunction=function(e,t){const[n,r]=[Number.isNaN(e),Number.isNaN(t)];if(n&&r)return 0;if(n)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){const[n,r]=[Object.is(e,0),Object.is(t,0)];if(!n&&r)return-1;if(n&&!r)return 1}return 0}},{}],iJ7y:[function(e,t,n){var r=arguments[3];Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i="object"==typeof r&&r&&r.Object===Object&&r,o=i;n.default=o},{}],ygki:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_freeGlobal.js")),i="object"==typeof self&&self&&self.Object===Object&&self,o=r.default||i||Function("return this")();n.default=o},{"./_freeGlobal.js":"iJ7y"}],Oi8n:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_root.js")).default.Symbol;n.default=r},{"./_root.js":"ygki"}],InRc:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_Symbol.js")),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r.default?r.default.toStringTag:void 0;n.default=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},{"./_Symbol.js":"Oi8n"}],iwg4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=Object.prototype.toString;n.default=function(e){return r.call(e)}},{}],svpX:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./_Symbol.js")),i=a(e("./_getRawTag.js")),o=a(e("./_objectToString.js"));function a(e){return e&&e.__esModule?e:{default:e}}var s=r.default?r.default.toStringTag:void 0;n.default=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?(0,i.default)(e):(0,o.default)(e)}},{"./_Symbol.js":"Oi8n","./_getRawTag.js":"InRc","./_objectToString.js":"iwg4"}],UKR9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){return null!=e&&"object"==typeof e}},{}],MYZg:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("./_baseGetTag.js")),i=o(e("./isObjectLike.js"));function o(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){return(0,i.default)(e)&&"[object ArrayBuffer]"==(0,r.default)(e)}},{"./_baseGetTag.js":"svpX","./isObjectLike.js":"UKR9"}],pmj6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){return function(t){return e(t)}}},{}],oPFz:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_freeGlobal.js")),i="object"==typeof n&&n&&!n.nodeType&&n,o=i&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===i&&r.default.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();n.default=s},{"./_freeGlobal.js":"iJ7y"}],rXXV:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./_baseIsArrayBuffer.js")),i=a(e("./_baseUnary.js")),o=a(e("./_nodeUtil.js"));function a(e){return e&&e.__esModule?e:{default:e}}var s=o.default&&o.default.isArrayBuffer,l=s?(0,i.default)(s):r.default;n.default=l},{"./_baseIsArrayBuffer.js":"MYZg","./_baseUnary.js":"pmj6","./_nodeUtil.js":"oPFz"}],XYHx:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isDataView=function(e){return e instanceof DataView},n.isStringNumberKey=function(e){return"string"==typeof e&&e===(0,r.ToInteger)(e)+""},Object.defineProperty(n,"isArrayBuffer",{enumerable:!0,get:function(){return i.default}});var r=e("./spec"),i=function(e){return e&&e.__esModule?e:{default:e}}(e("lodash-es/isArrayBuffer"))},{"./spec":"xQUP","lodash-es/isArrayBuffer":"rXXV"}],EEXG:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createPrivateStorage=function(){const e=new WeakMap;return t=>{let n=e.get(t);return n||(n=Object.create(null),e.set(t,n),n)}}},{}],DTZk:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},{}],tWvT:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("./_baseGetTag.js")),i=o(e("./isObject.js"));function o(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){if(!(0,i.default)(e))return!1;var t=(0,r.default)(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},{"./_baseGetTag.js":"svpX","./isObject.js":"DTZk"}],xFkS:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_root.js")).default["__core-js_shared__"];n.default=r},{"./_root.js":"ygki"}],pULC:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_coreJsData.js")),i=function(){var e=/[^.]+$/.exec(r.default&&r.default.keys&&r.default.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();n.default=function(e){return!!i&&i in e}},{"./_coreJsData.js":"xFkS"}],UKJK:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=Function.prototype.toString;n.default=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},{}],Zczf:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=s(e("./isFunction.js")),i=s(e("./_isMasked.js")),o=s(e("./isObject.js")),a=s(e("./_toSource.js"));function s(e){return e&&e.__esModule?e:{default:e}}var l=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,h=c.toString,d=u.hasOwnProperty,f=RegExp("^"+h.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.default=function(e){return!(!(0,o.default)(e)||(0,i.default)(e))&&((0,r.default)(e)?f:l).test((0,a.default)(e))}},{"./isFunction.js":"tWvT","./_isMasked.js":"pULC","./isObject.js":"DTZk","./_toSource.js":"UKJK"}],ZVQn:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e,t){return null==e?void 0:e[t]}},{}],tx41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("./_baseIsNative.js")),i=o(e("./_getValue.js"));function o(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t){var n=(0,i.default)(e,t);return(0,r.default)(n)?n:void 0}},{"./_baseIsNative.js":"Zczf","./_getValue.js":"ZVQn"}],YsDH:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=(0,function(e){return e&&e.__esModule?e:{default:e}}(e("./_getNative.js")).default)(Object,"create");n.default=r},{"./_getNative.js":"tx41"}],sJnX:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_nativeCreate.js"));n.default=function(){this.__data__=r.default?(0,r.default)(null):{},this.size=0}},{"./_nativeCreate.js":"YsDH"}],c9sB:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},{}],zYTU:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_nativeCreate.js")),i=Object.prototype.hasOwnProperty;n.default=function(e){var t=this.__data__;if(r.default){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},{"./_nativeCreate.js":"YsDH"}],ZFwF:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_nativeCreate.js")),i=Object.prototype.hasOwnProperty;n.default=function(e){var t=this.__data__;return r.default?void 0!==t[e]:i.call(t,e)}},{"./_nativeCreate.js":"YsDH"}],i3LK:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_nativeCreate.js"));n.default=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r.default&&void 0===t?"__lodash_hash_undefined__":t,this}},{"./_nativeCreate.js":"YsDH"}],tE4I:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("./_hashClear.js")),i=l(e("./_hashDelete.js")),o=l(e("./_hashGet.js")),a=l(e("./_hashHas.js")),s=l(e("./_hashSet.js"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r.default,c.prototype.delete=i.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=s.default;var u=c;n.default=u},{"./_hashClear.js":"sJnX","./_hashDelete.js":"c9sB","./_hashGet.js":"zYTU","./_hashHas.js":"ZFwF","./_hashSet.js":"i3LK"}],cHCQ:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){this.__data__=[],this.size=0}},{}],SRq7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e,t){return e===t||e!=e&&t!=t}},{}],Hp84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./eq.js"));n.default=function(e,t){for(var n=e.length;n--;)if((0,r.default)(e[n][0],t))return n;return-1}},{"./eq.js":"SRq7"}],NMSb:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_assocIndexOf.js")),i=Array.prototype.splice;n.default=function(e){var t=this.__data__,n=(0,r.default)(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},{"./_assocIndexOf.js":"Hp84"}],P9vD:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_assocIndexOf.js"));n.default=function(e){var t=this.__data__,n=(0,r.default)(t,e);return n<0?void 0:t[n][1]}},{"./_assocIndexOf.js":"Hp84"}],mbsC:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_assocIndexOf.js"));n.default=function(e){return(0,r.default)(this.__data__,e)>-1}},{"./_assocIndexOf.js":"Hp84"}],GGNI:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_assocIndexOf.js"));n.default=function(e,t){var n=this.__data__,i=(0,r.default)(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},{"./_assocIndexOf.js":"Hp84"}],UlXa:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("./_listCacheClear.js")),i=l(e("./_listCacheDelete.js")),o=l(e("./_listCacheGet.js")),a=l(e("./_listCacheHas.js")),s=l(e("./_listCacheSet.js"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r.default,c.prototype.delete=i.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=s.default;var u=c;n.default=u},{"./_listCacheClear.js":"cHCQ","./_listCacheDelete.js":"NMSb","./_listCacheGet.js":"P9vD","./_listCacheHas.js":"mbsC","./_listCacheSet.js":"GGNI"}],hhFe:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("./_getNative.js")),i=o(e("./_root.js"));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,r.default)(i.default,"Map");n.default=a},{"./_getNative.js":"tx41","./_root.js":"ygki"}],S4lD:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./_Hash.js")),i=a(e("./_ListCache.js")),o=a(e("./_Map.js"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(){this.size=0,this.__data__={hash:new r.default,map:new(o.default||i.default),string:new r.default}}},{"./_Hash.js":"tE4I","./_ListCache.js":"UlXa","./_Map.js":"hhFe"}],yCDP:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},{}],QOd1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_isKeyable.js"));n.default=function(e,t){var n=e.__data__;return(0,r.default)(t)?n["string"==typeof t?"string":"hash"]:n.map}},{"./_isKeyable.js":"yCDP"}],kigP:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_getMapData.js"));n.default=function(e){var t=(0,r.default)(this,e).delete(e);return this.size-=t?1:0,t}},{"./_getMapData.js":"QOd1"}],uJAD:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_getMapData.js"));n.default=function(e){return(0,r.default)(this,e).get(e)}},{"./_getMapData.js":"QOd1"}],h8gm:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_getMapData.js"));n.default=function(e){return(0,r.default)(this,e).has(e)}},{"./_getMapData.js":"QOd1"}],VMmx:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_getMapData.js"));n.default=function(e,t){var n=(0,r.default)(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},{"./_getMapData.js":"QOd1"}],Ov7L:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("./_mapCacheClear.js")),i=l(e("./_mapCacheDelete.js")),o=l(e("./_mapCacheGet.js")),a=l(e("./_mapCacheHas.js")),s=l(e("./_mapCacheSet.js"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r.default,c.prototype.delete=i.default,c.prototype.get=o.default,c.prototype.has=a.default,c.prototype.set=s.default;var u=c;n.default=u},{"./_mapCacheClear.js":"S4lD","./_mapCacheDelete.js":"kigP","./_mapCacheGet.js":"uJAD","./_mapCacheHas.js":"h8gm","./_mapCacheSet.js":"VMmx"}],mNqw:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./_MapCache.js"));function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r.default),n}i.Cache=r.default;var o=i;n.default=o},{"./_MapCache.js":"Ov7L"}],cSEU:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isTypedArrayIndexedPropertyWritable=void 0;const r=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;n.isTypedArrayIndexedPropertyWritable=r},{}],ZpG8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./spec"),i=e("./is"),o=e("./private"),a=function(e){return e&&e.__esModule?e:{default:e}}(e("lodash-es/memoize")),s=e("./lib"),l=e("./bug");const c=(0,o.createPrivateStorage)();function u(e){return e instanceof m}function h(e){if(!u(e))throw new TypeError("This is not a Float16Array")}function d(e){const t=e.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=(0,s.convertToNumber)(e[r]);return n}const f={apply:(e,t,n)=>u(t)&&function(e){return"function"==typeof e&&v.has(e)}(e)?Reflect.apply(e,c(t).target,n):Reflect.apply(e,t,n)},p={get(e,t){let n=null;if(l.isTypedArrayIndexedPropertyWritable||(e=c(n=e).target),(0,i.isStringNumberKey)(t))return Reflect.has(e,t)?(0,s.convertToNumber)(Reflect.get(e,t)):void 0;{const r=null!==n&&Reflect.has(n,t)?Reflect.get(n,t):Reflect.get(e,t);if("function"!=typeof r)return r;let i=c(r).proxy;return void 0===i&&(i=c(r).proxy=new Proxy(r,f)),i}},set(e,t,n){let r=null;return l.isTypedArrayIndexedPropertyWritable||(e=c(r=e).target),(0,i.isStringNumberKey)(t)?Reflect.set(e,t,(0,s.roundToFloat16Bits)(n)):null===r||Reflect.has(e,t)&&!Object.isFrozen(r)?Reflect.set(e,t,n):Reflect.set(r,t,n)}};l.isTypedArrayIndexedPropertyWritable||(p.getPrototypeOf=e=>Reflect.getPrototypeOf(c(e).target),p.setPrototypeOf=(e,t)=>Reflect.setPrototypeOf(c(e).target,t),p.defineProperty=(e,t,n)=>{const r=c(e).target;return!Reflect.has(r,t)||Object.isFrozen(e)?Reflect.defineProperty(e,t,n):Reflect.defineProperty(r,t,n)},p.deleteProperty=(e,t)=>{const n=c(e).target;return Reflect.has(e,t)?Reflect.deleteProperty(e,t):Reflect.deleteProperty(n,t)},p.has=(e,t)=>Reflect.has(e,t)||Reflect.has(c(e).target,t),p.isExtensible=e=>Reflect.isExtensible(e),p.preventExtensions=e=>Reflect.preventExtensions(e),p.getOwnPropertyDescriptor=(e,t)=>Reflect.getOwnPropertyDescriptor(e,t),p.ownKeys=e=>Reflect.ownKeys(e));class m extends Uint16Array{constructor(e,t,n){if(u(e))super(c(e).target);else if(null===e||"object"!=typeof e||(0,i.isArrayBuffer)(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,t);break;case 3:super(e,t,n);break;default:super(...arguments)}else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],n=t.length;super(n);for(let e=0;e<n;++e)this[e]=(0,s.roundToFloat16Bits)(t[e])}let r;if(l.isTypedArrayIndexedPropertyWritable)r=new Proxy(this,p);else{const e=Object.create(null);c(e).target=this,r=new Proxy(e,p)}return c(r).target=this,c(this).proxy=r,r}static from(e,...t){if(0===t.length)return new m(Uint16Array.from(e,s.roundToFloat16Bits).buffer);const n=t[0],r=t[1];return new m(Uint16Array.from(e,(function(e,...t){return(0,s.roundToFloat16Bits)(n.call(this,e,...t))}),r).buffer)}static of(...e){return new m(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield(0,s.convertToNumber)(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield(0,s.convertToNumber)(e)}*entries(){for(const[e,t]of super.entries())yield[e,(0,s.convertToNumber)(t)]}map(e,...t){h(this);const n=t[0],r=[];for(let t=0,i=this.length;t<i;++t){const i=(0,s.convertToNumber)(this[t]);r.push(e.call(n,i,t,c(this).proxy))}return new m(r)}filter(e,...t){h(this);const n=t[0],r=[];for(let t=0,i=this.length;t<i;++t){const i=(0,s.convertToNumber)(this[t]);e.call(n,i,t,c(this).proxy)&&r.push(i)}return new m(r)}reduce(e,...t){let n,r;h(this),0===t.length?(n=(0,s.convertToNumber)(this[0]),r=1):(n=t[0],r=0);for(let t=r,i=this.length;t<i;++t)n=e(n,(0,s.convertToNumber)(this[t]),t,c(this).proxy);return n}reduceRight(e,...t){let n,r;h(this);const i=this.length;0===t.length?(n=(0,s.convertToNumber)(this[i-1]),r=i-1):(n=t[0],r=i);for(let t=r;t--;)n=e(n,(0,s.convertToNumber)(this[t]),t,c(this).proxy);return n}forEach(e,...t){h(this);const n=t[0];for(let t=0,r=this.length;t<r;++t)e.call(n,(0,s.convertToNumber)(this[t]),t,c(this).proxy)}find(e,...t){h(this);const n=t[0];for(let t=0,r=this.length;t<r;++t){const r=(0,s.convertToNumber)(this[t]);if(e.call(n,r,t,c(this).proxy))return r}}findIndex(e,...t){h(this);const n=t[0];for(let t=0,r=this.length;t<r;++t){const r=(0,s.convertToNumber)(this[t]);if(e.call(n,r,t,c(this).proxy))return t}return-1}every(e,...t){h(this);const n=t[0];for(let t=0,r=this.length;t<r;++t)if(!e.call(n,(0,s.convertToNumber)(this[t]),t,c(this).proxy))return!1;return!0}some(e,...t){h(this);const n=t[0];for(let t=0,r=this.length;t<r;++t)if(e.call(n,(0,s.convertToNumber)(this[t]),t,c(this).proxy))return!0;return!1}set(e,...t){h(this);const n=t[0];let r;if(u(e))r=c(e).target;else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],n=t.length;r=new Uint16Array(n);for(let e=0,n=t.length;e<n;++e)r[e]=(0,s.roundToFloat16Bits)(t[e])}super.set(r,n)}reverse(){return h(this),super.reverse(),c(this).proxy}fill(e,...t){return h(this),super.fill((0,s.roundToFloat16Bits)(e),...t),c(this).proxy}copyWithin(e,t,...n){return h(this),super.copyWithin(e,t,...n),c(this).proxy}sort(...e){h(this);let t=e[0];void 0===t&&(t=r.defaultCompareFunction);const n=(0,a.default)(s.convertToNumber);return super.sort((e,r)=>t(n(e),n(r))),c(this).proxy}slice(...e){let t;h(this);try{t=super.slice(...e)}catch(n){if(!(n instanceof TypeError))throw n;t=new Uint16Array(this.buffer,this.byteOffset,this.length).slice(...e)}return new m(t.buffer)}subarray(...e){let t;h(this);try{t=super.subarray(...e)}catch(n){if(!(n instanceof TypeError))throw n;t=new Uint16Array(this.buffer,this.byteOffset,this.length).subarray(...e)}return new m(t.buffer,t.byteOffset,t.length)}indexOf(e,...t){h(this);const n=this.length;let i=(0,r.ToInteger)(t[0]);i<0&&(i+=n)<0&&(i=0);for(let t=i,r=n;t<r;++t)if((0,s.convertToNumber)(this[t])===e)return t;return-1}lastIndexOf(e,...t){h(this);const n=this.length;let i=(0,r.ToInteger)(t[0]);(i=0===i?n:i+1)>=0?i=i<n?i:n:i+=n;for(let t=i;t--;)if((0,s.convertToNumber)(this[t])===e)return t;return-1}includes(e,...t){h(this);const n=this.length;let i=(0,r.ToInteger)(t[0]);i<0&&(i+=n)<0&&(i=0);const o=Number.isNaN(e);for(let t=i,r=n;t<r;++t){const n=(0,s.convertToNumber)(this[t]);if(o&&Number.isNaN(n))return!0;if(n===e)return!0}return!1}join(...e){return h(this),d(this).join(...e)}toLocaleString(...e){return h(this),d(this).toLocaleString(...e)}get[Symbol.toStringTag](){if(u(this))return"Float16Array"}}n.default=m;const g=m.prototype,v=new WeakSet;for(const e of Reflect.ownKeys(g)){const t=g[e];"function"==typeof t&&v.add(t)}},{"./spec":"xQUP","./is":"XYHx","./private":"EEXG","lodash-es/memoize":"mNqw","./lib":"GG94","./bug":"cSEU"}],q489:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getFloat16=function(e,t,...n){if(!(0,r.isDataView)(e))throw new TypeError("First argument to getFloat16 function must be a DataView");return(0,i.convertToNumber)(e.getUint16(t,...n))},n.setFloat16=function(e,t,n,...o){if(!(0,r.isDataView)(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(t,(0,i.roundToFloat16Bits)(n),...o)};var r=e("./is"),i=e("./lib")},{"./is":"XYHx","./lib":"GG94"}],Stm8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"hfround",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"Float16Array",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"getFloat16",{enumerable:!0,get:function(){return o.getFloat16}}),Object.defineProperty(n,"setFloat16",{enumerable:!0,get:function(){return o.setFloat16}});var r=a(e("./hfround")),i=a(e("./Float16Array")),o=e("./dataView.js");function a(e){return e&&e.__esModule?e:{default:e}}},{"./hfround":"G4sf","./Float16Array":"ZpG8","./dataView.js":"q489"}],rDCW:[function(e,t,n){},{}],FRpO:[function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var i,o,a;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,function(e){console&&console.warn&&console.warn(e)}(s)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var c=l.length,u=g(l,c);for(n=0;n<c;++n)o(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return h(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return h(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},{}],ExO1:[function(e,t,n){t.exports=e("events").EventEmitter},{events:"FRpO"}],yh9p:[function(e,t,n){"use strict";n.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=c(e),a=r[0],s=r[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),u=0,h=s>0?a-4:a;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(h(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function h(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(u(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],JgNJ:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=s;u>0;o=256*o+e[t+h],h+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=c}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(t*l-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+f]=255&a,f+=p,a/=256,c-=8);e[n+f-p]|=128*m}},{}],REa7:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],dskh:[function(e,t,n){var r=arguments[3],i=e("base64-js"),o=e("ieee754"),a=e("isarray");function s(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function l(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function c(e,t){if(l()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return p(this,e)}return h(this,e,t,n)}function h(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?v(e,t,n,r):"string"==typeof t?m(e,t,n):y(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t,n,r){return d(t),t<=0?c(e,t):void 0!==n?"string"==typeof r?c(e,t).fill(n,r):c(e,t).fill(n):c(e,t)}function p(e,t){if(d(t),e=c(e,t<0?0:0|b(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function m(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|x(t,n),i=(e=c(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}function g(e,t){var n=t.length<0?0:0|b(t.length);e=c(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function v(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=g(e,t),e}function y(e,t){if(u.isBuffer(t)){var n=0|b(t.length);return 0===(e=c(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||ne(t.length)?c(e,0):g(e,t);if("Buffer"===t.type&&a(t.data))return g(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function b(e){if(e>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),u.alloc(+e)}function x(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return K(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ee(e).length;default:if(r)return K(e).length;t=(""+t).toLowerCase(),r=!0}}function w(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return N(this,t,n);case"latin1":case"binary":return j(this,t,n);case"base64":return O(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function M(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function S(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:E(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):E(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function E(e,t,n,r,i){var o,a=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return-1}function T(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function C(e,t,n,r){return te(K(t,e.length-n),e,n,r)}function A(e,t,n,r){return te(Q(t),e,n,r)}function L(e,t,n,r){return A(e,t,n,r)}function P(e,t,n,r){return te(ee(t),e,n,r)}function R(e,t,n,r){return te($(t,e.length-n),e,n,r)}function O(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return D(r)}n.Buffer=u,n.SlowBuffer=_,n.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:s(),n.kMaxLength=l(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return h(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return f(null,e,t,n)},u.allocUnsafe=function(e){return p(null,e)},u.allocUnsafeSlow=function(e){return p(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=x,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)M(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)M(this,t,t+3),M(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)M(this,t,t+7),M(this,t+1,t+6),M(this,t+2,t+5),M(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):w.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(r,i),c=e.slice(t,n),h=0;h<s;++h)if(l[h]!==c[h]){o=l[h],a=c[h];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return S(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return S(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return L(this,e,t,n);case"base64":return P(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function D(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=I));return n}function N(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function j(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function F(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=J(e[o]);return i}function B(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function z(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function H(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function G(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function W(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function V(e,t,n,r,i){return i||W(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,i){return i||W(e,0,n,8),o.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||z(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||z(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||z(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||z(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||z(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||z(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||z(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||z(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||z(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||z(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||z(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||z(e,4,this.length),o.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||z(e,4,this.length),o.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||z(e,8,this.length),o.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||z(e,8,this.length),o.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):H(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):H(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):G(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):G(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):H(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):H(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):G(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):G(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return V(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return V(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=u.isBuffer(e)?e:K(new u(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var X=/[^+\/0-9A-Za-z-_]/g;function Y(e){if((e=Z(e).replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function Z(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function J(e){return e<16?"0"+e.toString(16):e.toString(16)}function K(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Q(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function $(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}function ee(e){return i.toByteArray(Y(e))}function te(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function ne(e){return e!=e}},{"base64-js":"yh9p",ieee754:"JgNJ",isarray:"REa7",buffer:"dskh"}],VCcH:[function(e,t,n){"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=e("buffer").Buffer,s=e("util").inspect,l=s&&s.custom||"inspect";function c(e,t,n){a.prototype.copy.call(e,t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return function(e,t,n){t&&o(e.prototype,t)}(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t=a.allocUnsafe(e>>>0),n=this.head,r=0;n;)c(n.data,t,r),r+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:l,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}]),e}()},{buffer:"dskh",util:"rDCW"}],pBGv:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,u=[],h=!1,d=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!h){var e=l(f);h=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||h||l(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],GRUB:[function(e,t,n){e("process");var r=e("process");function i(e,t){a(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return s||l?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(a,this,e)):r.nextTick(a,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(o,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(o,n),t(e)):r.nextTick(o,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},{process:"pBGv"}],Yj9o:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i={};function o(e,t,n){n||(n=Error);var r=function(e){function n(n,r,i){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,i))||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(n,e),n}(n);r.prototype.name=n.name,r.prototype.code=e,i[e]=r}function a(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}o("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),o("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o;if("string"==typeof t&&function(e,t,n){return e.substr(0,t.length)===t}(t,"not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(i," ").concat(a(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+".".length>e.length)&&-1!==e.indexOf(".",n)}(e)?"property":"argument";o='The "'.concat(e,'" ').concat(s," ").concat(i," ").concat(a(t,"type"))}return o+". Received type ".concat(r(n))}),TypeError),o("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),o("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),o("ERR_STREAM_PREMATURE_CLOSE","Premature close"),o("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),o("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),o("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),o("ERR_STREAM_WRITE_AFTER_END","write after end"),o("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),o("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),o("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=i},{}],TWVJ:[function(e,t,n){"use strict";var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},{"../../../errors":"Yj9o"}],Bm0n:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],yM1o:[function(e,t,n){var r=arguments[3];function i(e,t){if(o("noDeprecation"))return e;var n=!1;return function(){if(!n){if(o("throwDeprecation"))throw new Error(t);o("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}function o(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=i},{}],WSyY:[function(e,t,n){e("process");var r,i=arguments[3],o=e("process");function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){q(t,e)}}t.exports=L,L.WritableState=A;var s={deprecate:e("util-deprecate")},l=e("./internal/streams/stream"),c=e("buffer").Buffer,u=i.Uint8Array||function(){};function h(e){return c.from(e)}function d(e){return c.isBuffer(e)||e instanceof u}var f,p=e("./internal/streams/destroy"),m=e("./internal/streams/state"),g=m.getHighWaterMark,v=e("../errors").codes,y=v.ERR_INVALID_ARG_TYPE,b=v.ERR_METHOD_NOT_IMPLEMENTED,_=v.ERR_MULTIPLE_CALLBACK,x=v.ERR_STREAM_CANNOT_PIPE,w=v.ERR_STREAM_DESTROYED,M=v.ERR_STREAM_NULL_VALUES,S=v.ERR_STREAM_WRITE_AFTER_END,E=v.ERR_UNKNOWN_ENCODING,T=p.errorOrDestroy;function C(){}function A(t,n,i){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=n instanceof r),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=g(this,t,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){j(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function L(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!f.call(L,this))return new L(t);this._writableState=new A(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function P(e,t){var n=new S;T(e,n),o.nextTick(t,n)}function R(e,t,n,r){var i;return null===n?i=new M:"string"==typeof n||t.objectMode||(i=new y("chunk",["string","Buffer"],n)),!i||(T(e,i),o.nextTick(r,i),!1)}function O(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}function k(e,t,n,r,i,o){if(!n){var a=O(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,s,r,i,o);return l}function I(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new w("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function D(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(W,e,t),e._writableState.errorEmitted=!0,T(e,r)):(i(r),e._writableState.errorEmitted=!0,T(e,r),W(e,t))}function N(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function j(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if("function"!=typeof i)throw new _;if(N(n),t)D(e,n,r,t,i);else{var a=U(n)||e.destroyed;a||n.corked||n.bufferProcessing||!n.bufferedRequest||z(e,n),r?o.nextTick(F,e,n,a,i):F(e,n,a,i)}}function F(e,t,n,r){n||B(e,t),t.pendingcb--,r(),W(e,t)}function B(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function z(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0,l=!0;n;)i[s]=n,n.isBuf||(l=!1),n=n.next,s+=1;i.allBuffers=l,I(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,h=n.callback;if(I(e,t,!1,t.objectMode?1:c.length,c,u,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function U(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function H(e,t){e._final((function(n){t.pendingcb--,n&&T(e,n),t.prefinished=!0,e.emit("prefinish"),W(e,t)}))}function G(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,o.nextTick(H,e,t)))}function W(e,t){var n=U(t);if(n&&(G(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}function V(e,t,n){t.ending=!0,W(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function q(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree.next=e}e("inherits")(L,l),A.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(A.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(L,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===L&&e&&e._writableState instanceof A}})):f=function(e){return e instanceof this},L.prototype.pipe=function(){T(this,new x)},L.prototype.write=function(e,t,n){var r=this._writableState,i=!1,o=!r.objectMode&&d(e);return o&&!c.isBuffer(e)&&(e=h(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=C),r.ending?P(this,n):(o||R(this,r,e,n))&&(r.pendingcb++,i=k(this,r,o,e,t,n)),i},L.prototype.cork=function(){this._writableState.corked++},L.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||z(this,e))},L.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(L.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(L.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),L.prototype._write=function(e,t,n){n(new b("_write()"))},L.prototype._writev=null,L.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||V(this,r,n),this},Object.defineProperty(L.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),L.prototype.destroy=p.destroy,L.prototype._undestroy=p.undestroy,L.prototype._destroy=function(e,t){t(e)}},{"util-deprecate":"yM1o","./internal/streams/stream":"ExO1",buffer:"dskh","./internal/streams/destroy":"GRUB","./internal/streams/state":"TWVJ","../errors":"Yj9o",inherits:"Bm0n","./_stream_duplex":"Hba0",process:"pBGv"}],Hba0:[function(e,t,n){e("process");var r=e("process"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=u;var o=e("./_stream_readable"),a=e("./_stream_writable");e("inherits")(u,o);for(var s=i(a.prototype),l=0;l<s.length;l++){var c=s[l];u.prototype[c]||(u.prototype[c]=a.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},{"./_stream_readable":"DHrQ","./_stream_writable":"WSyY",inherits:"Bm0n",process:"pBGv"}],Wugr:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:"dskh"}],z0rv:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=a(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=a(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=a(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":"Wugr"}],mrEY:[function(e,t,n){"use strict";var r=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var a=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){s=!1,c=!0,a||o.call(t)},h=t._readableState&&t._readableState.endEmitted,d=function(){a=!1,h=!0,s||o.call(t)},f=function(e){o.call(t,e)},p=function(){var e;return a&&!h?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):s&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",p),t.req?m():t.on("request",m)):s&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",d),t.on("finish",u),!1!==n.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",u),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",d),t.removeListener("error",f),t.removeListener("close",p)}}},{"../../../errors":"Yj9o"}],AOGM:[function(e,t,n){e("process");var r,i=e("process");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=e("./end-of-stream"),s=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[s];if(null!==t){var n=e[f].read();null!==n&&(e[h]=null,e[s]=null,e[l]=null,t(p(n,!1)))}}function g(e){i.nextTick(m,e)}var v=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((o(r={get stream(){return this[f]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[c]?n(e[c]):t(p(void 0,!0))}))}));var n,r=this[h];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[u]?n(p(void 0,!0)):t[d](n,r)}),r)}}(r,this));else{var o=this[f].read();if(null!==o)return Promise.resolve(p(o,!1));n=new Promise(this[d])}return this[h]=n,n}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,n){e[f].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),r),v);t.exports=function(e){var t,n=Object.create(y,(o(t={},f,{value:e,writable:!0}),o(t,s,{value:null,writable:!0}),o(t,l,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,u,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var r=n[f].read();r?(n[h]=null,n[s]=null,n[l]=null,e(p(r,!1))):(n[s]=e,n[l]=t)},writable:!0}),t));return n[h]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[l];return null!==t&&(n[h]=null,n[s]=null,n[l]=null,t(e)),void(n[c]=e)}var r=n[s];null!==r&&(n[h]=null,n[s]=null,n[l]=null,r(p(void 0,!0))),n[u]=!0})),e.on("readable",g.bind(null,n)),n}},{"./end-of-stream":"mrEY",process:"pBGv"}],Rr4m:[function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],DHrQ:[function(e,t,n){e("process");var r,i=arguments[3],o=e("process");t.exports=P,P.ReadableState=L,e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},s=e("./internal/streams/stream"),l=e("buffer").Buffer,c=i.Uint8Array||function(){};function u(e){return l.from(e)}function h(e){return l.isBuffer(e)||e instanceof c}var d,f=e("util");d=f&&f.debuglog?f.debuglog("stream"):function(){};var p,m,g,v=e("./internal/streams/buffer_list"),y=e("./internal/streams/destroy"),b=e("./internal/streams/state"),_=b.getHighWaterMark,x=e("../errors").codes,w=x.ERR_INVALID_ARG_TYPE,M=x.ERR_STREAM_PUSH_AFTER_EOF,S=x.ERR_METHOD_NOT_IMPLEMENTED,E=x.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(P,s);var T=y.errorOrDestroy,C=["error","close","destroy","pause","resume"];function A(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function L(t,n,i){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=n instanceof r),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=_(this,t,"readableHighWaterMark",i),this.buffer=new v,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=e("string_decoder/").StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function P(t){if(r=r||e("./_stream_duplex"),!(this instanceof P))return new P(t);var n=this instanceof r;this._readableState=new L(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function R(e,t,n,r,i){d("readableAddChunk",t);var o,a=e._readableState;if(null===t)a.reading=!1,j(e,a);else if(i||(o=k(a,t)),o)T(e,o);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=u(t)),r)a.endEmitted?T(e,new E):O(e,a,t,!0);else if(a.ended)T(e,new M);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?O(e,a,t,!1):z(e,a)):O(e,a,t,!1)}else r||(a.reading=!1,z(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function O(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&F(e)),z(e,t)}function k(e,t){var n;return h(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new w("chunk",["string","Buffer","Uint8Array"],t)),n}Object.defineProperty(P.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),P.prototype.destroy=y.destroy,P.prototype._undestroy=y.undestroy,P.prototype._destroy=function(e,t){t(e)},P.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),R(this,e,t,!1,n)},P.prototype.unshift=function(e){return R(this,e,null,!0,!1)},P.prototype.isPaused=function(){return!1===this._readableState.flowing},P.prototype.setEncoding=function(t){p||(p=e("string_decoder/").StringDecoder);var n=new p(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=n.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var I=1073741824;function D(e){return e>=I?e=I:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function N(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=D(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function j(e,t){if(d("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?F(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,B(e)))}}function F(e){var t=e._readableState;d("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,o.nextTick(B,e))}function B(e){var t=e._readableState;d("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,X(e)}function z(e,t){t.readingMore||(t.readingMore=!0,o.nextTick(U,e,t))}function U(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(d("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function H(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,X(e))}}function G(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function W(e){d("readable nexttick read 0"),e.read(0)}function V(e,t){t.resumeScheduled||(t.resumeScheduled=!0,o.nextTick(q,e,t))}function q(e,t){d("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),X(e),t.flowing&&!t.reading&&e.read(0)}function X(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function Y(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function Z(e){var t=e._readableState;d("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,o.nextTick(J,t,e))}function J(e,t){if(d("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function K(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}P.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Z(this):F(this),null;if(0===(e=N(e,t))&&t.ended)return 0===t.length&&Z(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=N(n,t))),null===(r=e>0?Y(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Z(this)),null!==r&&this.emit("data",r),r},P.prototype._read=function(e){T(this,new S("_read()"))},P.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,d("pipe count=%d opts=%j",r.pipesCount,t);var i=t&&!1===t.end||e===o.stdout||e===o.stderr?m:s;function s(){d("onend"),e.end()}r.endEmitted?o.nextTick(i):n.once("end",i),e.on("unpipe",(function t(i,o){d("onunpipe"),i===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,d("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",t),n.removeListener("end",s),n.removeListener("end",m),n.removeListener("data",u),c=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}));var l=H(n);e.on("drain",l);var c=!1;function u(t){d("ondata");var i=e.write(t);d("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==K(r.pipes,e))&&!c&&(d("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function h(t){d("onerror",t),m(),e.removeListener("error",h),0===a(e,"error")&&T(e,t)}function f(){e.removeListener("finish",p),m()}function p(){d("onfinish"),e.removeListener("close",f),m()}function m(){d("unpipe"),n.unpipe(e)}return n.on("data",u),A(e,"error",h),e.once("close",f),e.once("finish",p),e.emit("pipe",n),r.flowing||(d("pipe resume"),n.resume()),e},P.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=K(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},P.prototype.on=function(e,t){var n=s.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,d("on readable",r.length,r.reading),r.length?F(this):r.reading||o.nextTick(W,this))),n},P.prototype.addListener=P.prototype.on,P.prototype.removeListener=function(e,t){var n=s.prototype.removeListener.call(this,e,t);return"readable"===e&&o.nextTick(G,this),n},P.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||o.nextTick(G,this),t},P.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!e.readableListening,V(this,e)),e.paused=!1,this},P.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},P.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<C.length;o++)e.on(C[o],this.emit.bind(this,C[o]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(P.prototype[Symbol.asyncIterator]=function(){return void 0===m&&(m=e("./internal/streams/async_iterator")),m(this)}),Object.defineProperty(P.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(P.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(P.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),P._fromList=Y,Object.defineProperty(P.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(P.from=function(t,n){return void 0===g&&(g=e("./internal/streams/from")),g(P,t,n)})},{events:"FRpO","./internal/streams/stream":"ExO1",buffer:"dskh",util:"rDCW","./internal/streams/buffer_list":"VCcH","./internal/streams/destroy":"GRUB","./internal/streams/state":"TWVJ","../errors":"Yj9o",inherits:"Bm0n","./_stream_duplex":"Hba0","string_decoder/":"z0rv","./internal/streams/async_iterator":"AOGM","./internal/streams/from":"Rr4m",process:"pBGv"}],tlBz:[function(e,t,n){"use strict";t.exports=u;var r=e("../errors").codes,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=r.ERR_TRANSFORM_WITH_LENGTH_0,l=e("./_stream_duplex");function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,n){d(e,t,n)}))}function d(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new i("_transform()"))},u.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},{"../errors":"Yj9o","./_stream_duplex":"Hba0",inherits:"Bm0n"}],nwyA:[function(e,t,n){"use strict";t.exports=i;var r=e("./_stream_transform");function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}e("inherits")(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":"tlBz",inherits:"Bm0n"}],AJFC:[function(e,t,n){"use strict";var r,i=e("../../../errors").codes,o=i.ERR_MISSING_ARGS,a=i.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function l(t,n,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;t.on("close",(function(){s=!0})),void 0===r&&(r=e("./end-of-stream")),r(t,{readable:n,writable:i},(function(e){if(e)return o(e);s=!0,o()}));var l=!1;return function(e){if(!s&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new a("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}function h(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}t.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=h(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var a=t.map((function(e,n){var o=n<t.length-1;return l(e,o,n>0,(function(e){r||(r=e),e&&a.forEach(c),o||(a.forEach(c),i(r))}))}));return t.reduce(u)}},{"../../../errors":"Yj9o","./end-of-stream":"mrEY"}],tzeh:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_readable.js":"DHrQ","./lib/_stream_writable.js":"WSyY","./lib/_stream_duplex.js":"Hba0","./lib/_stream_transform.js":"tlBz","./lib/_stream_passthrough.js":"nwyA","./lib/internal/streams/end-of-stream.js":"mrEY","./lib/internal/streams/pipeline.js":"AJFC"}],vexR:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],tcrG:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],gfUn:[function(e,t,n){e("process");var r=e("process"),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},o=/%[sdj%]/g;n.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(l(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(e).replace(o,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<i;s=r[++n])v(s)||!w(s)?a+=" "+s:a+=" "+l(s);return a},n.deprecate=function(e,t){if(void 0!==r&&!0===r.noDeprecation)return e;if(void 0===r)return function(){return n.deprecate(e,t).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(t);r.traceDeprecation?console.trace(t):console.error(t),i=!0}return e.apply(this,arguments)}};var a,s={};function l(e,t){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(t)?r.showHidden=t:t&&n._extend(r,t),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),h(r,e,r.depth)}function c(e,t){var n=l.styles[t];return n?"["+l.colors[n][0]+"m"+e+"["+l.colors[n][1]+"m":e}function u(e,t){return e}function h(e,t,r){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return b(i)||(i=h(e,i,r)),i}var o=d(e,t);if(o)return o;var a=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),S(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(t);if(0===a.length){if(E(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(M(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return f(t)}var c,u="",g=!1,v=["{","}"];return m(t)&&(g=!0,v=["[","]"]),E(t)&&(u=" [Function"+(t.name?": "+t.name:"")+"]"),x(t)&&(u=" "+RegExp.prototype.toString.call(t)),M(t)&&(u=" "+Date.prototype.toUTCString.call(t)),S(t)&&(u=" "+f(t)),0!==a.length||g&&0!=t.length?r<0?x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=g?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)P(t,String(a))?o.push(p(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))})),o}(e,t,r,s,a):a.map((function(n){return p(e,t,r,s,n,g)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,u,v)):v[0]+u+v[1]}function d(e,t){if(_(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),P(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=v(n)?h(e,l.value,null):h(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),_(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function m(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function _(e){return void 0===e}function x(e){return w(e)&&"[object RegExp]"===T(e)}function w(e){return"object"==typeof e&&null!==e}function M(e){return w(e)&&"[object Date]"===T(e)}function S(e){return w(e)&&("[object Error]"===T(e)||e instanceof Error)}function E(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(_(a)&&(a=""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var t=r.pid;s[e]=function(){var r=n.format.apply(n,arguments);console.error("%s %d: %s",e,t,r)}}else s[e]=function(){};return s[e]},n.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=m,n.isBoolean=g,n.isNull=v,n.isNullOrUndefined=function(e){return null==e},n.isNumber=y,n.isString=b,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=_,n.isRegExp=x,n.isObject=w,n.isDate=M,n.isError=S,n.isFunction=E,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function L(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),A[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",L(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}n.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},n.promisify.custom=R,n.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};e.apply(this,t).then((function(e){r.nextTick(a,null,e)}),(function(e){r.nextTick(O,e,a)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},{"./support/isBuffer":"vexR",inherits:"tcrG",process:"pBGv"}],m2P9:[function(e,t,n){e("process");var r=e("process"),i=e("readable-stream").Transform,o=e("util").inherits;function a(e){i.call(this,e),this._destroyed=!1}function s(e,t,n){n(null,e)}function l(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=s),"function"!=typeof r&&(r=null),e(t,n,r)}}o(a,i),a.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=l((function(e,t,n){var r=new a(e);return r._transform=t,n&&(r._flush=n),r})),t.exports.ctor=l((function(e,t,n){function r(t){if(!(this instanceof r))return new r(t);this.options=Object.assign({},e,t),a.call(this,this.options)}return o(r,a),r.prototype._transform=t,n&&(r.prototype._flush=n),r})),t.exports.obj=l((function(e,t,n){var r=new a(Object.assign({objectMode:!0,highWaterMark:16},e));return r._transform=t,n&&(r._flush=n),r}))},{"readable-stream":"tzeh",util:"gfUn",process:"pBGv"}],JO74:[function(e,t,n){function r(e,t){"use strict";var n=(t=t||{}).pos||0,i="<".charCodeAt(0),o=">".charCodeAt(0),a="-".charCodeAt(0),s="/".charCodeAt(0),l="!".charCodeAt(0),c="'".charCodeAt(0),u='"'.charCodeAt(0);function h(){for(var t=[];e[n];)if(e.charCodeAt(n)==i){if(e.charCodeAt(n+1)===s)return(n=e.indexOf(">",n))+1&&(n+=1),t;if(e.charCodeAt(n+1)===l){if(e.charCodeAt(n+2)==a){for(;-1!==n&&(e.charCodeAt(n)!==o||e.charCodeAt(n-1)!=a||e.charCodeAt(n-2)!=a||-1==n);)n=e.indexOf(">",n+1);-1===n&&(n=e.length)}else for(n+=2;e.charCodeAt(n)!==o&&e[n];)n++;n++;continue}var r=m();t.push(r)}else{var c=d();c.trim().length>0&&t.push(c),n++}return t}function d(){var t=n;return-2==(n=e.indexOf("<",n)-1)&&(n=e.length),e.slice(t,n+1)}function f(){for(var t=n;-1==="\n\t>/= ".indexOf(e[n])&&e[n];)n++;return e.slice(t,n)}var p=t.noChildNodes||["img","br","input","meta","link"];function m(){n++;const t=f(),r={};let i=[];for(;e.charCodeAt(n)!==o&&e[n];){var a=e.charCodeAt(n);if(a>64&&a<91||a>96&&a<123){for(var l=f(),d=e.charCodeAt(n);d&&d!==c&&d!==u&&!(d>64&&d<91||d>96&&d<123)&&d!==o;)n++,d=e.charCodeAt(n);if(d===c||d===u){var m=g();if(-1===n)return{tagName:t,attributes:r,children:i}}else m=null,n--;r[l]=m}n++}if(e.charCodeAt(n-1)!==s)if("script"==t){var v=n+1;n=e.indexOf("<\/script>",n),i=[e.slice(v,n-1)],n+=9}else"style"==t?(v=n+1,n=e.indexOf("</style>",n),i=[e.slice(v,n-1)],n+=8):-1==p.indexOf(t)&&(n++,i=h());else n++;return{tagName:t,attributes:r,children:i}}function g(){var t=e[n],r=++n;return n=e.indexOf(t,r),e.slice(r,n)}var v,y=null;if(void 0!==t.attrValue)for(t.attrName=t.attrName||"id",y=[];-1!==(v=new RegExp("\\s"+t.attrName+"\\s*=['\"]"+t.attrValue+"['\"]").exec(e),n=v?v.index:-1);)-1!==(n=e.lastIndexOf("<",n))&&y.push(m()),e=e.substr(n),n=0;else y=t.parseNode?m():h();return t.filter&&(y=r.filter(y,t.filter)),t.setPos&&(y.pos=n),y}r.simplify=function(e){var t={};if(!e.length)return"";if(1===e.length&&"string"==typeof e[0])return e[0];for(var n in e.forEach((function(e){if("object"==typeof e){t[e.tagName]||(t[e.tagName]=[]);var n=r.simplify(e.children||[]);t[e.tagName].push(n),e.attributes&&(n._attributes=e.attributes)}})),t)1==t[n].length&&(t[n]=t[n][0]);return t},r.filter=function(e,t){var n=[];return e.forEach((function(e){if("object"==typeof e&&t(e)&&n.push(e),e.children){var i=r.filter(e.children,t);n=n.concat(i)}})),n},r.stringify=function(e){var t="";function n(e){if(e)for(var n=0;n<e.length;n++)"string"==typeof e[n]?t+=e[n].trim():r(e[n])}function r(e){for(var r in t+="<"+e.tagName,e.attributes)null===e.attributes[r]?t+=" "+r:-1===e.attributes[r].indexOf('"')?t+=" "+r+'="'+e.attributes[r].trim()+'"':t+=" "+r+"='"+e.attributes[r].trim()+"'";t+=">",n(e.children),t+="</"+e.tagName+">"}return n(e),t},r.toContentString=function(e){if(Array.isArray(e)){var t="";return e.forEach((function(e){t=(t+=" "+r.toContentString(e)).trim()})),t}return"object"==typeof e?r.toContentString(e.children):" "+e},r.getElementById=function(e,t,n){var i=r(e,{attrValue:t});return n?r.simplify(i):i[0]},r.getElementsByClassName=function(e,t,n){const i=r(e,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+t+"[a-zA-Z0-9-s ]*"});return n?r.simplify(i):i},r.parseStream=function(t,n){if("string"==typeof n&&(n=n.length+2),"string"==typeof t){var i=e("fs");t=i.createReadStream(t,{start:n}),n=0}var o=n,a="";return t.on("data",(function(e){a+=e;for(var n=0;;){if(!(o=a.indexOf("<",o)+1))return void(o=n);if("/"!==a[o+1]){var i=r(a,{pos:o-1,parseNode:!0,setPos:!0});if((o=i.pos)>a.length-1||o<n)return a=a.slice(n),o=0,void(n=0);t.emit("xml",i),n=o}else o+=1,n=pos}})),t.on("end",(function(){console.log("end")})),t},r.transformStream=function(t){const n=e("through2");"string"==typeof t&&(t=t.length+2);var i=t||0,o="";return n({readableObjectMode:!0},(function(e,t,n){o+=e;for(var a=0;;){if(!(i=o.indexOf("<",i)+1))return i=a,n();if("/"!==o[i+1]){var s=r(o,{pos:i-1,parseNode:!0,setPos:!0});if((i=s.pos)>o.length-1||i<a)return o=o.slice(a),i=0,a=0,n();this.push(s),a=i}else i+=1,a=pos}n()}))},"object"==typeof t&&(t.exports=r,r.xml=r)},{fs:"rDCW",through2:"m2P9"}],j27V:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.geoKeys=n.geoKeyNames=n.ExtraSamplesValues=n.photometricInterpretations=n.fieldTypes=n.fieldTypeNames=n.arrayFields=n.fieldTagTypes=n.fieldTags=n.fieldTagNames=void 0;var r={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"};n.fieldTagNames=r;var i={};for(var o in n.fieldTags=i,r)r.hasOwnProperty(o)&&(i[r[o]]=parseInt(o,10));n.fieldTagTypes={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34665:"LONG",34735:"SHORT",34737:"ASCII",42113:"ASCII"};var a=[i.BitsPerSample,i.ExtraSamples,i.SampleFormat,i.StripByteCounts,i.StripOffsets,i.StripRowCounts,i.TileByteCounts,i.TileOffsets,i.SubIFDs];n.arrayFields=a;var s={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"};n.fieldTypeNames=s;var l={};for(var c in n.fieldTypes=l,s)s.hasOwnProperty(c)&&(l[s[c]]=parseInt(c,10));n.photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},n.ExtraSamplesValues={Unspecified:0,Assocalpha:1,Unassalpha:2};var u={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};n.geoKeyNames=u;var h={};for(var d in n.geoKeys=h,u)u.hasOwnProperty(d)&&(h[u[d]]=parseInt(d,10))},{}],fpBl:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fromWhiteIsZero=function(e,t){for(var n,r=e.width,i=e.height,o=new Uint8Array(r*i*3),a=0,s=0;a<e.length;++a,s+=3)n=256-e[a]/t*256,o[s]=n,o[s+1]=n,o[s+2]=n;return o},n.fromBlackIsZero=function(e,t){for(var n,r=e.width,i=e.height,o=new Uint8Array(r*i*3),a=0,s=0;a<e.length;++a,s+=3)n=e[a]/t*256,o[s]=n,o[s+1]=n,o[s+2]=n;return o},n.fromPalette=function(e,t){for(var n=e.width,r=e.height,i=new Uint8Array(n*r*3),o=t.length/3,a=t.length/3*2,s=0,l=0;s<e.length;++s,l+=3){var c=e[s];i[l]=t[c]/65536*256,i[l+1]=t[c+o]/65536*256,i[l+2]=t[c+a]/65536*256}return i},n.fromCMYK=function(e){for(var t=e.width,n=e.height,r=new Uint8Array(t*n*3),i=0,o=0;i<e.length;i+=4,o+=3){var a=e[i],s=e[i+1],l=e[i+2],c=e[i+3];r[o]=(255-a)/256*255*((255-c)/256),r[o+1]=(255-s)/256*255*((255-c)/256),r[o+2]=(255-l)/256*255*((255-c)/256)}return r},n.fromYCbCr=function(e){for(var t=e.width,n=e.height,r=new Uint8ClampedArray(t*n*3),i=0,o=0;i<e.length;i+=3,o+=3){var a=e[i],s=e[i+1],l=e[i+2];r[o]=a+1.402*(l-128),r[o+1]=a-.34414*(s-128)-.71414*(l-128),r[o+2]=a+1.772*(s-128)}return r},n.fromCIELab=function(e){for(var t=e.width,n=e.height,r=new Uint8Array(t*n*3),i=0,o=0;i<e.length;i+=3,o+=3){var a=(e[i+0]+16)/116,s=(e[i+1]<<24>>24)/500+a,l=a-(e[i+2]<<24>>24)/200,c=void 0,u=void 0,h=void 0;u=-.9689*(s=.95047*(s*s*s>.008856?s*s*s:(s-16/116)/7.787))+1.8758*(a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+.0415*(l=1.08883*(l*l*l>.008856?l*l*l:(l-16/116)/7.787)),h=.0557*s+-.204*a+1.057*l,c=(c=3.2406*s+-1.5372*a+-.4986*l)>.0031308?1.055*Math.pow(c,1/2.4)-.055:12.92*c,u=u>.0031308?1.055*Math.pow(u,1/2.4)-.055:12.92*u,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:12.92*h,r[o]=255*Math.max(0,Math.min(1,c)),r[o+1]=255*Math.max(0,Math.min(1,u)),r[o+2]=255*Math.max(0,Math.min(1,h))}return r}},{}],IKSA:[function(e,t,n){"use strict";function r(e,t){var n=e.length-t,r=0;do{for(var i=t;i>0;i--)e[r+t]+=e[r],r++;n-=t}while(n>0)}function i(e,t,n){for(var r=0,i=e.length,o=i/n;i>t;){for(var a=t;a>0;--a)e[r+t]+=e[r],++r;i-=t}for(var s=e.slice(),l=0;l<o;++l)for(var c=0;c<n;++c)e[n*l+c]=s[(n-c-1)*o+l]}Object.defineProperty(n,"__esModule",{value:!0}),n.applyPredictor=function(e,t,n,o,a,s){if(!t||1===t)return e;for(var l=0;l<a.length;++l){if(a[l]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(a[l]!==a[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var c=a[0]/8,u=2===s?1:a.length,h=0;h<o&&!(h*u*n*c>=e.byteLength);++h){var d=void 0;if(2===t){switch(a[0]){case 8:d=new Uint8Array(e,h*u*n*c,u*n*c);break;case 16:d=new Uint16Array(e,h*u*n*c,u*n*c/2);break;case 32:d=new Uint32Array(e,h*u*n*c,u*n*c/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(a[0]," bits per sample."))}r(d,u)}else 3===t&&i(d=new Uint8Array(e,h*u*n*c,u*n*c),u,c)}return e}},{}],FJDe:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("@babel/runtime/regenerator")),i=l(e("@babel/runtime/helpers/asyncToGenerator")),o=l(e("@babel/runtime/helpers/classCallCheck")),a=l(e("@babel/runtime/helpers/createClass")),s=e("../predictor");function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,[{key:"decode",value:function(){var e=(0,i.default)(r.default.mark((function e(t,n){var i,o,a,l,c;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decodeBlock(n);case 2:if(i=e.sent,1===(o=t.Predictor||1)){e.next=9;break}return a=!t.StripOffsets,l=a?t.TileWidth:t.ImageWidth,c=a?t.TileLength:t.RowsPerStrip||t.ImageLength,e.abrupt("return",(0,s.applyPredictor)(i,o,l,c,t.BitsPerSample,t.PlanarConfiguration));case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();n.default=c},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","../predictor":"IKSA"}],V9bQ:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("@babel/runtime/helpers/classCallCheck")),i=l(e("@babel/runtime/helpers/createClass")),o=l(e("@babel/runtime/helpers/inherits")),a=l(e("@babel/runtime/helpers/possibleConstructorReturn")),s=l(e("@babel/runtime/helpers/getPrototypeOf"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){(0,o.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"decodeBlock",value:function(e){return e}}]),n}(l(e("./basedecoder")).default);n.default=c},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./basedecoder":"FJDe"}],tcId:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("@babel/runtime/helpers/classCallCheck")),i=l(e("@babel/runtime/helpers/createClass")),o=l(e("@babel/runtime/helpers/inherits")),a=l(e("@babel/runtime/helpers/possibleConstructorReturn")),s=l(e("@babel/runtime/helpers/getPrototypeOf"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var n=t.length-1;n>=0;n--)e.push(t[n]);return e}var u=function(e){(0,o.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"decodeBlock",value:function(e){return function(e){for(var t=new Uint16Array(4093),n=new Uint8Array(4093),r=0;r<=257;r++)t[r]=4096,n[r]=r;var i=258,o=9,a=0;function s(){i=258,o=9}function l(e){var t=function(e,t,n){var r=t%8,i=Math.floor(t/8),o=8-r,a=t+n-8*(i+1),s=8*(i+2)-(t+n),l=8*(i+2)-t;if(s=Math.max(0,s),i>=e.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var c=e[i]&Math.pow(2,8-r)-1,u=c<<=n-o;if(i+1<e.length){var h=e[i+1]>>>s;u+=h<<=Math.max(0,n-l)}if(a>8&&i+2<e.length){var d=8*(i+3)-(t+n);u+=e[i+2]>>>d}return u}(e,a,o);return a+=o,t}function u(e,r){return n[i]=r,t[i]=e,++i-1}function h(e){for(var r=[],i=e;4096!==i;i=t[i])r.push(n[i]);return r}var d=[];s();for(var f,p=new Uint8Array(e),m=l(p);257!==m;){if(256===m){for(s(),m=l(p);256===m;)m=l(p);if(257===m)break;if(m>256)throw new Error("corrupted code at scanline ".concat(m));c(d,h(m)),f=m}else if(m<i){var g=h(m);c(d,g),u(f,g[g.length-1]),f=m}else{var v=h(f);if(!v)throw new Error("Bogus entry. Not in dictionary, ".concat(f," / ").concat(i,", position: ").concat(a));c(d,v),d.push(v[v.length-1]),u(f,v[v.length-1]),f=m}i+1>=Math.pow(2,o)&&(12===o?f=void 0:o++),m=l(p)}return new Uint8Array(d)}(e).buffer}}]),n}(l(e("./basedecoder")).default);n.default=u},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./basedecoder":"FJDe"}],J7kk:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=u(e("@babel/runtime/helpers/inherits")),i=u(e("@babel/runtime/helpers/possibleConstructorReturn")),o=u(e("@babel/runtime/helpers/getPrototypeOf")),a=u(e("@babel/runtime/helpers/classCallCheck")),s=u(e("@babel/runtime/helpers/createClass")),l=u(e("@babel/runtime/helpers/typeof")),c=u(e("./basedecoder"));function u(e){return e&&e.__esModule?e:{default:e}}var h=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),d=4017,f=799,p=3406,m=2276,g=1567,v=3784,y=5793,b=2896;function _(e,t){for(var n=0,r=[],i=16;i>0&&!e[i-1];)--i;r.push({children:[],index:0});for(var o,a=r[0],s=0;s<i;s++){for(var l=0;l<e[s];l++){for((a=r.pop()).children[a.index]=t[n];a.index>0;)a=r.pop();for(a.index++,r.push(a);r.length<=s;)r.push(o={children:[],index:0}),a.children[a.index]=o.children,a=o;n++}s+1<i&&(r.push(o={children:[],index:0}),a.children[a.index]=o.children,a=o)}return r[0].children}function x(e,t,n,r,i,o,a,s,c){var u=n.mcusPerLine,d=n.progressive,f=t,p=t,m=0,g=0;function v(){if(g>0)return m>>--g&1;if(255===(m=e[p++])){var t=e[p++];if(t)throw new Error("unexpected marker: ".concat((m<<8|t).toString(16)))}return g=7,m>>>7}function y(e){for(var t,n=e;null!==(t=v());){if("number"==typeof(n=n[t]))return n;if("object"!==(0,l.default)(n))throw new Error("invalid huffman sequence")}return null}function b(e){for(var t=e,n=0;t>0;){var r=v();if(null===r)return;n=n<<1|r,--t}return n}function _(e){var t=b(e);return t>=1<<e-1?t:t+(-1<<e)+1}var x,w=0,M=0;function S(e,t,n,r,i){var o=n%u,a=(n/u|0)*e.v+r,s=o*e.h+i;t(e,e.blocks[a][s])}function E(e,t,n){var r=n/e.blocksPerLine|0,i=n%e.blocksPerLine;t(e,e.blocks[r][i])}var T,C,A,L,P,R,O=r.length;R=d?0===o?0===s?function(e,t){var n=y(e.huffmanTableDC),r=0===n?0:_(n)<<c;e.pred+=r,t[0]=e.pred}:function(e,t){t[0]|=v()<<c}:0===s?function(e,t){if(w>0)w--;else for(var n=o,r=a;n<=r;){var i=y(e.huffmanTableAC),s=15&i,l=i>>4;if(0===s){if(l<15){w=b(l)+(1<<l)-1;break}n+=16}else t[h[n+=l]]=_(s)*(1<<c),n++}}:function(e,t){for(var n=o,r=a,i=0;n<=r;){var s=h[n],l=t[s]<0?-1:1;switch(M){case 0:var u=y(e.huffmanTableAC),d=15&u;if(i=u>>4,0===d)i<15?(w=b(i)+(1<<i),M=4):(i=16,M=1);else{if(1!==d)throw new Error("invalid ACn encoding");x=_(d),M=i?2:3}continue;case 1:case 2:t[s]?t[s]+=(v()<<c)*l:0==--i&&(M=2===M?3:0);break;case 3:t[s]?t[s]+=(v()<<c)*l:(t[s]=x<<c,M=0);break;case 4:t[s]&&(t[s]+=(v()<<c)*l)}n++}4===M&&0==--w&&(M=0)}:function(e,t){var n=y(e.huffmanTableDC),r=0===n?0:_(n);e.pred+=r,t[0]=e.pred;for(var i=1;i<64;){var o=y(e.huffmanTableAC),a=15&o,s=o>>4;if(0===a){if(s<15)break;i+=16}else t[h[i+=s]]=_(a),i++}};var k,I,D=0;I=1===O?r[0].blocksPerLine*r[0].blocksPerColumn:u*n.mcusPerColumn;for(var N=i||I;D<I;){for(C=0;C<O;C++)r[C].pred=0;if(w=0,1===O)for(T=r[0],P=0;P<N;P++)E(T,R,D),D++;else for(P=0;P<N;P++){for(C=0;C<O;C++){var j=T=r[C],F=j.h,B=j.v;for(A=0;A<B;A++)for(L=0;L<F;L++)S(T,R,D,A,L)}if(++D===I)break}if(g=0,(k=e[p]<<8|e[p+1])<65280)throw new Error("marker was not found");if(!(k>=65488&&k<=65495))break;p+=2}return p-f}function w(e,t){var n=[],r=t.blocksPerLine,i=t.blocksPerColumn,o=r<<3,a=new Int32Array(64),s=new Uint8Array(64);function l(e,n,r){var i,o,a,s,l,c,u,h,_,x,w=t.quantizationTable,M=r;for(x=0;x<64;x++)M[x]=e[x]*w[x];for(x=0;x<8;++x){var S=8*x;0!==M[1+S]||0!==M[2+S]||0!==M[3+S]||0!==M[4+S]||0!==M[5+S]||0!==M[6+S]||0!==M[7+S]?(i=y*M[0+S]+128>>8,o=y*M[4+S]+128>>8,a=M[2+S],s=M[6+S],l=b*(M[1+S]-M[7+S])+128>>8,h=b*(M[1+S]+M[7+S])+128>>8,c=M[3+S]<<4,u=M[5+S]<<4,_=i-o+1>>1,i=i+o+1>>1,o=_,_=a*v+s*g+128>>8,a=a*g-s*v+128>>8,s=_,_=l-u+1>>1,l=l+u+1>>1,u=_,_=h+c+1>>1,c=h-c+1>>1,h=_,_=i-s+1>>1,i=i+s+1>>1,s=_,_=o-a+1>>1,o=o+a+1>>1,a=_,_=l*m+h*p+2048>>12,l=l*p-h*m+2048>>12,h=_,_=c*f+u*d+2048>>12,c=c*d-u*f+2048>>12,u=_,M[0+S]=i+h,M[7+S]=i-h,M[1+S]=o+u,M[6+S]=o-u,M[2+S]=a+c,M[5+S]=a-c,M[3+S]=s+l,M[4+S]=s-l):(_=y*M[0+S]+512>>10,M[0+S]=_,M[1+S]=_,M[2+S]=_,M[3+S]=_,M[4+S]=_,M[5+S]=_,M[6+S]=_,M[7+S]=_)}for(x=0;x<8;++x){var E=x;0!==M[8+E]||0!==M[16+E]||0!==M[24+E]||0!==M[32+E]||0!==M[40+E]||0!==M[48+E]||0!==M[56+E]?(i=y*M[0+E]+2048>>12,o=y*M[32+E]+2048>>12,a=M[16+E],s=M[48+E],l=b*(M[8+E]-M[56+E])+2048>>12,h=b*(M[8+E]+M[56+E])+2048>>12,c=M[24+E],u=M[40+E],_=i-o+1>>1,i=i+o+1>>1,o=_,_=a*v+s*g+2048>>12,a=a*g-s*v+2048>>12,s=_,_=l-u+1>>1,l=l+u+1>>1,u=_,_=h+c+1>>1,c=h-c+1>>1,h=_,_=i-s+1>>1,i=i+s+1>>1,s=_,_=o-a+1>>1,o=o+a+1>>1,a=_,_=l*m+h*p+2048>>12,l=l*p-h*m+2048>>12,h=_,_=c*f+u*d+2048>>12,c=c*d-u*f+2048>>12,u=_,M[0+E]=i+h,M[56+E]=i-h,M[8+E]=o+u,M[48+E]=o-u,M[16+E]=a+c,M[40+E]=a-c,M[24+E]=s+l,M[32+E]=s-l):(_=y*r[x+0]+8192>>14,M[0+E]=_,M[8+E]=_,M[16+E]=_,M[24+E]=_,M[32+E]=_,M[40+E]=_,M[48+E]=_,M[56+E]=_)}for(x=0;x<64;++x){var T=128+(M[x]+8>>4);n[x]=T<0?0:T>255?255:T}}for(var c=0;c<i;c++){for(var u=c<<3,h=0;h<8;h++)n.push(new Uint8Array(o));for(var _=0;_<r;_++){l(t.blocks[c][_],s,a);for(var x=0,w=_<<3,M=0;M<8;M++)for(var S=n[u+M],E=0;E<8;E++)S[w+E]=s[x++]}}return n}var M=function(){function e(){(0,a.default)(this,e),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return(0,s.default)(e,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(e){var t=0;function n(){var n=e[t]<<8|e[t+1];return t+=2,n}function r(e){var t,n,r=0,i=0;for(n in e.components)e.components.hasOwnProperty(n)&&(r<(t=e.components[n]).h&&(r=t.h),i<t.v&&(i=t.v));var o=Math.ceil(e.samplesPerLine/8/r),a=Math.ceil(e.scanLines/8/i);for(n in e.components)if(e.components.hasOwnProperty(n)){t=e.components[n];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/r),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),c=o*t.h,u=a*t.v,h=[],d=0;d<u;d++){for(var f=[],p=0;p<c;p++)f.push(new Int32Array(64));h.push(f)}t.blocksPerLine=s,t.blocksPerColumn=l,t.blocks=h}e.maxH=r,e.maxV=i,e.mcusPerLine=o,e.mcusPerColumn=a}var i,o,a=n();if(65496!==a)throw new Error("SOI not found");for(a=n();65497!==a;){switch(a){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var s=(i=n(),o=e.subarray(t,t+i-2),t+=o.length,o);65504===a&&74===s[0]&&70===s[1]&&73===s[2]&&70===s[3]&&0===s[4]&&(this.jfif={version:{major:s[5],minor:s[6]},densityUnits:s[7],xDensity:s[8]<<8|s[9],yDensity:s[10]<<8|s[11],thumbWidth:s[12],thumbHeight:s[13],thumbData:s.subarray(14,14+3*s[12]*s[13])}),65518===a&&65===s[0]&&100===s[1]&&111===s[2]&&98===s[3]&&101===s[4]&&0===s[5]&&(this.adobe={version:s[6],flags0:s[7]<<8|s[8],flags1:s[9]<<8|s[10],transformCode:s[11]});break;case 65499:for(var l=n()+t-2;t<l;){var c=e[t++],u=new Int32Array(64);if(c>>4==0)for(var d=0;d<64;d++)u[h[d]]=e[t++];else{if(c>>4!=1)throw new Error("DQT: invalid table spec");for(var f=0;f<64;f++)u[h[f]]=n()}this.quantizationTables[15&c]=u}break;case 65472:case 65473:case 65474:n();for(var p={extended:65473===a,progressive:65474===a,precision:e[t++],scanLines:n(),samplesPerLine:n(),components:{},componentsOrder:[]},m=e[t++],g=void 0,v=0;v<m;v++){g=e[t];var y=e[t+1]>>4,b=15&e[t+1],w=e[t+2];p.componentsOrder.push(g),p.components[g]={h:y,v:b,quantizationIdx:w},t+=3}r(p),this.frames.push(p);break;case 65476:for(var M=n(),S=2;S<M;){for(var E=e[t++],T=new Uint8Array(16),C=0,A=0;A<16;A++,t++)T[A]=e[t],C+=T[A];for(var L=new Uint8Array(C),P=0;P<C;P++,t++)L[P]=e[t];S+=17+C,E>>4==0?this.huffmanTablesDC[15&E]=_(T,L):this.huffmanTablesAC[15&E]=_(T,L)}break;case 65501:n(),this.resetInterval=n();break;case 65498:n();for(var R=e[t++],O=[],k=this.frames[0],I=0;I<R;I++){var D=k.components[e[t++]],N=e[t++];D.huffmanTableDC=this.huffmanTablesDC[N>>4],D.huffmanTableAC=this.huffmanTablesAC[15&N],O.push(D)}var j=e[t++],F=e[t++],B=e[t++],z=x(e,t,k,O,this.resetInterval,j,F,B>>4,15&B);t+=z;break;case 65535:255!==e[t]&&t--;break;default:if(255===e[t-3]&&e[t-2]>=192&&e[t-2]<=254){t-=3;break}throw new Error("unknown JPEG marker ".concat(a.toString(16)))}a=n()}}},{key:"getResult",value:function(){var e=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var t=0;t<this.frames.length;t++)for(var n=this.frames[t].components,r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];n[o].quantizationTable=this.quantizationTables[n[o].quantizationIdx],delete n[o].quantizationIdx}for(var a=e[0],s=a.components,l=a.componentsOrder,c=[],u=a.samplesPerLine,h=a.scanLines,d=0;d<l.length;d++){var f=s[l[d]];c.push({lines:w(0,f),scaleX:f.h/a.maxH,scaleY:f.v/a.maxV})}for(var p=new Uint8Array(u*h*c.length),m=0,g=0;g<h;++g)for(var v=0;v<u;++v)for(var y=0;y<c.length;++y){var b=c[y];p[m]=b.lines[0|g*b.scaleY][0|v*b.scaleX],++m}return p}}]),e}(),S=function(e){(0,r.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,o.default)(e);if(t){var a=(0,o.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,i.default)(this,n)}}(n);function n(e){var r;return(0,a.default)(this,n),(r=t.call(this)).reader=new M,e.JPEGTables&&r.reader.parse(e.JPEGTables),r}return(0,s.default)(n,[{key:"decodeBlock",value:function(e){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(e)),this.reader.getResult().buffer}}]),n}(c.default);n.default=S},{"@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/typeof":"b9XL","./basedecoder":"FJDe"}],tbG5:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},a={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],uxo6:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],X4kj:[function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],LP5M:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,i,o,a,s,l,c,u,h,d,f,p,m,g,v,y,b,_,x,w,M,S,E,T;n=e.state,r=e.next_in,E=e.input,i=r+(e.avail_in-5),o=e.next_out,T=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),b=m[f&v];t:for(;;){if(f>>>=_=b>>>24,p-=_,0==(_=b>>>16&255))T[o++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(f&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&b,(_&=15)&&(p<_&&(f+=E[r++]<<p,p+=8),x+=f&(1<<_)-1,f>>>=_,p-=_),p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),b=g[f&y];n:for(;;){if(f>>>=_=b>>>24,p-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=g[(65535&b)+(f&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&b,p<(_&=15)&&(f+=E[r++]<<p,(p+=8)<_&&(f+=E[r++]<<p,p+=8)),(w+=f&(1<<_)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=_,p-=_,w>(_=o-a)){if((_=w-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(M=0,S=d,0===h){if(M+=c-_,_<x){x-=_;do{T[o++]=d[M++]}while(--_);M=o-w,S=T}}else if(h<_){if(M+=c+h-_,(_-=h)<x){x-=_;do{T[o++]=d[M++]}while(--_);if(M=0,h<x){x-=_=h;do{T[o++]=d[M++]}while(--_);M=o-w,S=T}}}else if(M+=h-_,_<x){x-=_;do{T[o++]=d[M++]}while(--_);M=o-w,S=T}for(;x>2;)T[o++]=S[M++],T[o++]=S[M++],T[o++]=S[M++],x-=3;x&&(T[o++]=S[M++],x>1&&(T[o++]=S[M++]))}else{M=o-w;do{T[o++]=T[M++],T[o++]=T[M++],T[o++]=T[M++],x-=3}while(x>2);x&&(T[o++]=T[M++],x>1&&(T[o++]=T[M++]))}break}}break}}while(r<i&&o<s);r-=x=p>>3,f&=(1<<(p-=x<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=p}},{}],uNlq:[function(e,t,n){"use strict";var r=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,l,c,u,h,d){var f,p,m,g,v,y,b,_,x,w=d.bits,M=0,S=0,E=0,T=0,C=0,A=0,L=0,P=0,R=0,O=0,k=null,I=0,D=new r.Buf16(16),N=new r.Buf16(16),j=null,F=0;for(M=0;M<=15;M++)D[M]=0;for(S=0;S<l;S++)D[t[n+S]]++;for(C=w,T=15;T>=1&&0===D[T];T--);if(C>T&&(C=T),0===T)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(E=1;E<T&&0===D[E];E++);for(C<E&&(C=E),P=1,M=1;M<=15;M++)if(P<<=1,(P-=D[M])<0)return-1;if(P>0&&(0===e||1!==T))return-1;for(N[1]=0,M=1;M<15;M++)N[M+1]=N[M]+D[M];for(S=0;S<l;S++)0!==t[n+S]&&(h[N[t[n+S]]++]=S);if(0===e?(k=j=h,y=19):1===e?(k=i,I-=257,j=o,F-=257,y=256):(k=a,j=s,y=-1),O=0,S=0,M=E,v=u,A=C,L=0,m=-1,g=(R=1<<C)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){b=M-L,h[S]<y?(_=0,x=h[S]):h[S]>y?(_=j[F+h[S]],x=k[I+h[S]]):(_=96,x=0),f=1<<M-L,E=p=1<<A;do{c[v+(O>>L)+(p-=f)]=b<<24|_<<16|x|0}while(0!==p);for(f=1<<M-1;O&f;)f>>=1;if(0!==f?(O&=f-1,O+=f):O=0,S++,0==--D[M]){if(M===T)break;M=t[n+h[S]]}if(M>C&&(O&g)!==m){for(0===L&&(L=C),v+=E,P=1<<(A=M-L);A+L<T&&!((P-=D[A+L])<=0);)A++,P<<=1;if(R+=1<<A,1===e&&R>852||2===e&&R>592)return 1;c[m=O&g]=C<<24|A<<16|v-u|0}}return 0!==O&&(c[v+O]=M-L<<24|64<<16|0),d.bits=C,0}},{"../utils/common":"tbG5"}],GIDK:[function(e,t,n){"use strict";var r=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),l=-2,c=12,u=30;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):l}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):l}function m(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,p(e))):l}function g(e,t){var n,r;return e?(r=new d,e.state=r,r.window=null,0!==(n=m(e,t))&&(e.state=null),n):l}var v,y,b=!0;function _(e){if(b){var t;for(v=new r.Buf32(512),y=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,y,0,e.work,{bits:5}),b=!1}e.lencode=v,e.lenbits=9,e.distcode=y,e.distbits=5}function x(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}n.inflateReset=p,n.inflateReset2=m,n.inflateResetKeep=f,n.inflateInit=function(e){return g(e,15)},n.inflateInit2=g,n.inflate=function(e,t){var n,d,f,p,m,g,v,y,b,w,M,S,E,T,C,A,L,P,R,O,k,I,D,N,j=0,F=new r.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===c&&(n.mode=13),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=n.hold,b=n.bits,w=g,M=v,I=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(2&n.wrap&&35615===y){n.check=0,F[0]=255&y,F[1]=y>>>8&255,n.check=o(n.check,F,2,0),y=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=u;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=u;break}if(b-=4,k=8+(15&(y>>>=4)),0===n.wbits)n.wbits=k;else if(k>n.wbits){e.msg="invalid window size",n.mode=u;break}n.dmax=1<<k,e.adler=n.check=1,n.mode=512&y?10:c,y=0,b=0;break;case 2:for(;b<16;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=u;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=u;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(F[0]=255&y,F[1]=y>>>8&255,n.check=o(n.check,F,2,0)),y=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.head&&(n.head.time=y),512&n.flags&&(F[0]=255&y,F[1]=y>>>8&255,F[2]=y>>>16&255,F[3]=y>>>24&255,n.check=o(n.check,F,4,0)),y=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(F[0]=255&y,F[1]=y>>>8&255,n.check=o(n.check,F,2,0)),y=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(F[0]=255&y,F[1]=y>>>8&255,n.check=o(n.check,F,2,0)),y=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((S=n.length)>g&&(S=g),S&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,d,p,S,k)),512&n.flags&&(n.check=o(n.check,d,S,p)),g-=S,p+=S,n.length-=S),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;S=0;do{k=d[p+S++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&S<g);if(512&n.flags&&(n.check=o(n.check,d,S,p)),g-=S,p+=S,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;S=0;do{k=d[p+S++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&S<g);if(512&n.flags&&(n.check=o(n.check,d,S,p)),g-=S,p+=S,k)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=u;break}y=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=c;break;case 10:for(;b<32;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}e.adler=n.check=h(y),y=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=b,2;e.adler=n.check=1,n.mode=c;case c:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}switch(n.last=1&y,b-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(_(n),n.mode=20,6===t){y>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=u}y>>>=2,b-=2;break;case 14:for(y>>>=7&b,b-=7&b;b<32;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=u;break}if(n.length=65535&y,y=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(S=n.length){if(S>g&&(S=g),S>v&&(S=v),0===S)break e;r.arraySet(f,d,p,S,m),g-=S,p+=S,v-=S,m+=S,n.length-=S;break}n.mode=c;break;case 17:for(;b<14;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(n.nlen=257+(31&y),y>>>=5,b-=5,n.ndist=1+(31&y),y>>>=5,b-=5,n.ncode=4+(15&y),y>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=u;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.lens[B[n.have++]]=7&y,y>>>=3,b-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},I=s(0,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,I){e.msg="invalid code lengths set",n.mode=u;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;A=(j=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,L=65535&j,!((C=j>>>24)<=b);){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(L<16)y>>>=C,b-=C,n.lens[n.have++]=L;else{if(16===L){for(N=C+2;b<N;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(y>>>=C,b-=C,0===n.have){e.msg="invalid bit length repeat",n.mode=u;break}k=n.lens[n.have-1],S=3+(3&y),y>>>=2,b-=2}else if(17===L){for(N=C+3;b<N;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}b-=C,k=0,S=3+(7&(y>>>=C)),y>>>=3,b-=3}else{for(N=C+7;b<N;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}b-=C,k=0,S=11+(127&(y>>>=C)),y>>>=7,b-=7}if(n.have+S>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=u;break}for(;S--;)n.lens[n.have++]=k}}if(n.mode===u)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=u;break}if(n.lenbits=9,D={bits:n.lenbits},I=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,I){e.msg="invalid literal/lengths set",n.mode=u;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},I=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,I){e.msg="invalid distances set",n.mode=u;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&v>=258){e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=b,a(e,M),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,d=e.input,g=e.avail_in,y=n.hold,b=n.bits,n.mode===c&&(n.back=-1);break}for(n.back=0;A=(j=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,L=65535&j,!((C=j>>>24)<=b);){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(A&&0==(240&A)){for(P=C,R=A,O=L;A=(j=n.lencode[O+((y&(1<<P+R)-1)>>P)])>>>16&255,L=65535&j,!(P+(C=j>>>24)<=b);){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}y>>>=P,b-=P,n.back+=P}if(y>>>=C,b-=C,n.back+=C,n.length=L,0===A){n.mode=26;break}if(32&A){n.back=-1,n.mode=c;break}if(64&A){e.msg="invalid literal/length code",n.mode=u;break}n.extra=15&A,n.mode=22;case 22:if(n.extra){for(N=n.extra;b<N;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;A=(j=n.distcode[y&(1<<n.distbits)-1])>>>16&255,L=65535&j,!((C=j>>>24)<=b);){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(0==(240&A)){for(P=C,R=A,O=L;A=(j=n.distcode[O+((y&(1<<P+R)-1)>>P)])>>>16&255,L=65535&j,!(P+(C=j>>>24)<=b);){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}y>>>=P,b-=P,n.back+=P}if(y>>>=C,b-=C,n.back+=C,64&A){e.msg="invalid distance code",n.mode=u;break}n.offset=L,n.extra=15&A,n.mode=24;case 24:if(n.extra){for(N=n.extra;b<N;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=u;break}n.mode=25;case 25:if(0===v)break e;if(S=M-v,n.offset>S){if((S=n.offset-S)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=u;break}S>n.wnext?(S-=n.wnext,E=n.wsize-S):E=n.wnext-S,S>n.length&&(S=n.length),T=n.window}else T=f,E=m-n.offset,S=n.length;S>v&&(S=v),v-=S,n.length-=S;do{f[m++]=T[E++]}while(--S);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;f[m++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===g)break e;g--,y|=d[p++]<<b,b+=8}if(M-=v,e.total_out+=M,n.total+=M,M&&(e.adler=n.check=n.flags?o(n.check,f,M,m-M):i(n.check,f,M,m-M)),M=v,(n.flags?y:h(y))!==n.check){e.msg="incorrect data check",n.mode=u;break}y=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===g)break e;g--,y+=d[p++]<<b,b+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=u;break}y=0,b=0}n.mode=29;case 29:I=1;break e;case u:I=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=b,(n.wsize||M!==e.avail_out&&n.mode<u&&(n.mode<27||4!==t))&&x(e,e.output,e.next_out,M-e.avail_out)?(n.mode=31,-4):(w-=e.avail_in,M-=e.avail_out,e.total_in+=w,e.total_out+=M,n.total+=M,n.wrap&&M&&(e.adler=n.check=n.flags?o(n.check,f,M,e.next_out-M):i(n.check,f,M,e.next_out-M)),e.data_type=n.bits+(n.last?64:0)+(n.mode===c?128:0)+(20===n.mode||15===n.mode?256:0),(0===w&&0===M||4===t)&&0===I&&(I=-5),I)},n.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,0):l},n.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&i(1,t,r,0)!==n.check?-3:x(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):l},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":"tbG5","./adler32":"uxo6","./crc32":"X4kj","./inffast":"LP5M","./inftrees":"uNlq"}],Q3ZD:[function(e,t,n){"use strict";var r=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,i,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),a=0,o=0;a<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,o,s=t||e.length,c=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)c[r++]=i;else if((o=a[i])>4)c[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&e[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return l(c,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":"tbG5"}],xUUw:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],gMAY:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],bdtv:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],WIli:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],faQk:[function(e,t,n){"use strict";var r=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),u=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[n])}function d(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(e,t){var n,s,l,c,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?d.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(d.output,d.next_out),c=d.next_out-l,h=o.buf2string(d.output,l),d.next_out=c,d.avail_out=f-c,c&&i.arraySet(d.output,d.output,l,c,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},n.ungzip=d},{"./zlib/inflate":"GIDK","./utils/common":"tbG5","./utils/strings":"Q3ZD","./zlib/constants":"xUUw","./zlib/messages":"gMAY","./zlib/zstream":"bdtv","./zlib/gzheader":"WIli"}],JAiC:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(e("@babel/runtime/helpers/classCallCheck")),i=c(e("@babel/runtime/helpers/createClass")),o=c(e("@babel/runtime/helpers/inherits")),a=c(e("@babel/runtime/helpers/possibleConstructorReturn")),s=c(e("@babel/runtime/helpers/getPrototypeOf")),l=e("pako/lib/inflate");function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){(0,o.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"decodeBlock",value:function(e){return(0,l.inflate)(new Uint8Array(e)).buffer}}]),n}(c(e("./basedecoder")).default);n.default=u},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","pako/lib/inflate":"faQk","./basedecoder":"FJDe"}],OcPz:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("@babel/runtime/helpers/classCallCheck")),i=l(e("@babel/runtime/helpers/createClass")),o=l(e("@babel/runtime/helpers/inherits")),a=l(e("@babel/runtime/helpers/possibleConstructorReturn")),s=l(e("@babel/runtime/helpers/getPrototypeOf"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){(0,o.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"decodeBlock",value:function(e){for(var t=new DataView(e),n=[],r=0;r<e.byteLength;++r){var i=t.getInt8(r);if(i<0){var o=t.getUint8(r+1);i=-i;for(var a=0;a<=i;++a)n.push(o);r+=1}else{for(var s=0;s<=i;++s)n.push(t.getUint8(r+s+1));r+=i+1}}return new Uint8Array(n).buffer}}]),n}(l(e("./basedecoder")).default);n.default=c},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./basedecoder":"FJDe"}],FGCZ:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getDecoder=function(e){switch(e.Compression){case void 0:case 1:return new r.default;case 5:return new i.default;case 6:throw new Error("old style JPEG compression is not supported.");case 7:return new o.default(e);case 8:case 32946:return new a.default;case 32773:return new s.default;default:throw new Error("Unknown compression method identifier: ".concat(e.Compression))}};var r=l(e("./raw")),i=l(e("./lzw")),o=l(e("./jpeg")),a=l(e("./deflate")),s=l(e("./packbits"));function l(e){return e&&e.__esModule?e:{default:e}}},{"./raw":"V9bQ","./lzw":"tcId","./jpeg":"J7kk","./deflate":"JAiC","./packbits":"OcPz"}],OQju:[function(e,t,n){"use strict";function r(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new(Object.getPrototypeOf(e).constructor)(t*n*r)}function i(e,t,n,i,o){var a=t/i,s=n/o;return e.map((function(e){for(var l=r(e,i,o),c=0;c<o;++c)for(var u=Math.min(Math.round(s*c),n-1),h=0;h<i;++h){var d=Math.min(Math.round(a*h),t-1),f=e[u*t+d];l[c*i+h]=f}return l}))}function o(e,t,n){return(1-n)*e+n*t}function a(e,t,n,i,a){var s=t/i,l=n/a;return e.map((function(e){for(var c=r(e,i,a),u=0;u<a;++u)for(var h=l*u,d=Math.floor(h),f=Math.min(Math.ceil(h),n-1),p=0;p<i;++p){var m=s*p,g=m%1,v=Math.floor(m),y=Math.min(Math.ceil(m),t-1),b=e[d*t+v],_=e[d*t+y],x=e[f*t+v],w=e[f*t+y],M=o(o(b,_,g),o(x,w,g),h%1);c[u*i+p]=M}return c}))}function s(e,t,n,i,o,a){for(var s=t/i,l=n/o,c=r(e,i,o,a),u=0;u<o;++u)for(var h=Math.min(Math.round(l*u),n-1),d=0;d<i;++d)for(var f=Math.min(Math.round(s*d),t-1),p=0;p<a;++p){var m=e[h*t*a+f*a+p];c[u*i*a+d*a+p]=m}return c}function l(e,t,n,i,a,s){for(var l=t/i,c=n/a,u=r(e,i,a,s),h=0;h<a;++h)for(var d=c*h,f=Math.floor(d),p=Math.min(Math.ceil(d),n-1),m=0;m<i;++m)for(var g=l*m,v=g%1,y=Math.floor(g),b=Math.min(Math.ceil(g),t-1),_=0;_<s;++_){var x=e[f*t*s+y*s+_],w=e[f*t*s+b*s+_],M=e[p*t*s+y*s+_],S=e[p*t*s+b*s+_],E=o(o(x,w,v),o(M,S,v),d%1);u[h*i*s+m*s+_]=E}return u}Object.defineProperty(n,"__esModule",{value:!0}),n.resampleNearest=i,n.resampleBilinear=a,n.resample=function(e,t,n,r,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"nearest";switch(s.toLowerCase()){case"nearest":return i(e,t,n,r,o);case"bilinear":case"linear":return a(e,t,n,r,o);default:throw new Error("Unsupported resampling method: '".concat(s,"'"))}},n.resampleNearestInterleaved=s,n.resampleBilinearInterleaved=l,n.resampleInterleaved=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"nearest";switch(a.toLowerCase()){case"nearest":return s(e,t,n,r,i,o);case"bilinear":case"linear":return l(e,t,n,r,i,o);default:throw new Error("Unsupported resampling method: '".concat(a,"'"))}}},{}],eOWo:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=p(e("@babel/runtime/helpers/slicedToArray")),i=p(e("@babel/runtime/regenerator")),o=p(e("@babel/runtime/helpers/asyncToGenerator")),a=p(e("@babel/runtime/helpers/classCallCheck")),s=p(e("@babel/runtime/helpers/createClass")),l=e("@petamoriken/float16"),c=p(e("txml")),u=e("./globals"),h=e("./rgb"),d=e("./compression"),f=e("./resample");function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t,n){for(var r=0,i=t;i<n;++i)r+=e[i];return r}function g(e,t,n){switch(e){case 1:if(t<=8)return new Uint8Array(n);if(t<=16)return new Uint16Array(n);if(t<=32)return new Uint32Array(n);break;case 2:if(8===t)return new Int8Array(n);if(16===t)return new Int16Array(n);if(32===t)return new Int32Array(n);break;case 3:switch(t){case 16:case 32:return new Float32Array(n);case 64:return new Float64Array(n)}}throw Error("Unsupported data format/bitsPerSample")}function v(e,t){return(1!==e&&2!==e||!(t<=32)||t%8!=0)&&(3!==e||16!==t&&32!==t&&64!==t)}function y(e,t,n,r,i,o,a){var s=new DataView(e),l=2===n?1:r,c=g(t,i,2===n?a*o:a*o*r),u=parseInt("1".repeat(i),2);if(1===t){var h=o*(1===n?r*i:i);0!=(7&h)&&(h=h+7&-8);for(var d=0;d<a;++d)for(var f=d*h,p=0;p<o;++p)for(var m=f+p*l*i,v=0;v<l;++v){var y=m+v*i,b=(d*o+p)*l+v,_=Math.floor(y/8),x=y%8;if(x+i<=8)c[b]=s.getUint8(_)>>8-i-x&u;else if(x+i<=16)c[b]=s.getUint16(_)>>16-i-x&u;else if(x+i<=24){var w=s.getUint16(_)<<8|s.getUint8(_+2);c[b]=w>>24-i-x&u}else c[b]=s.getUint32(_)>>32-i-x&u}}return c.buffer}var b=function(){function e(t,n,r,i,o,s){(0,a.default)(this,e),this.fileDirectory=t,this.geoKeys=n,this.dataView=r,this.littleEndian=i,this.tiles=o?{}:null,this.isTiled=!t.StripOffsets;var l=t.PlanarConfiguration;if(this.planarConfiguration=void 0===l?1:l,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=s}return(0,s.default)(e,[{key:"getFileDirectory",value:function(){return this.fileDirectory}},{key:"getGeoKeys",value:function(){return this.geoKeys}},{key:"getWidth",value:function(){return this.fileDirectory.ImageWidth}},{key:"getHeight",value:function(){return this.fileDirectory.ImageLength}},{key:"getSamplesPerPixel",value:function(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}},{key:"getTileWidth",value:function(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}},{key:"getTileHeight",value:function(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}},{key:"getBlockWidth",value:function(){return this.getTileWidth()}},{key:"getBlockHeight",value:function(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}},{key:"getBytesPerPixel",value:function(){for(var e=0,t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}},{key:"getSampleByteSize",value:function(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError("Sample index ".concat(e," is out of range."));return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}},{key:"getReaderForSample",value:function(e){var t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(e,t){return(0,l.getFloat16)(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}},{key:"getSampleFormat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}},{key:"getBitsPerSample",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.fileDirectory.BitsPerSample[e]}},{key:"getArrayForSample",value:function(e,t){return g(this.getSampleFormat(e),this.getBitsPerSample(e),t)}},{key:"getTileOrStrip",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n,r,a,s){var l,c,u,h,d,f,p,m,g=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=Math.ceil(this.getWidth()/this.getTileWidth()),c=Math.ceil(this.getHeight()/this.getTileHeight()),h=this.tiles,1===this.planarConfiguration?u=n*l+t:2===this.planarConfiguration&&(u=r*l*c+n*l+t),this.isTiled?(d=this.fileDirectory.TileOffsets[u],f=this.fileDirectory.TileByteCounts[u]):(d=this.fileDirectory.StripOffsets[u],f=this.fileDirectory.StripByteCounts[u]),e.next=7,this.source.fetch([{offset:d,length:f}],s);case 7:return p=e.sent[0],null!==h&&h[u]?m=h[u]:(m=(0,o.default)(i.default.mark((function e(){var t,r,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.decode(g.fileDirectory,p);case 2:return t=e.sent,r=g.getSampleFormat(),o=g.getBitsPerSample(),v(r,o)&&(t=y(t,r,g.planarConfiguration,g.getSamplesPerPixel(),o,g.getTileWidth(),g.getBlockHeight(n))),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))(),null!==h&&(h[u]=m)),e.t0=t,e.t1=n,e.t2=r,e.next=14,m;case 14:return e.t3=e.sent,e.abrupt("return",{x:e.t0,y:e.t1,sample:e.t2,data:e.t3});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"_readRaster",value:function(){var e=(0,o.default)(i.default.mark((function e(t,n,r,o,a,s,l,c,u){var h,d,p,g,v,y,b,_,x,w,M,S,E,T,C,A,L,P,R=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(h=this.getTileWidth(),d=this.getTileHeight(),p=Math.max(Math.floor(t[0]/h),0),g=Math.min(Math.ceil(t[2]/h),Math.ceil(this.getWidth()/this.getTileWidth())),v=Math.max(Math.floor(t[1]/d),0),y=Math.min(Math.ceil(t[3]/d),Math.ceil(this.getHeight()/this.getTileHeight())),b=t[2]-t[0],_=this.getBytesPerPixel(),x=[],w=[],M=0;M<n.length;++M)1===this.planarConfiguration?x.push(m(this.fileDirectory.BitsPerSample,0,n[M])/8):x.push(0),w.push(this.getReaderForSample(n[M]));for(S=[],E=this.littleEndian,T=v;T<y;++T)for(C=p;C<g;++C)for(A=function(e){var i=e,s=n[e];2===R.planarConfiguration&&(_=R.getSampleByteSize(e));var l=R.getTileOrStrip(C,T,s,a,u);S.push(l),l.then((function(e){for(var a=e.data,s=new DataView(a),l=R.getBlockHeight(e.y),c=e.y*d,u=e.x*h,f=c+l,p=(e.x+1)*h,m=w[i],g=Math.min(l,l-(f-t[3])),v=Math.min(h,h-(p-t[2])),y=Math.max(0,t[1]-c);y<g;++y)for(var M=Math.max(0,t[0]-u);M<v;++M){var S=(y*h+M)*_,T=m.call(s,S+x[i],E),C=void 0;o?(C=(y+c-t[1])*b*n.length+(M+u-t[0])*n.length+i,r[C]=T):(C=(y+c-t[1])*b+M+u-t[0],r[i][C]=T)}}))},L=0;L<n.length;++L)A(L);return e.next=16,Promise.all(S);case 16:if(!(s&&t[2]-t[0]!==s||l&&t[3]-t[1]!==l)){e.next=21;break}return(P=o?(0,f.resampleInterleaved)(r,t[2]-t[0],t[3]-t[1],s,l,n.length,c):(0,f.resample)(r,t[2]-t[0],t[3]-t[1],s,l,c)).width=s,P.height=l,e.abrupt("return",P);case 21:return r.width=s||t[2]-t[0],r.height=l||t[3]-t[1],e.abrupt("return",r);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,s,l,c){return e.apply(this,arguments)}}()},{key:"readRasters",value:function(){var e=(0,o.default)(i.default.mark((function e(){var t,n,r,o,a,s,l,c,u,h,f,p,m,v,y,b,_,x,w,M,S,E,T,C,A,L,P=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=P.length>0&&void 0!==P[0]?P[0]:{},n=t.window,r=t.samples,o=void 0===r?[]:r,a=t.interleave,s=t.pool,l=void 0===s?null:s,c=t.width,u=t.height,h=t.resampleMethod,f=t.fillValue,p=t.signal,!((m=n||[0,0,this.getWidth(),this.getHeight()])[0]>m[2]||m[1]>m[3])){e.next=4;break}throw new Error("Invalid subsets");case 4:if(v=m[2]-m[0],y=m[3]-m[1],b=v*y,_=this.getSamplesPerPixel(),o&&o.length){e.next=12;break}for(x=0;x<_;++x)o.push(x);e.next=19;break;case 12:w=0;case 13:if(!(w<o.length)){e.next=19;break}if(!(o[w]>=_)){e.next=16;break}return e.abrupt("return",Promise.reject(new RangeError("Invalid sample index '".concat(o[w],"'."))));case 16:++w,e.next=13;break;case 19:if(a)S=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample),M=g(S,E,b*o.length),f&&M.fill(f);else for(M=[],T=0;T<o.length;++T)C=this.getArrayForSample(o[T],b),Array.isArray(f)&&T<f.length?C.fill(f[T]):f&&!Array.isArray(f)&&C.fill(f),M.push(C);return A=l||(0,d.getDecoder)(this.fileDirectory),e.next=23,this._readRaster(m,o,M,a,A,c,u,h,p);case 23:return L=e.sent,e.abrupt("return",L);case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readRGB",value:function(){var e=(0,o.default)(i.default.mark((function e(){var t,n,r,o,a,s,l,c,d,f,p,m,g,v,y,b,_,x,w,M,S=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.length>0&&void 0!==S[0]?S[0]:{},n=t.window,r=t.pool,o=void 0===r?null:r,a=t.width,s=t.height,l=t.resampleMethod,c=t.enableAlpha,d=void 0!==c&&c,f=t.signal,!((p=n||[0,0,this.getWidth(),this.getHeight()])[0]>p[2]||p[1]>p[3])){e.next=4;break}throw new Error("Invalid subsets");case 4:if((m=this.fileDirectory.PhotometricInterpretation)!==u.photometricInterpretations.RGB){e.next=9;break}if(g=[0,1,2],this.fileDirectory.ExtraSamples!==u.ExtraSamplesValues.Unspecified&&d)for(g=[],v=0;v<this.fileDirectory.BitsPerSample.length;v+=1)g.push(v);return e.abrupt("return",this.readRasters({window:n,interleave:!0,samples:g,pool:o,width:a,height:s,resampleMethod:l,signal:f}));case 9:e.t0=m,e.next=e.t0===u.photometricInterpretations.WhiteIsZero||e.t0===u.photometricInterpretations.BlackIsZero||e.t0===u.photometricInterpretations.Palette?12:e.t0===u.photometricInterpretations.CMYK?14:e.t0===u.photometricInterpretations.YCbCr||e.t0===u.photometricInterpretations.CIELab?16:18;break;case 12:return y=[0],e.abrupt("break",19);case 14:return y=[0,1,2,3],e.abrupt("break",19);case 16:return y=[0,1,2],e.abrupt("break",19);case 18:throw new Error("Invalid or unsupported photometric interpretation.");case 19:return b={window:p,interleave:!0,samples:y,pool:o,width:a,height:s,resampleMethod:l,signal:f},_=this.fileDirectory,e.next=23,this.readRasters(b);case 23:x=e.sent,w=Math.pow(2,this.fileDirectory.BitsPerSample[0]),e.t1=m,e.next=e.t1===u.photometricInterpretations.WhiteIsZero?28:e.t1===u.photometricInterpretations.BlackIsZero?30:e.t1===u.photometricInterpretations.Palette?32:e.t1===u.photometricInterpretations.CMYK?34:e.t1===u.photometricInterpretations.YCbCr?36:e.t1===u.photometricInterpretations.CIELab?38:40;break;case 28:return M=(0,h.fromWhiteIsZero)(x,w),e.abrupt("break",41);case 30:return M=(0,h.fromBlackIsZero)(x,w),e.abrupt("break",41);case 32:return M=(0,h.fromPalette)(x,_.ColorMap),e.abrupt("break",41);case 34:return M=(0,h.fromCMYK)(x),e.abrupt("break",41);case 36:return M=(0,h.fromYCbCr)(x),e.abrupt("break",41);case 38:return M=(0,h.fromCIELab)(x),e.abrupt("break",41);case 40:throw new Error("Unsupported photometric interpretation.");case 41:return M.width=x.width,M.height=x.height,e.abrupt("return",M);case 44:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTiePoints",value:function(){if(!this.fileDirectory.ModelTiepoint)return[];for(var e=[],t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}},{key:"getGDALMetadata",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={};if(!this.fileDirectory.GDAL_METADATA)return null;var n=this.fileDirectory.GDAL_METADATA,r=(0,c.default)(n.substring(0,n.length-1));if(!r[0].tagName)throw new Error("Failed to parse GDAL metadata XML.");var i=r[0];if("GDALMetadata"!==i.tagName)throw new Error("Unexpected GDAL metadata XML tag.");var o=i.children.filter((function(e){return"Item"===e.tagName}));null!==e&&(o=o.filter((function(t){return Number(t.attributes.sample)===e})));for(var a=0;a<o.length;++a){var s=o[a];t[s.attributes.name]=s.children[0]}return t}},{key:"getGDALNoData",value:function(){if(!this.fileDirectory.GDAL_NODATA)return null;var e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}},{key:"getOrigin",value:function(){var e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}},{key:"getResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return[n[0],n[5],n[10]];if(e){var i=e.getResolution(),o=(0,r.default)(i,3),a=o[0],s=o[1],l=o[2];return[a*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),l*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}},{key:"pixelIsArea",value:function(){return 1===this.geoKeys.GTRasterTypeGeoKey}},{key:"getBoundingBox",value:function(){var e=this.getOrigin(),t=this.getResolution(),n=e[0],r=e[1],i=n+t[0]*this.getWidth(),o=r+t[1]*this.getHeight();return[Math.min(n,i),Math.min(r,o),Math.max(n,i),Math.max(r,o)]}}]),e}();n.default=b},{"@babel/runtime/helpers/slicedToArray":"HETk","@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@petamoriken/float16":"Stm8",txml:"JO74","./globals":"j27V","./rgb":"fpBl","./compression":"FGCZ","./resample":"OQju"}],dqpX:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("@babel/runtime/helpers/classCallCheck")),i=a(e("@babel/runtime/helpers/createClass")),o=e("@petamoriken/float16");function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this._dataView=new DataView(t)}return(0,i.default)(e,[{key:"getUint64",value:function(e,t){var n,r=this.getUint32(e,t),i=this.getUint32(e+4,t);if(t){if(n=r+Math.pow(2,32)*i,!Number.isSafeInteger(n))throw new Error("".concat(n," exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues"));return n}if(n=Math.pow(2,32)*r+i,!Number.isSafeInteger(n))throw new Error("".concat(n," exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues"));return n}},{key:"getInt64",value:function(e,t){for(var n=0,r=(128&this._dataView.getUint8(e+(t?7:0)))>0,i=!0,o=0;o<8;o++){var a=this._dataView.getUint8(e+(t?o:7-o));r&&(i?0!==a&&(a=255&~(a-1),i=!1):a=255&~a),n+=a*Math.pow(256,o)}return r&&(n=-n),n}},{key:"getUint8",value:function(e,t){return this._dataView.getUint8(e,t)}},{key:"getInt8",value:function(e,t){return this._dataView.getInt8(e,t)}},{key:"getUint16",value:function(e,t){return this._dataView.getUint16(e,t)}},{key:"getInt16",value:function(e,t){return this._dataView.getInt16(e,t)}},{key:"getUint32",value:function(e,t){return this._dataView.getUint32(e,t)}},{key:"getInt32",value:function(e,t){return this._dataView.getInt32(e,t)}},{key:"getFloat16",value:function(e,t){return(0,o.getFloat16)(this._dataView,t)}},{key:"getFloat32",value:function(e,t){return this._dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e,t){return this._dataView.getFloat64(e,t)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}();n.default=s},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@petamoriken/float16":"Stm8"}],dGLV:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("@babel/runtime/helpers/classCallCheck")),i=o(e("@babel/runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,n,i,o){(0,r.default)(this,e),this._dataView=new DataView(t),this._sliceOffset=n,this._littleEndian=i,this._bigTiff=o}return(0,i.default)(e,[{key:"covers",value:function(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}},{key:"readUint8",value:function(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}},{key:"readInt8",value:function(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}},{key:"readUint16",value:function(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}},{key:"readInt16",value:function(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}},{key:"readUint32",value:function(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}},{key:"readInt32",value:function(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}},{key:"readFloat32",value:function(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}},{key:"readFloat64",value:function(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}},{key:"readUint64",value:function(e){var t,n=this.readUint32(e),r=this.readUint32(e+4);if(this._littleEndian){if(t=n+Math.pow(2,32)*r,!Number.isSafeInteger(t))throw new Error("".concat(t," exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues"));return t}if(t=Math.pow(2,32)*n+r,!Number.isSafeInteger(t))throw new Error("".concat(t," exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues"));return t}},{key:"readInt64",value:function(e){for(var t=0,n=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0,r=!0,i=0;i<8;i++){var o=this._dataView.getUint8(e+(this._littleEndian?i:7-i));n&&(r?0!==o&&(o=255&~(o-1),r=!1):o=255&~o),t+=o*Math.pow(256,i)}return n&&(t=-t),t}},{key:"readOffset",value:function(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}},{key:"sliceOffset",get:function(){return this._sliceOffset}},{key:"sliceTop",get:function(){return this._sliceOffset+this.buffer.byteLength}},{key:"littleEndian",get:function(){return this._littleEndian}},{key:"bigTiff",get:function(){return this._bigTiff}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}();n.default=a},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW"}],z2GM:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.extendSerializer=function(e,t){const n=e.deserialize.bind(e),r=e.serialize.bind(e);return{deserialize:e=>t.deserialize(e,n),serialize:e=>t.serialize(e,r)}},n.DefaultSerializer=void 0;const r={deserialize:e=>(e=>e&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker)(e)?(e=>Object.assign(Error(e.message),{name:e.name,stack:e.stack}))(e):e,serialize:e=>e instanceof Error?(e=>({__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack}))(e):e};n.DefaultSerializer=r},{}],kdjL:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerSerializer=function(e){i=(0,r.extendSerializer)(i,e)},n.deserialize=function(e){return i.deserialize(e)},n.serialize=function(e){return i.serialize(e)};var r=e("./serializers");let i=r.DefaultSerializer},{"./serializers":"z2GM"}],LQHy:[function(e,t,n){"use strict";let r;function i(e){return(""+e).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Object.defineProperty(n,"__esModule",{value:!0}),n.getBaseURL=i,n.getBundleURL=function(){return r||(r=function(){try{throw new Error}catch(e){const t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return i(t[0])}return"/"}()),r}},{}],XK2w:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.selectWorkerImplementation=function(){return"undefined"==typeof Worker?class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}}:class extends Worker{constructor(e,t){"string"==typeof e&&t&&t._baseURL?e=new URL(e,t._baseURL):"string"==typeof e&&!o(e)&&(0,r.getBundleURL)().match(/^file:\/\//i)&&(e=new URL(e,(0,r.getBundleURL)().replace(/\/[^\/]+$/,"/")),e=a(`importScripts(${JSON.stringify(e)});`)),"string"==typeof e&&o(e)&&(e=a(`importScripts(${JSON.stringify(e)});`)),super(e,t)}}},n.defaultPoolSize=void 0;var r=e("./get-bundle-url.browser");const i="undefined"!=typeof navigator&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;n.defaultPoolSize=i;const o=e=>/^(file|https?:)?\/\//i.test(e);function a(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}},{"./get-bundle-url.browser":"LQHy"}],IAgR:[function(e,t,n){var r=1e3,i=6e4,o=60*i,a=24*o;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}t.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=a?s(e,t,a,"day"):t>=o?s(e,t,o,"hour"):t>=i?s(e,t,i,"minute"):t>=r?s(e,t,r,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=o?Math.round(e/o)+"h":t>=i?Math.round(e/i)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],Kest:[function(e,t,n){t.exports=function(t){function n(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let t;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),o=i-(t||i);n.diff=o,n.prev=t,n.curr=i,t=i,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if("%%"===t)return t;s++;const o=r.formatters[i];if("function"==typeof o){const r=e[s];t=o.call(n,r),e.splice(s,1),s--}return t}),r.formatArgs.call(n,e),(n.log||r.log).apply(n,e)}return a.namespace=e,a.enabled=r.enabled(e),a.useColors=r.useColors(),a.color=n(e),a.destroy=i,a.extend=o,"function"==typeof r.init&&r.init(a),r.instances.push(a),a}function i(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(a),...r.skips.map(a).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),Object.keys(t).forEach(e=>{r[e]=t[e]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=n,r.enable(r.load()),r}},{ms:"IAgR"}],jcLW:[function(e,t,n){e("process");var r=e("process");n.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=function(){let e;try{e=n.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=void 0),e},n.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage=function(){try{return localStorage}catch(e){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(n);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},{"./common":"Kest",process:"pBGv"}],sfrJ:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AsyncSerialScheduler=void 0,n.AsyncSerialScheduler=class{constructor(e){this._baseObserver=e,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(e=>this._baseObserver.error(e))}error(e){this._baseObserver.error(e)}schedule(e){const t=Promise.all(this._pendingPromises),n=[],r=e=>n.push(e),i=Promise.resolve().then(()=>function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){yield t,yield e(r),this._pendingPromises.delete(i);for(const e of n)this._baseObserver.next(e)}))).catch(e=>{this._pendingPromises.delete(i),this._baseObserver.error(e)});this._pendingPromises.add(i)}}},{}],lj3f:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerObservableSymbol=function(){r()&&!i("observable")&&(Symbol.observable=Symbol("observable"))},n.getSymbol=n.hasSymbol=n.hasSymbols=void 0;const r=()=>"function"==typeof Symbol;n.hasSymbols=r;const i=e=>r()&&Boolean(Symbol[e]);n.hasSymbol=i,n.getSymbol=e=>i(e)?Symbol[e]:"@@"+e,i("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"))},{}],B9l3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Observable=n.SubscriptionObserver=n.Subscription=void 0;var r=e("./_symbols");const i=(0,r.getSymbol)("iterator"),o=(0,r.getSymbol)("observable"),a=(0,r.getSymbol)("species");function s(e,t){const n=e[t];if(null!=n){if("function"!=typeof n)throw new TypeError(n+" is not a function");return n}}function l(e){let t=e.constructor;return void 0!==t&&null===(t=t[a])&&(t=void 0),void 0!==t?t:v}function c(e){c.log?c.log(e):setTimeout(()=>{throw e},0)}function u(e){Promise.resolve().then(()=>{try{e()}catch(e){c(e)}})}function h(e){const t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{const e=s(t,"unsubscribe");e&&e.call(t)}}catch(e){c(e)}}function d(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function f(e,t,n){e._state="running";const r=e._observer;try{const i=r?s(r,t):void 0;switch(t){case"next":i&&i.call(r,n);break;case"error":if(d(e),!i)throw n;i.call(r,n);break;case"complete":d(e),i&&i.call(r)}}catch(e){c(e)}"closed"===e._state?h(e):"running"===e._state&&(e._state="ready")}function p(e,t,n){if("closed"!==e._state)return"buffering"===e._state?(e._queue=e._queue||[],void e._queue.push({type:t,value:n})):"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:n}],void u(()=>function(e){const t=e._queue;if(t){e._queue=void 0,e._state="ready";for(const n of t)if(f(e,n.type,n.value),"closed"===e._state)break}}(e))):void f(e,t,n)}class m{constructor(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";const n=new g(this);try{this._cleanup=t.call(void 0,n)}catch(e){n.error(e)}"initializing"===this._state&&(this._state="ready")}get closed(){return"closed"===this._state}unsubscribe(){"closed"!==this._state&&(d(this),h(this))}}n.Subscription=m;class g{constructor(e){this._subscription=e}get closed(){return"closed"===this._subscription._state}next(e){p(this._subscription,"next",e)}error(e){p(this._subscription,"error",e)}complete(){p(this._subscription,"complete")}}n.SubscriptionObserver=g;class v{constructor(e){if(!(this instanceof v))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof e)throw new TypeError("Observable initializer must be a function");this._subscriber=e}subscribe(e,t,n){return"object"==typeof e&&null!==e||(e={next:e,error:t,complete:n}),new m(e,this._subscriber)}pipe(e,...t){let n=this;for(const r of[e,...t])n=r(n);return n}tap(e,t,n){const r="object"!=typeof e||null===e?{next:e,error:t,complete:n}:e;return new v(e=>this.subscribe({next(t){r.next&&r.next(t),e.next(t)},error(t){r.error&&r.error(t),e.error(t)},complete(){r.complete&&r.complete(),e.complete()},start(e){r.start&&r.start(e)}}))}forEach(e){return new Promise((t,n)=>{if("function"!=typeof e)return void n(new TypeError(e+" is not a function"));function r(){i.unsubscribe(),t()}const i=this.subscribe({next(t){try{e(t,r)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t})})}map(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(l(this))(t=>this.subscribe({next(n){let r=n;try{r=e(n)}catch(e){return t.error(e)}t.next(r)},error(e){t.error(e)},complete(){t.complete()}}))}filter(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(l(this))(t=>this.subscribe({next(n){try{if(!e(n))return}catch(e){return t.error(e)}t.next(n)},error(e){t.error(e)},complete(){t.complete()}}))}reduce(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");const n=l(this),r=arguments.length>1;let i=!1,o=t;return new n(t=>this.subscribe({next(n){const a=!i;if(i=!0,!a||r)try{o=e(o,n)}catch(e){return t.error(e)}else o=n},error(e){t.error(e)},complete(){if(!i&&!r)return t.error(new TypeError("Cannot reduce an empty sequence"));t.next(o),t.complete()}}))}concat(...e){const t=l(this);return new t(n=>{let r,i=0;return function o(a){r=a.subscribe({next(e){n.next(e)},error(e){n.error(e)},complete(){i===e.length?(r=void 0,n.complete()):o(t.from(e[i++]))}})}(this),()=>{r&&(r.unsubscribe(),r=void 0)}})}flatMap(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=l(this);return new t(n=>{const r=[],i=this.subscribe({next(i){let a;if(e)try{a=e(i)}catch(e){return n.error(e)}else a=i;const s=t.from(a).subscribe({next(e){n.next(e)},error(e){n.error(e)},complete(){const e=r.indexOf(s);e>=0&&r.splice(e,1),o()}});r.push(s)},error(e){n.error(e)},complete(){o()}});function o(){i.closed&&0===r.length&&n.complete()}return()=>{r.forEach(e=>e.unsubscribe()),i.unsubscribe()}})}[o](){return this}static from(e){const t="function"==typeof this?this:v;if(null==e)throw new TypeError(e+" is not an object");const n=s(e,o);if(n){const r=n.call(e);if(Object(r)!==r)throw new TypeError(r+" is not an object");return function(e){return e instanceof v}(r)&&r.constructor===t?r:new t(e=>r.subscribe(e))}if((0,r.hasSymbol)("iterator")){const n=s(e,i);if(n)return new t(t=>{u(()=>{if(!t.closed){for(const r of n.call(e))if(t.next(r),t.closed)return;t.complete()}})})}if(Array.isArray(e))return new t(t=>{u(()=>{if(!t.closed){for(const n of e)if(t.next(n),t.closed)return;t.complete()}})});throw new TypeError(e+" is not observable")}static of(...e){return new("function"==typeof this?this:v)(t=>{u(()=>{if(!t.closed){for(const n of e)if(t.next(n),t.closed)return;t.complete()}})})}static get[a](){return this}}n.Observable=v,(0,r.hasSymbols)()&&Object.defineProperty(v,Symbol("extensions"),{value:{symbol:o,hostReportError:c},configurable:!0});var y=v;n.default=y},{"./_symbols":"lj3f"}],QC75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e){"function"==typeof e?e():e&&"function"==typeof e.unsubscribe&&e.unsubscribe()}},{}],apmd:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./_scheduler"),i=a(e("./observable")),o=a(e("./unsubscribe"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){return t=>new i.default(n=>{const i=new r.AsyncSerialScheduler(n),a=t.subscribe({complete(){i.complete()},error(e){i.error(e)},next(t){i.schedule(n=>function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){(yield e(t))&&n(t)})))}});return()=>(0,o.default)(a)})}},{"./_scheduler":"sfrJ","./observable":"B9l3","./unsubscribe":"QC75"}],FgiE:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterator=function(e){return e&&(0,r.hasSymbol)("asyncIterator")&&e[Symbol.asyncIterator]},n.isIterator=function(e){return e&&(0,r.hasSymbol)("iterator")&&e[Symbol.iterator]};var r=e("./_symbols")},{"./_symbols":"lj3f"}],ltny:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./_scheduler"),i=e("./_util"),o=s(e("./observable")),a=s(e("./unsubscribe"));function s(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){return t=>new o.default(n=>{const o=new r.AsyncSerialScheduler(n),s=t.subscribe({complete(){o.complete()},error(e){o.error(e)},next(t){o.schedule(n=>function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){var r,o;const a=yield e(t);if((0,i.isIterator)(a)||(0,i.isAsyncIterator)(a))try{for(var s,l=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(a);!(s=yield l.next()).done;){const e=s.value;n(e)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=l.return)&&(yield o.call(l))}finally{if(r)throw r.error}}else a.map(e=>n(e))})))}});return()=>(0,a.default)(s)})}},{"./_scheduler":"sfrJ","./_util":"FgiE","./observable":"B9l3","./unsubscribe":"QC75"}],jAhG:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return new r.Observable(t=>{let n=0;const r=setInterval(()=>{t.next(n++)},e);return()=>clearInterval(r)})};var r=e("./observable")},{"./observable":"B9l3"}],aP59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./_scheduler"),i=a(e("./observable")),o=a(e("./unsubscribe"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){return t=>new i.default(n=>{const i=new r.AsyncSerialScheduler(n),a=t.subscribe({complete(){i.complete()},error(e){i.error(e)},next(t){i.schedule(n=>function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){const r=yield e(t);n(r)})))}});return()=>(0,o.default)(a)})}},{"./_scheduler":"sfrJ","./observable":"B9l3","./unsubscribe":"QC75"}],Rg1v:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./observable"),i=function(e){return e&&e.__esModule?e:{default:e}}(e("./unsubscribe"));n.default=function(...e){return 0===e.length?r.Observable.from([]):new r.Observable(t=>{let n=0;const r=e.map(r=>r.subscribe({error(e){t.error(e),o()},next(e){t.next(e)},complete(){++n===e.length&&(t.complete(),o())}})),o=()=>{r.forEach(e=>(0,i.default)(e))};return o})}},{"./observable":"B9l3","./unsubscribe":"QC75"}],wtHd:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./observable"));class i extends r.default{constructor(){super(e=>(this._observers.add(e),()=>this._observers.delete(e))),this._observers=new Set}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){for(const e of this._observers)e.complete()}}var o=i;n.default=o},{"./observable":"B9l3"}],NgdC:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./observable")),i=a(e("./subject")),o=a(e("./unsubscribe"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(e){const t=new i.default;let n,a=0;return new r.default(r=>{n||(n=e.subscribe(t));const i=t.subscribe(r);return a++,()=>{a--,i.unsubscribe(),0===a&&((0,o.default)(n),n=void 0)}})}},{"./observable":"B9l3","./subject":"wtHd","./unsubscribe":"QC75"}],b7o0:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("./_scheduler"),i=a(e("./observable")),o=a(e("./unsubscribe"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t){return n=>new i.default(i=>{let a,s=0;const l=new r.AsyncSerialScheduler(i),c=n.subscribe({complete(){l.complete()},error(e){l.error(e)},next(n){l.schedule(r=>function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){const i=0===s?void 0===t?n:t:a;a=yield e(i,n,s++),r(a)})))}});return()=>(0,o.default)(c)})}},{"./_scheduler":"sfrJ","./observable":"B9l3","./unsubscribe":"QC75"}],cyO3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"filter",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"flatMap",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"interval",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"map",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"merge",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"multicast",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"Observable",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"scan",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"Subject",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(n,"unsubscribe",{enumerable:!0,get:function(){return d.default}});var r=f(e("./filter")),i=f(e("./flatMap")),o=f(e("./interval")),a=f(e("./map")),s=f(e("./merge")),l=f(e("./multicast")),c=f(e("./observable")),u=f(e("./scan")),h=f(e("./subject")),d=f(e("./unsubscribe"));function f(e){return e&&e.__esModule?e:{default:e}}},{"./filter":"apmd","./flatMap":"ltny","./interval":"jAhG","./map":"aP59","./merge":"Rg1v","./multicast":"NgdC","./observable":"B9l3","./scan":"b7o0","./subject":"wtHd","./unsubscribe":"QC75"}],vpgy:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.allSettled=function(e){return Promise.all(e.map(e=>{const t=e=>({status:"fulfilled",value:e}),n=e=>({status:"rejected",reason:e}),r=Promise.resolve(e);try{return r.then(t,n)}catch(e){return Promise.reject(e)}}))}},{}],UYCO:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.PoolEventType=void 0,n.PoolEventType=r,function(e){e.initialized="initialized",e.taskCanceled="taskCanceled",e.taskCompleted="taskCompleted",e.taskFailed="taskFailed",e.taskQueued="taskQueued",e.taskQueueDrained="taskQueueDrained",e.taskStart="taskStart",e.terminated="terminated"}(r||(n.PoolEventType=r={}))},{}],fmdM:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.$worker=n.$transferable=n.$terminate=n.$events=n.$errors=void 0;const r=Symbol("thread.errors");n.$errors=r;const i=Symbol("thread.events");n.$events=i;const o=Symbol("thread.terminate");n.$terminate=o;const a=Symbol("thread.transferable");n.$transferable=a;const s=Symbol("thread.worker");n.$worker=s},{}],LBuu:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Thread=void 0;var r=e("../symbols");function i(e){throw Error(e)}const o={errors:e=>e[r.$errors]||i("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),events:e=>e[r.$events]||i("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),terminate:e=>e[r.$terminate]()};n.Thread=o},{"../symbols":"fmdM"}],EB3M:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"PoolEventType",{enumerable:!0,get:function(){return s.PoolEventType}}),Object.defineProperty(n,"Thread",{enumerable:!0,get:function(){return l.Thread}}),n.Pool=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("debug")),i=e("observable-fns"),o=e("../ponyfills"),a=e("./implementation"),s=e("./pool-types"),l=e("./thread"),c=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};let u=1;class h{constructor(e,t){this.eventSubject=new i.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const n="number"==typeof t?{size:t}:t||{},{size:o=a.defaultPoolSize}=n;this.debug=(0,r.default)("threads:pool:"+function(e){return e.replace(/\W/g," ").trim().replace(/\s+/g,"-")}(n.name||String(u++))),this.options=n,this.workers=function(e,t){return function(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}(t).map(()=>({init:e(),runningTasks:[]}))}(e,o),this.eventObservable=(0,i.multicast)(i.Observable.from(this.eventSubject)),Promise.all(this.workers.map(e=>e.init)).then(()=>this.eventSubject.next({type:s.PoolEventType.initialized,size:this.workers.length}),e=>{this.debug("Error while initializing pool worker:",e),this.eventSubject.error(e),this.initErrors.push(e)})}findIdlingWorker(){const{concurrency:e=1}=this.options;return this.workers.find(t=>t.runningTasks.length<e)}runPoolTask(e,t){return c(this,void 0,void 0,(function*(){const n=this.workers.indexOf(e)+1;this.debug(`Running task #${t.id} on worker #${n}...`),this.eventSubject.next({type:s.PoolEventType.taskStart,taskID:t.id,workerID:n});try{const r=yield t.run(yield e.init);this.debug(`Task #${t.id} completed successfully`),this.eventSubject.next({type:s.PoolEventType.taskCompleted,returnValue:r,taskID:t.id,workerID:n})}catch(e){this.debug(`Task #${t.id} failed`),this.eventSubject.next({type:s.PoolEventType.taskFailed,taskID:t.id,error:e,workerID:n})}}))}run(e,t){return c(this,void 0,void 0,(function*(){const n=(()=>c(this,void 0,void 0,(function*(){yield new Promise(e=>setTimeout(e,0));try{yield this.runPoolTask(e,t)}finally{e.runningTasks=e.runningTasks.filter(e=>e!==n),this.isClosing||this.scheduleWork()}})))();e.runningTasks.push(n)}))}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const e=this.findIdlingWorker();if(!e)return;const t=this.taskQueue.shift();if(!t)return this.debug("Task queue is empty"),void this.eventSubject.next({type:s.PoolEventType.taskQueueDrained});this.run(e,t)}taskCompletion(e){return new Promise((t,n)=>{const r=this.events().subscribe(i=>{i.type===s.PoolEventType.taskCompleted&&i.taskID===e?(r.unsubscribe(),t(i.returnValue)):i.type===s.PoolEventType.taskFailed&&i.taskID===e?(r.unsubscribe(),n(i.error)):i.type===s.PoolEventType.terminated&&(r.unsubscribe(),n(Error("Pool has been terminated before task was run.")))})})}settled(e=!1){return c(this,void 0,void 0,(function*(){const t=()=>function(e,t){return e.reduce((e,n)=>[...e,...t(n)],[])}(this.workers,e=>e.runningTasks),n=[],r=this.eventObservable.subscribe(e=>{e.type===s.PoolEventType.taskFailed&&n.push(e.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):e&&0===this.taskQueue.length?(yield(0,o.allSettled)(t()),n):(yield new Promise((e,t)=>{const n=this.eventObservable.subscribe({next(t){t.type===s.PoolEventType.taskQueueDrained&&(n.unsubscribe(),e())},error:t})}),yield(0,o.allSettled)(t()),r.unsubscribe(),n)}))}completed(e=!1){return c(this,void 0,void 0,(function*(){const t=this.settled(e),n=new Promise((e,n)=>{const r=this.eventObservable.subscribe({next(i){i.type===s.PoolEventType.taskQueueDrained?(r.unsubscribe(),e(t)):i.type===s.PoolEventType.taskFailed&&(r.unsubscribe(),n(i.error))},error:n})}),r=yield Promise.race([t,n]);if(r.length>0)throw r[0]}))}events(){return this.eventObservable}queue(e){const{maxQueuedJobs:t=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const n=()=>this.taskCompletion(i.id);let r;const i={id:this.nextTaskID++,run:e,cancel:()=>{-1!==this.taskQueue.indexOf(i)&&(this.taskQueue=this.taskQueue.filter(e=>e!==i),this.eventSubject.next({type:s.PoolEventType.taskCanceled,taskID:i.id}))},get then(){if(!r){const e=n();r=e.then.bind(e)}return r}};if(this.taskQueue.length>=t)throw Error("Maximum number of pool tasks queued. Refusing to queue another one.\nThis usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.");return this.debug(`Queueing task #${i.id}...`),this.taskQueue.push(i),this.eventSubject.next({type:s.PoolEventType.taskQueued,taskID:i.id}),this.scheduleWork(),i}terminate(e){return c(this,void 0,void 0,(function*(){this.isClosing=!0,e||(yield this.completed(!0)),this.eventSubject.next({type:s.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(e=>c(this,void 0,void 0,(function*(){return l.Thread.terminate(yield e.init)}))))}))}}function d(e,t){return new h(e,t)}h.EventType=s.PoolEventType,d.EventType=s.PoolEventType;const f=d;n.Pool=f},{debug:"jcLW","observable-fns":"cyO3","../ponyfills":"vpgy","./implementation":"XK2w","./pool-types":"UYCO","./thread":"LBuu"}],PRGP:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createPromiseWithResolver=function(){let e,t=!1,n=r;return[new Promise(r=>{t?r(e):n=r}),r=>{t=!0,e=r,n()}]};const r=()=>{}},{}],ZLGT:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.WorkerEventType=void 0,e("../symbols"),n.WorkerEventType=r,function(e){e.internalError="internalError",e.message="message",e.termination="termination"}(r||(n.WorkerEventType=r={}))},{"../symbols":"fmdM"}],zXl4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ObservablePromise=void 0;var r=e("observable-fns");const i=()=>{},o=e=>e,a=e=>Promise.resolve().then(e);function s(e){throw e}class l extends r.Observable{constructor(e){super(t=>{const n=this,r=Object.assign(Object.assign({},t),{complete(){t.complete(),n.onCompletion()},error(e){t.error(e),n.onError(e)},next(e){t.next(e),n.onNext(e)}});try{return this.initHasRun=!0,e(r)}catch(e){r.error(e)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(e){this.firstValueSet||(this.firstValue=e,this.firstValueSet=!0)}onError(e){this.state="rejected",this.rejection=e;for(const t of this.rejectionCallbacks)a(()=>t(e))}onCompletion(){this.state="fulfilled";for(const e of this.fulfillmentCallbacks)a(()=>e(this.firstValue))}then(e,t){const n=e||o,r=t||s;let i=!1;return new Promise((e,t)=>{const o=n=>{if(!i){i=!0;try{e(r(n))}catch(e){t(e)}}};return this.initHasRun||this.subscribe({error:o}),"fulfilled"===this.state?e(n(this.firstValue)):"rejected"===this.state?(i=!0,e(r(this.rejection))):(this.fulfillmentCallbacks.push(t=>{try{e(n(t))}catch(e){o(e)}}),void this.rejectionCallbacks.push(o))})}catch(e){return this.then(void 0,e)}finally(e){const t=e||i;return this.then(e=>(t(),e),()=>t())}static from(e){return function(e){return e&&"function"==typeof e.then}(e)?new l(t=>{e.then(e=>{t.next(e),t.complete()},e=>{t.error(e)})}):super.from(e)}}n.ObservablePromise=l},{"observable-fns":"cyO3"}],qW1u:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[r.$transferable]},n.Transfer=function(e,t){if(!t){if(!function(e){return!(!e||"object"!=typeof e)}(e))throw Error();t=[e]}return{[r.$transferable]:!0,send:e,transferables:t}};var r=e("./symbols")},{"./symbols":"fmdM"}],fUdt:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.WorkerMessageType=n.MasterMessageType=void 0,n.MasterMessageType=r,function(e){e.run="run"}(r||(n.MasterMessageType=r={})),n.WorkerMessageType=i,function(e){e.error="error",e.init="init",e.result="result",e.running="running",e.uncaughtError="uncaughtError"}(i||(n.WorkerMessageType=i={}))},{}],iMbm:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createProxyFunction=p,n.createProxyModule=function(e,t){const n={};for(const r of t)n[r]=p(e,r);return n};var r=function(e){return e&&e.__esModule?e:{default:e}}(e("debug")),i=e("observable-fns"),o=e("../common"),a=e("../observable-promise"),s=e("../transferable"),l=e("../types/messages");const c=(0,r.default)("threads:master:messages");let u=1;const h=e=>Array.from(new Set(e));function d(e,t){return new i.Observable(n=>{let r;const i=a=>{if(c("Message from worker:",a.data),a.data&&a.data.uid===t)if((e=>e&&e.type===l.WorkerMessageType.running)(a.data))r=a.data.resultType;else if((e=>e&&e.type===l.WorkerMessageType.result)(a.data))"promise"===r?(void 0!==a.data.payload&&n.next((0,o.deserialize)(a.data.payload)),n.complete(),e.removeEventListener("message",i)):(a.data.payload&&n.next((0,o.deserialize)(a.data.payload)),a.data.complete&&(n.complete(),e.removeEventListener("message",i)));else if((e=>e&&e.type===l.WorkerMessageType.error)(a.data)){const t=(0,o.deserialize)(a.data.error);n.error(t),e.removeEventListener("message",i)}};return e.addEventListener("message",i),()=>e.removeEventListener("message",i)})}function f(e){if(0===e.length)return{args:[],transferables:[]};const t=[],n=[];for(const r of e)(0,s.isTransferDescriptor)(r)?(t.push((0,o.serialize)(r.send)),n.push(...r.transferables)):t.push((0,o.serialize)(r));return{args:t,transferables:0===n.length?n:h(n)}}function p(e,t){return(...n)=>{const r=u++,{args:o,transferables:s}=f(n),h={type:l.MasterMessageType.run,uid:r,method:t,args:o};c("Sending command to run function to worker:",h);try{e.postMessage(h,s)}catch(e){return a.ObservablePromise.from(Promise.reject(e))}return a.ObservablePromise.from((0,i.multicast)(d(e,r)))}}},{debug:"jcLW","observable-fns":"cyO3","../common":"kdjL","../observable-promise":"zXl4","../transferable":"qW1u","../types/messages":"fUdt"}],a83E:[function(e,t,n){e("process"),e("process"),Object.defineProperty(n,"__esModule",{value:!0}),n.spawn=function(e,t){return u(this,void 0,void 0,(function*(){d("Initializing new thread");const n=(yield function(e,t,n){return u(this,void 0,void 0,(function*(){let n;const r=new Promise((e,r)=>{n=setTimeout(()=>r(Error("Timeout: Did not receive an init message from worker after 10000ms. Make sure the worker calls expose().")),t)}),i=yield Promise.race([e,r]);return clearTimeout(n),i}))}(p(e),t&&t.timeout?t.timeout:1e4)).exposed,{termination:r,terminate:i}=function(e){const[t,n]=(0,a.createPromiseWithResolver)();return{terminate:()=>u(this,void 0,void 0,(function*(){f("Terminating worker"),yield e.terminate(),n()})),termination:t}}(e),o=m(e,r);if("function"===n.type)return g((0,c.createProxyFunction)(e),e,o,i);if("module"===n.type)return g((0,c.createProxyModule)(e,n.methods),e,o,i);{const e=n.type;throw Error("Worker init message states unexpected type of expose(): "+e)}}))};var r=function(e){return e&&e.__esModule?e:{default:e}}(e("debug")),i=e("observable-fns"),o=e("../common"),a=e("../promise"),s=e("../symbols"),l=e("../types/master"),c=e("./invocation-proxy"),u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const h=(0,r.default)("threads:master:messages"),d=(0,r.default)("threads:master:spawn"),f=(0,r.default)("threads:master:thread-utils");function p(e){return new Promise((t,n)=>{const r=i=>{h("Message from worker before finishing initialization:",i.data),(e=>e&&"init"===e.type)(i.data)?(e.removeEventListener("message",r),t(i.data)):(e=>e&&"uncaughtError"===e.type)(i.data)&&(e.removeEventListener("message",r),n((0,o.deserialize)(i.data.error)))};e.addEventListener("message",r)})}function m(e,t){return new i.Observable(n=>{const r=e=>{const t={type:l.WorkerEventType.message,data:e.data};n.next(t)},i=e=>{f("Unhandled promise rejection event in thread:",e);const t={type:l.WorkerEventType.internalError,error:Error(e.reason)};n.next(t)};e.addEventListener("message",r),e.addEventListener("unhandledrejection",i),t.then(()=>{const t={type:l.WorkerEventType.termination};e.removeEventListener("message",r),e.removeEventListener("unhandledrejection",i),n.next(t),n.complete()})})}function g(e,t,n,r){const i=n.filter(e=>e.type===l.WorkerEventType.internalError).map(e=>e.error);return Object.assign(e,{[s.$errors]:i,[s.$events]:n,[s.$terminate]:r,[s.$worker]:t})}},{debug:"jcLW","observable-fns":"cyO3","../common":"kdjL","../promise":"PRGP","../symbols":"fmdM","../types/master":"ZLGT","./invocation-proxy":"iMbm",process:"pBGv"}],HfK0:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Pool",{enumerable:!0,get:function(){return i.Pool}}),Object.defineProperty(n,"spawn",{enumerable:!0,get:function(){return o.spawn}}),Object.defineProperty(n,"Thread",{enumerable:!0,get:function(){return a.Thread}}),n.Worker=void 0;var r=e("./implementation"),i=e("./pool"),o=e("./spawn"),a=e("./thread");const s=(0,r.selectWorkerImplementation)();n.Worker=s},{"./implementation":"XK2w","./pool":"EB3M","./spawn":"a83E","./thread":"LBuu"}],JZ8d:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}},{}],LkZ7:[function(e,t,n){var r=arguments[3];Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,o=a(e("./ponyfill.js"));function a(e){return e&&e.__esModule?e:{default:e}}i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==t?t:Function("return this")();var s=(0,o.default)(i),l=s;n.default=l},{"./ponyfill.js":"JZ8d"}],UALh:[function(e,t,n){"use strict";const r=e("symbol-observable").default;t.exports=e=>Boolean(e&&e[r]&&e===e[r]())},{"symbol-observable":"LkZ7"}],AZa4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r={isWorkerRuntime:function(){return!("undefined"==typeof self||!self.postMessage)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}};n.default=r},{}],l5pR:[function(e,t,n){e("process");var r=e("process");Object.defineProperty(n,"__esModule",{value:!0}),n.expose=function(e){if(!l.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(u)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(u=!0,"function"==typeof e)l.default.subscribeToMasterMessages(t=>{h(t)&&!t.method&&v(t.uid,e,t.args.map(o.deserialize))}),function(){const e={type:s.WorkerMessageType.init,exposed:{type:"function"}};l.default.postMessageToMaster(e)}();else{if("object"!=typeof e||!e)throw Error("Invalid argument passed to expose(). Expected a function or an object, got: "+e);l.default.subscribeToMasterMessages(t=>{h(t)&&t.method&&v(t.uid,e[t.method],t.args.map(o.deserialize))}),function(e){const t={type:s.WorkerMessageType.init,exposed:{type:"module",methods:e}};l.default.postMessageToMaster(t)}(Object.keys(e).filter(t=>"function"==typeof e[t]))}},Object.defineProperty(n,"registerSerializer",{enumerable:!0,get:function(){return o.registerSerializer}}),Object.defineProperty(n,"Transfer",{enumerable:!0,get:function(){return a.Transfer}});var i=c(e("is-observable")),o=e("../common"),a=e("../transferable"),s=e("../types/messages"),l=c(e("./implementation"));function c(e){return e&&e.__esModule?e:{default:e}}let u=!1;const h=e=>e&&e.type===s.MasterMessageType.run,d=e=>(0,i.default)(e)||function(e){return e&&"object"==typeof e&&"function"==typeof e.subscribe}(e);function f(e){return(0,a.isTransferDescriptor)(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function p(e,t){const{payload:n,transferables:r}=f(t),i={type:s.WorkerMessageType.error,uid:e,error:(0,o.serialize)(n)};l.default.postMessageToMaster(i,r)}function m(e,t,n){const{payload:r,transferables:i}=f(n),o={type:s.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:r};l.default.postMessageToMaster(o,i)}function g(e){try{const t={type:s.WorkerMessageType.uncaughtError,error:(0,o.serialize)(e)};l.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",t,"\nOriginal error:",e)}}function v(e,t,n){return function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){let r;try{r=t(...n)}catch(t){return p(e,t)}const i=d(r)?"observable":"promise";if(function(e,t){const n={type:s.WorkerMessageType.running,uid:e,resultType:t};l.default.postMessageToMaster(n)}(e,i),d(r))r.subscribe(t=>m(e,!1,(0,o.serialize)(t)),t=>p(e,(0,o.serialize)(t)),()=>m(e,!0));else try{const t=yield r;m(e,!0,(0,o.serialize)(t))}catch(t){p(e,(0,o.serialize)(t))}}))}"undefined"!=typeof self&&"function"==typeof self.addEventListener&&l.default.isWorkerRuntime()&&(self.addEventListener("error",e=>{setTimeout(()=>g(e.error||e),250)}),self.addEventListener("unhandledrejection",e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout(()=>g(t),250)})),void 0!==r&&"function"==typeof r.on&&l.default.isWorkerRuntime()&&(r.on("uncaughtException",e=>{setTimeout(()=>g(e),250)}),r.on("unhandledRejection",e=>{e&&"string"==typeof e.message&&setTimeout(()=>g(e),250)}))},{"is-observable":"UALh","../common":"kdjL","../transferable":"qW1u","../types/messages":"fUdt","./implementation":"AZa4",process:"pBGv"}],CqwR:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={registerSerializer:!0,expose:!0,DefaultSerializer:!0,Transfer:!0};Object.defineProperty(n,"registerSerializer",{enumerable:!0,get:function(){return i.registerSerializer}}),Object.defineProperty(n,"expose",{enumerable:!0,get:function(){return a.expose}}),Object.defineProperty(n,"DefaultSerializer",{enumerable:!0,get:function(){return s.DefaultSerializer}}),Object.defineProperty(n,"Transfer",{enumerable:!0,get:function(){return l.Transfer}});var i=e("./common"),o=e("./master/index");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=e("./worker/index"),s=e("./serializers"),l=e("./transferable")},{"./common":"kdjL","./master/index":"HfK0","./worker/index":"l5pR","./serializers":"z2GM","./transferable":"qW1u"}],dHPO:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("@babel/runtime/regenerator")),i=l(e("@babel/runtime/helpers/asyncToGenerator")),o=l(e("@babel/runtime/helpers/classCallCheck")),a=l(e("@babel/runtime/helpers/createClass")),s=e("threads");function l(e){return e&&e.__esModule?e:{default:e}}var c="undefined"!=typeof navigator?navigator.hardwareConcurrency:null,u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Worker("decoder.worker.1936c0d9.js");(0,o.default)(this,e),this.pool=(0,s.Pool)((function(){return(0,s.spawn)(n)}),t)}return(0,a.default)(e,[{key:"decode",value:function(){var e=(0,i.default)(r.default.mark((function e(t,n){var o=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){o.pool.queue(function(){var o=(0,i.default)(r.default.mark((function i(o){var l;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o(t,(0,s.Transfer)(n));case 3:l=r.sent,e(l),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),a(r.t0);case 10:case"end":return r.stop()}}),i,null,[[0,7]])})));return function(e){return o.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this.pool.terminate(!0)}}]),e}();n.default=u},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW",threads:"CqwR","./decoder.worker.js":[["decoder.worker.1936c0d9.js","LHx9"],"decoder.worker.1936c0d9.js.map","LHx9"]}],t2zx:[function(e,t,n){t.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}},{}],U8F3:[function(e,t,n){var r=e("./objectWithoutPropertiesLoose");t.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}},{"./objectWithoutPropertiesLoose":"t2zx"}],OMTj:[function(e,t,n){t.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},{}],kQhN:[function(e,t,n){var r=e("./arrayWithHoles"),i=e("./iterableToArray"),o=e("./unsupportedIterableToArray"),a=e("./nonIterableRest");t.exports=function(e){return r(e)||i(e)||o(e)||a()}},{"./arrayWithHoles":"OUZ9","./iterableToArray":"OMTj","./unsupportedIterableToArray":"UyFj","./nonIterableRest":"Rom6"}],ZJpj:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseContentType=function(e){var t=e.split(";").map((function(e){return e.trim()})),n=(0,r.default)(t);return{type:n[0],params:u(n.slice(1).map((function(e){return e.split("=")})))}},n.parseContentRange=d,n.parseByteRanges=function(e,t){for(var n=null,r=new TextDecoder("ascii"),i=[],o="--".concat(t),a="".concat(o,"--"),s=0;s<10;++s)r.decode(new Uint8Array(e,s,o.length))===o&&(n=s);if(null===n)throw new Error("Could not find initial boundary");for(;n<e.byteLength;){var l=r.decode(new Uint8Array(e,n,Math.min(o.length+1024,e.byteLength-n)));if(0===l.length||l.startsWith(a))break;if(!l.startsWith(o))throw new Error("Part does not start with boundary");var u=l.substr(o.length+2);if(0===u.length)break;var f=u.indexOf(c),p=h(u.substr(0,f)),m=d(p["content-range"]),g=m.start,v=m.end,y=m.total,b=n+o.length+f+c.length,_=parseInt(v,10)+1-parseInt(g,10);i.push({headers:p,data:e.slice(b,b+_),offset:g,length:_,fileSize:y}),n=b+_+4}return i};var r=o(e("@babel/runtime/helpers/toArray")),i=o(e("@babel/runtime/helpers/slicedToArray"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c="\r\n\r\n";function u(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);var t,n={},r=a(e);try{for(r.s();!(t=r.n()).done;){var o=(0,i.default)(t.value,2),s=o[0],l=o[1];n[s.toLowerCase()]=l}}catch(e){r.e(e)}finally{r.f()}return n}function h(e){return u(e.split("\r\n").map((function(e){var t=e.split(":").map((function(e){return e.trim()}));return t[0]=t[0].toLowerCase(),t})))}function d(e){var t,n,r;if(e){var o=e.match(/bytes (\d+)-(\d+)\/(\d+)/),a=(0,i.default)(o,4);t=a[1],n=a[2],r=a[3],t=parseInt(t,10),n=parseInt(n,10),r=parseInt(r,10)}return{start:t,end:n,total:r}}},{"@babel/runtime/helpers/toArray":"kQhN","@babel/runtime/helpers/slicedToArray":"HETk"}],LzCD:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BaseSource=void 0;var r=s(e("@babel/runtime/regenerator")),i=s(e("@babel/runtime/helpers/asyncToGenerator")),o=s(e("@babel/runtime/helpers/classCallCheck")),a=s(e("@babel/runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,[{key:"fetch",value:function(){var e=(0,i.default)(r.default.mark((function e(t){var n,i=this,o=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:void 0,e.next=3,Promise.all(t.map((function(e){return i.fetchSlice(e,n)})));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSlice",value:function(){var e=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("fetching of slice ".concat(t," not possible, not implemented"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fileSize",get:function(){return null}}]),e}();n.BaseSource=l},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW"}],eMzk:[function(e,t,n){"use strict";t.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},{}],sfWH:[function(e,t,n){"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new s(n,null,t,e):new s(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function o(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function a(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}t.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)n.push(o.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,o=this.head;null!==o&&r<e;r++)o=o.next;var a=[];for(r=0;o&&r<t;r++)a.push(o.value),o=this.removeNode(o);for(null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev),r=0;r<n.length;r++)o=i(this,o,n[r]);return a},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{e("./iterator.js")(r)}catch(e){}},{"./iterator.js":"eMzk"}],tpff:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=e("yallist"),a=Symbol("max"),s=Symbol("length"),l=Symbol("lengthCalculator"),c=Symbol("allowStale"),u=Symbol("maxAge"),h=Symbol("dispose"),d=Symbol("noDisposeOnSet"),f=Symbol("lruList"),p=Symbol("cache"),m=Symbol("updateAgeOnGet"),g=function(){return 1},v=function(){function e(t){if(r(this,e),"number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[a]=t.max||1/0;var n=t.length||g;if(this[l]="function"!=typeof n?g:n,this[c]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[u]=t.maxAge||0,this[h]=t.dispose,this[d]=t.noDisposeOnSet||!1,this[m]=t.updateAgeOnGet||!1,this.reset()}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"rforEach",value:function(e,t){t=t||this;for(var n=this[f].tail;null!==n;){var r=n.prev;M(this,e,n,t),n=r}}},{key:"forEach",value:function(e,t){t=t||this;for(var n=this[f].head;null!==n;){var r=n.next;M(this,e,n,t),n=r}}},{key:"keys",value:function(){return this[f].toArray().map((function(e){return e.key}))}},{key:"values",value:function(){return this[f].toArray().map((function(e){return e.value}))}},{key:"reset",value:function(){var e=this;this[h]&&this[f]&&this[f].length&&this[f].forEach((function(t){return e[h](t.key,t.value)})),this[p]=new Map,this[f]=new o,this[s]=0}},{key:"dump",value:function(){var e=this;return this[f].map((function(t){return!b(e,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}})).toArray().filter((function(e){return e}))}},{key:"dumpLru",value:function(){return this[f]}},{key:"set",value:function(e,t,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");var r=n?Date.now():0,i=this[l](t,e);if(this[p].has(e)){if(i>this[a])return x(this,this[p].get(e)),!1;var o=this[p].get(e).value;return this[h]&&(this[d]||this[h](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[s]+=i-o.length,o.length=i,this.get(e),_(this),!0}var c=new w(e,t,i,r,n);return c.length>this[a]?(this[h]&&this[h](e,t),!1):(this[s]+=c.length,this[f].unshift(c),this[p].set(e,this[f].head),_(this),!0)}},{key:"has",value:function(e){if(!this[p].has(e))return!1;var t=this[p].get(e).value;return!b(this,t)}},{key:"get",value:function(e){return y(this,e,!0)}},{key:"peek",value:function(e){return y(this,e,!1)}},{key:"pop",value:function(){var e=this[f].tail;return e?(x(this,e),e.value):null}},{key:"del",value:function(e){x(this,this[p].get(e))}},{key:"load",value:function(e){this.reset();for(var t=Date.now(),n=e.length-1;n>=0;n--){var r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{var o=i-t;o>0&&this.set(r.k,r.v,o)}}}},{key:"prune",value:function(){var e=this;this[p].forEach((function(t,n){return y(e,n,!1)}))}},{key:"max",set:function(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[a]=e||1/0,_(this)},get:function(){return this[a]}},{key:"allowStale",set:function(e){this[c]=!!e},get:function(){return this[c]}},{key:"maxAge",set:function(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,_(this)},get:function(){return this[u]}},{key:"lengthCalculator",set:function(e){var t=this;"function"!=typeof e&&(e=g),e!==this[l]&&(this[l]=e,this[s]=0,this[f].forEach((function(e){e.length=t[l](e.value,e.key),t[s]+=e.length}))),_(this)},get:function(){return this[l]}},{key:"length",get:function(){return this[s]}},{key:"itemCount",get:function(){return this[f].length}}]),e}(),y=function(e,t,n){var r=e[p].get(t);if(r){var i=r.value;if(b(e,i)){if(x(e,r),!e[c])return}else n&&(e[m]&&(r.value.now=Date.now()),e[f].unshiftNode(r));return i.value}},b=function(e,t){if(!t||!t.maxAge&&!e[u])return!1;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[u]&&n>e[u]},_=function(e){if(e[s]>e[a])for(var t=e[f].tail;e[s]>e[a]&&null!==t;){var n=t.prev;x(e,t),t=n}},x=function(e,t){if(t){var n=t.value;e[h]&&e[h](n.key,n.value),e[s]-=n.length,e[p].delete(n.key),e[f].removeNode(t)}},w=function e(t,n,i,o,a){r(this,e),this.key=t,this.value=n,this.length=i,this.now=o,this.maxAge=a||0},M=function(e,t,n,r){var i=n.value;b(e,i)&&(x(e,n),e[c]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};t.exports=v},{yallist:"sfWH"}],FOZT:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.assign=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},n.chunk=function(e,t){for(var n=[],r=e.length,i=0;i<r;i+=t){for(var o=[],a=i;a<i+t;a++)o.push(e[a]);n.push(o)}return n},n.endsWith=function(e,t){return!(e.length<t.length)&&e.substr(e.length-t.length)===t},n.forEach=function(e,t){for(var n=e.length,r=0;r<n;r++)t(e[r],r)},n.invert=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t},n.range=function(e){for(var t=[],n=0;n<e;n++)t.push(n);return t},n.times=function(e,t){for(var n=[],r=0;r<e;r++)n.push(t(r));return n},n.toArray=f,n.toArrayRecursively=function e(t){return t.length?f(t).map(e):t},n.parseContentRange=function(e){if(!e)return null;if("string"!=typeof e)throw new Error("invalid argument");var t=function(e){return Number.parseInt(e,10)},n=e.match(/^(\w*) /),r=n&&n[1];return(n=e.match(/(\d+)-(\d+)\/(\d+|\*)/))?{unit:r,first:t(n[1]),last:t(n[2]),length:"*"===n[3]?null:t(n[3])}:(n=e.match(/(\d+|\*)/))?{unit:r,first:null,last:null,length:"*"===n[1]?null:t(n[1])}:null},n.wait=function(e){return p.apply(this,arguments)},n.zip=function(e,t){var n=Array.isArray(e)?e:Array.from(e),r=Array.isArray(t)?t:Array.from(t);return n.map((function(e,t){return[e,r[t]]}))},n.AggregateError=n.CustomAggregateError=n.AbortError=void 0;var r=h(e("@babel/runtime/regenerator")),i=h(e("@babel/runtime/helpers/classCallCheck")),o=h(e("@babel/runtime/helpers/assertThisInitialized")),a=h(e("@babel/runtime/helpers/inherits")),s=h(e("@babel/runtime/helpers/possibleConstructorReturn")),l=h(e("@babel/runtime/helpers/getPrototypeOf")),c=h(e("@babel/runtime/helpers/wrapNativeSuper")),u=h(e("@babel/runtime/helpers/asyncToGenerator"));function h(e){return e&&e.__esModule?e:{default:e}}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}function f(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}function p(){return(p=(0,u.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=function(e){(0,a.default)(n,e);var t=d(n);function n(e){var r;return(0,i.default)(this,n),r=t.call(this,e),Error.captureStackTrace&&Error.captureStackTrace((0,o.default)(r),n),r.name="AbortError",r}return n}((0,c.default)(Error));n.AbortError=m;var g=function(e){(0,a.default)(n,e);var t=d(n);function n(e,r){var o;return(0,i.default)(this,n),(o=t.call(this,r)).errors=e,o.message=r,o.name="AggregateError",o}return n}((0,c.default)(Error));n.CustomAggregateError=g;var v=g;n.AggregateError=v},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/assertThisInitialized":"E7HD","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","@babel/runtime/helpers/wrapNativeSuper":"ozpi","@babel/runtime/helpers/asyncToGenerator":"agGE"}],xD7g:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BlockedSource=void 0;var r=p(e("@babel/runtime/regenerator")),i=p(e("@babel/runtime/helpers/slicedToArray")),o=p(e("@babel/runtime/helpers/asyncToGenerator")),a=p(e("@babel/runtime/helpers/inherits")),s=p(e("@babel/runtime/helpers/possibleConstructorReturn")),l=p(e("@babel/runtime/helpers/getPrototypeOf")),c=p(e("@babel/runtime/helpers/classCallCheck")),u=p(e("@babel/runtime/helpers/createClass")),h=p(e("lru-cache")),d=e("./basesource"),f=e("../utils");function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,c.default)(this,e),this.offset=t,this.length=n,this.data=r}return(0,u.default)(e,[{key:"top",get:function(){return this.offset+this.length}}]),e}(),y=function e(t,n,r){(0,c.default)(this,e),this.offset=t,this.length=n,this.blockIds=r},b=function(e){(0,a.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.blockSize,a=void 0===o?65536:o,s=i.cacheSize,l=void 0===s?100:s;return(0,c.default)(this,n),(r=t.call(this)).source=e,r.blockSize=a,r.blockCache=new h.default({max:l}),r.blockRequests=new Map,r.blockIdsToFetch=new Set,r}return(0,u.default)(n,[{key:"fetch",value:function(){var e=(0,o.default)(r.default.mark((function e(t,n){var o,a,s,l,c,u,h,d,p,g,v,y,b,_,x,w,M,S,E,T,C,A,L,P,R,O,k,I,D,N,j,F,B,z,U,H,G,W;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=new Map,a=new Map,s=new Set,l=m(t);try{for(l.s();!(c=l.n()).done;)for(u=c.value,h=u.offset,d=u.length,p=h+d,null!==(g=this.fileSize)&&(p=Math.min(p,g)),v=Math.floor(h/this.blockSize)*this.blockSize,y=v;y<p;y+=this.blockSize)b=Math.floor(y/this.blockSize),this.blockCache.has(b)?o.set(b,this.blockCache.get(b)):this.blockRequests.has(b)?a.set(b,this.blockRequests.get(b)):(this.blockIdsToFetch.has(b)||this.blockIdsToFetch.add(b),s.add(b))}catch(e){l.e(e)}finally{l.f()}return e.next=7,(0,f.wait)();case 7:this.fetchBlocks(n),_=m(s),e.prev=9,_.s();case 11:if((x=_.n()).done){e.next=26;break}if(w=x.value,M=this.blockRequests.get(w),S=this.blockCache.get(w),!M){e.next=19;break}a.set(w,M),e.next=24;break;case 19:if(!S){e.next=23;break}o.set(w,S),e.next=24;break;case 23:throw new Error("Block ".concat(w," is not in the block requests"));case 24:e.next=11;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(9),_.e(e.t0);case 31:return e.prev=31,_.f(),e.finish(31);case 34:return e.next=36,Promise.allSettled(a.values());case 36:if(!(E=e.sent).some((function(e){return"rejected"===e.status}))){e.next=65;break}T=new Set,C=m((0,f.zip)(a.keys(),E));try{for(C.s();!(A=C.n()).done;)L=(0,i.default)(A.value,2),P=L[0],R=L[1],O=R.rejected,k=R.reason,O&&"AbortError"===k.name&&k.signal!==n&&(this.blockIdsToFetch.add(P),T.add(P))}catch(e){C.e(e)}finally{C.f()}if(!(this.blockIdsToFetch.length>0)){e.next=65;break}this.fetchBlocks(n),I=m(T),e.prev=44,I.s();case 46:if((D=I.n()).done){e.next=54;break}if(N=D.value,j=this.blockRequests.get(N)){e.next=51;break}throw new Error("Block ".concat(N," is not in the block requests"));case 51:a.set(N,j);case 52:e.next=46;break;case 54:e.next=59;break;case 56:e.prev=56,e.t1=e.catch(44),I.e(e.t1);case 59:return e.prev=59,I.f(),e.finish(59);case 62:return e.next=64,Promise.allSettled(Array.from(a.values()));case 64:E=e.sent;case 65:if(!E.some((function(e){return"rejected"===e.status}))){e.next=69;break}if(!n||!n.aborted){e.next=68;break}throw new f.AbortError("Request was aborted");case 68:throw new f.AggregateError(E.filter((function(e){return"rejected"===e.status})).map((function(e){return e.reason})),"Request failed");case 69:F=E.map((function(e){return e.value})),B=new Map((0,f.zip)(Array.from(a.keys()),F)),z=m(o);try{for(z.s();!(U=z.n()).done;)H=(0,i.default)(U.value,2),G=H[0],W=H[1],B.set(G,W)}catch(e){z.e(e)}finally{z.f()}return e.abrupt("return",this.readSliceData(t,B));case 74:case"end":return e.stop()}}),e,this,[[9,28,31,34],[44,56,59,62]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchBlocks",value:function(e){var t=this;this.blockIdsToFetch.size>0&&function(){for(var n=t.groupBlocks(t.blockIdsToFetch),i=t.source.fetch(n,e),a=function(a){var s,l=m(n[a].blockIds);try{var c=function(){var n=s.value,l=(0,o.default)(r.default.mark((function o(){var s,l,c,u,h,d;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,i;case 3:return r.t0=a,s=r.sent[r.t0],l=n*t.blockSize,c=l-s.offset,u=Math.min(c+t.blockSize,s.data.byteLength),h=s.data.slice(c,u),d=new v(l,h.byteLength,h),t.blockCache.set(n,d),r.abrupt("return",d);case 14:throw r.prev=14,r.t1=r.catch(0),"AbortError"===r.t1.name&&(r.t1.signal=e),r.t1;case 18:return r.prev=18,t.blockRequests.delete(n),r.finish(18);case 21:case"end":return r.stop()}}),o,null,[[0,14,18,21]])})))();t.blockRequests.set(n,l)};for(l.s();!(s=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}},s=0;s<n.length;++s)a(s);t.blockIdsToFetch.clear()}()}},{key:"groupBlocks",value:function(e){var t=Array.from(e).sort((function(e,t){return e-t}));if(0===t.length)return[];var n,r=[],i=null,o=[],a=m(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;null===i||i+1===s?(r.push(s),i=s):(o.push(new y(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[s],i=s)}}catch(e){a.e(e)}finally{a.f()}return o.push(new y(r[0]*this.blockSize,r.length*this.blockSize,r)),o}},{key:"readSliceData",value:function(e,t){var n=this;return e.map((function(e){for(var r=e.offset+e.length,i=Math.floor(e.offset/n.blockSize),o=Math.floor((e.offset+e.length)/n.blockSize),a=new ArrayBuffer(e.length),s=new Uint8Array(a),l=i;l<=o;++l){var c,u=t.get(l),h=u.offset-e.offset,d=0,f=0;h<0?d=-h:h>0&&(f=h),c=u.top-r<0?u.length-d:r-u.offset-d;var p=new Uint8Array(u.data,d,c);s.set(p,f)}return a}))}},{key:"fileSize",get:function(){return this.source.fileSize}}]),n}(d.BaseSource);n.BlockedSource=b},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/slicedToArray":"HETk","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","lru-cache":"tpff","./basesource":"LzCD","../utils":"FOZT"}],uL1U:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BaseClient=n.BaseResponse=void 0;var r=s(e("@babel/runtime/regenerator")),i=s(e("@babel/runtime/helpers/asyncToGenerator")),o=s(e("@babel/runtime/helpers/classCallCheck")),a=s(e("@babel/runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,[{key:"getHeader",value:function(e){throw new Error("not implemented")}},{key:"getData",value:function(){var e=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ok",get:function(){return this.status>=200&&this.status<=299}},{key:"status",get:function(){throw new Error("not implemented")}}]),e}();n.BaseResponse=l;var c=function(){function e(t){(0,o.default)(this,e),this.url=t}return(0,a.default)(e,[{key:"request",value:function(){var e=(0,i.default)(r.default.mark((function e(){var t,n=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw(t=n.length>0&&void 0!==n[0]?n[0]:{}).headers,t.credentials,t.signal,new Error("request is not implemented");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();n.BaseClient=c},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW"}],Un5s:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FetchClient=void 0;var r=h(e("@babel/runtime/regenerator")),i=h(e("@babel/runtime/helpers/asyncToGenerator")),o=h(e("@babel/runtime/helpers/classCallCheck")),a=h(e("@babel/runtime/helpers/createClass")),s=h(e("@babel/runtime/helpers/inherits")),l=h(e("@babel/runtime/helpers/possibleConstructorReturn")),c=h(e("@babel/runtime/helpers/getPrototypeOf")),u=e("./base");function h(e){return e&&e.__esModule?e:{default:e}}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}var f=function(e){(0,s.default)(n,e);var t=d(n);function n(e){var r;return(0,o.default)(this,n),(r=t.call(this)).response=e,r}return(0,a.default)(n,[{key:"getHeader",value:function(e){return this.response.headers.get(e)}},{key:"getData",value:function(){var e=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.response.arrayBuffer){e.next=6;break}return e.next=3,this.response.arrayBuffer();case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,this.response.buffer();case 8:e.t0=e.sent.buffer;case 9:return t=e.t0,e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"status",get:function(){return this.response.status}}]),n}(u.BaseResponse),p=function(e){(0,s.default)(n,e);var t=d(n);function n(e,r){var i;return(0,o.default)(this,n),(i=t.call(this,e)).credentials=r,i}return(0,a.default)(n,[{key:"request",value:function(){var e=(0,i.default)(r.default.mark((function e(){var t,n,i,o,a,s=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.headers,i=t.credentials,o=t.signal,e.next=3,fetch(this.url,{headers:n,credentials:i,signal:o});case 3:return a=e.sent,e.abrupt("return",new f(a));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(u.BaseClient);n.FetchClient=p},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./base":"uL1U"}],hvgd:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.XHRClient=void 0;var r=f(e("@babel/runtime/helpers/slicedToArray")),i=f(e("@babel/runtime/regenerator")),o=f(e("@babel/runtime/helpers/asyncToGenerator")),a=f(e("@babel/runtime/helpers/classCallCheck")),s=f(e("@babel/runtime/helpers/createClass")),l=f(e("@babel/runtime/helpers/inherits")),c=f(e("@babel/runtime/helpers/possibleConstructorReturn")),u=f(e("@babel/runtime/helpers/getPrototypeOf")),h=e("./base"),d=e("../../utils");function f(e){return e&&e.__esModule?e:{default:e}}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}var m=function(e){(0,l.default)(n,e);var t=p(n);function n(e,r){var i;return(0,a.default)(this,n),(i=t.call(this)).xhr=e,i.data=r,i}return(0,s.default)(n,[{key:"getHeader",value:function(e){return this.xhr.getResponseHeader(e)}},{key:"getData",value:function(){var e=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.data);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"status",get:function(){return this.xhr.status}}]),n}(h.BaseResponse),g=function(e){(0,l.default)(n,e);var t=p(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return(0,s.default)(n,[{key:"constructRequest",value:function(e,t){var n=this;return new Promise((function(i,o){var a=new XMLHttpRequest;a.open("GET",n.url),a.responseType="arraybuffer";for(var s=0,l=Object.entries(e);s<l.length;s++){var c=(0,r.default)(l[s],2),u=c[0],h=c[1];a.setRequestHeader(u,h)}a.onload=function(){var e=a.response;i(new m(a,e))},a.onerror=o,a.onabort=function(){return o(new d.AbortError("Request aborted"))},a.send(),t&&(t.aborted&&a.abort(),t.addEventListener("abort",(function(){return a.abort()})))}))}},{key:"request",value:function(){var e=(0,o.default)(i.default.mark((function e(){var t,n,r,o,a=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=t.headers,r=t.signal,e.next=3,this.constructRequest(n,r);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(h.BaseClient);n.XHRClient=g},{"@babel/runtime/helpers/slicedToArray":"HETk","@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./base":"uL1U","../../utils":"FOZT"}],p5a1:[function(e,t,n){var r,i=arguments[3];n.fetch=c(i.fetch)&&c(i.ReadableStream),n.writableStream=c(i.WritableStream),n.abortController=c(i.AbortController),n.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),n.blobConstructor=!0}catch(e){}function o(){if(void 0!==r)return r;if(i.XMLHttpRequest){r=new i.XMLHttpRequest;try{r.open("GET",i.XDomainRequest?"/":"https://example.com")}catch(e){r=null}}else r=null;return r}function a(e){var t=o();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}var s=void 0!==i.ArrayBuffer,l=s&&c(i.ArrayBuffer.prototype.slice);function c(e){return"function"==typeof e}n.arraybuffer=n.fetch||s&&a("arraybuffer"),n.msstream=!n.fetch&&l&&a("ms-stream"),n.mozchunkedarraybuffer=!n.fetch&&s&&a("moz-chunked-arraybuffer"),n.overrideMimeType=n.fetch||!!o()&&c(o().overrideMimeType),n.vbArray=c(i.VBArray),r=null},{}],Yj0v:[function(e,t,n){e("process");var r=e("process");void 0===r||!r.version||0===r.version.indexOf("v0.")||0===r.version.indexOf("v1.")&&0!==r.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return r.nextTick(e);case 2:return r.nextTick((function(){e.call(null,t)}));case 3:return r.nextTick((function(){e.call(null,t,n)}));case 4:return r.nextTick((function(){e.call(null,t,n,i)}));default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return r.nextTick((function(){e.apply(null,o)}))}}}:t.exports=r},{process:"pBGv"}],Nqn4:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=a),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:"dskh"}],Q14w:[function(e,t,n){e("buffer").Buffer;var r=e("buffer").Buffer;function i(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===i(e)},n.isObject=function(e){return"object"==typeof e&&null!==e},n.isDate=function(e){return"[object Date]"===i(e)},n.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=r.isBuffer},{buffer:"dskh"}],CQMM:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=e("util");function o(e,t,n){e.copy(t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":"Nqn4",util:"rDCW"}],lCUh:[function(e,t,n){"use strict";var r=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return o||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":"Yj0v"}],jPmE:[function(e,t,n){e("process"),e("process");var r=arguments[3],i=e("process-nextick-args");function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){N(t,e)}}t.exports=b;var a,s=i.nextTick;b.WritableState=y;var l=Object.create(e("core-util-is"));l.inherits=e("inherits");var c={deprecate:e("util-deprecate")},u=e("./internal/streams/stream"),h=e("safe-buffer").Buffer,d=r.Uint8Array||function(){};function f(e){return h.from(e)}function p(e){return h.isBuffer(e)||e instanceof d}var m,g=e("./internal/streams/destroy");function v(){}function y(t,n){a=a||e("./_stream_duplex"),t=t||{};var r=n instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,s=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var c=!1===t.decodeStrings;this.decodeStrings=!c,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){C(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function b(t){if(a=a||e("./_stream_duplex"),!(m.call(b,this)||this instanceof a))return new b(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),u.call(this)}function _(e,t){var n=new Error("write after end");e.emit("error",n),i.nextTick(t,n)}function x(e,t,n,r){var o=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),i.nextTick(r,a),o=!1),o}function w(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n)),t}function M(e,t,n,r,i,o){if(!n){var a=w(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else S(e,t,!1,s,r,i,o);return l}function S(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function E(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(I,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(o(r),e._writableState.errorEmitted=!0,e.emit("error",r),I(e,t))}function T(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function C(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(T(n),t)E(e,n,r,t,i);else{var o=R(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||P(e,n),r?s(A,e,n,o,i):A(e,n,o,i)}}function A(e,t,n,r){n||L(e,t),t.pendingcb--,r(),I(e,t)}function L(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function P(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0,l=!0;n;)i[s]=n,n.isBuf||(l=!1),n=n.next,s+=1;i.allBuffers=l,S(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,h=n.callback;if(S(e,t,!1,t.objectMode?1:c.length,c,u,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),I(e,t)}))}function k(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i.nextTick(O,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function I(e,t){var n=R(t);return n&&(k(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}function D(e,t,n){t.ending=!0,I(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function N(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}l.inherits(b,u),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(m=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!m.call(this,e)||this===b&&e&&e._writableState instanceof y}})):m=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,n){var r=this._writableState,i=!1,o=!r.objectMode&&p(e);return o&&!h.isBuffer(e)&&(e=f(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=v),r.ended?_(this,n):(o||x(this,r,e,n))&&(r.pendingcb++,i=M(this,r,o,e,t,n)),i},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||P(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||D(this,r,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}},{"process-nextick-args":"Yj0v","core-util-is":"Q14w",inherits:"Bm0n","util-deprecate":"yM1o","./internal/streams/stream":"ExO1","safe-buffer":"Nqn4","./internal/streams/destroy":"lCUh","./_stream_duplex":"Jcj8",process:"pBGv"}],Jcj8:[function(e,t,n){"use strict";var r=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=h;var o=Object.create(e("core-util-is"));o.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");o.inherits(h,a);for(var l=i(s.prototype),c=0;c<l.length;c++){var u=l[c];h.prototype[u]||(h.prototype[u]=s.prototype[u])}function h(e){if(!(this instanceof h))return new h(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},{"process-nextick-args":"Yj0v","core-util-is":"Q14w",inherits:"Bm0n","./_stream_readable":"YrHu","./_stream_writable":"jPmE"}],OUJr:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=a(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=a(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=a(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":"Nqn4"}],YrHu:[function(e,t,n){e("process");var r=arguments[3],i=e("process"),o=e("process-nextick-args");t.exports=M;var a,s=e("isarray");M.ReadableState=w,e("events").EventEmitter;var l=function(e,t){return e.listeners(t).length},c=e("./internal/streams/stream"),u=e("safe-buffer").Buffer,h=r.Uint8Array||function(){};function d(e){return u.from(e)}function f(e){return u.isBuffer(e)||e instanceof h}var p=Object.create(e("core-util-is"));p.inherits=e("inherits");var m=e("util"),g=void 0;g=m&&m.debuglog?m.debuglog("stream"):function(){};var v,y=e("./internal/streams/BufferList"),b=e("./internal/streams/destroy");p.inherits(M,c);var _=["error","close","destroy","pause","resume"];function x(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function w(t,n){t=t||{};var r=n instanceof(a=a||e("./_stream_duplex"));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(v||(v=e("string_decoder/").StringDecoder),this.decoder=new v(t.encoding),this.encoding=t.encoding)}function M(t){if(a=a||e("./_stream_duplex"),!(this instanceof M))return new M(t);this._readableState=new w(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function S(e,t,n,r,i){var o,a=e._readableState;return null===t?(a.reading=!1,R(e,a)):(i||(o=T(a,t)),o?e.emit("error",o):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=d(t)),r?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?E(e,a,t,!1):I(e,a)):E(e,a,t,!1))):r||(a.reading=!1)),C(a)}function E(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&O(e)),I(e,t)}function T(e,t){var n;return f(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function C(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}Object.defineProperty(M.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),M.prototype.destroy=b.destroy,M.prototype._undestroy=b.undestroy,M.prototype._destroy=function(e,t){this.push(null),t(e)},M.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),S(this,e,t,!1,n)},M.prototype.unshift=function(e){return S(this,e,null,!0,!1)},M.prototype.isPaused=function(){return!1===this._readableState.flowing},M.prototype.setEncoding=function(t){return v||(v=e("string_decoder/").StringDecoder),this._readableState.decoder=new v(t),this._readableState.encoding=t,this};var A=8388608;function L(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function P(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=L(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,O(e)}}function O(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(g("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?o.nextTick(k,e):k(e))}function k(e){g("emit readable"),e.emit("readable"),z(e)}function I(e,t){t.readingMore||(t.readingMore=!0,o.nextTick(D,e,t))}function D(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(g("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function N(e){return function(){var t=e._readableState;g("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&l(e,"data")&&(t.flowing=!0,z(e))}}function j(e){g("readable nexttick read 0"),e.read(0)}function F(e,t){t.resumeScheduled||(t.resumeScheduled=!0,o.nextTick(B,e,t))}function B(e,t){t.reading||(g("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),z(e),t.flowing&&!t.reading&&e.read(0)}function z(e){var t=e._readableState;for(g("flow",t.flowing);t.flowing&&null!==e.read(););}function U(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=H(e,t.buffer,t.decoder),n);var n}function H(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?G(e,t):W(e,t),r}function G(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0==(e-=a)){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++r}return t.length-=r,i}function W(e,t){var n=u.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0==(e-=a)){a===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++i}return t.length-=i,n}function V(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,o.nextTick(q,t,e))}function q(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function X(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}M.prototype.read=function(e){g("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return g("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?V(this):O(this),null;if(0===(e=P(e,t))&&t.ended)return 0===t.length&&V(this),null;var r,i=t.needReadable;return g("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&g("length less than watermark",i=!0),t.ended||t.reading?g("reading or ended",i=!1):i&&(g("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=P(n,t))),null===(r=e>0?U(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&V(this)),null!==r&&this.emit("data",r),r},M.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},M.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,g("pipe count=%d opts=%j",r.pipesCount,t);var a=t&&!1===t.end||e===i.stdout||e===i.stderr?v:s;function s(){g("onend"),e.end()}r.endEmitted?o.nextTick(a):n.once("end",a),e.on("unpipe",(function t(i,o){g("onunpipe"),i===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,g("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",f),e.removeListener("unpipe",t),n.removeListener("end",s),n.removeListener("end",v),n.removeListener("data",d),u=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=N(n);e.on("drain",c);var u=!1,h=!1;function d(t){g("ondata"),h=!1,!1!==e.write(t)||h||((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==X(r.pipes,e))&&!u&&(g("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function f(t){g("onerror",t),v(),e.removeListener("error",f),0===l(e,"error")&&e.emit("error",t)}function p(){e.removeListener("finish",m),v()}function m(){g("onfinish"),e.removeListener("close",p),v()}function v(){g("unpipe"),n.unpipe(e)}return n.on("data",d),x(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",n),r.flowing||(g("pipe resume"),n.resume()),e},M.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var a=X(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},M.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&O(this):o.nextTick(j,this))}return n},M.prototype.addListener=M.prototype.on,M.prototype.resume=function(){var e=this._readableState;return e.flowing||(g("resume"),e.flowing=!0,F(this,e)),this},M.prototype.pause=function(){return g("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(g("pause"),this._readableState.flowing=!1,this.emit("pause")),this},M.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(g("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){g("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<_.length;o++)e.on(_[o],this.emit.bind(this,_[o]));return this._read=function(t){g("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(M.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),M._fromList=U},{"process-nextick-args":"Yj0v",isarray:"REa7",events:"FRpO","./internal/streams/stream":"ExO1","safe-buffer":"Nqn4","core-util-is":"Q14w",inherits:"Bm0n",util:"rDCW","./internal/streams/BufferList":"CQMM","./internal/streams/destroy":"lCUh","./_stream_duplex":"Jcj8","string_decoder/":"OUJr",process:"pBGv"}],wBib:[function(e,t,n){"use strict";t.exports=a;var r=e("./_stream_duplex"),i=Object.create(e("core-util-is"));function o(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){l(e,t,n)})):l(this,null,null)}function l(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},{"./_stream_duplex":"Jcj8","core-util-is":"Q14w",inherits:"Bm0n"}],IxGW:[function(e,t,n){"use strict";t.exports=o;var r=e("./_stream_transform"),i=Object.create(e("core-util-is"));function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":"wBib","core-util-is":"Q14w",inherits:"Bm0n"}],JaqQ:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_readable.js":"YrHu","./lib/_stream_writable.js":"jPmE","./lib/_stream_duplex.js":"Jcj8","./lib/_stream_transform.js":"wBib","./lib/_stream_passthrough.js":"IxGW"}],UxIR:[function(e,t,n){e("process"),e("buffer").Buffer;var r=e("process"),i=e("buffer").Buffer,o=arguments[3],a=e("./capability"),s=e("inherits"),l=e("readable-stream"),c=n.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},u=n.IncomingMessage=function(e,t,n,s){var c=this;if(l.Readable.call(c),c._mode=n,c.headers={},c.rawHeaders=[],c.trailers={},c.rawTrailers=[],c.on("end",(function(){r.nextTick((function(){c.emit("close")}))})),"fetch"===n){if(c._fetchResponse=t,c.url=t.url,c.statusCode=t.status,c.statusMessage=t.statusText,t.headers.forEach((function(e,t){c.headers[t.toLowerCase()]=e,c.rawHeaders.push(t,e)})),a.writableStream){var u=new WritableStream({write:function(e){return new Promise((function(t,n){c._destroyed?n():c.push(new i(e))?t():c._resumeFetch=t}))},close:function(){o.clearTimeout(s),c._destroyed||c.push(null)},abort:function(e){c._destroyed||c.emit("error",e)}});try{return void t.body.pipeTo(u).catch((function(e){o.clearTimeout(s),c._destroyed||c.emit("error",e)}))}catch(e){}}var h=t.body.getReader();!function e(){h.read().then((function(t){if(!c._destroyed){if(t.done)return o.clearTimeout(s),void c.push(null);c.push(new i(t.value)),e()}})).catch((function(e){o.clearTimeout(s),c._destroyed||c.emit("error",e)}))}()}else if(c._xhr=e,c._pos=0,c.url=e.responseURL,c.statusCode=e.status,c.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var n=t[1].toLowerCase();"set-cookie"===n?(void 0===c.headers[n]&&(c.headers[n]=[]),c.headers[n].push(t[2])):void 0!==c.headers[n]?c.headers[n]+=", "+t[2]:c.headers[n]=t[2],c.rawHeaders.push(t[1],t[2])}})),c._charset="x-user-defined",!a.overrideMimeType){var d=c.rawHeaders["mime-type"];if(d){var f=d.match(/;\s*charset=([^;])(;|$)/);f&&(c._charset=f[1].toLowerCase())}c._charset||(c._charset="utf-8")}};s(u,l.Readable),u.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},u.prototype._onXHRProgress=function(){var e=this,t=e._xhr,n=null;switch(e._mode){case"text:vbarray":if(t.readyState!==c.DONE)break;try{n=new o.VBArray(t.responseBody).toArray()}catch(e){}if(null!==n){e.push(new i(n));break}case"text":try{n=t.responseText}catch(t){e._mode="text:vbarray";break}if(n.length>e._pos){var r=n.substr(e._pos);if("x-user-defined"===e._charset){for(var a=new i(r.length),s=0;s<r.length;s++)a[s]=255&r.charCodeAt(s);e.push(a)}else e.push(r,e._charset);e._pos=n.length}break;case"arraybuffer":if(t.readyState!==c.DONE||!t.response)break;n=t.response,e.push(new i(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=t.response,t.readyState!==c.LOADING||!n)break;e.push(new i(new Uint8Array(n)));break;case"ms-stream":if(n=t.response,t.readyState!==c.LOADING)break;var l=new o.MSStreamReader;l.onprogress=function(){l.result.byteLength>e._pos&&(e.push(new i(new Uint8Array(l.result.slice(e._pos)))),e._pos=l.result.byteLength)},l.onload=function(){e.push(null)},l.readAsArrayBuffer(n)}e._xhr.readyState===c.DONE&&"ms-stream"!==e._mode&&e.push(null)}},{"./capability":"p5a1",inherits:"Bm0n","readable-stream":"JaqQ",process:"pBGv",buffer:"dskh"}],AH4k:[function(e,t,n){var r=e("buffer").Buffer;t.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,i=0;i<n;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},{buffer:"dskh"}],yL7F:[function(e,t,n){e("buffer").Buffer,e("process");var r=e("buffer").Buffer,i=arguments[3],o=e("process"),a=e("./capability"),s=e("inherits"),l=e("./response"),c=e("readable-stream"),u=e("to-arraybuffer"),h=l.IncomingMessage,d=l.readyStates;function f(e,t){return a.fetch&&t?"fetch":a.mozchunkedarraybuffer?"moz-chunked-arraybuffer":a.msstream?"ms-stream":a.arraybuffer&&e?"arraybuffer":a.vbArray&&e?"text:vbarray":"text"}var p=t.exports=function(e){var t,n=this;c.Writable.call(n),n._opts=e,n._body=[],n._headers={},e.auth&&n.setHeader("Authorization","Basic "+new r(e.auth).toString("base64")),Object.keys(e.headers).forEach((function(t){n.setHeader(t,e.headers[t])}));var i=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!a.abortController)i=!1,t=!0;else if("prefer-streaming"===e.mode)t=!1;else if("allow-wrong-content-type"===e.mode)t=!a.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");t=!0}n._mode=f(t,i),n._fetchTimer=null,n.on("finish",(function(){n._onFinish()}))};function m(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}}s(p,c.Writable),p.prototype.setHeader=function(e,t){var n=e.toLowerCase();-1===g.indexOf(n)&&(this._headers[n]={name:e,value:t})},p.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},p.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},p.prototype._onFinish=function(){var e=this;if(!e._destroyed){var t=e._opts,n=e._headers,s=null;"GET"!==t.method&&"HEAD"!==t.method&&(s=a.arraybuffer?u(r.concat(e._body)):a.blobConstructor?new i.Blob(e._body.map((function(e){return u(e)})),{type:(n["content-type"]||{}).value||""}):r.concat(e._body).toString());var l=[];if(Object.keys(n).forEach((function(e){var t=n[e].name,r=n[e].value;Array.isArray(r)?r.forEach((function(e){l.push([t,e])})):l.push([t,r])})),"fetch"===e._mode){var c=null;if(a.abortController){var h=new AbortController;c=h.signal,e._fetchAbortController=h,"requestTimeout"in t&&0!==t.requestTimeout&&(e._fetchTimer=i.setTimeout((function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()}),t.requestTimeout))}i.fetch(e._opts.url,{method:e._opts.method,headers:l,body:s||void 0,mode:"cors",credentials:t.withCredentials?"include":"same-origin",signal:c}).then((function(t){e._fetchResponse=t,e._connect()}),(function(t){i.clearTimeout(e._fetchTimer),e._destroyed||e.emit("error",t)}))}else{var f=e._xhr=new i.XMLHttpRequest;try{f.open(e._opts.method,e._opts.url,!0)}catch(t){return void o.nextTick((function(){e.emit("error",t)}))}"responseType"in f&&(f.responseType=e._mode.split(":")[0]),"withCredentials"in f&&(f.withCredentials=!!t.withCredentials),"text"===e._mode&&"overrideMimeType"in f&&f.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in t&&(f.timeout=t.requestTimeout,f.ontimeout=function(){e.emit("requestTimeout")}),l.forEach((function(e){f.setRequestHeader(e[0],e[1])})),e._response=null,f.onreadystatechange=function(){switch(f.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(f.onprogress=function(){e._onXHRProgress()}),f.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{f.send(s)}catch(t){return void o.nextTick((function(){e.emit("error",t)}))}}}},p.prototype._onXHRProgress=function(){m(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},p.prototype._connect=function(){var e=this;e._destroyed||(e._response=new h(e._xhr,e._fetchResponse,e._mode,e._fetchTimer),e._response.on("error",(function(t){e.emit("error",t)})),e.emit("response",e._response))},p.prototype._write=function(e,t,n){this._body.push(e),n()},p.prototype.abort=p.prototype.destroy=function(){this._destroyed=!0,i.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},p.prototype.end=function(e,t,n){"function"==typeof e&&(n=e,e=void 0),c.Writable.prototype.end.call(this,e,t,n)},p.prototype.flushHeaders=function(){},p.prototype.setTimeout=function(){},p.prototype.setNoDelay=function(){},p.prototype.setSocketKeepAlive=function(){};var g=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]},{"./capability":"p5a1",inherits:"Bm0n","./response":"UxIR","readable-stream":"JaqQ","to-arraybuffer":"AH4k",buffer:"dskh",process:"pBGv"}],K5Tb:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}],OpTI:[function(e,t,n){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],oWqx:[function(e,t,n){var r,i=arguments[3];!function(e){var o="object"==typeof n&&n&&!n.nodeType&&n,a="object"==typeof t&&t&&!t.nodeType&&t,s="object"==typeof i&&i;s.global!==s&&s.window!==s&&s.self!==s||(e=s);var l,c,u=2147483647,h=36,d=/^xn--/,f=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},g=Math.floor,v=String.fromCharCode;function y(e){throw new RangeError(m[e])}function b(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function _(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+b((e=e.replace(p,".")).split("."),t).join(".")}function x(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function w(e){return b(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+v(e)})).join("")}function M(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,n){var r=0;for(e=n?g(e/700):e>>1,e+=g(e/t);e>455;r+=h)e=g(e/35);return g(r+36*e/(e+38))}function E(e){var t,n,r,i,o,a,s,l,c,d,f,p=[],m=e.length,v=0,b=128,_=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&y("not-basic"),p.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(o=v,a=1,s=h;i>=m&&y("invalid-input"),((l=(f=e.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:h)>=h||l>g((u-v)/a))&&y("overflow"),v+=l*a,!(l<(c=s<=_?1:s>=_+26?26:s-_));s+=h)a>g(u/(d=h-c))&&y("overflow"),a*=d;_=S(v-o,t=p.length+1,0==o),g(v/t)>u-b&&y("overflow"),b+=g(v/t),v%=t,p.splice(v++,0,b)}return w(p)}function T(e){var t,n,r,i,o,a,s,l,c,d,f,p,m,b,_,w=[];for(p=(e=x(e)).length,t=128,n=0,o=72,a=0;a<p;++a)(f=e[a])<128&&w.push(v(f));for(r=i=w.length,i&&w.push("-");r<p;){for(s=u,a=0;a<p;++a)(f=e[a])>=t&&f<s&&(s=f);for(s-t>g((u-n)/(m=r+1))&&y("overflow"),n+=(s-t)*m,t=s,a=0;a<p;++a)if((f=e[a])<t&&++n>u&&y("overflow"),f==t){for(l=n,c=h;!(l<(d=c<=o?1:c>=o+26?26:c-o));c+=h)_=l-d,b=h-d,w.push(v(M(d+_%b,0))),l=g(_/b);w.push(v(M(l,0))),o=S(n,m,r==i),n=0,++r}++n,++t}return w.join("")}if(l={version:"1.4.1",ucs2:{decode:x,encode:w},decode:E,encode:T,toASCII:function(e){return _(e,(function(e){return f.test(e)?"xn--"+T(e):e}))},toUnicode:function(e){return _(e,(function(e){return d.test(e)?E(e.slice(4).toLowerCase()):e}))}},"function"==typeof r&&"object"==typeof r.amd&&r.amd)r("punycode",(function(){return l}));else if(o&&a)if(t.exports==o)a.exports=l;else for(c in l)l.hasOwnProperty(c)&&(o[c]=l[c]);else e.punycode=l}(this)},{}],YsIc:[function(e,t,n){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],J6GP:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,f,p,m=e[u].replace(s,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),r(a,f)?i(a[f])?a[f].push(p):a[f]=[a[f],p]:a[f]=p}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],bvhO:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(a(e),(function(a){var s=encodeURIComponent(r(a))+n;return i(e[a])?o(e[a],(function(e){return s+encodeURIComponent(r(e))})).join(t):s+encodeURIComponent(r(e[a]))})).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],fk5h:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":"J6GP","./encode":"bvhO"}],Mej7:[function(e,t,n){"use strict";var r=e("punycode"),i=e("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=b,n.resolve=function(e,t){return b(e,!1,!0).resolve(t)},n.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},n.format=function(e){return i.isString(e)&&(e=b(e)),e instanceof o?e.format():o.prototype.format.call(e)},n.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=e("querystring");function b(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(s);if(b=b.trim(),!n&&1===e.split("#").length){var _=l.exec(b);if(_)return this.path=b,this.href=b,this.pathname=_[1],_[2]?(this.search=_[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var x=a.exec(b);if(x){var w=(x=x[0]).toLowerCase();this.protocol=w,b=b.substr(x.length)}if(n||x||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===b.substr(0,2);!M||x&&g[x]||(b=b.substr(2),this.slashes=!0)}if(!g[x]&&(M||x&&!v[x])){for(var S,E,T=-1,C=0;C<d.length;C++)-1!==(A=b.indexOf(d[C]))&&(-1===T||A<T)&&(T=A);for(-1!==(E=-1===T?b.lastIndexOf("@"):b.lastIndexOf("@",T))&&(S=b.slice(0,E),b=b.slice(E+1),this.auth=decodeURIComponent(S)),T=-1,C=0;C<h.length;C++){var A;-1!==(A=b.indexOf(h[C]))&&(-1===T||A<T)&&(T=A)}-1===T&&(T=b.length),this.host=b.slice(0,T),b=b.slice(T),this.parseHost(),this.hostname=this.hostname||"";var L="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!L)for(var P=this.hostname.split(/\./),R=(C=0,P.length);C<R;C++){var O=P[C];if(O&&!O.match(f)){for(var k="",I=0,D=O.length;I<D;I++)O.charCodeAt(I)>127?k+="x":k+=O[I];if(!k.match(f)){var N=P.slice(0,C),j=P.slice(C+1),F=O.match(p);F&&(N.push(F[1]),j.unshift(F[2])),j.length&&(b="/"+j.join(".")+b),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),L||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+B,this.href+=this.host,L&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[w])for(C=0,R=u.length;C<R;C++){var U=u[C];if(-1!==b.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),b=b.split(U).join(H)}}var G=b.indexOf("#");-1!==G&&(this.hash=b.substr(G),b=b.slice(0,G));var W=b.indexOf("?");if(-1!==W?(this.search=b.substr(W),this.query=b.substr(W+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,W)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var V=this.search||"";this.path=B+V}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=y.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(n[u]=e[u])}return v[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!v[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var f=h[d];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),_=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=_||b||n.host&&e.pathname,w=x,M=n.pathname&&n.pathname.split("/")||[],S=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!v[n.protocol]);if(S&&(n.hostname="",n.port=null,n.host&&(""===M[0]?M[0]=n.host:M.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),x=x&&(""===p[0]||""===M[0])),_)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search))return S&&(n.hostname=n.host=M.shift(),(L=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=L.shift(),n.host=n.hostname=L.shift())),n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!M.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=M.slice(-1)[0],T=(n.host||e.host||M.length>1)&&("."===E||".."===E)||""===E,C=0,A=M.length;A>=0;A--)"."===(E=M[A])?M.splice(A,1):".."===E?(M.splice(A,1),C++):C&&(M.splice(A,1),C--);if(!x&&!w)for(;C--;C)M.unshift("..");!x||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),T&&"/"!==M.join("/").substr(-1)&&M.push("");var L,P=""===M[0]||M[0]&&"/"===M[0].charAt(0);return S&&(n.hostname=n.host=P?"":M.length?M.shift():"",(L=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=L.shift(),n.host=n.hostname=L.shift())),(x=x||n.host&&M.length)&&!P&&M.unshift(""),M.length?n.pathname=M.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:"oWqx","./util":"YsIc",querystring:"fk5h"}],KKrj:[function(e,t,n){var r=arguments[3],i=e("./lib/request"),o=e("./lib/response"),a=e("xtend"),s=e("builtin-status-codes"),l=e("url"),c=n;c.request=function(e,t){e="string"==typeof e?l.parse(e):a(e);var n=-1===r.location.protocol.search(/^https?:$/)?"http:":"",o=e.protocol||n,s=e.hostname||e.host,c=e.port,u=e.path||"/";s&&-1!==s.indexOf(":")&&(s="["+s+"]"),e.url=(s?o+"//"+s:"")+(c?":"+c:"")+u,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var h=new i(e);return t&&h.on("response",t),h},c.get=function(e,t){var n=c.request(e,t);return n.end(),n},c.ClientRequest=i,c.IncomingMessage=o.IncomingMessage,c.Agent=function(){},c.Agent.defaultMaxSockets=4,c.globalAgent=new c.Agent,c.STATUS_CODES=s,c.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]},{"./lib/request":"yL7F","./lib/response":"UxIR",xtend:"K5Tb","builtin-status-codes":"OpTI",url:"Mej7"}],wVMl:[function(e,t,n){var r=e("http"),i=e("url"),o=t.exports;for(var a in r)r.hasOwnProperty(a)&&(o[a]=r[a]);function s(e){if("string"==typeof e&&(e=i.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}o.request=function(e,t){return e=s(e),r.request.call(this,e,t)},o.get=function(e,t){return e=s(e),r.get.call(this,e,t)}},{http:"KKrj",url:"Mej7"}],SHlS:[function(e,t,n){e("buffer").Buffer;var r=e("buffer").Buffer;Object.defineProperty(n,"__esModule",{value:!0}),n.HttpClient=void 0;var i=v(e("@babel/runtime/helpers/defineProperty")),o=v(e("@babel/runtime/regenerator")),a=v(e("@babel/runtime/helpers/asyncToGenerator")),s=v(e("@babel/runtime/helpers/classCallCheck")),l=v(e("@babel/runtime/helpers/createClass")),c=v(e("@babel/runtime/helpers/inherits")),u=v(e("@babel/runtime/helpers/possibleConstructorReturn")),h=v(e("@babel/runtime/helpers/getPrototypeOf")),d=v(e("http")),f=v(e("https")),p=v(e("url")),m=e("./base"),g=e("../../utils");function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var i=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var x=function(e){(0,c.default)(n,e);var t=_(n);function n(e,r){var i;return(0,s.default)(this,n),(i=t.call(this)).response=e,i.dataPromise=r,i}return(0,l.default)(n,[{key:"getHeader",value:function(e){return this.response.headers[e]}},{key:"getData",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataPromise;case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"status",get:function(){return this.response.statusCode}}]),n}(m.BaseResponse),w=function(e){(0,c.default)(n,e);var t=_(n);function n(e){var r;return(0,s.default)(this,n),(r=t.call(this,e)).parsedUrl=p.default.parse(r.url),r.httpApi="http:"===r.parsedUrl.protocol?d.default:f.default,r}return(0,l.default)(n,[{key:"constructRequest",value:function(e,t){var n=this;return new Promise((function(i,o){var a=n.httpApi.get(b(b({},n.parsedUrl),{},{headers:e}),(function(e){var t=new Promise((function(t){var n=[];e.on("data",(function(e){n.push(e)})),e.on("end",(function(){var e=r.concat(n).buffer;t(e)})),e.on("error",o)}));i(new x(e,t))}));a.on("error",o),t&&(t.aborted&&a.destroy(new g.AbortError("Request aborted")),t.addEventListener("abort",(function(){return a.destroy(new g.AbortError("Request aborted"))})))}))}},{key:"request",value:function(){var e=(0,a.default)(o.default.mark((function e(){var t,n,r,i,a=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=t.headers,r=t.signal,e.next=3,this.constructRequest(n,r);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(m.BaseClient);n.HttpClient=w},{"@babel/runtime/helpers/defineProperty":"IxO8","@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0",http:"KKrj",https:"wVMl",url:"Mej7","./base":"uL1U","../../utils":"FOZT",buffer:"dskh"}],itmA:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeFetchSource=M,n.makeXHRSource=S,n.makeHttpSource=E,n.makeRemoteSource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceXHR,i=void 0!==n&&n,o=(0,r.default)(t,["forceXHR"]);return"function"!=typeof fetch||i?"undefined"!=typeof XMLHttpRequest?S(e,o):E(e,o):M(e,o)};var r=y(e("@babel/runtime/helpers/objectWithoutProperties")),i=y(e("@babel/runtime/helpers/defineProperty")),o=y(e("@babel/runtime/regenerator")),a=y(e("@babel/runtime/helpers/asyncToGenerator")),s=y(e("@babel/runtime/helpers/classCallCheck")),l=y(e("@babel/runtime/helpers/createClass")),c=y(e("@babel/runtime/helpers/inherits")),u=y(e("@babel/runtime/helpers/possibleConstructorReturn")),h=y(e("@babel/runtime/helpers/getPrototypeOf")),d=e("./httputils"),f=e("./basesource"),p=e("./blockedsource"),m=e("./client/fetch"),g=e("./client/xhr"),v=e("./client/http");function y(e){return e&&e.__esModule?e:{default:e}}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){(0,c.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var i=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}(n);function n(e,r,i,o){var a;return(0,s.default)(this,n),(a=t.call(this)).client=e,a.headers=r,a.maxRanges=i,a.allowFullFile=o,a._fileSize=null,a}return(0,l.default)(n,[{key:"fetch",value:function(){var e=(0,a.default)(o.default.mark((function e(t,n){var r=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.maxRanges>=t.length)){e.next=4;break}return e.abrupt("return",this.fetchSlices(t,n));case 4:this.maxRanges>0&&t.length;case 5:return e.next=7,Promise.all(t.map((function(e){return r.fetchSlice(e,n)})));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchSlices",value:function(){var e=(0,a.default)(o.default.mark((function e(t,n){var r,i,a,s,l,c,u,h,f,p,m,g,v,y=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.request({headers:_(_({},this.headers),{},{Range:"bytes=".concat(t.map((function(e){var t=e.offset,n=e.length;return"".concat(t,"-").concat(t+n)})).join(","))}),signal:n});case 2:if((r=e.sent).ok){e.next=7;break}throw new Error("Error fetching data.");case 7:if(206!==r.status){e.next=32;break}if(i=(0,d.parseContentType)(r.getHeader("content-type")),a=i.type,s=i.params,"multipart/byteranges"!==a){e.next=18;break}return e.t0=d.parseByteRanges,e.next=13,r.getData();case 13:return e.t1=e.sent,e.t2=s.boundary,l=(0,e.t0)(e.t1,e.t2),this._fileSize=l[0].fileSize||null,e.abrupt("return",l);case 18:return e.next=20,r.getData();case 20:if(c=e.sent,u=(0,d.parseContentRange)(r.getHeader("content-range")),h=u.start,f=u.end,p=u.total,this._fileSize=p||null,m=[{data:c,offset:h,length:f-h}],!(t.length>1)){e.next=29;break}return e.next=27,Promise.all(t.slice(1).map((function(e){return y.fetchSlice(e,n)})));case 27:return g=e.sent,e.abrupt("return",m.concat(g));case 29:return e.abrupt("return",m);case 32:if(this.allowFullFile){e.next=34;break}throw new Error("Server responded with full file");case 34:return e.next=36,r.getData();case 36:return v=e.sent,this._fileSize=v.byteLength,e.abrupt("return",[{data:v,offset:0,length:v.byteLength}]);case 39:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchSlice",value:function(){var e=(0,a.default)(o.default.mark((function e(t,n){var r,i,a,s,l,c,u;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.offset,i=t.length,e.next=3,this.client.request({headers:_(_({},this.headers),{},{Range:"bytes=".concat(r,"-").concat(r+i)}),signal:n});case 3:if((a=e.sent).ok){e.next=8;break}throw new Error("Error fetching data.");case 8:if(206!==a.status){e.next=17;break}return e.next=11,a.getData();case 11:return s=e.sent,l=(0,d.parseContentRange)(a.getHeader("content-range")),c=l.total,this._fileSize=c||null,e.abrupt("return",{data:s,offset:r,length:i});case 17:if(this.allowFullFile){e.next=19;break}throw new Error("Server responded with full file");case 19:return e.next=21,a.getData();case 21:return u=e.sent,this._fileSize=u.byteLength,e.abrupt("return",{data:u,offset:0,length:u.byteLength});case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fileSize",get:function(){return this._fileSize}}]),n}(f.BaseSource);function w(e,t){var n=t.blockSize,r=t.cacheSize;return null===n?e:new p.BlockedSource(e,n,r)}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.headers,i=void 0===n?{}:n,o=t.credentials,a=t.maxRanges,s=void 0===a?0:a,l=t.allowFullFile,c=void 0!==l&&l,u=(0,r.default)(t,["headers","credentials","maxRanges","allowFullFile"]),h=new m.FetchClient(e,o);return w(new x(h,i,s,c),u)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.headers,i=void 0===n?{}:n,o=t.maxRanges,a=void 0===o?0:o,s=t.allowFullFile,l=void 0!==s&&s,c=(0,r.default)(t,["headers","maxRanges","allowFullFile"]),u=new g.XHRClient(e);return w(new x(u,i,a,l),c)}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.headers,i=void 0===n?{}:n,o=t.maxRanges,a=void 0===o?0:o,s=t.allowFullFile,l=void 0!==s&&s,c=(0,r.default)(t,["headers","maxRanges","allowFullFile"]),u=new v.HttpClient(e);return w(new x(u,i,a,l),c)}},{"@babel/runtime/helpers/objectWithoutProperties":"U8F3","@babel/runtime/helpers/defineProperty":"IxO8","@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./httputils":"ZJpj","./basesource":"LzCD","./blockedsource":"xD7g","./client/fetch":"Un5s","./client/xhr":"hvgd","./client/http":"SHlS"}],wM9h:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeBufferSource=function(e){return new h(e)};var r=u(e("@babel/runtime/helpers/classCallCheck")),i=u(e("@babel/runtime/helpers/createClass")),o=u(e("@babel/runtime/helpers/inherits")),a=u(e("@babel/runtime/helpers/possibleConstructorReturn")),s=u(e("@babel/runtime/helpers/getPrototypeOf")),l=e("./basesource"),c=e("../utils");function u(e){return e&&e.__esModule?e:{default:e}}var h=function(e){(0,o.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}(n);function n(e){var i;return(0,r.default)(this,n),(i=t.call(this)).arrayBuffer=e,i}return(0,i.default)(n,[{key:"fetchSlice",value:function(e,t){if(t&&t.aborted)throw new c.AbortError("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}]),n}(l.BaseSource)},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./basesource":"LzCD","../utils":"FOZT"}],GiEG:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeFileReaderSource=function(e){return new h(e)};var r=u(e("@babel/runtime/regenerator")),i=u(e("@babel/runtime/helpers/asyncToGenerator")),o=u(e("@babel/runtime/helpers/classCallCheck")),a=u(e("@babel/runtime/helpers/createClass")),s=u(e("@babel/runtime/helpers/inherits")),l=u(e("@babel/runtime/helpers/possibleConstructorReturn")),c=u(e("@babel/runtime/helpers/getPrototypeOf"));function u(e){return e&&e.__esModule?e:{default:e}}var h=function(e){(0,s.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(n);function n(e){var r;return(0,o.default)(this,n),(r=t.call(this)).file=e,r}return(0,a.default)(n,[{key:"fetchSlice",value:function(){var e=(0,i.default)(r.default.mark((function e(t,n){var i=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=i.file.slice(t.offset,t.offset+t.length),a=new FileReader;a.onload=function(t){return e(t.target.result)},a.onerror=r,a.onabort=r,a.readAsArrayBuffer(o),n&&n.addEventListener("abort",(function(){return a.abort()}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(e("./basesource").BaseSource)},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","./basesource":"LzCD"}],G7Cz:[function(e,t,n){e("buffer").Buffer;var r=e("buffer").Buffer;Object.defineProperty(n,"__esModule",{value:!0}),n.makeFileSource=function(e){return new m(e)};var i=d(e("@babel/runtime/regenerator")),o=d(e("@babel/runtime/helpers/asyncToGenerator")),a=d(e("@babel/runtime/helpers/classCallCheck")),s=d(e("@babel/runtime/helpers/createClass")),l=d(e("@babel/runtime/helpers/inherits")),c=d(e("@babel/runtime/helpers/possibleConstructorReturn")),u=d(e("@babel/runtime/helpers/getPrototypeOf")),h=e("fs");function d(e){return e&&e.__esModule?e:{default:e}}function f(e){return new Promise((function(t,n){(0,h.close)(e,(function(e){e?n(e):t()}))}))}function p(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Promise((function(e,n){h.read.apply(void 0,t.concat([function(t,r,i){t?n(t):e({bytesRead:r,buffer:i})}]))}))}var m=function(e){(0,l.default)(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}(n);function n(e){var r;return(0,a.default)(this,n),(r=t.call(this)).path=e,r.openRequest=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return new Promise((function(r,i){(0,h.open)(e,t,n,(function(e,t){e?i(e):r(t)}))}))}(e,"r"),r}return(0,s.default)(n,[{key:"fetchSlice",value:function(){var e=(0,o.default)(i.default.mark((function e(t){var n,o,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.openRequest;case 2:return n=e.sent,e.next=5,p(n,r.alloc(t.length),0,t.length,t.offset);case 5:return o=e.sent,a=o.buffer,e.abrupt("return",a.buffer);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,o.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.openRequest;case 2:return t=e.sent,e.next=5,f(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(e("./basesource").BaseSource)},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0",fs:"rDCW","./basesource":"LzCD",buffer:"dskh"}],BGyE:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.writeGeotiff=function(e,t){var n,o,a,s;"number"==typeof e[0]?(n=t.height||t.ImageLength,a=t.width||t.ImageWidth,o=e.length/(n*a),s=e):(o=e.length,n=e[0].length,a=e[0][0].length,s=[],(0,i.times)(n,(function(t){(0,i.times)(a,(function(n){(0,i.times)(o,(function(r){s.push(e[r][t][n])}))}))}))),t.ImageLength=n,delete t.height,t.ImageWidth=a,delete t.width,t.BitsPerSample||(t.BitsPerSample=(0,i.times)(o,(function(){return 8}))),g.forEach((function(e){var n=e[0];if(!t[n]){var r=e[1];t[n]=r}})),t.PhotometricInterpretation||(t.PhotometricInterpretation=3===t.BitsPerSample.length?2:1),t.SamplesPerPixel||(t.SamplesPerPixel=[o]),t.StripByteCounts||(t.StripByteCounts=[o*n*a]),t.ModelPixelScale||(t.ModelPixelScale=[360/a,180/n,0]),t.SampleFormat||(t.SampleFormat=(0,i.times)(o,(function(){return 1})));var l=Object.keys(t).filter((function(e){return(0,i.endsWith)(e,"GeoKey")})).sort((function(e,t){return u[e]-u[t]}));if(!t.GeoKeyDirectory){var c=[1,1,0,l.length];l.forEach((function(e){var n,i,o,a=Number(u[e]);c.push(a),"SHORT"===r.fieldTagTypes[a]?(n=1,i=0,o=t[e]):"GeogCitationGeoKey"===e?(n=t.GeoAsciiParams.length,i=Number(u.GeoAsciiParams),o=0):console.log("[geotiff.js] couldn't get TIFFTagLocation for ".concat(e)),c.push(i),c.push(n),c.push(o)})),t.GeoKeyDirectory=c}for(var h in l)l.hasOwnProperty(h)&&delete t[h];["Compression","ExtraSamples","GeographicTypeGeoKey","GTModelTypeGeoKey","GTRasterTypeGeoKey","ImageLength","ImageWidth","PhotometricInterpretation","PlanarConfiguration","ResolutionUnit","SamplesPerPixel","XPosition","YPosition"].forEach((function(e){t[e]&&(t[e]=function(e){return Array.isArray(e)?e:[e]}(t[e]))}));var d=function(e){var t={};for(var n in e)"StripOffsets"!==n&&(u[n]||console.error(n,"not in name2code:",Object.keys(u)),t[u[n]]=e[n]);return t}(t);return m(s,a,n,d)};var r=e("./globals"),i=e("./utils");function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=(0,i.invert)(r.fieldTagNames),c=(0,i.invert)(r.geoKeyNames),u={};(0,i.assign)(u,l),(0,i.assign)(u,c);var h=(0,i.invert)(r.fieldTypeNames),d=1e3,f={nextZero:function(e,t){for(var n=t;0!==e[n];)n++;return n},readUshort:function(e,t){return e[t]<<8|e[t+1]},readShort:function(e,t){var n=f.ui8;return n[0]=e[t+1],n[1]=e[t+0],f.i16[0]},readInt:function(e,t){var n=f.ui8;return n[0]=e[t+3],n[1]=e[t+2],n[2]=e[t+1],n[3]=e[t+0],f.i32[0]},readUint:function(e,t){var n=f.ui8;return n[0]=e[t+3],n[1]=e[t+2],n[2]=e[t+1],n[3]=e[t+0],f.ui32[0]},readASCII:function(e,t,n){return n.map((function(n){return String.fromCharCode(e[t+n])})).join("")},readFloat:function(e,t){var n=f.ui8;return(0,i.times)(4,(function(r){n[r]=e[t+3-r]})),f.fl32[0]},readDouble:function(e,t){var n=f.ui8;return(0,i.times)(8,(function(r){n[r]=e[t+7-r]})),f.fl64[0]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=n>>0&255},writeASCII:function(e,t,n){(0,i.times)(n.length,(function(r){e[t+r]=n.charCodeAt(r)}))},ui8:new Uint8Array(8)};f.fl64=new Float64Array(f.ui8.buffer),f.writeDouble=function(e,t,n){f.fl64[0]=n,(0,i.times)(8,(function(n){e[t+n]=f.ui8[7-n]}))};var p=function(e,t,n,a){var s=n,l=Object.keys(a).filter((function(e){return null!=e&&"undefined"!==e}));e.writeUshort(t,s,l.length);var c,u=(s+=2)+12*l.length+4,d=o(l);try{var f=function(){var n=c.value,o=null;"number"==typeof n?o=n:"string"==typeof n&&(o=parseInt(n,10));var l=r.fieldTagTypes[o],d=h[l];if(null==l||void 0===l||void 0===l)throw new Error("unknown type of tag: ".concat(o));var f=a[n];if(void 0===f)throw new Error("failed to get value for key ".concat(n));"ASCII"===l&&"string"==typeof f&&!1===(0,i.endsWith)(f,"\0")&&(f+="\0");var p=f.length;e.writeUshort(t,s,o),s+=2,e.writeUshort(t,s,d),s+=2,e.writeUint(t,s,p);var m=[-1,1,1,2,4,8,0,0,0,0,0,0,8][d]*p,g=s+=4;m>4&&(e.writeUint(t,s,u),g=u),"ASCII"===l?e.writeASCII(t,g,f):"SHORT"===l?(0,i.times)(p,(function(n){e.writeUshort(t,g+2*n,f[n])})):"LONG"===l?(0,i.times)(p,(function(n){e.writeUint(t,g+4*n,f[n])})):"RATIONAL"===l?(0,i.times)(p,(function(n){e.writeUint(t,g+8*n,Math.round(1e4*f[n])),e.writeUint(t,g+8*n+4,1e4)})):"DOUBLE"===l&&(0,i.times)(p,(function(n){e.writeDouble(t,g+8*n,f[n])})),m>4&&(u+=m+=1&m),s+=4};for(d.s();!(c=d.n()).done;)f()}catch(e){d.e(e)}finally{d.f()}return[s,u]},m=function(e,t,n,r){if(null==n)throw new Error("you passed into encodeImage a width of type ".concat(n));if(null==t)throw new Error("you passed into encodeImage a width of type ".concat(t));var o={256:[t],257:[n],273:[d],278:[n],305:"geotiff.js"};if(r)for(var a in r)r.hasOwnProperty(a)&&(o[a]=r[a]);var s=new Uint8Array(function(e){var t=new Uint8Array(d),n=4,r=f;t[0]=77,t[1]=77,t[3]=42;var i=8;if(r.writeUint(t,n,i),n+=4,e.forEach((function(n,o){var a=p(r,t,i,n);i=a[1],o<e.length-1&&r.writeUint(t,a[0],i)})),t.slice)return t.slice(0,i).buffer;for(var o=new Uint8Array(i),a=0;a<i;a++)o[a]=t[a];return o.buffer}([o])),l=new Uint8Array(e),c=o[277],u=new Uint8Array(d+t*n*c);return(0,i.times)(s.length,(function(e){u[e]=s[e]})),(0,i.forEach)(l,(function(e,t){u[d+t]=e})),u.buffer},g=[["Compression",1],["PlanarConfiguration",1],["XPosition",0],["YPosition",0],["ResolutionUnit",1],["ExtraSamples",0],["GeoAsciiParams","WGS 84\0"],["ModelTiepoint",[0,0,0,-180,90,0]],["GTModelTypeGeoKey",2],["GTRasterTypeGeoKey",1],["GeographicTypeGeoKey",4326],["GeogCitationGeoKey","WGS 84"]]},{"./globals":"j27V","./utils":"FOZT"}],dy4f:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setLogger=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a;s=e},n.debug=function(){var e;return(e=s).debug.apply(e,arguments)},n.log=function(){var e;return(e=s).log.apply(e,arguments)},n.info=function(){var e;return(e=s).info.apply(e,arguments)},n.warn=function(){var e;return(e=s).warn.apply(e,arguments)},n.error=function(){var e;return(e=s).error.apply(e,arguments)},n.time=function(){var e;return(e=s).time.apply(e,arguments)},n.timeEnd=function(){var e;return(e=s).timeEnd.apply(e,arguments)};var r=o(e("@babel/runtime/helpers/classCallCheck")),i=o(e("@babel/runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,[{key:"log",value:function(){}},{key:"debug",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}},{key:"time",value:function(){}},{key:"timeEnd",value:function(){}}]),e}(),s=new a},{"@babel/runtime/helpers/classCallCheck":"fcMS","@babel/runtime/helpers/createClass":"P8NW"}],bsJs:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fromUrl=function(e){return U.apply(this,arguments)},n.fromArrayBuffer=function(e,t){return H.apply(this,arguments)},n.fromFile=function(e,t){return G.apply(this,arguments)},n.fromBlob=function(e,t){return W.apply(this,arguments)},n.fromUrls=function(e){return V.apply(this,arguments)},n.writeArrayBuffer=function(e,t){return q.apply(this,arguments)},Object.defineProperty(n,"Pool",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(n,"getDecoder",{enumerable:!0,get:function(){return S.getDecoder}}),Object.defineProperty(n,"setLogger",{enumerable:!0,get:function(){return E.setLogger}}),n.rgb=n.globals=n.MultiGeoTIFF=n.default=n.GeoTIFF=void 0;var r=A(e("@babel/runtime/regenerator")),i=A(e("@babel/runtime/helpers/defineProperty")),o=A(e("@babel/runtime/helpers/slicedToArray")),a=A(e("@babel/runtime/helpers/asyncToGenerator")),s=A(e("@babel/runtime/helpers/createClass")),l=A(e("@babel/runtime/helpers/inherits")),c=A(e("@babel/runtime/helpers/possibleConstructorReturn")),u=A(e("@babel/runtime/helpers/getPrototypeOf")),h=A(e("@babel/runtime/helpers/wrapNativeSuper")),d=A(e("@babel/runtime/helpers/classCallCheck")),f=A(e("./geotiffimage")),p=A(e("./dataview64")),m=A(e("./dataslice")),g=A(e("./pool")),v=e("./source/remote"),y=e("./source/arraybuffer"),b=e("./source/filereader"),_=e("./source/file"),x=C(e("./globals"));n.globals=x;var w=e("./geotiffwriter"),M=C(e("./rgb"));n.rgb=M;var S=e("./compression"),E=e("./logging");function T(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return T=function(){return e},e}function C(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=T();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function A(e){return e&&e.__esModule?e:{default:e}}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}function O(e){switch(e){case x.fieldTypes.BYTE:case x.fieldTypes.ASCII:case x.fieldTypes.SBYTE:case x.fieldTypes.UNDEFINED:return 1;case x.fieldTypes.SHORT:case x.fieldTypes.SSHORT:return 2;case x.fieldTypes.LONG:case x.fieldTypes.SLONG:case x.fieldTypes.FLOAT:case x.fieldTypes.IFD:return 4;case x.fieldTypes.RATIONAL:case x.fieldTypes.SRATIONAL:case x.fieldTypes.DOUBLE:case x.fieldTypes.LONG8:case x.fieldTypes.SLONG8:case x.fieldTypes.IFD8:return 8;default:throw new RangeError("Invalid field type: ".concat(e))}}function k(e){var t=e.GeoKeyDirectory;if(!t)return null;for(var n={},r=4;r<=4*t[3];r+=4){var i=x.geoKeyNames[t[r]],o=t[r+1]?x.fieldTagNames[t[r+1]]:null,a=t[r+2],s=t[r+3],l=null;if(o){if(null==(l=e[o]))throw new Error("Could not get value of geoKey '".concat(i,"'."));"string"==typeof l?l=l.substring(s,s+a-1):l.subarray&&(l=l.subarray(s,s+a),1===a&&(l=l[0]))}else l=s;n[i]=l}return n}function I(e,t,n,r){var i=null,o=null,a=O(t);switch(t){case x.fieldTypes.BYTE:case x.fieldTypes.ASCII:case x.fieldTypes.UNDEFINED:i=new Uint8Array(n),o=e.readUint8;break;case x.fieldTypes.SBYTE:i=new Int8Array(n),o=e.readInt8;break;case x.fieldTypes.SHORT:i=new Uint16Array(n),o=e.readUint16;break;case x.fieldTypes.SSHORT:i=new Int16Array(n),o=e.readInt16;break;case x.fieldTypes.LONG:case x.fieldTypes.IFD:i=new Uint32Array(n),o=e.readUint32;break;case x.fieldTypes.SLONG:i=new Int32Array(n),o=e.readInt32;break;case x.fieldTypes.LONG8:case x.fieldTypes.IFD8:i=new Array(n),o=e.readUint64;break;case x.fieldTypes.SLONG8:i=new Array(n),o=e.readInt64;break;case x.fieldTypes.RATIONAL:i=new Uint32Array(2*n),o=e.readUint32;break;case x.fieldTypes.SRATIONAL:i=new Int32Array(2*n),o=e.readInt32;break;case x.fieldTypes.FLOAT:i=new Float32Array(n),o=e.readFloat32;break;case x.fieldTypes.DOUBLE:i=new Float64Array(n),o=e.readFloat64;break;default:throw new RangeError("Invalid field type: ".concat(t))}if(t!==x.fieldTypes.RATIONAL&&t!==x.fieldTypes.SRATIONAL)for(var s=0;s<n;++s)i[s]=o.call(e,r+s*a);else for(var l=0;l<n;l+=2)i[l]=o.call(e,r+l*a),i[l+1]=o.call(e,r+(l*a+4));return t===x.fieldTypes.ASCII?new TextDecoder("utf-8").decode(i):i}var D=function e(t,n,r){(0,d.default)(this,e),this.fileDirectory=t,this.geoKeyDirectory=n,this.nextIFDByteOffset=r},N=function(e){(0,l.default)(n,e);var t=R(n);function n(e){var r;return(0,d.default)(this,n),(r=t.call(this,"No image at index ".concat(e))).index=e,r}return n}((0,h.default)(Error)),j=function(){function e(){(0,d.default)(this,e)}return(0,s.default)(e,[{key:"readRasters",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t,n,i,a,s,l,c,u,h,d,f,p,m,g,v,y,b,_,x,w,M,S,E,T,C,A,L,R,O,k,I,D,N,j,F,B,z,U,H,G=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=G.length>0&&void 0!==G[0]?G[0]:{},n=t.window,i=t.width,a=t.height,s=t.resX,l=t.resY,c=t.bbox,e.next=5,this.getImage();case 5:return u=e.sent,h=u,e.next=9,this.getImageCount();case 9:if(d=e.sent,f=u.getBoundingBox(),!n||!c){e.next=13;break}throw new Error('Both "bbox" and "window" passed.');case 13:if(!i&&!a){e.next=24;break}if(n&&(p=u.getOrigin(),m=(0,o.default)(p,2),g=m[0],v=m[1],y=u.getResolution(),b=(0,o.default)(y,2),_=b[0],x=b[1],c=[g+n[0]*_,v+n[1]*x,g+n[2]*_,v+n[3]*x]),w=c||f,!i){e.next=20;break}if(!s){e.next=19;break}throw new Error("Both width and resX passed");case 19:s=(w[2]-w[0])/i;case 20:if(!a){e.next=24;break}if(!l){e.next=23;break}throw new Error("Both width and resY passed");case 23:l=(w[3]-w[1])/a;case 24:if(!s&&!l){e.next=48;break}M=[],S=0;case 27:if(!(S<d)){e.next=36;break}return e.next=30,this.getImage(S);case 30:E=e.sent,T=E.fileDirectory,C=T.SubfileType,A=T.NewSubfileType,(0===S||2===C||1&A)&&M.push(E);case 33:++S,e.next=27;break;case 36:M.sort((function(e,t){return e.getWidth()-t.getWidth()})),L=0;case 38:if(!(L<M.length)){e.next=48;break}if(R=M[L],O=(f[2]-f[0])/R.getWidth(),k=(f[3]-f[1])/R.getHeight(),h=R,!(s&&s>O||l&&l>k)){e.next=45;break}return e.abrupt("break",48);case 45:++L,e.next=38;break;case 48:return I=n,c&&(D=u.getOrigin(),N=(0,o.default)(D,2),j=N[0],F=N[1],B=h.getResolution(u),z=(0,o.default)(B,2),U=z[0],H=z[1],I=[Math.round((c[0]-j)/U),Math.round((c[1]-F)/H),Math.round((c[2]-j)/U),Math.round((c[3]-F)/H)],I=[Math.min(I[0],I[2]),Math.min(I[1],I[3]),Math.max(I[0],I[2]),Math.max(I[1],I[3])]),e.abrupt("return",h.readRasters(P(P({},t),{},{window:I})));case 51:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),F=function(e){(0,l.default)(n,e);var t=R(n);function n(e,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(0,d.default)(this,n),(a=t.call(this)).source=e,a.littleEndian=r,a.bigTiff=i,a.firstIFDOffset=o,a.cache=s.cache||!1,a.ifdRequests=[],a.ghostValues=null,a}return(0,s.default)(n,[{key:"getSlice",value:function(){var e=(0,a.default)(r.default.mark((function e(t,n){var i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.bigTiff?4048:1024,e.t0=m.default,e.next=4,this.source.fetch([{offset:t,length:void 0!==n?n:i}]);case 4:return e.t1=e.sent[0],e.t2=t,e.t3=this.littleEndian,e.t4=this.bigTiff,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parseFileDirectoryAt",value:function(){var e=(0,a.default)(r.default.mark((function e(t){var n,i,o,a,s,l,c,u,h,d,f,p,m,g,v,y,b,_,w,M;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.bigTiff?20:12,i=this.bigTiff?8:2,e.next=4,this.getSlice(t);case 4:if(o=e.sent,a=this.bigTiff?o.readUint64(t):o.readUint16(t),s=a*n+(this.bigTiff?16:6),o.covers(t,s)){e.next=11;break}return e.next=10,this.getSlice(t,s);case 10:o=e.sent;case 11:l={},c=t+(this.bigTiff?8:2),u=0;case 14:if(!(u<a)){e.next=41;break}if(h=o.readUint16(c),d=o.readUint16(c+2),f=this.bigTiff?o.readUint64(c+4):o.readUint32(c+4),p=void 0,m=void 0,g=O(d),v=c+(this.bigTiff?12:8),!(g*f<=(this.bigTiff?8:4))){e.next=26;break}p=I(o,d,f,v),e.next=36;break;case 26:if(y=o.readOffset(v),b=O(d)*f,!o.covers(y,b)){e.next=32;break}p=I(o,d,f,y),e.next=36;break;case 32:return e.next=34,this.getSlice(y,b);case 34:_=e.sent,p=I(_,d,f,y);case 36:m=1===f&&-1===x.arrayFields.indexOf(h)&&d!==x.fieldTypes.RATIONAL&&d!==x.fieldTypes.SRATIONAL?p[0]:p,l[x.fieldTagNames[h]]=m;case 38:c+=n,++u,e.next=14;break;case 41:return w=k(l),M=o.readOffset(t+i+n*a),e.abrupt("return",new D(l,w,M));case 44:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestIFD",value:function(){var e=(0,a.default)(r.default.mark((function e(t){var n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ifdRequests[t]){e.next=4;break}return e.abrupt("return",this.ifdRequests[t]);case 4:if(0!==t){e.next=9;break}return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),e.abrupt("return",this.ifdRequests[t]);case 9:if(this.ifdRequests[t-1]){e.next=19;break}e.prev=10,this.ifdRequests[t-1]=this.requestIFD(t-1),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(10),!(e.t0 instanceof N)){e.next=18;break}throw new N(t);case 18:throw e.t0;case 19:return this.ifdRequests[t]=(0,a.default)(r.default.mark((function e(){var i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ifdRequests[t-1];case 2:if(0!==(i=e.sent).nextIFDByteOffset){e.next=5;break}throw new N(t);case 5:return e.abrupt("return",n.parseFileDirectoryAt(i.nextIFDByteOffset));case 6:case"end":return e.stop()}}),e)})))(),e.abrupt("return",this.ifdRequests[t]);case 21:case"end":return e.stop()}}),e,this,[[10,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getImage",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t,n,i=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:0,e.next=3,this.requestIFD(t);case 3:return n=e.sent,e.abrupt("return",new f.default(n.fileDirectory,n.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImageCount",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=!0;case 2:if(!n){e.next=18;break}return e.prev=3,e.next=6,this.requestIFD(t);case 6:++t,e.next=16;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof N)){e.next=15;break}n=!1,e.next=16;break;case 15:throw e.t0;case 16:e.next=2;break;case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getGhostValues",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t,n,i,a,s,l,c,u,h=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.bigTiff?16:8,!this.ghostValues){e.next=3;break}return e.abrupt("return",this.ghostValues);case 3:return i=(n="GDAL_STRUCTURAL_METADATA_SIZE=").length+100,e.next=7,this.getSlice(t,i);case 7:if(a=e.sent,n!==I(a,x.fieldTypes.ASCII,n.length,t)){e.next=19;break}if(s=I(a,x.fieldTypes.ASCII,i,t),l=s.split("\n")[0],!((c=Number(l.split("=")[1].split(" ")[0])+l.length)>i)){e.next=16;break}return e.next=15,this.getSlice(t,c);case 15:a=e.sent;case 16:u=I(a,x.fieldTypes.ASCII,c,t),this.ghostValues={},u.split("\n").filter((function(e){return e.length>0})).map((function(e){return e.split("=")})).forEach((function(e){var t=(0,o.default)(e,2),n=t[0],r=t[1];h.ghostValues[n]=r}));case 19:return e.abrupt("return",this.ghostValues);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){return"function"==typeof this.source.close&&this.source.close()}}],[{key:"fromSource",value:function(){var e=(0,a.default)(r.default.mark((function e(t,i,o){var a,s,l,c,u,h,d;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetch([{offset:0,length:1024}],o);case 2:if(a=e.sent[0],s=new p.default(a),18761!==(l=s.getUint16(0,0))){e.next=9;break}c=!0,e.next=14;break;case 9:if(19789!==l){e.next=13;break}c=!1,e.next=14;break;case 13:throw new TypeError("Invalid byte order value.");case 14:if(42!==(u=s.getUint16(2,c))){e.next=19;break}h=!1,e.next=27;break;case 19:if(43!==u){e.next=26;break}if(h=!0,8===s.getUint16(4,c)){e.next=24;break}throw new Error("Unsupported offset byte-size.");case 24:e.next=27;break;case 26:throw new TypeError("Invalid magic number.");case 27:return d=h?s.getUint64(8,c):s.getUint32(4,c),e.abrupt("return",new n(t,c,h,d,i));case 29:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(j);n.GeoTIFF=F;var B=F;n.default=B;var z=function(e){(0,l.default)(n,e);var t=R(n);function n(e,r){var i;return(0,d.default)(this,n),(i=t.call(this)).mainFile=e,i.overviewFiles=r,i.imageFiles=[e].concat(r),i.fileDirectoriesPerFile=null,i.fileDirectoriesPerFileParsing=null,i.imageCount=null,i}return(0,s.default)(n,[{key:"parseFileDirectoriesPerFile",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map((function(e){return e.parseFileDirectoryAt(e.firstIFDOffset)}))),e.next=3,Promise.all(t);case 3:return this.fileDirectoriesPerFile=e.sent,e.abrupt("return",this.fileDirectoriesPerFile);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImage",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t,n,i,o,a,s,l,c=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:0,e.next=3,this.getImageCount();case 3:return e.next=5,this.parseFileDirectoriesPerFile();case 5:n=0,i=0,o=0;case 8:if(!(o<this.imageFiles.length)){e.next=26;break}a=this.imageFiles[o],s=0;case 11:if(!(s<this.imageCounts[o])){e.next=22;break}if(t!==n){e.next=17;break}return e.next=15,a.requestIFD(i);case 15:return l=e.sent,e.abrupt("return",new f.default(l.fileDirectory,l.geoKeyDirectory,a.dataView,a.littleEndian,a.cache,a.source));case 17:n++,i++;case 19:s++,e.next=11;break;case 22:i=0;case 23:o++,e.next=8;break;case 26:throw new RangeError("Invalid image index");case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImageCount",value:function(){var e=(0,a.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.imageCount){e.next=2;break}return e.abrupt("return",this.imageCount);case 2:return t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map((function(e){return e.getImageCount()}))),e.next=5,Promise.all(t);case 5:return this.imageCounts=e.sent,this.imageCount=this.imageCounts.reduce((function(e,t){return e+t}),0),e.abrupt("return",this.imageCount);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(j);function U(){return(U=(0,a.default)(r.default.mark((function e(t){var n,i,o=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},i=o.length>2?o[2]:void 0,e.abrupt("return",F.fromSource((0,v.makeRemoteSource)(t,n),i));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=(0,a.default)(r.default.mark((function e(t,n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F.fromSource((0,y.makeBufferSource)(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){return(G=(0,a.default)(r.default.mark((function e(t,n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F.fromSource((0,_.makeFileSource)(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=(0,a.default)(r.default.mark((function e(t,n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F.fromSource((0,b.makeFileReaderSource)(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=(0,a.default)(r.default.mark((function e(t){var n,i,o,a,s,l=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:[],i=l.length>2&&void 0!==l[2]?l[2]:{},o=l.length>3?l[3]:void 0,e.next=5,F.fromSource((0,v.makeRemoteSource)(t,i),o);case 5:return a=e.sent,e.next=8,Promise.all(n.map((function(e){return F.fromSource((0,v.makeRemoteSource)(e,i))})));case 8:return s=e.sent,e.abrupt("return",new z(a,s));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=(0,a.default)(r.default.mark((function e(t,n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.writeGeotiff)(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.MultiGeoTIFF=z},{"@babel/runtime/regenerator":"PMvg","@babel/runtime/helpers/defineProperty":"IxO8","@babel/runtime/helpers/slicedToArray":"HETk","@babel/runtime/helpers/asyncToGenerator":"agGE","@babel/runtime/helpers/createClass":"P8NW","@babel/runtime/helpers/inherits":"d4H2","@babel/runtime/helpers/possibleConstructorReturn":"pxk2","@babel/runtime/helpers/getPrototypeOf":"UJE0","@babel/runtime/helpers/wrapNativeSuper":"ozpi","@babel/runtime/helpers/classCallCheck":"fcMS","./geotiffimage":"eOWo","./dataview64":"dqpX","./dataslice":"dGLV","./pool":"dHPO","./source/remote":"itmA","./source/arraybuffer":"wM9h","./source/filereader":"GiEG","./source/file":"G7Cz","./globals":"j27V","./geotiffwriter":"BGyE","./rgb":"fpBl","./compression":"FGCZ","./logging":"dy4f"}]},{},["bsJs"])},function(e,t,n){var r=n(8),i=n(0),o=n(1),a=n(10).default,s=o.featureEach,l=(o.coordEach,i.polygon,i.featureCollection);function c(e){var t=r(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:a(e),r.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach((function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:a(e),t.push(e)})):s(e,(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:a(e),t.push(e)})),r.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:a(e),r.prototype.remove.call(this,e,t)},t.clear=function(){return r.prototype.clear.call(this)},t.search=function(e){var t=r.prototype.search.call(this,this.toBBox(e));return l(t)},t.collides=function(e){return r.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=r.prototype.all.call(this);return l(e)},t.toJSON=function(){return r.prototype.toJSON.call(this)},t.fromJSON=function(e){return r.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=a(e);else{if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=a(e)}return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}e.exports=c,e.exports.default=c},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=7},function(e,t,n){"use strict";e.exports=i,e.exports.default=i;var r=n(9);function i(e,t){if(!(this instanceof i))return new i(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function o(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=t;a<n;a++)o=e.children[a],l(i,e.leaf?r(o):o);return i}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,n,i,o){for(var a,s=[t,n];s.length;)(n=s.pop())-(t=s.pop())<=i||(a=t+Math.ceil((n-t)/i/2)*i,r(e,a,t,n,o),s.push(t,a,a,n))}i.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],r=this.toBBox;if(!p(e,t))return n;for(var i,o,a,s,l=[];t;){for(i=0,o=t.children.length;i<o;i++)a=t.children[i],p(e,s=t.leaf?r(a):a)&&(t.leaf?n.push(a):f(e,s)?this._all(a,n):l.push(a));t=l.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!p(e,t))return!1;for(var r,i,o,a,s=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],p(e,a=t.leaf?n(o):o)){if(t.leaf||f(e,a))return!0;s.push(o)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(e,t){if(!e)return this;for(var n,r,i,a,s=this.data,l=this.toBBox(e),c=[],u=[];s||c.length;){if(s||(s=c.pop(),r=c[c.length-1],n=u.pop(),a=!0),s.leaf&&-1!==(i=o(e,s.children,t)))return s.children.splice(i,1),c.push(s),this._condense(c),this;a||s.leaf||!f(s,l)?r?(n++,s=r.children[n],a=!1):s=null:(c.push(s),u.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var i,o=n-t+1,s=this._maxEntries;if(o<=s)return a(i=m(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var l,c,u,h,d=Math.ceil(o/s),f=d*Math.ceil(Math.sqrt(s));for(g(e,t,n,f,this.compareMinX),l=t;l<=n;l+=f)for(g(e,l,u=Math.min(l+f-1,n),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),i.children.push(this._build(e,c,h,r-1));return a(i,this.toBBox),i},_chooseSubtree:function(e,t,n,r){for(var i,o,a,s,l,c,u,d,f,p;r.push(t),!t.leaf&&r.length-1!==n;){for(u=d=1/0,i=0,o=t.children.length;i<o;i++)l=h(a=t.children[i]),f=e,p=a,(c=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-l)<d?(d=c,u=l<u?l:u,s=a):c===d&&l<u&&(u=l,s=a);t=s||t.children[0]}return t},_insert:function(e,t,n){var r=this.toBBox,i=n?e:r(e),o=[],a=this._chooseSubtree(i,this.data,t,o);for(a.children.push(e),l(a,i);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){var r,i,o,a,l,c,u,d,f,p,m,g,v,y;for(c=u=1/0,r=t;r<=n-t;r++)i=s(e,0,r,this.toBBox),o=s(e,r,n,this.toBBox),f=i,p=o,m=void 0,g=void 0,v=void 0,y=void 0,m=Math.max(f.minX,p.minX),g=Math.max(f.minY,p.minY),v=Math.min(f.maxX,p.maxX),y=Math.min(f.maxY,p.maxY),a=Math.max(0,v-m)*Math.max(0,y-g),l=h(i)+h(o),a<c?(c=a,d=r,u=l<u?l:u):a===c&&l<u&&(u=l,d=r);return d},_chooseSplitAxis:function(e,t,n){var r=e.leaf?this.compareMinX:c,i=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},_allDistMargin:function(e,t,n,r){e.children.sort(r);var i,o,a=this.toBBox,c=s(e,0,t,a),u=s(e,n-t,n,a),h=d(c)+d(u);for(i=t;i<n-t;i++)o=e.children[i],l(c,e.leaf?a(o):o),h+=d(c);for(i=n-t-1;i>=t;i--)o=e.children[i],l(u,e.leaf?a(o):o),h+=d(u);return h},_adjustParentBBoxes:function(e,t,n){for(var r=n;r>=0;r--)l(t[r],e)},_condense:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():a(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},function(e,t,n){e.exports=function(){"use strict";function e(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function t(e,t){return e<t?-1:e>t?1:0}return function(n,r,i,o,a){!function t(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=r-i+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1),d=Math.max(i,Math.floor(r-l*u/s+h)),f=Math.min(o,Math.floor(r+(s-l)*u/s+h));t(n,r,d,f,a)}var p=n[r],m=i,g=o;for(e(n,i,r),a(n[o],p)>0&&e(n,i,o);m<g;){for(e(n,m,g),m++,g--;a(n[m],p)<0;)m++;for(;a(n[g],p)>0;)g--}0===a(n[i],p)?e(n,i,g):(g++,e(n,g,o)),g<=r&&(i=g+1),r<=g&&(o=g-1)}}(n,r,i||0,o||n.length-1,a||t)}}()},function(e,t,n){"use strict";n.r(t);var r=n(1);function i(e){var t=[1/0,1/0,-1/0,-1/0];return Object(r.coordEach)(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}i.default=i,t.default=i},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){var r=n(4),i=n(13);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);e.exports=i.locals||{}},function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r)()((function(e){return e[1]}));i.push([e.i,"#_lithosphere_control_navigation_root {\r\n    display: flex;\r\n}\r\n#_lithosphere_control_navigation_root svg {\r\n    width: 24px;\r\n    height: 24px;\r\n}\r\n#_lithosphere_control_navigation_root > div {\r\n    width: 80px;\r\n    margin-right: 6px;\r\n    display: flex;\r\n    flex-flow: column;\r\n}\r\n#_lithosphere_control_navigation_root > div > div:first-child {\r\n    background: black;\r\n    color: white;\r\n    height: 26px;\r\n    line-height: 26px;\r\n    text-transform: uppercase;\r\n    font-size: 12px;\r\n}\r\n#_lithosphere_control_navigation_root > div > div:first-child svg {\r\n    width: 18px;\r\n    height: 18px;\r\n    padding: 4px 0px;\r\n}\r\n\r\n._lithosphere_control_navigation_panel {\r\n    width: 80px;\r\n    max-height: 0px;\r\n    overflow: hidden;\r\n    line-height: 42px;\r\n    background: black;\r\n    color: white;\r\n    display: flex;\r\n    border-top: 1px solid #444;\r\n    opacity: 0;\r\n    pointer-events: none;\r\n    transition: all 0.2s ease-out;\r\n}\r\n\r\n#_lithosphere_control_navigation_root\r\n    > div:hover\r\n    > ._lithosphere_control_navigation_panel,\r\n#_lithosphere_control_navigation_root\r\n    ._lithosphere_control_navigation_panel.active {\r\n    opacity: 1;\r\n    max-height: 100px;\r\n    pointer-events: inherit;\r\n}\r\n._lithosphere_control_navigation_panel div {\r\n    cursor: pointer;\r\n    transition: background 0.2s ease-out;\r\n}\r\n._lithosphere_control_navigation_panel div:hover {\r\n    background: rgba(255, 255, 255, 0.15);\r\n}\r\n\r\n#_lithosphere_control_navigation_spin_root\r\n    ._lithosphere_control_navigation_panel {\r\n    height: 30px;\r\n}\r\n#_lithosphere_control_navigation_dolly_root\r\n    ._lithosphere_control_navigation_panel {\r\n    height: 30px;\r\n}\r\n#_lithosphere_control_navigation_pan_root\r\n    ._lithosphere_control_navigation_panel {\r\n    line-height: 30px;\r\n    height: 90px;\r\n    flex-flow: column;\r\n}\r\n#_lithosphere_control_navigation_zoom_root\r\n    ._lithosphere_control_navigation_panel {\r\n    height: 30px;\r\n}\r\n\r\n#_lithosphere_control_navigation_spin_left,\r\n#_lithosphere_control_navigation_spin_right,\r\n#_lithosphere_control_navigation_dolly_up,\r\n#_lithosphere_control_navigation_dolly_down,\r\n#_lithosphere_control_navigation_zoom_in,\r\n#_lithosphere_control_navigation_zoom_out {\r\n    width: 50%;\r\n    text-align: center;\r\n}\r\n\r\n#_lithosphere_control_navigation_pan_up {\r\n    height: 30px;\r\n    line-height: 49px;\r\n    text-align: center;\r\n}\r\n#_lithosphere_control_navigation_pan_left,\r\n#_lithosphere_control_navigation_pan_right {\r\n    height: 30px;\r\n    line-height: 44px;\r\n    width: 50%;\r\n    text-align: center;\r\n}\r\n#_lithosphere_control_navigation_pan_down {\r\n    height: 30px;\r\n    line-height: 38px;\r\n    text-align: center;\r\n}\r\n",""]),t.default=i},function(e,t,n){var r=n(4),i=n(15);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);e.exports=i.locals||{}},function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r)()((function(e){return e[1]}));i.push([e.i,"._lithosphere_loadingscreen_loading {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    perspective: 160px;\r\n    top: 0;\r\n    left: 0;\r\n}\r\n\r\n._lithosphere_loadingscreen_loading > div {\r\n    width: 60px;\r\n    height: 60px;\r\n    background: rgba(255, 255, 255, 0);\r\n    position: absolute;\r\n    left: 50%;\r\n    margin-left: -30px;\r\n    top: 50%;\r\n    margin-top: -5px;\r\n    border-radius: 2px;\r\n    border: 2px solid rgba(255, 255, 255, 0.7);\r\n}\r\n\r\n@-webkit-keyframes translateIn {\r\n    30% {\r\n        transform: rotateX(60deg) rotateY(0deg) rotateZ(45deg) translateZ(20px)\r\n            scale(1);\r\n        opacity: 0.7;\r\n        background: rgba(255, 255, 255, 0.3);\r\n    }\r\n    100% {\r\n        transform: rotateX(65deg) rotateY(0deg) rotateZ(45deg) translateZ(0px)\r\n            scale(0.85);\r\n        opacity: 0;\r\n        background: rgba(255, 255, 255, 0);\r\n    }\r\n}\r\n\r\n@keyframes translateIn {\r\n    30% {\r\n        transform: rotateX(60deg) rotateY(0deg) rotateZ(45deg) translateZ(20px)\r\n            scale(1);\r\n        opacity: 0.7;\r\n        background: rgba(255, 255, 255, 0.3);\r\n    }\r\n    100% {\r\n        transform: rotateX(65deg) rotateY(0deg) rotateZ(45deg) translateZ(0px)\r\n            scale(0.85);\r\n        opacity: 0;\r\n        background: rgba(255, 255, 255, 0);\r\n    }\r\n}\r\n\r\n._lithosphere_loadingscreen_loading > div {\r\n    opacity: 0;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(1) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(30px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 500ms;\r\n            animation: translateIn 1.9s ease-in infinite 500ms;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(2) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(60px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 700ms;\r\n            animation: translateIn 1.9s ease-in infinite 700ms;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(3) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(85px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 800ms;\r\n            animation: translateIn 1.9s ease-in infinite 800ms;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(4) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(105px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 1000ms;\r\n            animation: translateIn 1.9s ease-in infinite 1000ms;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(5) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(120px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 1200ms;\r\n            animation: translateIn 1.9s ease-in infinite 1200ms;\r\n}\r\n._lithosphere_loadingscreen_loading > div:nth-of-type(6) {\r\n    transform: rotateX(70deg) rotateY(0deg) rotateZ(45deg) translateZ(130px);\r\n    -webkit-animation: translateIn 1.9s ease-in infinite 1400ms;\r\n            animation: translateIn 1.9s ease-in infinite 1400ms;\r\n}\r\n",""]),t.default=i},function(e,t,n){"use strict";n.r(t);const r=0,i=1,o=2;function a(){}Object.assign(a.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}});const s=[];for(let e=0;e<256;e++)s[e]=(e<16?"0":"")+e.toString(16);let l=1234567;const c={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(s[255&e]+s[e>>8&255]+s[e>>16&255]+s[e>>24&255]+"-"+s[255&t]+s[t>>8&255]+"-"+s[t>>16&15|64]+s[t>>24&255]+"-"+s[63&n|128]+s[n>>8&255]+"-"+s[n>>16&255]+s[n>>24&255]+s[255&r]+s[r>>8&255]+s[r>>16&255]+s[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},damp:function(e,t,n,r){return c.lerp(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(c.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(l=e%2147483647),l=16807*l%2147483647,(l-1)/2147483646},degToRad:function(e){return e*c.DEG2RAD},radToDeg:function(e){return e*c.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((t+r)/2),u=a((t+r)/2),h=o((t-r)/2),d=a((t-r)/2),f=o((r-t)/2),p=a((r-t)/2);switch(i){case"XYX":e.set(s*u,l*h,l*d,s*c);break;case"YZY":e.set(l*d,s*u,l*h,s*c);break;case"ZXZ":e.set(l*h,l*d,s*u,s*c);break;case"XZX":e.set(s*u,l*p,l*f,s*c);break;case"YXY":e.set(l*f,s*u,l*p,s*c);break;case"ZYZ":e.set(l*p,l*f,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class u{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class h{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],_=r[2],x=r[5],w=r[8];return i[0]=o*p+a*v+s*_,i[3]=o*m+a*y+s*x,i[6]=o*g+a*b+s*w,i[1]=l*p+c*v+u*_,i[4]=l*m+c*y+u*x,i[7]=l*g+c*b+u*w,i[2]=h*p+d*v+f*_,i[5]=h*m+d*y+f*x,i[8]=h*g+d*b+f*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*i*c+n*a*s+r*i*l-r*o*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=c*o-a*l,h=a*s-c*i,d=l*i-o*s,f=t*u+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(a*n-r*o)*p,e[3]=h*p,e[4]=(c*t-r*s)*p,e[5]=(r*i-a*t)*p,e[6]=d*p,e[7]=(n*s-l*t)*p,e[8]=(o*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,a){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*l,r[6]=t*a+n*c,r[1]=-n*i+t*s,r[4]=-n*o+t*l,r[7]=-n*a+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}let d;const f={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===d&&(d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),d.width=e.width,d.height=e.height;const n=d.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=d}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let p=0;function m(e=m.DEFAULT_IMAGE,t=m.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,a=1023,s=1009,l=1,d=3e3){Object.defineProperty(this,"id",{value:p++}),this.uuid=c.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new u(0,0),this.repeat=new u(1,1),this.center=new u(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new h,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.version=0,this.onUpdate=null}function g(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?f.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}m.DEFAULT_IMAGE=void 0,m.DEFAULT_MAPPING=300,m.prototype=Object.assign(Object.create(a.prototype),{constructor:m,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=c.generateUUID()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(g(r[e].image)):t.push(g(r[e]))}else t=g(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(m.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class v{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(a+1)/2,o=(u+1)/2,m=(p+1)/2,g=(s+c)/4,v=(l+d)/4,y=(h+f)/4;return e>o&&e>m?e<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=g/n,i=v/n):o>m?o<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,t),this}let m=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(m)<.001&&(m=1),this.x=(f-h)/m,this.y=(l-d)/m,this.z=(c-s)/m,this.w=Math.acos((a+u+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class y extends a{constructor(e,t,n){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=e,this.height=t,this.scissor=new v(0,0,e,t),this.scissorTest=!1,this.viewport=new v(0,0,e,t),n=n||{},this.texture=new m(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setSize(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class b{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return n.copy(e).slerp(t,r)}static slerpFlat(e,t,n,r,i,o,a){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],f=i[o+2],p=i[o+3];if(u!==p||s!==h||l!==d||c!==f){let e=1-a;const t=s*h+l*d+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,a=Math.sin(a*o)/i}const i=a*n;if(s=s*e+h*i,l=l*e+d*i,c=c*e+f*i,u=u*e+p*i,e===1-a){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const a=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],d=i[o+2],f=i[o+3];return e[t]=a*f+c*u+s*d-l*h,e[t+1]=s*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-s*u,e[t+3]=c*f-a*u-s*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=s(n/2),d=s(r/2),f=s(i/2);switch(o){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(o-r)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(i-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(c.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+r*l-i*s,this._y=r*c+o*s+i*a-n*l,this._z=i*c+o*l+n*s-r*a,this._w=o*c-n*a-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class _{constructor(e=0,t=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(w.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(w.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*n,c=s*n+a*t-i*r,u=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return x.copy(this).projectOnVector(e),this.sub(x)}reflect(e){return this.sub(x.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(c.clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const x=new _,w=new b;class M{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new _(1/0,1/0,1/0),this.max=void 0!==t?t:new _(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],c=e[s+1],u=e[s+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),c=e.getY(s),u=e.getZ(s);l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=T.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new _),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new _),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),C.copy(t.boundingBox),C.applyMatrix4(e.matrixWorld),this.union(C));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new _),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,T),T.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(I),D.subVectors(this.max,I),A.subVectors(e.a,I),L.subVectors(e.b,I),P.subVectors(e.c,I),R.subVectors(L,A),O.subVectors(P,L),k.subVectors(A,P);let t=[0,-R.z,R.y,0,-O.z,O.y,0,-k.z,k.y,R.z,0,-R.x,O.z,0,-O.x,k.z,0,-k.x,-R.y,R.x,0,-O.y,O.x,0,-k.y,k.x,0];return!!S(t,A,L,P,D)&&(t=[1,0,0,0,1,0,0,0,1],!!S(t,A,L,P,D)&&(N.crossVectors(R,O),t=[N.x,N.y,N.z],S(t,A,L,P,D)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new _),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return T.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(T).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(E[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),E[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),E[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),E[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),E[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),E[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),E[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),E[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(E)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function S(e,t,n,r,i){for(let o=0,a=e.length-3;o<=a;o+=3){j.fromArray(e,o);const a=i.x*Math.abs(j.x)+i.y*Math.abs(j.y)+i.z*Math.abs(j.z),s=t.dot(j),l=n.dot(j),c=r.dot(j);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>a)return!1}return!0}const E=[new _,new _,new _,new _,new _,new _,new _,new _],T=new _,C=new M,A=new _,L=new _,P=new _,R=new _,O=new _,k=new _,I=new _,D=new _,N=new _,j=new _,F=new M;class B{constructor(e,t){this.center=void 0!==e?e:new _,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):F.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new _),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new M),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const z=new _,U=new _,H=new _,G=new _,W=new _,V=new _,q=new _;class X{constructor(e,t){this.origin=void 0!==e?e:new _,this.direction=void 0!==t?t:new _(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new _),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,z)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new _),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=z.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(z.copy(this.direction).multiplyScalar(t).add(this.origin),z.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){U.copy(e).add(t).multiplyScalar(.5),H.copy(t).sub(e).normalize(),G.copy(this.origin).sub(U);const i=.5*e.distanceTo(t),o=-this.direction.dot(H),a=G.dot(this.direction),s=-G.dot(H),l=G.lengthSq(),c=Math.abs(1-o*o);let u,h,d,f;if(c>0)if(u=o*s-a,h=o*a-s,f=i*c,u>=0)if(h>=-f)if(h<=f){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=i,u=Math.max(0,-(o*h+a)),d=-u*u+h*(h+2*s)+l;else h=-i,u=Math.max(0,-(o*h+a)),d=-u*u+h*(h+2*s)+l;else h<=-f?(u=Math.max(0,-(-o*i+a)),h=u>0?-i:Math.min(Math.max(-i,-s),i),d=-u*u+h*(h+2*s)+l):h<=f?(u=0,h=Math.min(Math.max(-i,-s),i),d=h*(h+2*s)+l):(u=Math.max(0,-(o*i+a)),h=u>0?i:Math.min(Math.max(-i,-s),i),d=-u*u+h*(h+2*s)+l);else h=o>0?-i:i,u=Math.max(0,-(o*h+a)),d=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(H).multiplyScalar(h).add(U),d}intersectSphere(e,t){z.subVectors(e.center,this.origin);const n=z.dot(this.direction),r=z.dot(z)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,a,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,z)}intersectTriangle(e,t,n,r,i){W.subVectors(t,e),V.subVectors(n,e),q.crossVectors(W,V);let o,a=this.direction.dot(q);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}G.subVectors(this.origin,e);const s=o*this.direction.dot(V.crossVectors(G,V));if(s<0)return null;const l=o*this.direction.dot(W.cross(G));if(l<0)return null;if(s+l>a)return null;const c=-o*G.dot(q);return c<0?null:this.at(c/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class Y{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,l,c,u,h,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Y).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Z.setFromMatrixColumn(e,0).length(),i=1/Z.setFromMatrixColumn(e,1).length(),o=1/Z.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*c,n=o*u,r=a*c,i=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-a*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*a,t[4]=r*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*a,t[4]=-o*u,t[8]=r+n*a,t[1]=n+r*a,t[5]=o*c,t[9]=i-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*c,n=o*u,r=a*c,i=a*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,r=a*s,i=a*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*s,n=o*l,r=a*s,i=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=o*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=a*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(K,e,Q)}lookAt(e,t,n){const r=this.elements;return te.subVectors(e,t),0===te.lengthSq()&&(te.z=1),te.normalize(),$.crossVectors(n,te),0===$.lengthSq()&&(1===Math.abs(n.z)?te.x+=1e-4:te.z+=1e-4,te.normalize(),$.crossVectors(n,te)),$.normalize(),ee.crossVectors(te,$),r[0]=$.x,r[4]=ee.x,r[8]=te.x,r[1]=$.y,r[5]=ee.y,r[9]=te.y,r[2]=$.z,r[6]=ee.z,r[10]=te.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=r[0],w=r[4],M=r[8],S=r[12],E=r[1],T=r[5],C=r[9],A=r[13],L=r[2],P=r[6],R=r[10],O=r[14],k=r[3],I=r[7],D=r[11],N=r[15];return i[0]=o*x+a*E+s*L+l*k,i[4]=o*w+a*T+s*P+l*I,i[8]=o*M+a*C+s*R+l*D,i[12]=o*S+a*A+s*O+l*N,i[1]=c*x+u*E+h*L+d*k,i[5]=c*w+u*T+h*P+d*I,i[9]=c*M+u*C+h*R+d*D,i[13]=c*S+u*A+h*O+d*N,i[2]=f*x+p*E+m*L+g*k,i[6]=f*w+p*T+m*P+g*I,i[10]=f*M+p*C+m*R+g*D,i[14]=f*S+p*A+m*O+g*N,i[3]=v*x+y*E+b*L+_*k,i[7]=v*w+y*T+b*P+_*I,i[11]=v*M+y*C+b*R+_*D,i[15]=v*S+y*A+b*O+_*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*o*h-r*o*d+r*l*c-i*s*c)+e[11]*(+t*l*u-t*a*d-i*o*u+n*o*d+i*a*c-n*l*c)+e[15]*(-r*a*c-t*s*u+t*a*h+r*o*u-n*o*h+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*h*l+p*s*d-a*m*d-u*s*g+a*h*g,y=f*h*l-c*m*l-f*s*d+o*m*d+c*s*g-o*h*g,b=c*p*l-f*u*l+f*a*d-o*p*d-c*a*g+o*u*g,_=f*u*s-c*p*s-f*a*h+o*p*h+c*a*m-o*u*m,x=t*v+n*y+r*b+i*_;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=v*w,e[1]=(p*h*i-u*m*i-p*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(a*m*i-p*s*i+p*r*l-n*m*l-a*r*g+n*s*g)*w,e[3]=(u*s*i-a*h*i-u*r*l+n*h*l+a*r*d-n*s*d)*w,e[4]=y*w,e[5]=(c*m*i-f*h*i+f*r*d-t*m*d-c*r*g+t*h*g)*w,e[6]=(f*s*i-o*m*i-f*r*l+t*m*l+o*r*g-t*s*g)*w,e[7]=(o*h*i-c*s*i+c*r*l-t*h*l-o*r*d+t*s*d)*w,e[8]=b*w,e[9]=(f*u*i-c*p*i-f*n*d+t*p*d+c*n*g-t*u*g)*w,e[10]=(o*p*i-f*a*i+f*n*l-t*p*l-o*n*g+t*a*g)*w,e[11]=(c*a*i-o*u*i-c*n*l+t*u*l+o*n*d-t*a*d)*w,e[12]=_*w,e[13]=(c*p*r-f*u*r+f*n*h-t*p*h-c*n*m+t*u*m)*w,e[14]=(f*a*r-o*p*r-f*n*s+t*p*s+o*n*m-t*a*m)*w,e[15]=(o*u*r-c*a*r+c*n*s-t*u*s-o*n*h+t*a*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,c=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+n,c*s-r*o,0,l*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,c=o+o,u=a+a,h=i*l,d=i*c,f=i*u,p=o*c,m=o*u,g=a*u,v=s*l,y=s*c,b=s*u,_=n.x,x=n.y,w=n.z;return r[0]=(1-(p+g))*_,r[1]=(d+b)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(d-b)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(f+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Z.set(r[0],r[1],r[2]).length();const o=Z.set(r[4],r[5],r[6]).length(),a=Z.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],J.copy(this);const s=1/i,l=1/o,c=1/a;return J.elements[0]*=s,J.elements[1]*=s,J.elements[2]*=s,J.elements[4]*=l,J.elements[5]*=l,J.elements[6]*=l,J.elements[8]*=c,J.elements[9]*=c,J.elements[10]*=c,t.setFromRotationMatrix(J),n.x=i,n.y=o,n.z=a,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,i,o){const a=this.elements,s=1/(t-e),l=1/(n-r),c=1/(o-i),u=(t+e)*s,h=(n+r)*l,d=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Z=new _,J=new Y,K=new _(0,0,0),Q=new _(1,1,1),$=new _,ee=new _,te=new _;class ne{constructor(e=0,t=0,n=0,r=ne.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const r=c.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],l=i[1],u=i[5],h=i[9],d=i[2],f=i[6],p=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(s,p));break;case"XZY":this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return re.makeRotationFromQuaternion(e),this.setFromRotationMatrix(re,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return ie.setFromEuler(this),this.setFromQuaternion(ie,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new _(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ne.DefaultOrder="XYZ",ne.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const re=new Y,ie=new b;class oe{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let ae=0;const se=new _,le=new b,ce=new Y,ue=new _,he=new _,de=new _,fe=new b,pe=new _(1,0,0),me=new _(0,1,0),ge=new _(0,0,1),ve={type:"added"},ye={type:"removed"};function be(){Object.defineProperty(this,"id",{value:ae++}),this.uuid=c.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=be.DefaultUp.clone();const e=new _,t=new ne,n=new b,r=new _(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Y},normalMatrix:{value:new h}}),this.matrix=new Y,this.matrixWorld=new Y,this.matrixAutoUpdate=be.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new oe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}be.DefaultUp=new _(0,1,0),be.DefaultMatrixAutoUpdate=!0,be.prototype=Object.assign(Object.create(a.prototype),{constructor:be,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.multiply(le),this},rotateOnWorldAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.premultiply(le),this},rotateX:function(e){return this.rotateOnAxis(pe,e)},rotateY:function(e){return this.rotateOnAxis(me,e)},rotateZ:function(e){return this.rotateOnAxis(ge,e)},translateOnAxis:function(e,t){return se.copy(e).applyQuaternion(this.quaternion),this.position.add(se.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(pe,e)},translateY:function(e){return this.translateOnAxis(me,e)},translateZ:function(e){return this.translateOnAxis(ge,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ce.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?ue.copy(e):ue.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),he.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ce.lookAt(he,ue,this.up):ce.lookAt(ue,he,this.up),this.quaternion.setFromRotationMatrix(ce),r&&(ce.extractRotation(r.matrixWorld),le.setFromRotationMatrix(ce),this.quaternion.premultiply(le.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ve)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ye)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(ye)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),ce.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ce.multiply(e.parent.matrixWorld)),e.applyMatrix4(ce),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new _),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new b),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(he,e,de),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new _),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(he,fe,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new _),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}});const _e=new _,xe=new _,we=new h;class Me{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new _(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=_e.subVectors(n,t).cross(xe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new _),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new _);const n=e.delta(_e),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new _),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||we.getNormalMatrix(e),r=this.coplanarPoint(_e).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const Se=new _,Ee=new _,Te=new _,Ce=new _,Ae=new _,Le=new _,Pe=new _,Re=new _,Oe=new _,ke=new _;class Ie{constructor(e,t,n){this.a=void 0!==e?e:new _,this.b=void 0!==t?t:new _,this.c=void 0!==n?n:new _}static getNormal(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new _),r.subVectors(n,t),Se.subVectors(e,t),r.cross(Se);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Se.subVectors(r,t),Ee.subVectors(n,t),Te.subVectors(e,t);const o=Se.dot(Se),a=Se.dot(Ee),s=Se.dot(Te),l=Ee.dot(Ee),c=Ee.dot(Te),u=o*l-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new _),0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*s-a*c)*h,f=(o*c-a*s)*h;return i.set(1-d-f,f,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ce),Ce.x>=0&&Ce.y>=0&&Ce.x+Ce.y<=1}static getUV(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,Ce),s.set(0,0),s.addScaledVector(i,Ce.x),s.addScaledVector(o,Ce.y),s.addScaledVector(a,Ce.z),s}static isFrontFacing(e,t,n,r){return Se.subVectors(n,t),Ee.subVectors(e,t),Se.cross(Ee).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Se.subVectors(this.c,this.b),Ee.subVectors(this.a,this.b),.5*Se.cross(Ee).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new _),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ie.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Me),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ie.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return Ie.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Ie.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ie.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new _);const n=this.a,r=this.b,i=this.c;let o,a;Ae.subVectors(r,n),Le.subVectors(i,n),Re.subVectors(e,n);const s=Ae.dot(Re),l=Le.dot(Re);if(s<=0&&l<=0)return t.copy(n);Oe.subVectors(e,r);const c=Ae.dot(Oe),u=Le.dot(Oe);if(c>=0&&u<=c)return t.copy(r);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return o=s/(s-c),t.copy(n).addScaledVector(Ae,o);ke.subVectors(e,i);const d=Ae.dot(ke),f=Le.dot(ke);if(f>=0&&d<=f)return t.copy(i);const p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(n).addScaledVector(Le,a);const m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return Pe.subVectors(i,r),a=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(Pe,a);const g=1/(m+p+h);return o=p*g,a=h*g,t.copy(n).addScaledVector(Ae,o).addScaledVector(Le,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const De={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ne={h:0,s:0,l:0},je={h:0,s:0,l:0};function Fe(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Be(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ze(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ue{constructor(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=c.euclideanModulo(e,1),t=c.clamp(t,0,1),n=c.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Fe(i,r,e+1/3),this.g=Fe(i,r,e),this.b=Fe(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=De[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Be(e.r),this.g=Be(e.g),this.b=Be(e.b),this}copyLinearToSRGB(e){return this.r=ze(e.r),this.g=ze(e.g),this.b=ze(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let a,s;const l=(o+i)/2;if(o===i)a=0,s=0;else{const e=i-o;switch(s=l<=.5?e/(i+o):e/(2-i-o),i){case t:a=(n-r)/e+(n<r?6:0);break;case n:a=(r-t)/e+2;break;case r:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Ne),Ne.h+=e,Ne.s+=t,Ne.l+=n,this.setHSL(Ne.h,Ne.s,Ne.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ne),e.getHSL(je);const n=c.lerp(Ne.h,je.h,t),r=c.lerp(Ne.s,je.s,t),i=c.lerp(Ne.l,je.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ue.NAMES=De,Ue.prototype.r=1,Ue.prototype.g=1,Ue.prototype.b=1;class He{constructor(e,t,n,r,i,o=0){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new _,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Ue,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let Ge=0;function We(){Object.defineProperty(this,"id",{value:Ge++}),this.uuid=c.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Ve(e){We.call(this),this.type="MeshBasicMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}We.prototype=Object.assign(Object.create(a.prototype),{constructor:We,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(We.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Ve.prototype=Object.create(We.prototype),Ve.prototype.constructor=Ve,Ve.prototype.isMeshBasicMaterial=!0,Ve.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const qe=new _,Xe=new u;function Ye(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Ze(e,t,n){Ye.call(this,new Int8Array(e),t,n)}function Je(e,t,n){Ye.call(this,new Uint8Array(e),t,n)}function Ke(e,t,n){Ye.call(this,new Uint8ClampedArray(e),t,n)}function Qe(e,t,n){Ye.call(this,new Int16Array(e),t,n)}function $e(e,t,n){Ye.call(this,new Uint16Array(e),t,n)}function et(e,t,n){Ye.call(this,new Int32Array(e),t,n)}function tt(e,t,n){Ye.call(this,new Uint32Array(e),t,n)}function nt(e,t,n){Ye.call(this,new Uint16Array(e),t,n)}function rt(e,t,n){Ye.call(this,new Float32Array(e),t,n)}function it(e,t,n){Ye.call(this,new Float64Array(e),t,n)}function ot(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(Ye.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ye.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Ue),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new u),t[n++]=i.x,t[n++]=i.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new _),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new v),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Xe.fromBufferAttribute(this,t),Xe.applyMatrix3(e),this.setXY(t,Xe.x,Xe.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)qe.fromBufferAttribute(this,t),qe.applyMatrix3(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.applyMatrix4(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.applyNormalMatrix(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.transformDirection(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ze.prototype=Object.create(Ye.prototype),Ze.prototype.constructor=Ze,Je.prototype=Object.create(Ye.prototype),Je.prototype.constructor=Je,Ke.prototype=Object.create(Ye.prototype),Ke.prototype.constructor=Ke,Qe.prototype=Object.create(Ye.prototype),Qe.prototype.constructor=Qe,$e.prototype=Object.create(Ye.prototype),$e.prototype.constructor=$e,et.prototype=Object.create(Ye.prototype),et.prototype.constructor=et,tt.prototype=Object.create(Ye.prototype),tt.prototype.constructor=tt,nt.prototype=Object.create(Ye.prototype),nt.prototype.constructor=nt,nt.prototype.isFloat16BufferAttribute=!0,rt.prototype=Object.create(Ye.prototype),rt.prototype.constructor=rt,it.prototype=Object.create(Ye.prototype),it.prototype.constructor=it;const at={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function st(e,t){return new at[e](t)}let lt=0;const ct=new Y,ut=new be,ht=new _,dt=new M,ft=new M,pt=new _;function mt(){Object.defineProperty(this,"id",{value:lt++}),this.uuid=c.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}mt.prototype=Object.assign(Object.create(a.prototype),{constructor:mt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(ot(e)>65535?tt:$e)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new h).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return ct.makeRotationX(e),this.applyMatrix4(ct),this},rotateY:function(e){return ct.makeRotationY(e),this.applyMatrix4(ct),this},rotateZ:function(e){return ct.makeRotationZ(e),this.applyMatrix4(ct),this},translate:function(e,t,n){return ct.makeTranslation(e,t,n),this.applyMatrix4(ct),this},scale:function(e,t,n){return ct.makeScale(e,t,n),this.applyMatrix4(ct),this},lookAt:function(e){return ut.lookAt(e),ut.updateMatrix(),this.applyMatrix4(ut.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ht).negate(),this.translate(ht.x,ht.y,ht.z),this},setFromPoints:function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new rt(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new M);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new _(-1/0,-1/0,-1/0),new _(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];dt.setFromBufferAttribute(n),this.morphTargetsRelative?(pt.addVectors(this.boundingBox.min,dt.min),this.boundingBox.expandByPoint(pt),pt.addVectors(this.boundingBox.max,dt.max),this.boundingBox.expandByPoint(pt)):(this.boundingBox.expandByPoint(dt.min),this.boundingBox.expandByPoint(dt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new B);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new _,1/0);if(e){const n=this.boundingSphere.center;if(dt.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ft.setFromBufferAttribute(n),this.morphTargetsRelative?(pt.addVectors(dt.min,ft.min),dt.expandByPoint(pt),pt.addVectors(dt.max,ft.max),dt.expandByPoint(pt)):(dt.expandByPoint(ft.min),dt.expandByPoint(ft.max))}dt.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)pt.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(pt));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],a=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)pt.fromBufferAttribute(o,t),a&&(ht.fromBufferAttribute(e,t),pt.add(ht)),r=Math.max(r,n.distanceToSquared(pt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,a=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Ye(new Float32Array(4*a),4));const s=t.tangent.array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new _,c[e]=new _;const h=new _,d=new _,f=new _,p=new u,m=new u,g=new u,v=new _,y=new _;function b(e,t,n){h.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(o,2*e),m.fromArray(o,2*t),g.fromArray(o,2*n),d.sub(h),f.sub(h),m.sub(p),g.sub(p);const i=1/(m.x*g.y-g.x*m.y);isFinite(i)&&(v.copy(d).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(i),y.copy(f).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(i),l[e].add(v),l[t].add(v),l[n].add(v),c[e].add(y),c[t].add(y),c[n].add(y))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)b(n[e+0],n[e+1],n[e+2])}const w=new _,M=new _,S=new _,E=new _;function T(e){S.fromArray(i,3*e),E.copy(S);const t=l[e];w.copy(t),w.sub(S.multiplyScalar(S.dot(t))).normalize(),M.crossVectors(E,t);const n=M.dot(c[e])<0?-1:1;s[4*e]=w.x,s[4*e+1]=w.y,s[4*e+2]=w.z,s[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)T(n[e+0]),T(n[e+1]),T(n[e+2])}},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Ye(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new _,i=new _,o=new _,a=new _,s=new _,l=new _,c=new _,u=new _;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,f),o.fromBufferAttribute(t,p),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),a.fromBufferAttribute(n,d),s.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),a.add(c),s.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,i.length-s);for(let e=0,t=s;e<l;e++,t++)i[t]=a[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)pt.fromBufferAttribute(e,t),pt.normalize(),e.setXYZ(t,pt.x,pt.y,pt.z)},toNonIndexed:function(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let a=0,s=0;for(let e=0,i=t.length;e<i;e++){a=t[e]*r;for(let e=0;e<r;e++)o[s++]=n[a++]}return new Ye(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new mt,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),e.data.attributes[t]=i}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),o.push(i)}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e},clone:function(){return(new mt).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const gt=new Y,vt=new X,yt=new B,bt=new _,_t=new _,xt=new _,wt=new _,Mt=new _,St=new _,Et=new _,Tt=new _,Ct=new _,At=new u,Lt=new u,Pt=new u,Rt=new _,Ot=new _;function kt(e=new mt,t=new Ve){be.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function It(e,t,n,r,i,o,a,s,l,c,h,d){bt.fromBufferAttribute(i,c),_t.fromBufferAttribute(i,h),xt.fromBufferAttribute(i,d);const f=e.morphTargetInfluences;if(t.morphTargets&&o&&f){Et.set(0,0,0),Tt.set(0,0,0),Ct.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=f[e],n=o[e];0!==t&&(wt.fromBufferAttribute(n,c),Mt.fromBufferAttribute(n,h),St.fromBufferAttribute(n,d),a?(Et.addScaledVector(wt,t),Tt.addScaledVector(Mt,t),Ct.addScaledVector(St,t)):(Et.addScaledVector(wt.sub(bt),t),Tt.addScaledVector(Mt.sub(_t),t),Ct.addScaledVector(St.sub(xt),t)))}bt.add(Et),_t.add(Tt),xt.add(Ct)}e.isSkinnedMesh&&(e.boneTransform(c,bt),e.boneTransform(h,_t),e.boneTransform(d,xt));const p=function(e,t,n,r,i,o,a,s){let l;if(l=1===t.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==t.side,s),null===l)return null;Ot.copy(s),Ot.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Ot);return c<n.near||c>n.far?null:{distance:c,point:Ot.clone(),object:e}}(e,t,n,r,bt,_t,xt,Rt);if(p){s&&(At.fromBufferAttribute(s,c),Lt.fromBufferAttribute(s,h),Pt.fromBufferAttribute(s,d),p.uv=Ie.getUV(Rt,bt,_t,xt,At,Lt,Pt,new u)),l&&(At.fromBufferAttribute(l,c),Lt.fromBufferAttribute(l,h),Pt.fromBufferAttribute(l,d),p.uv2=Ie.getUV(Rt,bt,_t,xt,At,Lt,Pt,new u));const e=new He(c,h,d);Ie.getNormal(bt,_t,xt,e.normal),p.face=e}return p}kt.prototype=Object.assign(Object.create(be.prototype),{constructor:kt,isMesh:!0,copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),yt.copy(n.boundingSphere),yt.applyMatrix4(i),!1===e.ray.intersectsSphere(yt))return;if(gt.copy(i).invert(),vt.copy(e.ray).applyMatrix4(gt),null!==n.boundingBox&&!1===vt.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,f=h.length;n<f;n++){const f=h[n],p=r[f.materialIndex];for(let n=Math.max(f.start,d.start),r=Math.min(f.start+f.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=It(this,p,e,vt,a,s,l,c,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=f.materialIndex,t.push(o))}}else{for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),f=i.getX(n+2);o=It(this,r,e,vt,a,s,l,c,u,h,d,f),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],f=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3){o=It(this,f,e,vt,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}}else{for(let n=Math.max(0,d.start),i=Math.min(a.count,d.start+d.count);n<i;n+=3){o=It(this,r,e,vt,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class Dt extends mt{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const a=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const s=[],l=[],c=[],u=[];let h=0,d=0;function f(e,t,n,r,i,o,f,p,m,g,v){const y=o/m,b=f/g,x=o/2,w=f/2,M=p/2,S=m+1,E=g+1;let T=0,C=0;const A=new _;for(let o=0;o<E;o++){const a=o*b-w;for(let s=0;s<S;s++){const h=s*y-x;A[e]=h*r,A[t]=a*i,A[n]=M,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=p>0?1:-1,c.push(A.x,A.y,A.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,r=h+t+S*(e+1),i=h+(t+1)+S*(e+1),o=h+(t+1)+S*e;s.push(n,r,o),s.push(r,i,o),C+=6}a.addGroup(d,C,v),d+=C,h+=T}f("z","y","x",-1,-1,n,t,e,o,i,0),f("z","y","x",1,-1,n,t,-e,o,i,1),f("x","z","y",1,1,e,n,t,r,o,2),f("x","z","y",1,-1,e,n,-t,r,o,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new rt(l,3)),this.setAttribute("normal",new rt(c,3)),this.setAttribute("uv",new rt(u,2))}}function Nt(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function jt(e){const t={};for(let n=0;n<e.length;n++){const r=Nt(e[n]);for(const e in r)t[e]=r[e]}return t}const Ft={clone:Nt,merge:jt};function Bt(e){We.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function zt(){be.call(this),this.type="Camera",this.matrixWorldInverse=new Y,this.projectionMatrix=new Y,this.projectionMatrixInverse=new Y}function Ut(e=50,t=1,n=.1,r=2e3){zt.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Bt.prototype=Object.create(We.prototype),Bt.prototype.constructor=Bt,Bt.prototype.isShaderMaterial=!0,Bt.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Nt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},Bt.prototype.toJSON=function(e){const t=We.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},zt.prototype=Object.assign(Object.create(be.prototype),{constructor:zt,isCamera:!0,copy:function(e,t){return be.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new _),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){be.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){be.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),Ut.prototype=Object.assign(Object.create(zt.prototype),{constructor:Ut,isPerspectiveCamera:!0,copy:function(e,t){return zt.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*c.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*c.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*c.RAD2DEG*Math.atan(Math.tan(.5*c.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*c.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/a,r*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=be.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function Ht(e,t,n){if(be.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new Ut(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new _(1,0,0)),this.add(r);const i=new Ut(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new _(-1,0,0)),this.add(i);const o=new Ut(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new _(0,1,0)),this.add(o);const a=new Ut(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new _(0,-1,0)),this.add(a);const s=new Ut(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new _(0,0,1)),this.add(s);const l=new Ut(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new _(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}function Gt(e,t,n,r,i,o,a,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:301,a=void 0!==a?a:1022,m.call(this,e,t,n,r,i,o,a,s,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}Ht.prototype=Object.create(be.prototype),Ht.prototype.constructor=Ht,Gt.prototype=Object.create(m.prototype),Gt.prototype.constructor=Gt,Gt.prototype.isCubeTexture=!0,Object.defineProperty(Gt.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});class Wt extends y{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),t=t||{},this.texture=new Gt(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Dt(5,5,5),i=new Bt({name:"CubemapFromEquirect",uniforms:Nt(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const o=new kt(r,i),a=t.minFilter;1008===t.minFilter&&(t.minFilter=1006);return new Ht(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}function Vt(e,t,n,r,i,o,a,s,l,c,u,h){m.call(this,null,o,a,s,l,c,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==c?c:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Vt.prototype=Object.create(m.prototype),Vt.prototype.constructor=Vt,Vt.prototype.isDataTexture=!0;const qt=new B,Xt=new _;class Yt{constructor(e,t,n,r,i,o){this.planes=[void 0!==e?e:new Me,void 0!==t?t:new Me,void 0!==n?n:new Me,void 0!==r?r:new Me,void 0!==i?i:new Me,void 0!==o?o:new Me]}set(e,t,n,r,i,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-r,u-s,p-h,y-m).normalize(),t[1].setComponents(a+r,u+s,p+h,y+m).normalize(),t[2].setComponents(a+i,u+l,p+d,y+g).normalize(),t[3].setComponents(a-i,u-l,p-d,y-g).normalize(),t[4].setComponents(a-o,u-c,p-f,y-v).normalize(),t[5].setComponents(a+o,u+c,p+f,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),qt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(qt)}intersectsSprite(e){return qt.center.set(0,0,0),qt.radius=.7071067811865476,qt.applyMatrix4(e.matrixWorld),this.intersectsSphere(qt)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Xt.x=r.normal.x>0?e.max.x:e.min.x,Xt.y=r.normal.y>0?e.max.y:e.min.y,Xt.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Xt)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}function Zt(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Jt(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,i,o),t.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){const o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class Kt extends mt{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,a=Math.floor(n),s=Math.floor(r),l=a+1,c=s+1,u=e/a,h=t/s,d=[],f=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const r=n*u-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),o=t+1+l*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new rt(f,3)),this.setAttribute("normal",new rt(p,3)),this.setAttribute("uv",new rt(m,2))}}const Qt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},$t={common:{diffuse:{value:new Ue(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new h},uv2Transform:{value:new h},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new u(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ue(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ue(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new h}},sprite:{diffuse:{value:new Ue(15658734)},opacity:{value:1},center:{value:new u(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new h}}},en={basic:{uniforms:jt([$t.common,$t.specularmap,$t.envmap,$t.aomap,$t.lightmap,$t.fog]),vertexShader:Qt.meshbasic_vert,fragmentShader:Qt.meshbasic_frag},lambert:{uniforms:jt([$t.common,$t.specularmap,$t.envmap,$t.aomap,$t.lightmap,$t.emissivemap,$t.fog,$t.lights,{emissive:{value:new Ue(0)}}]),vertexShader:Qt.meshlambert_vert,fragmentShader:Qt.meshlambert_frag},phong:{uniforms:jt([$t.common,$t.specularmap,$t.envmap,$t.aomap,$t.lightmap,$t.emissivemap,$t.bumpmap,$t.normalmap,$t.displacementmap,$t.fog,$t.lights,{emissive:{value:new Ue(0)},specular:{value:new Ue(1118481)},shininess:{value:30}}]),vertexShader:Qt.meshphong_vert,fragmentShader:Qt.meshphong_frag},standard:{uniforms:jt([$t.common,$t.envmap,$t.aomap,$t.lightmap,$t.emissivemap,$t.bumpmap,$t.normalmap,$t.displacementmap,$t.roughnessmap,$t.metalnessmap,$t.fog,$t.lights,{emissive:{value:new Ue(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},toon:{uniforms:jt([$t.common,$t.aomap,$t.lightmap,$t.emissivemap,$t.bumpmap,$t.normalmap,$t.displacementmap,$t.gradientmap,$t.fog,$t.lights,{emissive:{value:new Ue(0)}}]),vertexShader:Qt.meshtoon_vert,fragmentShader:Qt.meshtoon_frag},matcap:{uniforms:jt([$t.common,$t.bumpmap,$t.normalmap,$t.displacementmap,$t.fog,{matcap:{value:null}}]),vertexShader:Qt.meshmatcap_vert,fragmentShader:Qt.meshmatcap_frag},points:{uniforms:jt([$t.points,$t.fog]),vertexShader:Qt.points_vert,fragmentShader:Qt.points_frag},dashed:{uniforms:jt([$t.common,$t.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qt.linedashed_vert,fragmentShader:Qt.linedashed_frag},depth:{uniforms:jt([$t.common,$t.displacementmap]),vertexShader:Qt.depth_vert,fragmentShader:Qt.depth_frag},normal:{uniforms:jt([$t.common,$t.bumpmap,$t.normalmap,$t.displacementmap,{opacity:{value:1}}]),vertexShader:Qt.normal_vert,fragmentShader:Qt.normal_frag},sprite:{uniforms:jt([$t.sprite,$t.fog]),vertexShader:Qt.sprite_vert,fragmentShader:Qt.sprite_frag},background:{uniforms:{uvTransform:{value:new h},t2D:{value:null}},vertexShader:Qt.background_vert,fragmentShader:Qt.background_frag},cube:{uniforms:jt([$t.envmap,{opacity:{value:1}}]),vertexShader:Qt.cube_vert,fragmentShader:Qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qt.equirect_vert,fragmentShader:Qt.equirect_frag},distanceRGBA:{uniforms:jt([$t.common,$t.displacementmap,{referencePosition:{value:new _},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qt.distanceRGBA_vert,fragmentShader:Qt.distanceRGBA_frag},shadow:{uniforms:jt([$t.lights,$t.fog,{color:{value:new Ue(0)},opacity:{value:1}}]),vertexShader:Qt.shadow_vert,fragmentShader:Qt.shadow_frag}};function tn(e,t,n,r,i){const o=new Ue(0);let a,s,l=0,c=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,d(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(o,l)},render:function(n,i,f,p){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,l):m&&m.isColor&&(d(m,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||306===m.mapping)?(void 0===s&&(s=new kt(new Dt(1,1,1),new Bt({name:"BackgroundCubeMaterial",uniforms:Nt(en.cube.uniforms),vertexShader:en.cube.vertexShader,fragmentShader:en.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),m.isWebGLCubeRenderTarget&&(m=m.texture),s.material.uniforms.envMap.value=m,s.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,c===m&&u===m.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=m,u=m.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):m&&m.isTexture&&(void 0===a&&(a=new kt(new Kt(2,2),new Bt({name:"BackgroundMaterial",uniforms:Nt(en.background.uniforms),vertexShader:en.background.vertexShader,fragmentShader:en.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&u===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=m,u=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function nn(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=d(null);let c=l;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function p(e){m(e,0)}function m(n,i){const o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;if(o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i}}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,o,a,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,a,s):e.vertexAttribIPointer(t,n,i,a,s)}function y(){b(),c!==l&&(c=l,u(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,b){let _=!1;if(a){const t=function(t,n,i){const a=!0===i.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[a];void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[a]=u);return u}(y,h,l);c!==t&&(c=t,u(c.object)),_=function(e,t){const n=c.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return c.attributesNum!==i||c.index!==t}(y,b),_&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}c.attributes=n,c.attributesNum=i,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==b&&n.update(b,34963),_&&(!function(i,o,a,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=s.attributes,c=a.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const r=c[t];if(r>=0){const o=l[t];if(void 0!==o){const t=o.normalized,i=o.itemSize,a=n.get(o);if(void 0===a)continue;const l=a.buffer,c=a.type,u=a.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,a=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)):p(r),e.bindBuffer(34962,l),v(r,i,c,t,a*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)):p(r),e.bindBuffer(34962,l),v(r,i,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const o=t.buffer,a=t.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r+0,4,a,!1,64,0),e.vertexAttribPointer(r+1,4,a,!1,64,16),e.vertexAttribPointer(r+2,4,a,!1,64,32),e.vertexAttribPointer(r+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const o=t.buffer,a=t.type;m(r,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r,3,a,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}g()}(i,l,h,y),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:g}}function rn(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,a,s){if(0===s)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,r,a,s),n.update(a,o,s)}}function on(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function an(e){const t=this;let n=null,r=0,i=!1,o=!1;const a=new Me,s=new h,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==i||null===c){const t=r+4*o,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(i,s),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,a,s){const h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||o&&!f)o?u(null):c();else{const e=o?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=u(h,a,t,s);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function sn(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(303===o||304===o){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const a=e.getRenderList(),s=e.getRenderTarget(),l=new Wt(o.height/2);return l.fromEquirectangularTexture(e,i),t.set(i,l),e.setRenderTarget(s),e.setRenderList(a),i.addEventListener("dispose",r),n(l.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}function ln(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function cn(e,t,n,r){const i={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete i[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const s=new(ot(n)>65535?tt:$e)(n,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function un(e,t,n,r){const i=r.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,a,t*s),n.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,a,r*s,c),n.update(l,o,c)}}function hn(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function dn(e,t){return e[0]-t[0]}function fn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function pn(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,a,s){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(fn);for(let e=0;e<8;e++)e<c&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(dn);const h=a.morphTargets&&o.morphAttributes.position,d=a.morphNormals&&o.morphAttributes.normal;let f=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],a=t[1];i!==Number.MAX_SAFE_INTEGER&&a?(h&&o.getAttribute("morphTarget"+e)!==h[i]&&o.setAttribute("morphTarget"+e,h[i]),d&&o.getAttribute("morphNormal"+e)!==d[i]&&o.setAttribute("morphNormal"+e,d[i]),n[e]=a,f+=a):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const p=o.morphTargetsRelative?1:1-f;s.getUniforms().setValue(e,"morphTargetBaseInfluence",p),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function mn(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=r.render.frame,s=e.geometry,l=t.get(e,s);return i.get(l)!==a&&(t.update(l),i.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}function gn(e=null,t=1,n=1,r=1){m.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function vn(e=null,t=1,n=1,r=1){m.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}en.physical={uniforms:jt([en.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new u(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ue(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},gn.prototype=Object.create(m.prototype),gn.prototype.constructor=gn,gn.prototype.isDataTexture2DArray=!0,vn.prototype=Object.create(m.prototype),vn.prototype.constructor=vn,vn.prototype.isDataTexture3D=!0;const yn=new m,bn=new gn,_n=new vn,xn=new Gt,wn=[],Mn=[],Sn=new Float32Array(16),En=new Float32Array(9),Tn=new Float32Array(4);function Cn(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=wn[i];if(void 0===o&&(o=new Float32Array(i),wn[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function An(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Ln(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Pn(e,t){let n=Mn[t];void 0===n&&(n=new Int32Array(t),Mn[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Rn(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function On(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(An(n,t))return;e.uniform2fv(this.addr,t),Ln(n,t)}}function kn(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(An(n,t))return;e.uniform3fv(this.addr,t),Ln(n,t)}}function In(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(An(n,t))return;e.uniform4fv(this.addr,t),Ln(n,t)}}function Dn(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(An(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ln(n,t)}else{if(An(n,r))return;Tn.set(r),e.uniformMatrix2fv(this.addr,!1,Tn),Ln(n,r)}}function Nn(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(An(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ln(n,t)}else{if(An(n,r))return;En.set(r),e.uniformMatrix3fv(this.addr,!1,En),Ln(n,r)}}function jn(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(An(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ln(n,t)}else{if(An(n,r))return;Sn.set(r),e.uniformMatrix4fv(this.addr,!1,Sn),Ln(n,r)}}function Fn(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||yn,i)}function Bn(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||bn,i)}function zn(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||_n,i)}function Un(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||xn,i)}function Hn(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Gn(e,t){const n=this.cache;An(n,t)||(e.uniform2iv(this.addr,t),Ln(n,t))}function Wn(e,t){const n=this.cache;An(n,t)||(e.uniform3iv(this.addr,t),Ln(n,t))}function Vn(e,t){const n=this.cache;An(n,t)||(e.uniform4iv(this.addr,t),Ln(n,t))}function qn(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Xn(e,t){e.uniform1fv(this.addr,t)}function Yn(e,t){e.uniform1iv(this.addr,t)}function Zn(e,t){e.uniform2iv(this.addr,t)}function Jn(e,t){e.uniform3iv(this.addr,t)}function Kn(e,t){e.uniform4iv(this.addr,t)}function Qn(e,t){const n=Cn(t,this.size,2);e.uniform2fv(this.addr,n)}function $n(e,t){const n=Cn(t,this.size,3);e.uniform3fv(this.addr,n)}function er(e,t){const n=Cn(t,this.size,4);e.uniform4fv(this.addr,n)}function tr(e,t){const n=Cn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function nr(e,t){const n=Cn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function rr(e,t){const n=Cn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ir(e,t,n){const r=t.length,i=Pn(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||yn,i[e])}function or(e,t,n){const r=t.length,i=Pn(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||xn,i[e])}function ar(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Rn;case 35664:return On;case 35665:return kn;case 35666:return In;case 35674:return Dn;case 35675:return Nn;case 35676:return jn;case 5124:case 35670:return Hn;case 35667:case 35671:return Gn;case 35668:case 35672:return Wn;case 35669:case 35673:return Vn;case 5125:return qn;case 35678:case 36198:case 36298:case 36306:case 35682:return Fn;case 35679:case 36299:case 36307:return zn;case 35680:case 36300:case 36308:case 36293:return Un;case 36289:case 36303:case 36311:case 36292:return Bn}}(t.type)}function sr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Xn;case 35664:return Qn;case 35665:return $n;case 35666:return er;case 35674:return tr;case 35675:return nr;case 35676:return rr;case 5124:case 35670:return Yn;case 35667:case 35671:return Zn;case 35668:case 35672:return Jn;case 35669:case 35673:return Kn;case 35678:case 36198:case 36298:case 36306:case 35682:return ir;case 35680:case 36300:case 36308:case 36293:return or}}(t.type)}function lr(e){this.id=e,this.seq=[],this.map={}}sr.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Ln(t,e)},lr.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const cr=/(\w+)(\])?(\[|\.)?/g;function ur(e,t){e.seq.push(t),e.map[t.id]=t}function hr(e,t,n){const r=e.name,i=r.length;for(cr.lastIndex=0;;){const o=cr.exec(r),a=cr.lastIndex;let s=o[1];const l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===i){ur(n,void 0===c?new ar(s,e,t):new sr(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new lr(s),ur(n,e)),n=e}}}function dr(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);hr(n,e.getUniformLocation(t,n.name),this)}}function fr(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}dr.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},dr.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},dr.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,r)}},dr.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let pr=0;function mr(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function gr(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function vr(e,t){const n=mr(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function yr(e,t){const n=mr(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function br(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function _r(e){return""!==e}function xr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function wr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Mr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Sr(e){return e.replace(Mr,Er)}function Er(e,t){const n=Qt[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Sr(n)}const Tr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Cr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ar(e){return e.replace(Cr,Pr).replace(Tr,Lr)}function Lr(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Pr(e,t,n,r)}function Pr(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Rr(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Or(e,t,n,r){const i=e.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=e.gammaFactor>0?e.gammaFactor:1,f=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_r).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[p].filter(_r).join("\n"),g.length>0&&(g+="\n"),v=[f,p].filter(_r).join("\n"),v.length>0&&(v+="\n")):(g=[Rr(n),"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_r).join("\n"),v=[f,Rr(n),"#define SHADER_NAME "+n.shaderName,p,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Qt.tonemapping_pars_fragment:"",0!==n.toneMapping?br("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Qt.encodings_pars_fragment,n.map?vr("mapTexelToLinear",n.mapEncoding):"",n.matcap?vr("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?vr("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?vr("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?vr("lightMapTexelToLinear",n.lightMapEncoding):"",yr("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(_r).join("\n")),a=Sr(a),a=xr(a,n),a=wr(a,n),s=Sr(s),s=xr(s,n),s=wr(s,n),a=Ar(a),s=Ar(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+v+s,_=fr(i,35633,y+g+a),x=fr(i,35632,b);if(i.attachShader(m,_),i.attachShader(m,x),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(m).trim(),t=i.getShaderInfoLog(_).trim(),n=i.getShaderInfoLog(x).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const t=gr(i,_,"vertex"),n=gr(i,x,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let w,M;return i.deleteShader(_),i.deleteShader(x),this.getUniforms=function(){return void 0===w&&(w=new dr(i,m)),w},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}(i,m)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=pr++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=x,this}function kr(e,t,n,r,i,o){const a=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,t}return{getParameters:function(i,a,p,g,v){const y=g.fog,b=i.isMeshStandardMaterial?g.environment:null,_=t.get(i.envMap||b),x=f[i.type],w=v.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=u,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let M,S;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),x){const e=en[x];M=e.vertexShader,S=e.fragmentShader}else M=i.vertexShader,S=i.fragmentShader;const E=e.getRenderTarget();return{isWebGL2:s,shaderID:x,shaderName:i.type,vertexShader:M,fragmentShader:S,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==E?m(E.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:m(_),envMapCubeUV:!!_&&(306===_.mapping||307===_.mapping),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<p.length;e++)n.push(t[p[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=en[t];n=Ft.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Or(e,n,t,i),a.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function Ir(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Dr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Nr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function jr(e){const t=[];let n=0;const r=[],i=[],o={id:-1};function a(r,i,a,s,l,c){let u=t[n];const h=e.get(a);return void 0===u?(u={id:r.id,object:r,geometry:i,material:a,program:h.program||o,groupOrder:s,renderOrder:r.renderOrder,z:l,group:c},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,o,s,l){const c=a(e,t,n,o,s,l);(!0===n.transparent?i:r).push(c)},unshift:function(e,t,n,o,s,l){const c=a(e,t,n,o,s,l);(!0===n.transparent?i:r).unshift(c)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Dr),i.length>1&&i.sort(t||Nr)}}}function Fr(e){let t=new WeakMap;return{get:function(n,r){const i=t.get(n);let o;return void 0===i?(o=new jr(e),t.set(n,new WeakMap),t.get(n).set(r,o)):(o=i.get(r),void 0===o&&(o=new jr(e),i.set(r,o))),o},dispose:function(){t=new WeakMap}}}function Br(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new _,color:new Ue};break;case"SpotLight":n={position:new _,direction:new _,color:new Ue,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new _,color:new Ue,distance:0,decay:0};break;case"HemisphereLight":n={direction:new _,skyColor:new Ue,groundColor:new Ue};break;case"RectAreaLight":n={color:new Ue,position:new _,halfWidth:new _,halfHeight:new _}}return e[t.id]=n,n}}}let zr=0;function Ur(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Hr(e,t){const n=new Br,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new u};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new u,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new _);const o=new _,a=new Y,s=new Y;return{setup:function(o){let a=0,s=0,l=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0;o.sort(Ur);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,b=t.distance,_=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=v.r*y,s+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=_,i.directionalShadowMatrix[c]=t.shadow.matrix,p++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=_,i.spotShadowMatrix[h]=t.shadow.matrix,g++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=_,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[f]=e,f++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=$t.LTC_FLOAT_1,i.rectAreaLTC2=$t.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=$t.LTC_HALF_1,i.rectAreaLTC2=$t.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=s,i.ambient[2]=l;const v=i.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===f&&v.numDirectionalShadows===p&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=c,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=f,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=f,v.numDirectionalShadows=p,v.numPointShadows=m,v.numSpotShadows=g,i.version=zr++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(d.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function Gr(e,t){const n=new Hr(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Wr(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new Gr(e,t),n.set(r,[]),n.get(r).push(o)):i>=n.get(r).length?(o=new Gr(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}function Vr(e){We.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function qr(e){We.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new _,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Vr.prototype=Object.create(We.prototype),Vr.prototype.constructor=Vr,Vr.prototype.isMeshDepthMaterial=!0,Vr.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},qr.prototype=Object.create(We.prototype),qr.prototype.constructor=qr,qr.prototype.isMeshDistanceMaterial=!0,qr.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function Xr(e,t,n){let r=new Yt;const i=new u,o=new u,a=new v,s=[],l=[],c={},h={0:1,1:0,2:2},d=new Bt({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new u},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new mt;p.setAttribute("position",new Ye(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new kt(p,d),g=this;function b(n,r){const i=t.update(m);d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,f,m,null)}function _(e,t,n){const r=e<<0|t<<1|n<<2;let i=s[r];return void 0===i&&(i=new Vr({depthPacking:3201,morphTargets:e,skinning:t}),s[r]=i),i}function x(e,t,n){const r=e<<0|t<<1|n<<2;let i=l[r];return void 0===i&&(i=new qr({morphTargets:e,skinning:t}),l[r]=i),i}function w(t,n,r,i,o,a,s){let l=null,u=_,d=t.customDepthMaterial;if(!0===i.isPointLight&&(u=x,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===r.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));l=u(e,i,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=l.uuid,t=r.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let i=n[t];void 0===i&&(i=l.clone(),n[t]=i),l=i}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===s?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function M(n,i,o,a,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=w(n,r,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,c)}}}else if(i.visible){const t=w(n,r,i,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)M(l[e],i,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,l){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let c=0,u=t.length;c<u;c++){const u=t[c],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const f=h.getFrameExtents();if(i.multiply(f),o.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/f.x),i.x=o.x*f.x,h.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/f.y),i.y=o.y*f.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const e={minFilter:1006,magFilter:1006,format:1023};h.map=new y(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.mapPass=new y(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:1003,magFilter:1003,format:1023};h.map=new y(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const p=h.getViewportCount();for(let e=0;e<p;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(a),h.updateMatrices(u,e),r=h.getFrustum(),M(s,l,h.camera,u,this.type)}h.isPointLightShadow||3!==this.type||b(h,l),h.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(c,u,h)}}function Yr(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new v;let r=null;const i=new v(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?I(2929):D(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){let t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?I(2960):D(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&l===r||(e.stencilOp(t,n,r),a=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null}}};let s={},l=null,c=null,u=null,h=null,d=null,f=null,p=null,m=null,g=null,y=!1,b=null,_=null,x=null,w=null,M=null;const S=e.getParameter(35661);let E=!1,T=0;const C=e.getParameter(7938);-1!==C.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(C)[1]),E=T>=1):-1!==C.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),E=T>=2);let A=null,L={};const P=new v,R=new v;function O(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const k={};function I(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function D(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}k[3553]=O(3553,3553,1),k[34067]=O(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),I(2929),o.setFunc(3),B(!1),z(1),I(2884),F(0);const N={100:32774,101:32778,102:32779};if(r)N[103]=32775,N[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(N[103]=e.MIN_EXT,N[104]=e.MAX_EXT)}const j={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function F(t,n,r,i,o,a,s,l){if(0!==t){if(c||(I(3042),c=!0),5===t)o=o||n,a=a||r,s=s||i,n===h&&o===p||(e.blendEquationSeparate(N[n],N[o]),h=n,p=o),r===d&&i===f&&a===m&&s===g||(e.blendFuncSeparate(j[r],j[i],j[a],j[s]),d=r,f=i,m=a,g=s),u=t,y=null;else if(t!==u||l!==y){if(100===h&&100===p||(e.blendEquation(32774),h=100,p=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}d=null,f=null,m=null,g=null,u=t,y=l}}else c&&(D(3042),c=!1)}function B(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function z(t){0!==t?(I(2884),t!==_&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):D(2884),_=t}function U(t,n,r){t?(I(32823),w===n&&M===r||(e.polygonOffset(n,r),w=n,M=r)):D(32823)}function H(t){void 0===t&&(t=33984+S-1),A!==t&&(e.activeTexture(t),A=t)}return{buffers:{color:i,depth:o,stencil:a},enable:I,disable:D,useProgram:function(t){return l!==t&&(e.useProgram(t),l=t,!0)},setBlending:F,setMaterial:function(e,t){2===e.side?D(2884):I(2884);let n=1===e.side;t&&(n=!n),B(n),1===e.blending&&!1===e.transparent?F(0):F(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);const r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),U(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:B,setCullFace:z,setLineWidth:function(t){t!==x&&(E&&e.lineWidth(t),x=t)},setPolygonOffset:U,setScissorTest:function(e){e?I(3089):D(3089)},activeTexture:H,bindTexture:function(t,n){null===A&&H();let r=L[A];void 0===r&&(r={type:void 0,texture:void 0},L[A]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||k[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=L[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===R.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),R.copy(t))},reset:function(){s={},A=null,L={},l=null,c=null,u=null,h=null,d=null,f=null,p=null,m=null,g=null,y=!1,b=null,_=null,x=null,w=null,M=null,i.reset(),o.reset(),a.reset()}}}function Zr(e,t,n,r,i,o,a){const s=i.isWebGL2,l=i.maxTextures,u=i.maxCubemapSize,h=i.maxTextureSize,d=i.maxSamples,f=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?c.floorPowerOfTwo:Math.floor,o=r(i*e.width),a=r(i*e.height);void 0===p&&(p=g(o,a));const s=n?g(o,a):p;s.width=o,s.height=a;return s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return c.isPowerOfTwo(e.width)&&c.isPowerOfTwo(e.height)}function b(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function _(t,n,i,o){e.generateMipmap(t);r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function w(e){return 1003===e||1004===e||1005===e?9728:9729}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}(n),a.memory.textures--}let E=0;function T(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void O(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function C(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;R(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);const a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,c=[];for(let e=0;e<6;e++)c[e]=a||l?l?r.image[e].image:r.image[e]:v(r.image[e],!1,!0,u);const h=c[0],d=y(h)||s,f=o.convert(r.format),p=o.convert(r.type),m=x(r.internalFormat,f,p);let g;if(P(34067,r,d),a){for(let e=0;e<6;e++){g=c[e].mipmaps;for(let t=0;t<g.length;t++){const i=g[t];1023!==r.format&&1022!==r.format?null!==f?n.compressedTexImage2D(34069+e,t,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,i.width,i.height,0,f,p,i.data)}}t.__maxMipLevel=g.length-1}else{g=r.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,c[e].width,c[e].height,0,f,p,c[e].data);for(let t=0;t<g.length;t++){const r=g[t].image[e].image;n.texImage2D(34069+e,t+1,m,r.width,r.height,0,f,p,r.data)}}else{n.texImage2D(34069+e,0,m,f,p,c[e]);for(let t=0;t<g.length;t++){const r=g[t];n.texImage2D(34069+e,t+1,m,f,p,r.image[e])}}t.__maxMipLevel=g.length}b(r,d)&&_(34067,r,h.width,h.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(a,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture))}const A={1e3:10497,1001:33071,1002:33648},L={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function P(n,o,a){a?(e.texParameteri(n,10242,A[o.wrapS]),e.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[o.wrapR]),e.texParameteri(n,10240,L[o.magFilter]),e.texParameteri(n,10241,L[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(o.magFilter)),e.texParameteri(n,10241,w(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=t.get("EXT_texture_filter_anisotropic");if(l){if(1015===o.type&&null===t.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(s||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function R(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",M),t.__webglTexture=e.createTexture(),a.memory.textures++)}function O(t,r,i){let a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),R(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);const l=function(e){return!s&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(r)&&!1===y(r.image),c=v(r.image,l,!1,h),u=y(c)||s,d=o.convert(r.format);let f,p=o.convert(r.type),m=x(r.internalFormat,d,p);P(a,r,u);const g=r.mipmaps;if(r.isDepthTexture)m=6402,s?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,p=o.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,p=o.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,p,null);else if(r.isDataTexture)if(g.length>0&&u){for(let e=0,t=g.length;e<t;e++)f=g[e],n.texImage2D(3553,e,m,f.width,f.height,0,d,p,f.data);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=g.length;e<t;e++)f=g[e],1023!==r.format&&1022!==r.format?null!==d?n.compressedTexImage2D(3553,e,m,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,f.width,f.height,0,d,p,f.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(g.length>0&&u){for(let e=0,t=g.length;e<t;e++)f=g[e],n.texImage2D(3553,e,m,d,p,f);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,p,c),t.__maxMipLevel=0;b(r,u)&&_(a,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function k(t,i,a,s){const l=o.convert(i.texture.format),c=o.convert(i.texture.type),u=x(i.texture.internalFormat,l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function I(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(1015===t.type?i=36012:1014===t.type&&(i=33190));const r=N(n);e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=N(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=o.convert(n.texture.format),i=o.convert(n.texture.type),a=x(n.texture.internalFormat,t,i);if(r){const t=N(n);e.renderbufferStorageMultisample(36161,t,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function D(t){const n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)e.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),I(n.__webglDepthbuffer[r],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),I(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function N(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}let j=!1,F=!1;this.allocateTextureUnit=function(){const e=E;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?O(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?O(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=C,this.setupRenderTarget=function(t){const i=r.get(t),l=r.get(t.texture);t.addEventListener("dispose",S),l.__webglTexture=e.createTexture(),a.memory.textures++;const c=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=y(t)||s;if(!s||1022!==t.texture.format||1015!==t.texture.type&&1016!==t.texture.type||(t.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){i.__webglFramebuffer=[];for(let t=0;t<6;t++)i.__webglFramebuffer[t]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(s){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=o.convert(t.texture.format),r=o.convert(t.texture.type),a=x(t.texture.internalFormat,n,r),s=N(t);e.renderbufferStorageMultisample(36161,s,a,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),I(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),P(34067,t.texture,h);for(let e=0;e<6;e++)k(i.__webglFramebuffer[e],t,36064,34069+e);b(t.texture,h)&&_(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),P(3553,t.texture,h),k(i.__webglFramebuffer,t,36064,3553),b(t.texture,h)&&_(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(b(t,y(e)||s)){const i=e.isWebGLCubeRenderTarget?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),_(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(s){const n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);const i=t.width,o=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===j&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),j=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),C(e,t)}}function Jr(e,t,n){const r=n.isWebGL2;return{convert:function(e){let n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return r?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):36492===e?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):1020===e?r?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Kr(e=[]){Ut.call(this),this.cameras=e}function Qr(){be.call(this),this.type="Group"}function $r(){this._targetRay=null,this._grip=null,this._hand=null}function ei(e,t){const n=this;let r=null,i=1,o=null,a="local-floor",s=null;const l=[],c=new Map,u=new Ut;u.layers.enable(1),u.viewport=new v;const h=new Ut;h.layers.enable(2),h.viewport=new v;const d=[u,h],f=new Kr;f.layers.enable(1),f.layers.enable(2);let p=null,m=null;function g(e){const t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){c.forEach((function(e,t){e.disconnect(t)})),c.clear(),p=null,m=null,e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),E.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(e){const t=r.inputSources;for(let e=0;e<l.length;e++)c.set(t[e],l[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=c.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),c.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=c.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new $r,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new $r,l[e]=t),t.getGripSpace()},this.getHand=function(e){let t=l[e];return void 0===t&&(t=new $r,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",y),r.addEventListener("inputsourceschange",b);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const s={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:i},l=new XRWebGLLayer(r,t,s);r.updateRenderState({baseLayer:l}),o=await r.requestReferenceSpace(a),E.setContext(r),E.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const x=new _,w=new _;function M(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){f.near=h.near=u.near=e.near,f.far=h.far=u.far=e.far,p===f.near&&m===f.far||(r.updateRenderState({depthNear:f.near,depthFar:f.far}),p=f.near,m=f.far);const t=e.parent,n=f.cameras;M(f,t);for(let e=0;e<n.length;e++)M(n[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){x.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(n.matrixWorld);const r=x.distanceTo(w),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=a*u,f=a*h,p=r/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+p,v=s+p,y=d-m,b=f+(r-m),_=l*s/v*g,M=c*s/v*g;e.projectionMatrix.makePerspective(y,b,_,M,g,v)}(f,u,h):f.projectionMatrix.copy(u.projectionMatrix),f};let S=null;const E=new Zt;E.setAnimationLoop((function(t,n){if(s=n.getViewerPose(o),null!==s){const t=s.views,n=r.renderState.baseLayer;e.setFramebuffer(n.framebuffer);let i=!1;t.length!==f.cameras.length&&(f.cameras.length=0,i=!0);for(let e=0;e<t.length;e++){const r=t[e],o=n.getViewport(r),a=d[e];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===e&&f.matrix.copy(a.matrix),!0===i&&f.cameras.push(a)}}const i=r.inputSources;for(let e=0;e<l.length;e++){const t=l[e],r=i[e];t.update(r,n,o)}S&&S(t,n)})),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function ti(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function ni(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default",d=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let f=null,p=null;const m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const g=this;let y=!1,b=null,x=0,w=0,M=null,S=null,E=-1,T=null;const C=new v,A=new v;let L=null,P=t.width,R=t.height,O=1,k=null,I=null;const D=new v(0,0,P,R),N=new v(0,0,P,R);let j=!1;const F=new Yt;let B=!1,z=!1;const U=new Y,H=new _,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===M?O:1}let V,q,X,Z,J,K,Q,$,ee,te,ne,re,ie,oe,ae,se,le,ce,ue,he,de,fe=n;function pe(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:d};if(t.addEventListener("webglcontextlost",ye,!1),t.addEventListener("webglcontextrestored",be,!1),null===fe){const t=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&t.shift(),fe=pe(t,e),null===fe)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===fe.getShaderPrecisionFormat&&(fe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function me(){V=new ln(fe),q=new on(fe,V,e),V.init(q),he=new Jr(fe,V,q),X=new Yr(fe,V,q),X.scissor(A.copy(N).multiplyScalar(O).floor()),X.viewport(C.copy(D).multiplyScalar(O).floor()),Z=new hn(fe),J=new Ir,K=new Zr(fe,V,X,J,q,he,Z),Q=new sn(g),$=new Jt(fe,q),de=new nn(fe,V,$,q),ee=new cn(fe,$,Z,de),te=new mn(fe,ee,$,Z),le=new pn(fe),ae=new an(J),ne=new kr(g,Q,V,q,de,ae),re=new ti(J),ie=new Fr(J),oe=new Wr(V,q),se=new tn(g,Q,X,te,s),ce=new rn(fe,V,Z,q),ue=new un(fe,V,Z,q),Z.programs=ne.programs,g.capabilities=q,g.extensions=V,g.properties=J,g.renderLists=ie,g.state=X,g.info=Z}me();const ge=new ei(g,fe);this.xr=ge;const ve=new Xr(g,te,q.maxTextureSize);function ye(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function be(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1,me()}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){xe(e),J.remove(e)}(t)}function xe(e){const t=J.get(e).program;void 0!==t&&ne.releaseProgram(t)}this.shadowMap=ve,this.getContext=function(){return fe},this.getContextAttributes=function(){return fe.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(P,R,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new u),e.set(P,R)},this.setSize=function(e,n,r){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,R=n,t.width=Math.floor(e*O),t.height=Math.floor(n*O),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new u),e.set(P*O,R*O).floor()},this.setDrawingBufferSize=function(e,n,r){P=e,R=n,O=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new v),e.copy(C)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,n,r){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,r),X.viewport(C.copy(D).multiplyScalar(O).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),X.scissor(A.copy(N).multiplyScalar(O).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(e){X.setScissorTest(j=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Ue),e.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),fe.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ye,!1),t.removeEventListener("webglcontextrestored",be,!1),ie.dispose(),oe.dispose(),J.dispose(),Q.dispose(),te.dispose(),de.dispose(),ge.dispose(),Me.stop()},this.renderBufferImmediate=function(e,t){de.initAttributes();const n=J.get(e);e.hasPositions&&!n.position&&(n.position=fe.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=fe.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=fe.createBuffer()),e.hasColors&&!n.color&&(n.color=fe.createBuffer());const r=t.getAttributes();e.hasPositions&&(fe.bindBuffer(34962,n.position),fe.bufferData(34962,e.positionArray,35048),de.enableAttribute(r.position),fe.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(fe.bindBuffer(34962,n.normal),fe.bufferData(34962,e.normalArray,35048),de.enableAttribute(r.normal),fe.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(fe.bindBuffer(34962,n.uv),fe.bufferData(34962,e.uvArray,35048),de.enableAttribute(r.uv),fe.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(fe.bindBuffer(34962,n.color),fe.bufferData(34962,e.colorArray,35048),de.enableAttribute(r.color),fe.vertexAttribPointer(r.color,3,5126,!1,0,0)),de.disableUnusedAttributes(),fe.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=G);const a=i.isMesh&&i.matrixWorld.determinant()<0,s=Ae(e,t,r,i);X.setMaterial(r,a);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=ee.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&le.update(i,n,r,s),de.setup(i,r,s,n,l);let d=ce;null!==l&&(u=$.get(l),d=ue,d.setIndex(u));const f=null!==l?l.count:c.count,p=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(p,g),b=Math.min(f,p+m,g+v)-1,_=Math.max(0,b-y+1);if(0!==_){if(i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*W()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*W()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(y,_,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,_,e)}else d.render(y,_)}},this.compile=function(e,t){p=oe.get(e),p.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))})),p.setupLights();const n=new WeakMap;e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];!1===n.has(o)&&(Ce(o,e,t),n.set(o))}else!1===n.has(r)&&(Ce(r,e,t),n.set(r))}))};let we=null;const Me=new Zt;function Se(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||F.intersectsSprite(e)){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=te.update(e),i=e.material;i.visible&&f.push(e,t,i,n,H.z,null)}}else if(e.isImmediateRenderObject)r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),f.push(e,null,e.material,n,H.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Z.render.frame&&(e.skeleton.update(),e.skeleton.frame=Z.render.frame),!e.frustumCulled||F.intersectsObject(e))){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=te.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=i[a.materialIndex];s&&s.visible&&f.push(e,t,s,n,H.z,a)}}else i.visible&&f.push(e,t,i,n,H.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)Se(i[e],t,n,r)}function Ee(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],a=o.object,s=o.geometry,l=null===r?o.material:r,c=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,r=e.length;n<r;n++){const r=e[n];a.layers.test(r.layers)&&(X.viewport(C.copy(r.viewport)),p.setupLightsView(r),Te(a,t,r,s,l,c))}}else Te(a,t,n,s,l,c)}}function Te(e,t,n,r,i,o){if(e.onBeforeRender(g,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Ae(n,t,i,e);X.setMaterial(i),de.reset(),function(e,t){e.render((function(e){g.renderBufferImmediate(e,t)}))}(e,r)}else g.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(g,t,n,r,i,o)}function Ce(e,t,n){!0!==t.isScene&&(t=G);const r=J.get(e),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=ne.getParameters(e,i.state,o,t,n),l=ne.getProgramCacheKey(s);let c=r.program,u=!0;if(r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=Q.get(e.envMap||r.environment),void 0===c)e.addEventListener("dispose",_e);else if(c.cacheKey!==l)xe(e);else if(r.lightsStateVersion!==a)u=!1;else{if(void 0!==s.shaderID)return;u=!1}u&&(s.uniforms=ne.getUniforms(e),e.onBeforeCompile(s,g),c=ne.acquireProgram(s,l),r.program=c,r.uniforms=s.uniforms,r.outputEncoding=s.outputEncoding);const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=ae.numPlanes,r.numIntersection=ae.numIntersection,h.clippingPlanes=ae.uniform),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=r.program.getUniforms(),f=dr.seqWithValue(d.seq,h);r.uniformsList=f}function Ae(e,t,n,r){!0!==t.isScene&&(t=G),K.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===M?g.outputEncoding:M.texture.encoding,s=Q.get(n.envMap||o),l=J.get(n),u=p.state.lights;if(!0===B&&(!0===z||e!==T)){const t=e===T&&n.id===E;ae.setState(n,e,t)}n.version===l.__version?n.fog&&l.fog!==i||l.environment!==o||l.needsLights&&l.lightsStateVersion!==u.state.version?Ce(n,t,r):void 0===l.numClippingPlanes||l.numClippingPlanes===ae.numPlanes&&l.numIntersection===ae.numIntersection?(l.outputEncoding!==a||l.envMap!==s)&&Ce(n,t,r):Ce(n,t,r):(Ce(n,t,r),l.__version=n.version);let h=!1,d=!1,f=!1;const m=l.program,v=m.getUniforms(),y=l.uniforms;if(X.useProgram(m.program)&&(h=!0,d=!0,f=!0),n.id!==E&&(E=n.id,d=!0),h||T!==e){if(v.setValue(fe,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&v.setValue(fe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),T!==e&&(T=e,d=!0,f=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=v.map.cameraPosition;void 0!==t&&t.setValue(fe,H.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&v.setValue(fe,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&v.setValue(fe,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){v.setOptional(fe,r,"bindMatrix"),v.setOptional(fe,r,"bindMatrixInverse");const e=r.skeleton;if(e){const t=e.bones;if(q.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=c.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(e.boneMatrices);const i=new Vt(r,n,n,1023,1015);e.boneMatrices=r,e.boneTexture=i,e.boneTextureSize=n}v.setValue(fe,"boneTexture",e.boneTexture,K),v.setValue(fe,"boneTextureSize",e.boneTextureSize)}else v.setOptional(fe,e,"boneMatrices")}}var b,_;return(d||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,v.setValue(fe,"receiveShadow",r.receiveShadow)),d&&(v.setValue(fe,"toneMappingExposure",g.toneMappingExposure),l.needsLights&&(_=f,(b=y).ambientLightColor.needsUpdate=_,b.lightProbe.needsUpdate=_,b.directionalLights.needsUpdate=_,b.directionalLightShadows.needsUpdate=_,b.pointLights.needsUpdate=_,b.pointLightShadows.needsUpdate=_,b.spotLights.needsUpdate=_,b.spotLightShadows.needsUpdate=_,b.rectAreaLights.needsUpdate=_,b.hemisphereLights.needsUpdate=_),i&&n.fog&&re.refreshFogUniforms(y,i),re.refreshMaterialUniforms(y,n,O,R),dr.upload(fe,l.uniformsList,y,K)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(dr.upload(fe,l.uniformsList,y,K),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&v.setValue(fe,"center",r.center),v.setValue(fe,"modelViewMatrix",r.modelViewMatrix),v.setValue(fe,"normalMatrix",r.normalMatrix),v.setValue(fe,"modelMatrix",r.matrixWorld),m}Me.setAnimationLoop((function(e){ge.isPresenting||we&&we(e)})),"undefined"!=typeof window&&Me.setContext(window),this.setAnimationLoop=function(e){we=e,ge.setAnimationLoop(e),null===e?Me.stop():Me.start()},this.render=function(e,t){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;de.resetDefaultState(),E=-1,T=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(t=ge.getCamera(t)),!0===e.isScene&&e.onBeforeRender(g,e,t,n||M),p=oe.get(e,m.length),p.init(),m.push(p),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromProjectionMatrix(U),z=this.localClippingEnabled,B=ae.init(this.clippingPlanes,z,t),f=ie.get(e,t),f.init(),Se(e,t,0,g.sortObjects),f.finish(),!0===g.sortObjects&&f.sort(k,I),!0===B&&ae.beginShadows();const i=p.state.shadowsArray;ve.render(i,e,t),p.setupLights(),p.setupLightsView(t),!0===B&&ae.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),se.render(f,e,t,r);const o=f.opaque,a=f.transparent;o.length>0&&Ee(o,e,t),a.length>0&&Ee(a,e,t),!0===e.isScene&&e.onAfterRender(g,e,t),null!==M&&(K.updateRenderTargetMipmap(M),K.updateMultisampleRenderTarget(M)),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),m.pop(),p=m.length>0?m[m.length-1]:null,f=null},this.setFramebuffer=function(e){b!==e&&null===M&&fe.bindFramebuffer(36160,e),b=e},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderList=function(){return f},this.setRenderList=function(e){f=e},this.getRenderTarget=function(){return M},this.setRenderTarget=function(e,t=0,n=0){M=e,x=t,w=n,e&&void 0===J.get(e).__webglFramebuffer&&K.setupRenderTarget(e);let r=b,i=!1;if(e){const n=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=n[t],i=!0):r=e.isWebGLMultisampleRenderTarget?J.get(e).__webglMultisampledFramebuffer:n,C.copy(e.viewport),A.copy(e.scissor),L=e.scissorTest}else C.copy(D).multiplyScalar(O).floor(),A.copy(N).multiplyScalar(O).floor(),L=j;if(S!==r&&(fe.bindFramebuffer(36160,r),S=r),X.viewport(C),X.scissor(A),X.setScissorTest(L),i){const r=J.get(e.texture);fe.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){let a=!1;s!==S&&(fe.bindFramebuffer(36160,s),a=!0);try{const s=e.texture,l=s.format,c=s.type;if(1023!==l&&he.convert(l)!==fe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=1016===c&&(V.has("EXT_color_buffer_half_float")||q.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(1009===c||he.convert(c)===fe.getParameter(35738)||1015===c&&(q.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===fe.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&fe.readPixels(t,n,r,i,he.convert(l),he.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&fe.bindFramebuffer(36160,S)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=he.convert(t.format);K.setTexture2D(t,0),fe.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,a=he.convert(n.format),s=he.convert(n.type);K.setTexture2D(n,0),fe.pixelStorei(37440,n.flipY),fe.pixelStorei(37441,n.premultiplyAlpha),fe.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?fe.texSubImage2D(3553,r,e.x,e.y,i,o,a,s,t.image.data):t.isCompressedTexture?fe.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):fe.texSubImage2D(3553,r,e.x,e.y,a,s,t.image),0===r&&n.generateMipmaps&&fe.generateMipmap(3553),X.unbindTexture()},this.initTexture=function(e){K.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){X.reset(),de.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ri(e){ni.call(this,e)}Kr.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Kr,isArrayCamera:!0}),Qr.prototype=Object.assign(Object.create(be.prototype),{constructor:Qr,isGroup:!0}),Object.assign($r.prototype,{constructor:$r,getHandSpace:function(){return null===this._hand&&(this._hand=new Qr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Qr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Qr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){let r=null,i=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const e=new Qr;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const i=l.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&a>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)));return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==o),this}}),Object.assign(ei.prototype,a.prototype),ri.prototype=Object.assign(Object.create(ni.prototype),{constructor:ri,isWebGL1Renderer:!0});class ii extends be{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function oi(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=c.generateUUID()}Object.defineProperty(oi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(oi.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=c.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new oi(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=c.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const ai=new _;function si(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function li(e){We.call(this),this.type="SpriteMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let ci;Object.defineProperties(si.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(si.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)ai.x=this.getX(t),ai.y=this.getY(t),ai.z=this.getZ(t),ai.applyMatrix4(e),this.setXYZ(t,ai.x,ai.y,ai.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Ye(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new si(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),li.prototype=Object.create(We.prototype),li.prototype.constructor=li,li.prototype.isSpriteMaterial=!0,li.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const ui=new _,hi=new _,di=new _,fi=new u,pi=new u,mi=new Y,gi=new _,vi=new _,yi=new _,bi=new u,_i=new u,xi=new u;function wi(e){if(be.call(this),this.type="Sprite",void 0===ci){ci=new mt;const e=new oi(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ci.setIndex([0,1,2,0,2,3]),ci.setAttribute("position",new si(e,3,0,!1)),ci.setAttribute("uv",new si(e,2,3,!1))}this.geometry=ci,this.material=void 0!==e?e:new li,this.center=new u(.5,.5)}function Mi(e,t,n,r,i,o){fi.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(pi.x=o*fi.x-i*fi.y,pi.y=i*fi.x+o*fi.y):pi.copy(fi),e.copy(t),e.x+=pi.x,e.y+=pi.y,e.applyMatrix4(mi)}wi.prototype=Object.assign(Object.create(be.prototype),{constructor:wi,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hi.setFromMatrixScale(this.matrixWorld),mi.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),di.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&hi.multiplyScalar(-di.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Mi(gi.set(-.5,-.5,0),di,o,hi,r,i),Mi(vi.set(.5,-.5,0),di,o,hi,r,i),Mi(yi.set(.5,.5,0),di,o,hi,r,i),bi.set(0,0),_i.set(1,0),xi.set(1,1);let a=e.ray.intersectTriangle(gi,vi,yi,!1,ui);if(null===a&&(Mi(vi.set(-.5,.5,0),di,o,hi,r,i),_i.set(0,1),a=e.ray.intersectTriangle(gi,yi,vi,!1,ui),null===a))return;const s=e.ray.origin.distanceTo(ui);s<e.near||s>e.far||t.push({distance:s,point:ui.clone(),uv:Ie.getUV(ui,gi,vi,yi,bi,_i,xi,new u),face:null,object:this})},copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const Si=new _,Ei=new _;function Ti(){be.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Ti.prototype=Object.assign(Object.create(be.prototype),{constructor:Ti,isLOD:!0,copy:function(e){be.prototype.copy.call(this,e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Si.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Si);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){Si.setFromMatrixPosition(e.matrixWorld),Ei.setFromMatrixPosition(this.matrixWorld);const n=Si.distanceTo(Ei)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){const t=be.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}});const Ci=new _,Ai=new v,Li=new v,Pi=new _,Ri=new Y;function Oi(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),kt.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Y,this.bindMatrixInverse=new Y}function ki(){be.call(this),this.type="Bone"}Oi.prototype=Object.assign(Object.create(kt.prototype),{constructor:Oi,isSkinnedMesh:!0,copy:function(e){return kt.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new v,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){kt.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const n=this.skeleton,r=this.geometry;Ai.fromBufferAttribute(r.attributes.skinIndex,e),Li.fromBufferAttribute(r.attributes.skinWeight,e),Ci.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=Li.getComponent(e);if(0!==r){const i=Ai.getComponent(e);Ri.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Pi.copy(Ci).applyMatrix4(Ri),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}),ki.prototype=Object.assign(Object.create(be.prototype),{constructor:ki,isBone:!0});const Ii=new Y,Di=new Y;function Ni(e=[],t=[]){this.uuid=c.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Ni.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Y)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Y;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Di;Ii.multiplyMatrices(i,t[r]),Ii.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new Ni(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new ki),this.bones.push(i),this.boneInverses.push((new Y).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}});const ji=new Y,Fi=new Y,Bi=[],zi=new kt;function Ui(e,t,n){kt.call(this,e,t),this.instanceMatrix=new Ye(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Hi(e){We.call(this),this.type="LineBasicMaterial",this.color=new Ue(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Ui.prototype=Object.assign(Object.create(kt.prototype),{constructor:Ui,isInstancedMesh:!0,copy:function(e){return kt.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const n=this.matrixWorld,r=this.count;if(zi.geometry=this.geometry,zi.material=this.material,void 0!==zi.material)for(let i=0;i<r;i++){this.getMatrixAt(i,ji),Fi.multiplyMatrices(n,ji),zi.matrixWorld=Fi,zi.raycast(e,Bi);for(let e=0,n=Bi.length;e<n;e++){const n=Bi[e];n.instanceId=i,n.object=this,t.push(n)}Bi.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Ye(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Hi.prototype=Object.create(We.prototype),Hi.prototype.constructor=Hi,Hi.prototype.isLineBasicMaterial=!0,Hi.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const Gi=new _,Wi=new _,Vi=new Y,qi=new X,Xi=new B;function Yi(e=new mt,t=new Hi){be.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}Yi.prototype=Object.assign(Object.create(be.prototype),{constructor:Yi,isLine:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Gi.fromBufferAttribute(t,e-1),Wi.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Gi.distanceTo(Wi);e.setAttribute("lineDistance",new rt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xi.copy(n.boundingSphere),Xi.applyMatrix4(r),Xi.radius+=i,!1===e.ray.intersectsSphere(Xi))return;Vi.copy(r).invert(),qi.copy(e.ray).applyMatrix4(Vi);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new _,l=new _,c=new _,u=new _,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,o=n.length-1;r<o;r+=h){const o=n[r],h=n[r+1];s.fromBufferAttribute(i,o),l.fromBufferAttribute(i,h);if(qi.distanceSqToSegment(s,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){s.fromBufferAttribute(i,n),l.fromBufferAttribute(i,n+1);if(qi.distanceSqToSegment(s,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Zi=new _,Ji=new _;function Ki(e,t){Yi.call(this,e,t),this.type="LineSegments"}function Qi(e,t){Yi.call(this,e,t),this.type="LineLoop"}function $i(e){We.call(this),this.type="PointsMaterial",this.color=new Ue(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Ki.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Ki,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Zi.fromBufferAttribute(t,e),Ji.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Zi.distanceTo(Ji);e.setAttribute("lineDistance",new rt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),Qi.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Qi,isLineLoop:!0}),$i.prototype=Object.create(We.prototype),$i.prototype.constructor=$i,$i.prototype.isPointsMaterial=!0,$i.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const eo=new Y,to=new X,no=new B,ro=new _;function io(e=new mt,t=new $i){be.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function oo(e,t,n,r,i,o,a){const s=to.distanceSqToPoint(e);if(s<n){const n=new _;to.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}function ao(e,t,n,r,i,o,a,s,l){m.call(this,e,t,n,r,i,o,a,s,l),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function so(e,t,n,r,i,o,a,s,l,c,u,h){m.call(this,null,o,a,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function lo(e,t,n,r,i,o,a,s,l){m.call(this,e,t,n,r,i,o,a,s,l),this.needsUpdate=!0}function co(e,t,n,r,i,o,a,s,l,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===c&&(n=1012),void 0===n&&1027===c&&(n=1020),m.call(this,null,r,i,o,a,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}io.prototype=Object.assign(Object.create(be.prototype),{constructor:io,isPoints:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),no.copy(n.boundingSphere),no.applyMatrix4(r),no.radius+=i,!1===e.ray.intersectsSphere(no))return;eo.copy(r).invert(),to.copy(e.ray).applyMatrix4(eo);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,s=n.length;i<s;i++){const s=n[i];ro.fromBufferAttribute(o,s),oo(ro,s,a,r,e,t,this)}}else for(let n=0,i=o.count;n<i;n++)ro.fromBufferAttribute(o,n),oo(ro,n,a,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),ao.prototype=Object.assign(Object.create(m.prototype),{constructor:ao,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),so.prototype=Object.create(m.prototype),so.prototype.constructor=so,so.prototype.isCompressedTexture=!0,lo.prototype=Object.create(m.prototype),lo.prototype.constructor=lo,lo.prototype.isCanvasTexture=!0,co.prototype=Object.create(m.prototype),co.prototype.constructor=co,co.prototype.isDepthTexture=!0;new _,new _,new _,new Ie;const uo=function(e,t,n){n=n||2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=ho(e,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c,u,h,d,f;if(r&&(o=function(e,t,n,r){const i=[];let o,a,s,l,c;for(o=0,a=t.length;o<a;o++)s=t[o]*r,l=o<a-1?t[o+1]*r:e.length,c=ho(e,s,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Mo(c));for(i.sort(bo),o=0;o<i.length;o++)_o(i[o],n),n=fo(n,n.next);return n}(e,t,o,n)),e.length>80*n){s=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<s&&(s=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-s,u-l),f=0!==f?1/f:0}return po(o,a,n,s,l,f),a};function ho(e,t,n,r,i){let o,a;if(i===function(e,t,n,r){let i=0;for(let o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=ko(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=ko(o,e[o],e[o+1],a);return a&&Co(a,a.next)&&(Io(a),a=a.next),a}function fo(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Co(r,r.next)&&0!==To(r.prev,r,r.next))r=r.next;else{if(Io(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function po(e,t,n,r,i,o,a){if(!e)return;!a&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=wo(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,a,s,l,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?go(e,r,i,o):mo(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Io(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?po(e=vo(fo(e),t,n),t,n,r,i,o,2):2===a&&yo(e,t,n,r,i,o):po(fo(e),t,n,r,i,o,1);break}}function mo(e){const t=e.prev,n=e,r=e.next;if(To(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(So(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&To(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function go(e,t,n,r){const i=e.prev,o=e,a=e.next;if(To(i,o,a)>=0)return!1;const s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=wo(s,l,t,n,r),d=wo(c,u,t,n,r);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&So(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&To(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&So(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&To(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&So(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&To(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&So(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&To(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function vo(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Co(i,o)&&Ao(i,r,r.next,o)&&Ro(i,o)&&Ro(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Io(r),Io(r.next),r=e=o),r=r.next}while(r!==e);return fo(r)}function yo(e,t,n,r,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Eo(a,e)){let s=Oo(a,e);return a=fo(a,a.next),s=fo(s,s.next),po(a,t,n,r,i,o),void po(s,t,n,r,i,o)}e=e.next}a=a.next}while(a!==e)}function bo(e,t){return e.x-t.x}function _o(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>a){if(a=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===a)return o;const s=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=l&&r!==n.x&&So(i<c?r:a,i,l,c,i<c?a:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Ro(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&xo(o,n)))&&(o=n,h=u)),n=n.next}while(n!==s);return o}(e,t)){const n=Oo(t,e);fo(t,t.next),fo(n,n.next)}}function xo(e,t){return To(e.prev,e,t.prev)<0&&To(t.next,e,e.next)<0}function wo(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mo(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function So(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Eo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ao(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ro(e,t)&&Ro(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(To(e.prev,e,t.prev)||To(e,t.prev,t))||Co(e,t)&&To(e.prev,e,e.next)>0&&To(t.prev,t,t.next)>0)}function To(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Co(e,t){return e.x===t.x&&e.y===t.y}function Ao(e,t,n,r){const i=Po(To(e,t,n)),o=Po(To(e,t,r)),a=Po(To(n,r,e)),s=Po(To(n,r,t));return i!==o&&a!==s||(!(0!==i||!Lo(e,n,t))||(!(0!==o||!Lo(e,r,t))||(!(0!==a||!Lo(n,e,r))||!(0!==s||!Lo(n,t,r)))))}function Lo(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Po(e){return e>0?1:e<0?-1:0}function Ro(e,t){return To(e.prev,e,e.next)<0?To(e,t,e.next)>=0&&To(e,e.prev,t)>=0:To(e,t,e.prev)<0||To(e,e.next,t)<0}function Oo(e,t){const n=new Do(e.i,e.x,e.y),r=new Do(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function ko(e,t,n,r){const i=new Do(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Io(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Do(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const No={area:function(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return No.area(e)<0},triangulateShape:function(e,t){const n=[],r=[],i=[];jo(e),Fo(n,e);let o=e.length;t.forEach(jo);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,Fo(n,t[e]);const a=uo(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}};function jo(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Fo(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Bo extends mt{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){o(e[t])}function o(e){const o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,f=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:zo;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let v,y,b,x,w,M=!1;m&&(v=m.getSpacedPoints(s),M=!0,c=!1,y=m.computeFrenetFrames(s,!1),b=new _,x=new _,w=new _),c||(p=0,h=0,d=0,f=0);const S=e.extractPoints(a);let E=S.shape;const T=S.holes;if(!No.isClockWise(E)){E=E.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];No.isClockWise(t)&&(T[e]=t.reverse())}}const C=No.triangulateShape(E,T),A=E;for(let e=0,t=T.length;e<t;e++){const t=T[e];E=E.concat(t)}function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const P=E.length,R=C.length;function O(e,t,n){let r,i,o;const a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,h=a*a+s*s,d=a*c-s*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),f=Math.sqrt(l*l+c*c),p=t.x-s/d,m=t.y+a/d,g=((n.x-c/f-p)*c-(n.y+l/f-m)*l)/(a*c-s*l);r=p+a*g-e.x,i=m+s*g-e.y;const v=r*r+i*i;if(v<=2)return new u(r,i);o=Math.sqrt(v/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,i=a,o=Math.sqrt(h)):(r=a,i=s,o=Math.sqrt(h/2))}return new u(r/o,i/o)}const k=[];for(let e=0,t=A.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),k[e]=O(A[e],A[n],A[r]);const I=[];let D,N=k.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];D=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),D[e]=O(t[e],t[r],t[i]);I.push(D),N=N.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=h*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+f;for(let e=0,t=A.length;e<t;e++){const t=L(A[e],k[e],r);B(t.x,t.y,-n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];D=I[e];for(let e=0,i=t.length;e<i;e++){const i=L(t[e],D[e],r);B(i.x,i.y,-n)}}}const j=d+f;for(let e=0;e<P;e++){const t=c?L(E[e],N[e],j):E[e];M?(x.copy(y.normals[0]).multiplyScalar(t.x),b.copy(y.binormals[0]).multiplyScalar(t.y),w.copy(v[0]).add(x).add(b),B(w.x,w.y,w.z)):B(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<P;t++){const n=c?L(E[t],N[t],j):E[t];M?(x.copy(y.normals[e]).multiplyScalar(n.x),b.copy(y.binormals[e]).multiplyScalar(n.y),w.copy(v[e]).add(x).add(b),B(w.x,w.y,w.z)):B(n.x,n.y,l/s*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=h*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+f;for(let e=0,t=A.length;e<t;e++){const t=L(A[e],k[e],r);B(t.x,t.y,l+n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];D=I[e];for(let e=0,i=t.length;e<i;e++){const i=L(t[e],D[e],r);M?B(i.x,i.y+v[s-1].y,v[s-1].x+n):B(i.x,i.y,l+n)}}}function F(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*p;e<n;e++){const n=P*e,o=P*(e+1);U(t+r+n,t+i+n,t+i+o,t+r+o)}}}function B(e,t,n){o.push(e),o.push(t),o.push(n)}function z(e,t,i){H(e),H(t),H(i);const o=r.length/3,a=g.generateTopUV(n,r,o-3,o-2,o-1);G(a[0]),G(a[1]),G(a[2])}function U(e,t,i,o){H(e),H(t),H(o),H(t),H(i),H(o);const a=r.length/3,s=g.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);G(s[0]),G(s[1]),G(s[3]),G(s[1]),G(s[2]),G(s[3])}function H(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=P*e;for(let e=0;e<R;e++){const n=C[e];z(n[2]+t,n[1]+t,n[0]+t)}e=s+2*p,t=P*e;for(let e=0;e<R;e++){const n=C[e];z(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<R;e++){const t=C[e];z(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=C[e];z(t[0]+P*s,t[1]+P*s,t[2]+P*s)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;F(A,t),t+=A.length;for(let e=0,n=T.length;e<n;e++){const n=T[e];F(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new rt(r,3)),this.setAttribute("uv",new rt(i,2)),this.computeVertexNormals()}toJSON(){const e=mt.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}const zo={generateTopUV:function(e,t,n,r,i){const o=t[3*n],a=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],h=t[3*i+1];return[new u(o,a),new u(s,l),new u(c,h)]},generateSideWallUV:function(e,t,n,r,i,o){const a=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],h=t[3*r+1],d=t[3*r+2],f=t[3*i],p=t[3*i+1],m=t[3*i+2],g=t[3*o],v=t[3*o+1],y=t[3*o+2];return Math.abs(s-h)<.01?[new u(a,1-l),new u(c,1-d),new u(f,1-m),new u(g,1-y)]:[new u(s,1-l),new u(h,1-d),new u(p,1-m),new u(v,1-y)]}};function Uo(e,t,n){mt.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],a=[],s=1e-5,l=new _,c=new _,u=new _,h=new _,d=new _;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const f=t+1;for(let r=0;r<=n;r++){const f=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,f,c),i.push(c.x,c.y,c.z),r-s>=0?(e(r-s,f,u),h.subVectors(c,u)):(e(r+s,f,u),h.subVectors(u,c)),f-s>=0?(e(r,f-s,u),d.subVectors(c,u)):(e(r,f+s,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),o.push(l.x,l.y,l.z),a.push(r,f)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*f+n,i=e*f+n+1,o=(e+1)*f+n+1,a=(e+1)*f+n;r.push(t,i,a),r.push(i,o,a)}this.setIndex(r),this.setAttribute("position",new rt(i,3)),this.setAttribute("normal",new rt(o,3)),this.setAttribute("uv",new rt(a,2))}Uo.prototype=Object.create(mt.prototype),Uo.prototype.constructor=Uo;class Ho extends mt{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let a=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,s,t),a+=s,s=0;function l(e){const a=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===No.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===No.isClockWise(t)&&(u[e]=t.reverse())}const h=No.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+a,i=t[1]+a,o=t[2]+a;n.push(r,i,o),s+=3}}this.setIndex(n),this.setAttribute("position",new rt(r,3)),this.setAttribute("normal",new rt(i,3)),this.setAttribute("uv",new rt(o,2))}toJSON(){const e=mt.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class Go extends mt{constructor(e=1,t=8,n=6,r=0,i=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let l=0;const c=[],u=new _,h=new _,d=[],f=[],p=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==o?y=.5/t:d==n&&s==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(o+v*a),u.y=e*Math.cos(o+v*a),u.z=e*Math.sin(r+s*i)*Math.sin(o+v*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(s+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],a=c[e+1][r],l=c[e+1][r+1];(0!==e||o>0)&&d.push(t,i,l),(e!==n-1||s<Math.PI)&&d.push(i,a,l)}this.setIndex(d),this.setAttribute("position",new rt(f,3)),this.setAttribute("normal",new rt(p,3)),this.setAttribute("uv",new rt(m,2))}}class Wo extends mt{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=[0,0],r={},i=new _;if(null!==e.index){const o=e.attributes.position,a=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,t=s.length;e<t;++e){const t=s[e],i=t.start;for(let e=i,o=i+t.count;e<o;e+=3)for(let t=0;t<3;t++){const i=a.getX(e+t),o=a.getX(e+(t+1)%3);n[0]=Math.min(i,o),n[1]=Math.max(i,o);const s=n[0]+","+n[1];void 0===r[s]&&(r[s]={index1:n[0],index2:n[1]})}}for(const e in r){const n=r[e];i.fromBufferAttribute(o,n.index1),t.push(i.x,i.y,i.z),i.fromBufferAttribute(o,n.index2),t.push(i.x,i.y,i.z)}}else{const n=e.attributes.position;for(let e=0,r=n.count/3;e<r;e++)for(let r=0;r<3;r++){const o=3*e+r;i.fromBufferAttribute(n,o),t.push(i.x,i.y,i.z);const a=3*e+(r+1)%3;i.fromBufferAttribute(n,a),t.push(i.x,i.y,i.z)}}this.setAttribute("position",new rt(t,3))}}function Vo(e){We.call(this),this.type="ShadowMaterial",this.color=new Ue(0),this.transparent=!0,this.setValues(e)}function qo(e){Bt.call(this,e),this.type="RawShaderMaterial"}function Xo(e){We.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ue(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new u(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Yo(e){Xo.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new u(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=c.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Zo(e){We.call(this),this.type="MeshPhongMaterial",this.color=new Ue(16777215),this.specular=new Ue(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new u(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Jo(e){We.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ue(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new u(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ko(e){We.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new u(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Qo(e){We.call(this),this.type="MeshLambertMaterial",this.color=new Ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function $o(e){We.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ue(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new u(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ea(e){Hi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Vo.prototype=Object.create(We.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isShadowMaterial=!0,Vo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this},qo.prototype=Object.create(Bt.prototype),qo.prototype.constructor=qo,qo.prototype.isRawShaderMaterial=!0,Xo.prototype=Object.create(We.prototype),Xo.prototype.constructor=Xo,Xo.prototype.isMeshStandardMaterial=!0,Xo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Yo.prototype=Object.create(Xo.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isMeshPhysicalMaterial=!0,Yo.prototype.copy=function(e){return Xo.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ue).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Zo.prototype=Object.create(We.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isMeshPhongMaterial=!0,Zo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Jo.prototype=Object.create(We.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isMeshToonMaterial=!0,Jo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ko.prototype=Object.create(We.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isMeshNormalMaterial=!0,Ko.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Qo.prototype=Object.create(We.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isMeshLambertMaterial=!0,Qo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},$o.prototype=Object.create(We.prototype),$o.prototype.constructor=$o,$o.prototype.isMeshMatcapMaterial=!0,$o.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ea.prototype=Object.create(Hi.prototype),ea.prototype.constructor=ea,ea.prototype.isLineDashedMaterial=!0,ea.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ta=Object.freeze({__proto__:null,ShadowMaterial:Vo,SpriteMaterial:li,RawShaderMaterial:qo,ShaderMaterial:Bt,PointsMaterial:$i,MeshPhysicalMaterial:Yo,MeshStandardMaterial:Xo,MeshPhongMaterial:Zo,MeshToonMaterial:Jo,MeshNormalMaterial:Ko,MeshLambertMaterial:Qo,MeshDepthMaterial:Vr,MeshDistanceMaterial:qr,MeshBasicMaterial:Ve,MeshMatcapMaterial:$o,LineDashedMaterial:ea,LineBasicMaterial:Hi,Material:We});const na={arraySlice:function(e,t,n){return na.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,a=0;a!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){l.push(t.times[e]);for(let n=0;n<s;++n)c.push(t.values[e*s+n])}}0!==l.length&&(t.times=na.convertArray(l,t.times.constructor),t.values=na.convertArray(c,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===a)continue;let s=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const e=s,t=l-s;d=na.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*l+s,t=e+l-s;d=na.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=s,n=l-s;e.evaluate(o),d=na.arraySlice(e.resultBuffer,t,n)}if("quaternion"===i){(new b).fromArray(d).normalize().conjugate().toArray(d)}const f=a.times.length;for(let e=0;e<f;++e){const t=e*u+c;if("quaternion"===i)b.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=2501,e}};function ra(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function ia(e,t,n,r){ra.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function oa(e,t,n,r){ra.call(this,e,t,n,r)}function aa(e,t,n,r){ra.call(this,e,t,n,r)}function sa(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=na.convertArray(t,this.TimeBufferType),this.values=na.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function la(e,t,n){sa.call(this,e,t,n)}function ca(e,t,n,r){sa.call(this,e,t,n,r)}function ua(e,t,n,r){sa.call(this,e,t,n,r)}function ha(e,t,n,r){ra.call(this,e,t,n,r)}function da(e,t,n,r){sa.call(this,e,t,n,r)}function fa(e,t,n,r){sa.call(this,e,t,n,r)}function pa(e,t,n,r){sa.call(this,e,t,n,r)}function ma(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=c.generateUUID(),this.duration<0&&this.resetDuration()}function ga(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ua;case"vector":case"vector2":case"vector3":case"vector4":return pa;case"color":return ca;case"quaternion":return da;case"bool":case"boolean":return la;case"string":return fa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];na.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(ra.prototype,{evaluate:function(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const a=t[1];e<a&&(n=2,i=a);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ra.prototype,{beforeStart_:ra.prototype.copySampleValue_,afterEnd_:ra.prototype.copySampleValue_}),ia.prototype=Object.assign(Object.create(ra.prototype),{constructor:ia,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,b=d*m-d*p;for(let e=0;e!==a;++e)i[e]=g*o[c+e]+v*o[l+e]+y*o[s+e]+b*o[u+e];return i}}),oa.prototype=Object.assign(Object.create(ra.prototype),{constructor:oa,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==a;++e)i[e]=o[l+e]*u+o[s+e]*c;return i}}),aa.prototype=Object.assign(Object.create(ra.prototype),{constructor:aa,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(sa,{toJSON:function(e){const t=e.constructor;let n;if(void 0!==t.toJSON)n=t.toJSON(e);else{n={name:e.name,times:na.convertArray(e.times,Array),values:na.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}}),Object.assign(sa.prototype,{constructor:sa,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new aa(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new oa(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ia(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this},trim:function(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=na.arraySlice(n,i,o),this.values=na.arraySlice(this.values,i*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&na.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e},optimize:function(){const e=na.arraySlice(this.times),t=na.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=e.length-1;let o=1;for(let a=1;a<i;++a){let i=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[o+a]){i=!0;break}}}if(i){if(a!==o){e[o]=e[a];const r=a*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,a=0;a!==n;++a)t[r+a]=t[e+a];++o}return o!==e.length?(this.times=na.arraySlice(e,0,o),this.values=na.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){const e=na.arraySlice(this.times,0),t=na.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),la.prototype=Object.assign(Object.create(sa.prototype),{constructor:la,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ca.prototype=Object.assign(Object.create(sa.prototype),{constructor:ca,ValueTypeName:"color"}),ua.prototype=Object.assign(Object.create(sa.prototype),{constructor:ua,ValueTypeName:"number"}),ha.prototype=Object.assign(Object.create(ra.prototype),{constructor:ha,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)b.slerpFlat(i,0,o,l-a,o,l,s);return i}}),da.prototype=Object.assign(Object.create(sa.prototype),{constructor:da,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ha(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),fa.prototype=Object.assign(Object.create(sa.prototype),{constructor:fa,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pa.prototype=Object.assign(Object.create(sa.prototype),{constructor:pa,ValueTypeName:"vector"}),Object.assign(ma,{parse:function(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(ga(n[e]).scale(r));const i=new ma(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i},toJSON:function(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(sa.toJSON(n[e]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let a=[],s=[];a.push((e+i-1)%i,e,(e+1)%i),s.push(0,1,0);const l=na.getKeyframeOrder(a);a=na.sortedArray(a,1,l),s=na.sortedArray(s,1,l),r||0!==a[0]||(a.push(i),s.push(s[0])),o.push(new ua(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new ma(e,-1,o)},findByName:function(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(ma.CreateFromMorphTargetSequence(e,r[e],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],a=[];na.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new ua(".morphTargetInfluence["+n+"]",e,o))}s=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(pa,o+".position",i,"pos",r),n(da,o+".quaternion",i,"rot",r),n(pa,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new ma(i,s,r,a)}}),Object.assign(ma.prototype,{resetDuration:function(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new ma(this.name,this.duration,e,this.blendMode)},toJSON:function(){return ma.toJSON(this)}});const va={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ya(e,t,n){const r=this;let i=!1,o=0,a=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}const ba=new ya;function _a(e){this.manager=void 0!==e?e:ba,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(_a.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const xa={};function wa(e){_a.call(this,e)}function Ma(e){_a.call(this,e)}function Sa(e){_a.call(this,e)}function Ea(e){_a.call(this,e)}function Ta(e){_a.call(this,e)}function Ca(e){_a.call(this,e)}function Aa(e){_a.call(this,e)}function La(){this.type="Curve",this.arcLengthDivisions=200}function Pa(e,t,n,r,i,o,a,s){La.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Ra(e,t,n,r,i,o){Pa.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function Oa(){let e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){let l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,c=(n-t)/a-(r-t)/(a+s)+(r-n)/s;l*=a,c*=a,i(t,n,l,c)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}wa.prototype=Object.assign(Object.create(_a.prototype),{constructor:wa,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=va.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==xa[e])return void xa[e].push({onLoad:t,onProgress:n,onError:r});const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);let s;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);r="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(s,n);break;case"json":r=JSON.parse(s);break;default:r=s}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{xa[e]=[],xa[e].push({onLoad:t,onProgress:n,onError:r}),s=new XMLHttpRequest,s.open("GET",e,!0),s.addEventListener("load",(function(t){const n=this.response,r=xa[e];if(delete xa[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),va.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),s.addEventListener("progress",(function(t){const n=xa[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),s.addEventListener("error",(function(t){const n=xa[e];delete xa[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),s.addEventListener("abort",(function(t){const n=xa[e];delete xa[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.overrideMimeType&&s.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)s.setRequestHeader(e,this.requestHeader[e]);s.send(null)}return i.manager.itemStart(e),s},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Ma.prototype=Object.assign(Object.create(_a.prototype),{constructor:Ma,load:function(e,t,n,r){const i=this,o=new wa(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=[];for(let n=0;n<e.length;n++){const r=ma.parse(e[n]);t.push(r)}return t}}),Sa.prototype=Object.assign(Object.create(_a.prototype),{constructor:Sa,load:function(e,t,n,r){const i=this,o=[],a=new so,s=new wa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let l=0;function c(c){s.load(e[c],(function(e){const n=i.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=1006),a.image=o,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else s.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}}),Ea.prototype=Object.assign(Object.create(_a.prototype),{constructor:Ea,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=va.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),va.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),Ta.prototype=Object.assign(Object.create(_a.prototype),{constructor:Ta,load:function(e,t,n,r){const i=new Gt,o=new Ea(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,a++,6===a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)s(t);return i}}),Ca.prototype=Object.assign(Object.create(_a.prototype),{constructor:Ca,load:function(e,t,n,r){const i=this,o=new Vt,a=new wa(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),Aa.prototype=Object.assign(Object.create(_a.prototype),{constructor:Aa,load:function(e,t,n,r){const i=new m,o=new Ea(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?1022:1023,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(La.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let a,s=0,l=i-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),a=n[r]-o,a<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)},getTangent:function(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const i=this.getPoint(n),o=this.getPoint(r),a=t||(i.isVector2?new u:new _);return a.copy(o).sub(i).normalize(),a},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new _,r=[],i=[],o=[],a=new _,s=new Y;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new _),r[t].normalize()}i[0]=new _,o[0]=new _;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(c.clamp(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(c.clamp(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Pa.prototype=Object.create(La.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isEllipseCurve=!0,Pa.prototype.getPoint=function(e,t){const n=t||new u,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const a=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=l-this.aY;s=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(s,l)},Pa.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Pa.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Pa.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ra.prototype=Object.create(Pa.prototype),Ra.prototype.constructor=Ra,Ra.prototype.isArcCurve=!0;const ka=new _,Ia=new Oa,Da=new Oa,Na=new Oa;function ja(e=[],t=!1,n="centripetal",r=.5){La.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function Fa(e,t,n,r,i){const o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function Ba(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function za(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Ua(e=new u,t=new u,n=new u,r=new u){La.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Ha(e=new _,t=new _,n=new _,r=new _){La.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Ga(e=new u,t=new u){La.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function Wa(e=new _,t=new _){La.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function Va(e=new u,t=new u,n=new u){La.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function qa(e=new _,t=new _,n=new _){La.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function Xa(e=[]){La.call(this),this.type="SplineCurve",this.points=e}ja.prototype=Object.create(La.prototype),ja.prototype.constructor=ja,ja.prototype.isCatmullRomCurve3=!0,ja.prototype.getPoint=function(e,t=new _){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let a,s,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?a=r[(l-1)%i]:(ka.subVectors(r[0],r[1]).add(r[0]),a=ka);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?s=r[(l+2)%i]:(ka.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=ka),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Ia.initNonuniformCatmullRom(a.x,u.x,h.x,s.x,t,n,r),Da.initNonuniformCatmullRom(a.y,u.y,h.y,s.y,t,n,r),Na.initNonuniformCatmullRom(a.z,u.z,h.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Ia.initCatmullRom(a.x,u.x,h.x,s.x,this.tension),Da.initCatmullRom(a.y,u.y,h.y,s.y,this.tension),Na.initCatmullRom(a.z,u.z,h.z,s.z,this.tension));return n.set(Ia.calc(c),Da.calc(c),Na.calc(c)),n},ja.prototype.copy=function(e){La.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ja.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},ja.prototype.fromJSON=function(e){La.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new _).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ua.prototype=Object.create(La.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isCubicBezierCurve=!0,Ua.prototype.getPoint=function(e,t=new u){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(za(e,r.x,i.x,o.x,a.x),za(e,r.y,i.y,o.y,a.y)),n},Ua.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ua.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ua.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ha.prototype=Object.create(La.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isCubicBezierCurve3=!0,Ha.prototype.getPoint=function(e,t=new _){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(za(e,r.x,i.x,o.x,a.x),za(e,r.y,i.y,o.y,a.y),za(e,r.z,i.z,o.z,a.z)),n},Ha.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ha.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ha.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ga.prototype=Object.create(La.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isLineCurve=!0,Ga.prototype.getPoint=function(e,t=new u){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ga.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ga.prototype.getTangent=function(e,t){const n=t||new u;return n.copy(this.v2).sub(this.v1).normalize(),n},Ga.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ga.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ga.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Wa.prototype=Object.create(La.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isLineCurve3=!0,Wa.prototype.getPoint=function(e,t=new _){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Wa.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Wa.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Wa.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Wa.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Va.prototype=Object.create(La.prototype),Va.prototype.constructor=Va,Va.prototype.isQuadraticBezierCurve=!0,Va.prototype.getPoint=function(e,t=new u){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(Ba(e,r.x,i.x,o.x),Ba(e,r.y,i.y,o.y)),n},Va.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Va.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Va.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},qa.prototype=Object.create(La.prototype),qa.prototype.constructor=qa,qa.prototype.isQuadraticBezierCurve3=!0,qa.prototype.getPoint=function(e,t=new _){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(Ba(e,r.x,i.x,o.x),Ba(e,r.y,i.y,o.y),Ba(e,r.z,i.z,o.z)),n},qa.prototype.copy=function(e){return La.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},qa.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},qa.prototype.fromJSON=function(e){return La.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Xa.prototype=Object.create(La.prototype),Xa.prototype.constructor=Xa,Xa.prototype.isSplineCurve=!0,Xa.prototype.getPoint=function(e,t=new u){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return n.set(Fa(a,s.x,l.x,c.x,h.x),Fa(a,s.y,l.y,c.y,h.y)),n},Xa.prototype.copy=function(e){La.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this},Xa.prototype.toJSON=function(){const e=La.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e},Xa.prototype.fromJSON=function(e){La.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new u).fromArray(n))}return this};var Ya=Object.freeze({__proto__:null,ArcCurve:Ra,CatmullRomCurve3:ja,CubicBezierCurve:Ua,CubicBezierCurve3:Ha,EllipseCurve:Pa,LineCurve:Ga,LineCurve3:Wa,QuadraticBezierCurve:Va,QuadraticBezierCurve3:qa,SplineCurve:Xa});function Za(){La.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ja(e){Za.call(this),this.type="Path",this.currentPoint=new u,e&&this.setFromPoints(e)}function Ka(e){Ja.call(this,e),this.uuid=c.generateUUID(),this.type="Shape",this.holes=[]}function Qa(e,t=1){be.call(this),this.type="Light",this.color=new Ue(e),this.intensity=t}function $a(e,t,n){Qa.call(this,e,n),this.type="HemisphereLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.groundColor=new Ue(t)}function es(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new u(512,512),this.map=null,this.mapPass=null,this.matrix=new Y,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Yt,this._frameExtents=new u(1,1),this._viewportCount=1,this._viewports=[new v(0,0,1,1)]}function ts(){es.call(this,new Ut(50,1,.5,500)),this.focus=1}function ns(e,t,n,r,i,o){Qa.call(this,e,t),this.type="SpotLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new ts}function rs(){es.call(this,new Ut(90,1,.5,500)),this._frameExtents=new u(4,2),this._viewportCount=6,this._viewports=[new v(2,1,1,1),new v(0,1,1,1),new v(3,1,1,1),new v(1,1,1,1),new v(3,0,1,1),new v(1,0,1,1)],this._cubeDirections=[new _(1,0,0),new _(-1,0,0),new _(0,0,1),new _(0,0,-1),new _(0,1,0),new _(0,-1,0)],this._cubeUps=[new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,0,1),new _(0,0,-1)]}function is(e,t,n,r){Qa.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new rs}function os(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){zt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function as(){es.call(this,new os(-5,5,5,-5,.5,500))}function ss(e,t){Qa.call(this,e,t),this.type="DirectionalLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,this.shadow=new as}function ls(e,t){Qa.call(this,e,t),this.type="AmbientLight"}function cs(e,t,n,r){Qa.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}Za.prototype=Object.assign(Object.create(La.prototype),{constructor:Za,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ga(t,e))},getPoint:function(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),a=0===o?0:1-e/o;return i.getPointAt(a)}r++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){La.prototype.copy.call(this,e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=La.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){La.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Ya[n.type]).fromJSON(n))}return this}}),Ja.prototype=Object.assign(Object.create(Za.prototype),{constructor:Ja,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const n=new Ga(this.currentPoint.clone(),new u(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){const i=new Va(this.currentPoint.clone(),new u(e,t),new u(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){const a=new Ua(this.currentPoint.clone(),new u(e,t),new u(n,r),new u(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){const t=new Xa([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){const l=new Pa(e,t,n,r,i,o,a,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Za.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=Za.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Za.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Ka.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Ka,getPointsHoles:function(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ja.prototype.copy.call(this,e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){const e=Ja.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){Ja.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Ja).fromJSON(n))}return this}}),Qa.prototype=Object.assign(Object.create(be.prototype),{constructor:Qa,isLight:!0,copy:function(e){return be.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=be.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),$a.prototype=Object.assign(Object.create(Qa.prototype),{constructor:$a,isHemisphereLight:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(es.prototype,{_projScreenMatrix:new Y,_lightPositionWorld:new _,_lookTarget:new _,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),ts.prototype=Object.assign(Object.create(es.prototype),{constructor:ts,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,n=2*c.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),es.prototype.updateMatrices.call(this,e)}}),ns.prototype=Object.assign(Object.create(Qa.prototype),{constructor:ns,isSpotLight:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),rs.prototype=Object.assign(Object.create(es.prototype),{constructor:rs,isPointLightShadow:!0,updateMatrices:function(e,t=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),is.prototype=Object.assign(Object.create(Qa.prototype),{constructor:is,isPointLight:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),os.prototype=Object.assign(Object.create(zt.prototype),{constructor:os,isOrthographicCamera:!0,copy:function(e,t){return zt.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=be.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),as.prototype=Object.assign(Object.create(es.prototype),{constructor:as,isDirectionalLightShadow:!0,updateMatrices:function(e){es.prototype.updateMatrices.call(this,e)}}),ss.prototype=Object.assign(Object.create(Qa.prototype),{constructor:ss,isDirectionalLight:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ls.prototype=Object.assign(Object.create(Qa.prototype),{constructor:ls,isAmbientLight:!0}),cs.prototype=Object.assign(Object.create(Qa.prototype),{constructor:cs,isRectAreaLight:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=Qa.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class us{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new _)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}function hs(e,t){Qa.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new us}function ds(e){_a.call(this,e),this.textures={}}hs.prototype=Object.assign(Object.create(Qa.prototype),{constructor:hs,isLightProbe:!0,copy:function(e){return Qa.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=Qa.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),ds.prototype=Object.assign(Object.create(_a.prototype),{constructor:ds,load:function(e,t,n,r){const i=this,o=new wa(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=new ta[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new Ue).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Ue).setHex(i.value);break;case"v2":r.uniforms[t].value=(new u).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new _).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new v).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new h).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new Y).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new u).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new u).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});const fs=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},ps=function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};function ms(){mt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function gs(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ye.call(this,e,t,n),this.meshPerAttribute=r||1}function vs(e){_a.call(this,e)}ms.prototype=Object.assign(Object.create(mt.prototype),{constructor:ms,isInstancedBufferGeometry:!0,copy:function(e){return mt.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=mt.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),gs.prototype=Object.assign(Object.create(Ye.prototype),{constructor:gs,isInstancedBufferAttribute:!0,copy:function(e){return Ye.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=Ye.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),vs.prototype=Object.assign(Object.create(_a.prototype),{constructor:vs,load:function(e,t,n,r){const i=this,o=new wa(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),a=new oi(st(i.type,o),i.stride);return a.uuid=i.uuid,t[r]=a,a}const i=e.isInstancedBufferGeometry?new ms:new mt,o=e.data.index;if(void 0!==o){const e=st(o.type,o.array);i.setIndex(new Ye(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let o;if(n.isInterleavedBufferAttribute){o=new si(r(e.data,n.data),n.itemSize,n.offset,n.normalized)}else{const e=st(n.type,n.array);o=new(n.isInstancedBufferAttribute?gs:Ye)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),i.setAttribute(t,o)}const s=e.data.morphAttributes;if(s)for(const t in s){const n=s[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let a;if(i.isInterleavedBufferAttribute){a=new si(r(e.data,i.data),i.itemSize,i.offset,i.normalized)}else{a=new Ye(st(i.type,i.array),i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),o.push(a)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new _;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new B(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});function ys(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),_a.call(this,e),this.options={premultiplyAlpha:"none"}}function bs(){this.type="ShapePath",this.color=new Ue,this.subPaths=[],this.currentPath=null}ys.prototype=Object.assign(Object.create(_a.prototype),{constructor:ys,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=va.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){va.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(bs.prototype,{moveTo:function(e,t){return this.currentPath=new Ja,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Ka;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],a=t[o],s=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],s=-s,a=t[i],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return r}const i=No.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let a,s,l;const c=[];if(1===o.length)return s=o[0],l=new Ka,l.curves=s.curves,c.push(l),c;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],d=[];let f,p,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)s=o[t],f=s.getPoints(),a=i(f),a=e?!a:a,a?(!u&&d[g]&&g++,d[g]={s:new Ka,p:f},d[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:f[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const a=i[o];let s=!0;for(let i=0;i<d.length;i++)r(a.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),s?(s=!1,h[i].push(a)):e=!0);s&&h[n].push(a)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),p=m[e];for(let e=0,t=p.length;e<t;e++)l.holes.push(p[e].h)}return c}});class _s{constructor(e){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],r=function(e,t,n){const r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[];let s=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)s=0,l-=o;else{const e=xs(t,i,s,l,n);s+=e.offsetX,a.push(e.path)}}return a}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}function xs(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const a=new bs;let s,l,c,u,h,d,f,p;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;){switch(e[i++]){case"m":s=e[i++]*t+n,l=e[i++]*t+r,a.moveTo(s,l);break;case"l":s=e[i++]*t+n,l=e[i++]*t+r,a.lineTo(s,l);break;case"q":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,a.quadraticCurveTo(h,d,c,u);break;case"b":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,f=e[i++]*t+n,p=e[i++]*t+r,a.bezierCurveTo(h,d,f,p,c,u)}}}return{offsetX:o.ha*t,path:a}}function ws(e){_a.call(this,e)}let Ms;ws.prototype=Object.assign(Object.create(_a.prototype),{constructor:ws,load:function(e,t,n,r){const i=this,o=new wa(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new _s(e)}});const Ss=function(){return void 0===Ms&&(Ms=new(window.AudioContext||window.webkitAudioContext)),Ms};function Es(e){_a.call(this,e)}function Ts(e,t,n){hs.call(this,void 0,n);const r=(new Ue).set(e),i=(new Ue).set(t),o=new _(r.r,r.g,r.b),a=new _(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function Cs(e,t){hs.call(this,void 0,t);const n=(new Ue).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Es.prototype=Object.assign(Object.create(_a.prototype),{constructor:Es,load:function(e,t,n,r){const i=this,o=new wa(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);Ss().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}),Ts.prototype=Object.assign(Object.create(hs.prototype),{constructor:Ts,isHemisphereLightProbe:!0,copy:function(e){return hs.prototype.copy.call(this,e),this},toJSON:function(e){return hs.prototype.toJSON.call(this,e)}}),Cs.prototype=Object.assign(Object.create(hs.prototype),{constructor:Cs,isAmbientLightProbe:!0,copy:function(e){return hs.prototype.copy.call(this,e),this},toJSON:function(e){return hs.prototype.toJSON.call(this,e)}});const As=new Y,Ls=new Y;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ut,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ut,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(c.DEG2RAD*t.fov*.5)/t.zoom;let a,s;Ls.elements[12]=-r,As.elements[12]=r,a=-o*t.aspect+i,s=o*t.aspect+i,n.elements[0]=2*t.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(n),a=-o*t.aspect-i,s=o*t.aspect-i,n.elements[0]=2*t.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ls),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(As)}});class Ps extends be{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}function Rs(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Rs.prototype,{accumulate:function(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){a.setValue(n,r);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]},_slerp:function(e,t,n,r){b.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){const o=this._workIndex*i;b.multiplyQuaternionsFlat(e,o,e,t,e,n),b.slerpFlat(e,t,e,t,e,o,r)},_lerp:function(e,t,n,r,i){const o=1-r;for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]*o+e[n+a]*r}},_lerpAdditive:function(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}});const Os=new RegExp("[\\[\\]\\.:\\/]","g"),ks="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Is=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ds=/(WCOD+)?/.source.replace("WCOD",ks),Ns=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),js=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fs=new RegExp("^"+Is+Ds+Ns+js+"$"),Bs=["material","materials","bones"];function zs(e,t,n){const r=n||Us.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Us(e,t,n){this.path=t,this.parsedPath=n||Us.parseTrackName(t),this.node=Us.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(zs.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Us,{Composite:zs,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Us.Composite(e,t,n):new Us(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Os,"")},parseTrackName:function(e){const t=Fs.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Bs.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}}),Object.assign(Us.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Us.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Us.prototype,{_getValue_unbound:Us.prototype.getValue,_setValue_unbound:Us.prototype.setValue}),Object.assign(function(){this.uuid=c.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let a=void 0,s=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=s++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new Us(u,n[e],r[e]))}else if(d<l){a=e[d];const s=--l,c=e[s];t[c.uuid]=d,e[d]=c,t[h]=s,e[s]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[s];let a=t[d];t[d]=o,void 0===a&&(a=new Us(u,n[e],r[e])),t[s]=a}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,l=t[s];if(void 0!==l&&l>=i){const o=i++,c=e[o];t[c.uuid]=l,e[l]=c,t[s]=o,e[o]=a;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[l];t[l]=r,t[o]=i}}}this.nCachedObjects_=i},uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<i){const a=--i,s=e[a],c=--o,u=e[c];t[s.uuid]=l,e[l]=s,t[u.uuid]=a,e[a]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[c];t[l]=r,t[a]=i,t.pop()}}else{const i=--o,a=e[i];i>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(u);for(let n=c,r=s.length;n!==r;++n){const r=s[n];u[n]=new Us(r,e,t)}return u},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}});class Hs{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,a=new Array(o),s={endingStart:2400,endingEnd:2400};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(a);break;case 2500:default:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=2202===n;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}function Gs(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Gs.prototype=Object.assign(Object.create(a.prototype),{constructor:Gs,_bindAction:function(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new Rs(Us.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),o[e]=u}a[e].resultBuffer=u.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new oa(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?ma.findByName(r,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){const e=s.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Hs(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,i),c},existingAction:function(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?ma.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(r,e,i,o)}const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this},setTime:function(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class Ws{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Ws(void 0===this.value.clone?this.value:this.value.clone())}}function Vs(e,t,n){oi.call(this,e,t),this.meshPerAttribute=n||1}function qs(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function Xs(e,t,n,r){this.ray=new X(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new oe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Ys(e,t){return e.distance-t.distance}function Zs(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)Zs(r[e],t,n,!0)}}Vs.prototype=Object.assign(Object.create(oi.prototype),{constructor:Vs,isInstancedInterleavedBuffer:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=oi.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=oi.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(qs.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(qs.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Xs.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,n){const r=n||[];return Zs(e,this,r,t),r.sort(Ys),r},intersectObjects:function(e,t,n){const r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=e.length;n<i;n++)Zs(e[n],this,r,t);return r.sort(Ys),r}});class Js{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(c.clamp(t/this.radius,-1,1))),this}}const Ks=new u;const Qs=new _,$s=new _;class el{constructor(e,t){this.start=void 0!==e?e:new _,this.end=void 0!==t?t:new _}set(e,t){return this.start.copy(e),this.end.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new _),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new _),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new _),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Qs.subVectors(e,this.start),$s.subVectors(this.end,this.start);const n=$s.dot($s);let r=$s.dot(Qs)/n;return t&&(r=c.clamp(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new _),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}function tl(e){be.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}tl.prototype=Object.create(be.prototype),tl.prototype.constructor=tl,tl.prototype.isImmediateRenderObject=!0;const nl=new _,rl=new Y,il=new Y;const ol=new Float32Array(1),al=(new Int32Array(ol.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),sl=5+al.length,ll=new Ve({side:1,depthWrite:!1,depthTest:!1}),{_lodPlanes:cl,_sizeLods:ul,_sigmas:hl}=(new kt(new Dt,ll),dl());Math.sqrt(5);function dl(){const e=[],t=[],n=[];let r=8;for(let i=0;i<sl;i++){const o=Math.pow(2,r);t.push(o);let a=1/o;i>4?a=al[i-8+4-1]:0==i&&(a=0),n.push(a);const s=1/(o-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,f=3,p=2,m=1,g=new Float32Array(f*d*h),v=new Float32Array(p*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,f*d*e),v.set(u,p*d*e);const i=[e,e,e,e,e,e];y.set(i,m*d*e)}const b=new mt;b.setAttribute("position",new Ye(g,f)),b.setAttribute("uv",new Ye(v,p)),b.setAttribute("faceIndex",new Ye(y,m)),e.push(b),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function fl(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom"}La.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(La.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Ja.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(ja.prototype),Object.create(ja.prototype),fl.prototype=Object.create(ja.prototype),Object.assign(fl.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class extends Ki{constructor(e=10,t=10,n=4473924,r=8947848){n=new Ue(n),r=new Ue(r);const i=t/2,o=e/t,a=e/2,s=[],l=[];for(let e=0,c=0,u=-a;e<=t;e++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new mt;c.setAttribute("position",new rt(s,3)),c.setAttribute("color",new rt(l,3));super(c,new Hi({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Ki{constructor(e){const t=function e(t){const n=[];t&&t.isBone&&n.push(t);for(let r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new mt,r=[],i=[],o=new Ue(0,0,1),a=new Ue(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new rt(r,3)),n.setAttribute("color",new rt(i,3));super(n,new Hi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");il.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(rl.multiplyMatrices(il,i.matrixWorld),nl.setFromMatrixPosition(rl),r.setXYZ(n,nl.x,nl.y,nl.z),rl.multiplyMatrices(il,i.parent.matrixWorld),nl.setFromMatrixPosition(rl),r.setXYZ(n+1,nl.x,nl.y,nl.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(_a.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ps(e)}}),_a.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new u(1/0,1/0),this.max=void 0!==t?t:new u(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ks.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new u),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new u),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new u),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new u),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ks.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(M.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(B.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Yt.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},el.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(c,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),c.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),c.ceilPowerOfTwo(e)}}),Object.assign(h.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(Y.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new _).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Me.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(b.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(X.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Ie.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Ie,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ie.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ie.getNormal(e,t,n,r)}}),Object.assign(Ka.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Bo(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ho(this,e)}}),Object.assign(u.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(_.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(v.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(be.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(be.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(kt.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(kt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Ti.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ni.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Oi.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(La.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Ut.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Qa.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ye.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(Ye.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(mt.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ye(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(mt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ms.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Xs.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(oi.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(oi.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Bo.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(ii.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Ws.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(We.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ue}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Zo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Yo.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(Bt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ni.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ni.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Xr.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(y.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Ps.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Es).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ht.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ht.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)};f.crossOrigin=void 0,f.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Aa;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},f.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Ta;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},f.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},f.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125");var pl=function(){function e(e){var t=this;this.updateSize=function(){t.renderer.setSize(t.container.offsetWidth,t.container.offsetHeight)},this.renderer=null,this.container=e,this._init()}return e.prototype._init=function(){var e=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}();this.container.innerHTML="",e?(this.renderer=new ni({logarithmicDepthBuffer:!1,alpha:!0,powerPreference:"high-performance"}),this.renderer.setClearColor(0,0),this.renderer.sortObjects=!1,this.renderer.autoClear=!1,this.container.appendChild(this.renderer.domElement),this.renderer.setPixelRatio(window.devicePixelRatio),window.addEventListener("resize",this.updateSize,!1),this.updateSize()):(this.container.innerHTML="<div style='margin-bottom: 5px;'>Seems like <a target='_blank' href='https://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation'>WebGL</a> isn't supported for you.</div><div>Find out how to get it <a target='_blank' href='https://get.webgl.org/'>here</a>.</div>",this.container.style.textAlign="center",this.container.style.fontSize="18px",console.warn("WebGL Not Supported"),this.renderer=null)},e.prototype.remove=function(){window.removeEventListener("resize",this.updateSize,!1)},e}();function ml(e,t){var n,a,s,l,c;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new _,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.275,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:r,ZOOM:i,PAN:o},this.enableTwoFingerZoomPan=!1,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.flipPanUp=!1,this.getPolarAngle=function(){return y.phi},this.getAzimuthalAngle=function(){return y.theta},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(d),h.update(),g=m.NONE},this.resetPosition=function(){var e=h.object.position.y;h.object.position.copy(h.position0),h.object.position.y=e,h.object.updateProjectionMatrix(),h.dispatchEvent(d),h.update(),g=m.NONE},this.update=(n=new _,a=(new b).setFromUnitVectors(e.up,new _(0,1,0)),s=a.clone().invert(),l=new _,c=new b,function(){var e=h.object.position;return n.copy(e).sub(h.target),n.applyQuaternion(a),y.setFromVector3(n),h.autoRotate&&g===m.NONE&&N(2*Math.PI/60/60*h.autoRotateSpeed),y.theta+=x.theta,y.phi+=x.phi,y.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,y.theta)),y.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,y.phi)),y.makeSafe(),y.radius*=w,y.radius=Math.max(h.minDistance,Math.min(h.maxDistance,y.radius)),h.target.add(M),n.setFromSpherical(y),n.applyQuaternion(s),e.copy(h.target).add(n),h.object.lookAt(h.target),!0===h.enableDamping?(x.theta*=1-h.dampingFactor,x.phi*=1-h.dampingFactor):x.set(0,0,0),w=1,M.set(0,0,0),!!(S||l.distanceToSquared(h.object.position)>v||8*(1-c.dot(h.object.quaternion))>v)&&(h.dispatchEvent(d),l.copy(h.object.position),c.copy(h.object.quaternion),S=!1,!0)}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",te,!1),h.domElement.removeEventListener("mousedown",X,!1),h.domElement.removeEventListener("wheel",J,!1),h.domElement.removeEventListener("touchstart",Q,!1),h.domElement.removeEventListener("touchend",ee,!1),h.domElement.removeEventListener("touchmove",$,!1),document.removeEventListener("mousemove",Y,!1),document.removeEventListener("mouseup",Z,!1),window.removeEventListener("keydown",K,!1)};var h=this,d={type:"change"},f={type:"start"},p={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,TOUCH_DOLLY_PAN:6},g=m.NONE,v=1e-6,y=new Js,x=new Js,w=1,M=new _,S=!1,E=new u,T=new u,C=new u,A=new u,L=new u,P=new u,R=new u,O=new u,k=new u;function I(){return h.domElement===document?h.domElement.body:h.domElement}function D(e){return e=e||1,Math.pow(.95,h.zoomSpeed*e)}function N(e){x.theta-=e}function j(e){x.phi-=e}this.rotateLeft=N,this.rotateUp=j;var F,B=(F=new _,function(e,t){var n=t.elements;h.flipPanUp?F.set(n[0],0,n[2]).normalize():F.set(n[0],n[1],0).normalize(),F.multiplyScalar(-e),M.add(F)}),z=function(){var e=new _;return function(t,n){var r=n.elements;h.flipPanUp?e.set(r[4],0,r[6]).normalize():e.set(r[4],r[5],0).normalize(),e.multiplyScalar(t),M.add(e)}}(),U=function(){var e=new _;return function(t,n){var r=I();if(h.object instanceof Ut){var i=h.object.position;e.copy(i).sub(h.target);var o=e.length();o*=Math.tan(h.object.fov/2*Math.PI/180),B(2*t*o/r.clientHeight,h.object.matrix),z(2*n*o/r.clientHeight,h.object.matrix)}else h.object instanceof os?(B(t*(h.object.right-h.object.left)/h.object.zoom/r.clientWidth,h.object.matrix),z(n*(h.object.top-h.object.bottom)/h.object.zoom/r.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)}}();function H(e){h.object instanceof Ut?w/=e:h.object instanceof os?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function G(e){h.object instanceof Ut?w*=e:h.object instanceof os?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function W(e){e.deltaY<0?G(D()):e.deltaY>0&&H(D()),h.update()}function V(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);R.set(0,r)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);O.set(0,r),k.subVectors(O,R);var i=I(),o=Math.abs(k.y)/(.01*i.clientHeight);k.y>0?G(D(o)):k.y<0&&H(D(o)),R.copy(O),h.update()}function X(e){if(!1!==h.enabled){if(e.preventDefault(),e.button===h.mouseButtons.ORBIT){if(!1===h.enableRotate)return;!function(e){E.set(e.clientX,e.clientY)}(e),g=m.ROTATE}else if(e.button===h.mouseButtons.ZOOM){if(!1===h.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),g=m.DOLLY}else if(e.button===h.mouseButtons.PAN){if(!1===h.enablePan)return;!function(e){A.set(e.clientX,e.clientY)}(e),g=m.PAN}g!==m.NONE&&(document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",Z,!1),h.dispatchEvent(f))}}function Y(e){if(!1!==h.enabled)if(e.preventDefault(),g===m.ROTATE){if(!1===h.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),C.subVectors(T,E);var t=I();N(2*Math.PI*C.x/t.clientWidth*h.rotateSpeed),j(2*Math.PI*C.y/t.clientHeight*h.rotateSpeed),E.copy(T),h.update()}(e)}else if(g===m.DOLLY){if(!1===h.enableZoom)return;!function(e){O.set(e.clientX,e.clientY),k.subVectors(O,R);var t=I(),n=Math.abs(k.y)/(.01*t.clientHeight);k.y>0?H(D(n)):k.y<0&&G(D(n)),R.copy(O),h.update()}(e)}else if(g===m.PAN){if(!1===h.enablePan)return;!function(e){L.set(e.clientX,e.clientY),P.subVectors(L,A),U(P.x,P.y),A.copy(L),h.update()}(e)}}function Z(e){!1!==h.enabled&&(document.removeEventListener("mousemove",Y,!1),document.removeEventListener("mouseup",Z,!1),h.dispatchEvent(p),g=m.NONE)}function J(e){!1===h.enabled||!1===h.enableZoom||g!==m.NONE&&g!==m.ROTATE||(e.preventDefault(),W(e),h.dispatchEvent(f),h.dispatchEvent(p))}function K(e){!1!==h.enabled&&!1!==h.enableKeys&&!1!==h.enablePan&&function(e){switch(e.keyCode){case h.keys.UP:U(0,h.keyPanSpeed),h.update();break;case h.keys.BOTTOM:U(0,-h.keyPanSpeed),h.update();break;case h.keys.LEFT:U(h.keyPanSpeed,0),h.update();break;case h.keys.RIGHT:U(-h.keyPanSpeed,0),h.update()}}(e)}function Q(e){if(!1!==h.enabled){switch(e.touches.length){case 1:if(!1===h.enableRotate)return;!function(e){E.set(e.touches[0].pageX,e.touches[0].pageY)}(e),g=m.TOUCH_ROTATE;break;case 2:if(!1===h.enableZoom&&!1===h.enablePan)return;if(!0===h.enableTwoFingerZoomPan)!function(e){if(!0===h.enableZoom&&V(e),!0===h.enablePan){var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;A.set(t,n)}}(e),g=!0===h.enableZoom&&!0===h.enablePan?m.TOUCH_DOLLY_PAN:!0===h.enableZoom&&!1===h.eanblePan?m.TOUCH_DOLLY:m.TOUCH_PAN;else{if(!1===h.enableZoom)return;V(e),g=m.TOUCH_DOLLY}break;case 3:if(!1===h.enablePan)return;if(!0===h.enableTwoFingerZoomPan)return;!function(e){A.set(e.touches[0].pageX,e.touches[0].pageY)}(e),g=m.TOUCH_PAN;break;default:g=m.NONE}g!==m.NONE&&h.dispatchEvent(f)}}function $(e){if(!1!==h.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===h.enableRotate)return;if(g!==m.TOUCH_ROTATE)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY),C.subVectors(T,E);var t=I();N(2*Math.PI*C.x/t.clientWidth*h.rotateSpeed),j(2*Math.PI*C.y/t.clientHeight*h.rotateSpeed),E.copy(T),h.update()}(e);break;case 2:if(!1===h.enableZoom&&!1===h.enablePan)return;if(g!==m.TOUCH_DOLLY&&g!==m.TOUCH_PAN&&g!==m.TOUCH_DOLLY_PAN)return;if(!0===h.enableTwoFingerZoomPan)!function(e){if(!0===h.enablePan){var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;L.set(t,n),P.subVectors(L,A),U(P.x,P.y),A.copy(L),!1===h.enableZoom&&h.update()}!0===h.enableZoom&&q(e)}(e);else{if(!1===h.enableZoom)return;q(e)}break;case 3:if(!1===h.enablePan)return;if(g!==m.TOUCH_PAN)return;!function(e){L.set(e.touches[0].pageX,e.touches[0].pageY),P.subVectors(L,A),U(P.x,P.y),A.copy(L),h.update()}(e);break;default:g=m.NONE}}function ee(e){!1!==h.enabled&&(h.dispatchEvent(p),g=m.NONE)}function te(e){e.preventDefault()}this.handleMouseWheel=W,h.domElement.addEventListener("contextmenu",te,!1),h.domElement.addEventListener("mousedown",X,!1),h.domElement.addEventListener("wheel",J,!1),h.domElement.addEventListener("touchstart",Q,!1),h.domElement.addEventListener("touchend",ee,!1),h.domElement.addEventListener("touchmove",$,!1),window.addEventListener("keydown",K,!1),this.update()}function gl(e){var t=this;e.rotation.set(0,0,0);var n=new be;n.add(e);var r=new be;r.position.y=10,r.add(n);var i,o,a=Math.PI/2,s=function(e){if(!1!==t.enabled){var i=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0;r.rotation.y-=.002*i,n.rotation.x-=.002*o,n.rotation.x=Math.max(-a,Math.min(a,n.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",s,!1)},document.addEventListener("mousemove",s,!1),this.enabled=!1,this.getObject=function(){return r},this.getPitchObject=function(){return n},this.getDirection=(i=new _(0,0,-1),o=new ne(0,0,0,"YXZ"),function(e){return o.set(n.rotation.x,r.rotation.y,0),e.copy(i).applyEuler(o),e})}ml.prototype=Object.create(a.prototype),ml.prototype.constructor=ml,Object.defineProperties(ml.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var vl={getIn:function(e,t,n){if(null==e)return null!=n?n:null;if("string"==typeof t&&(t=t.split(".")),null==t)return null!=n?n:null;for(var r=Object.assign({},e),i=0;i<t.length;i++){if(!r.hasOwnProperty(t[i]))return null!=n?n:null;r=r[t[i]]}return r},mod:function(e,t){var n=e%t;return Math.floor(n>=0?n:n+t)},findHighestMaxZoom:function(e){var t=0;for(var n in e)"Vectors As Tiles"!=e[n].name&&e[n].maxZoom>t&&(t=e[n].maxZoom);return t},findLowestMinZoom:function(e){var t=1/0;for(var n in e)"_vectorsastile_"!==e[n].path&&e[n].minZoom<t&&(t=e[n].minZoom);return t},isInExtent:function(e,t,n){var r=!0;if(t){var i=e.x+0,o=e.y+0,a=n.tileXYZ2LatLng(i,o,e.z),s=a.lat,l=a.lng;r=s<t[3]&&s>t[1]&&l<t[2]&&l>t[0],i=e.x+1,o=e.y+0,s=(a=n.tileXYZ2LatLng(i,o,e.z)).lat,l=a.lng,r=r||s<t[3]&&s>t[1]&&l<t[2]&&l>t[0],i=e.x+1,o=e.y+1,s=(a=n.tileXYZ2LatLng(i,o,e.z)).lat,l=a.lng,r=r||s<t[3]&&s>t[1]&&l<t[2]&&l>t[0],i=e.x+0,o=e.y+1,s=(a=n.tileXYZ2LatLng(i,o,e.z)).lat,l=a.lng,r=r||s<t[3]&&s>t[1]&&l<t[2]&&l>t[0]}return r},isInExtentEN:function(e,t,n,r){if(void 0===r&&(r=1e-7),!t)return!0;var i=t[0],o=t[1],a=t[2],s=t[3],l=n.tileXYZ2NwSe(e,n.trueTileResolution,!0),c=l.min,u=l.max;return u.x>i+r&&c.x<a-r&&u.y>o+r&&c.y<s-r},clone:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,r=e.length;n<r;n++)t[n]=vl.clone(e[n]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=vl.clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},getExtension:function(e){return/(?:\.([^.]+))?$/.exec(e)[1]||""},getRadiansPerPixel:function(e){return 360/Math.pow(2,e)*(Math.PI/180)/256},lastTileContains:[],tileContains:function(e,t,n){if(n)for(var r=0;r<vl.lastTileContains.length;r++){var i=vl.lastTileContains[r].call.xyz;if(i[0]==e[0]&&i[1]==e[1]&&i[2]==e[2]&&vl.lastTileContains[r].call.z==t)return vl.lastTileContains[r].result}for(var o=[],a=Math.pow(2,t)/Math.pow(2,e[2]),s=[(e[0]+1)*a-1,(e[1]+1)*a-1],l=[s[0]-a+1,s[1]-a+1],c=l[0];c<=s[0];c++)for(var u=l[1];u<=s[1];u++)o.push([c,u,t]);return vl.lastTileContains.unshift({call:{xyz:e,z:t},result:o}),vl.lastTileContains.length>3&&vl.lastTileContains.pop(),o},tileIsContained:function(e,t,n){for(var r=this.tileContains(e,t[2],n),i=0;i<r.length;i++)if(r[i][0]==t[0]&&r[i][1]==t[1])return!0;return!1},arrayAverage:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=null!=t?e[r][t]:e[r];return n/e.length},hexToRGB:function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},rotatePoint:function(e,t,n){var r=Math.cos(n),i=Math.sin(n),o=e.x-t[0],a=e.y-t[1];return{x:t[0]+o*r-a*i,y:t[1]+o*i+a*r}},rotateAroundArbAxis:function(e,t,n,r){e.updateWorldMatrix(!0);var i=e.getWorldQuaternion(new b).invert();t.applyQuaternion(i);var o=new b;o.setFromAxisAngle(t,n),e.quaternion.multiply(o)},getParamString:function(e,t,n){var r=[],i=new URLSearchParams(t.toUpperCase());for(var o in e)i.has(o.toUpperCase())||r.push(encodeURIComponent(n?o.toUpperCase():o)+"="+encodeURIComponent(e[o]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},setChildrenMaterialOpacity:function(e,t,n){e.children.forEach((function(e){e.material&&(e.material.transparent=!0,e.material.opacity=t),"function"==typeof n&&e.children&&e.children.length>0&&n(e)}))},setAllMaterialOpacity:function(e,t){e.material&&(e.material.transparent=!0,e.material.opacity=t),vl.setChildrenMaterialOpacity(e,t,(function(e){vl.setAllMaterialOpacity(e,t)}))}},yl=vl,bl=function(){function e(e,t,n,r){var i=this;this.onKeyDown=function(e){if(!i.firstPerson.lockControls)switch(i.isShift=e.shiftKey,e.keyCode){case 38:case 87:i.moveForward=!0;break;case 37:case 65:i.moveLeft=!0;break;case 40:case 83:i.moveBackward=!0;break;case 39:case 68:i.moveRight=!0;break;case 32:!0===i.canJump&&(i.velocity.y+=350),i.canJump=!1}},this.onKeyUp=function(e){if(!i.firstPerson.lockControls)switch(i.isShift=e.shiftKey,e.keyCode){case 38:case 87:i.moveForward=!1;break;case 37:case 65:i.moveLeft=!1;break;case 40:case 83:i.moveBackward=!1;break;case 39:case 68:i.moveRight=!1}},this.updateSize=function(){i.orbit.camera.aspect=i.sceneContainer.offsetWidth/i.sceneContainer.offsetHeight,i.orbit.camera.updateProjectionMatrix(),i.firstPerson.camera.aspect=i.sceneContainer.offsetWidth/i.sceneContainer.offsetHeight,i.firstPerson.camera.updateProjectionMatrix()},this.setNearFarPlane=function(e,t,n,r){!0===r&&(i._.keepNear=!0),!1===r&&(i._.keepNear=!1),e?i._.keepNear||(i.orbit.camera.near=1e4*i.orbit.near):(i._.keepNear||(i.orbit.camera.near=i.orbit.near),i.orbit.camera.far=i.orbit.far),null!=t&&(i.orbit.camera.near=t),null!=n&&(i.orbit.camera.far=n),i.orbit.camera.updateProjectionMatrix()},this.setFirstPersonHeight=function(e){i.firstPerson.height=e||3},this.getFirstPersonFocalLength=function(){return i.firstPerson.camera.getFocalLength()},this.setFirstPersonFocalLength=function(e){i.firstPerson.camera.setFocalLength(e)},this.getFirstPersonFOV=function(){return i.firstPerson.camera.fov},this.setFirstPersonFOV=function(e){i.firstPerson.camera.fov=e,i.firstPerson.camera.updateProjectionMatrix()},this.getFirstPersonAspect=function(){return i.firstPerson.camera.aspect},this.setFirstPersonAspect=function(e){i.firstPerson.camera.aspect=e,i.firstPerson.camera.updateProjectionMatrix()},this.setCameraAzimuthElevation=function(e,t,n){i.firstPerson.controls.getObject().rotation.y=(180-e)*(Math.PI/180),i.firstPerson.controls.getPitchObject().rotation.x=t*(Math.PI/180)},this.update=function(){if(i.isFirstPerson){var e=performance.now(),t=(e-i.prevTime)/1e3;i.prevTime=e,i.velocity.x-=10*i.velocity.x*t,i.velocity.z-=10*i.velocity.z*t,i.velocity.y-=9.8*100*t,i.moveForward&&(i.velocity.z-=1e3*t),i.moveBackward&&(i.velocity.z+=1e3*t),i.moveLeft&&(i.velocity.x-=1e3*t),i.moveRight&&(i.velocity.x+=1e3*t);var n=yl.rotatePoint({x:i.velocity.x*t,y:i.velocity.z*t},[0,0],-i.firstPerson.controls.getObject().rotation.y);return i.isShift?(n.x*=7,n.y*=7):(n.x*=3,n.y*=3),new u(n.x,n.y)}return null},this.container=e,this.sceneContainer=t,this.reset(),this._init(n,r)}return e.prototype.reset=function(){this.camera=null,this.controls=null,this.orbit={camera:null,controls:null,near:.1,far:15e9},this.firstPerson={camera:null,controls:null,lockControls:!1,height:3},this.isFirstPerson=!1,this._={keepNear:!1,crosshair:null},this.isShift=!1,this.moveForward=null,this.moveBackward=null,this.moveLeft=null,this.moveRight=null,this.canJump=null,this.prevTime=performance.now(),this.velocity=new _},e.prototype._init=function(e,t){this.orbit.camera=new Ut(60,this.sceneContainer.offsetWidth/this.sceneContainer.offsetHeight,this.orbit.near,this.orbit.far),this.orbit.camera.up=new _(0,-1,0),this.orbit.camera.position.set(0,-1e7/t.radiusScale,0),this.orbit.controls=new ml(this.orbit.camera,this.sceneContainer),this.orbit.controls.enabled=!0,this.orbit.controls.enableDamping=!0,this.orbit.controls.dampingFactor=.2,this.orbit.controls.target.y=1,this.orbit.controls.mouseButtons.ORBIT=o,this.orbit.controls.mouseButtons.PAN=r,this.orbit.controls.maxDistance=4*t.radii.major,this.orbit.controls.maxPolarAngle=Math.PI/2,this.orbit.controls.enablePan=!1,this.firstPerson.camera=new Ut(60,this.sceneContainer.offsetWidth/this.sceneContainer.offsetHeight,.1,15e7),this.firstPerson.controls=new gl(this.firstPerson.camera),this.firstPerson.controls.getObject().rotation.set(Math.PI,Math.PI,0),this.firstPerson.controls.getObject().position.set(0,1e7/t.radiusScale,0),e.add(this.firstPerson.controls.getObject()),this.isFirstPerson?this.requestPointerLocking():(this.camera=this.orbit.camera,this.controls=this.orbit.controls),this.updateSize(),this.setupEvents(),this.orbit.controls.update()},e.prototype.swap=function(e,t){this.isFirstPerson=!this.isFirstPerson,this.isFirstPerson?(this.firstPerson.lockControls=e||!1,t||this.requestPointerLocking(),this.inToFirstPerson()):(this.outFromFirstPerson(),this.camera=this.orbit.camera,this.controls=this.orbit.controls)},e.prototype.inToFirstPerson=function(){this.isFirstPerson=!0,this.toggleCrosshair(!0),this.camera=this.firstPerson.camera,this.firstPerson.controls.enabled=!this.firstPerson.lockControls,this.controls=this.firstPerson.controls,this.orbit.controls.resetPosition()},e.prototype.outFromFirstPerson=function(){this.isFirstPerson=!1,this.toggleCrosshair(!1),this.firstPerson.controls.enabled=!1,this.camera=this.orbit.camera,this.controls=this.orbit.controls},e.prototype.toggleCrosshair=function(e){null==this._.crosshair&&(this._.crosshair=document.createElement("div"),this._.crosshair.id="_lithosphere_crosshair",this._.crosshair.style=["position: absolute","left: calc(50% - 10px)","top: calc(50% - 10px)","width: 18px","height: 18px","border-radius: 15px","border: 3px solid lime"].join(";"),this.container.appendChild(this._.crosshair)),this._.crosshair.style.display=e?"inherit":"none"},e.prototype.requestPointerLocking=function(){var e=this;if("pointerLockElement"in document){var t=document.body,n=function(){document.pointerLockElement===t?e.inToFirstPerson():e.outFromFirstPerson()},r=function(e){alert("Pointer Lock Error")};if(document.addEventListener("pointerlockchange",n,!1),document.addEventListener("mozpointerlockchange",n,!1),document.addEventListener("webkitpointerlockchange",n,!1),document.addEventListener("pointerlockerror",r,!1),document.addEventListener("mozpointerlockerror",r,!1),document.addEventListener("webkitpointerlockerror",r,!1),/Firefox/i.test(navigator.userAgent)){var i=function(){document.fullscreenElement===t&&(document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),t.requestPointerLock())};document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),t.requestFullscreen()}else t.requestPointerLock()}else this.isFirstPerson=!1,alert("This browser does not support Pointer Locking.")},e.prototype.setupEvents=function(){document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("resize",this.updateSize,!1)},e}(),_l=484813681109536e-20,xl=Math.PI/2,wl=.017453292519943295,Ml=57.29577951308232,Sl=Math.PI/4,El=2*Math.PI,Tl=3.14159265359,Cl={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Al={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Ll=/[\s_\-\/\(\)]/g;function Pl(e,t){if(e[t])return e[t];for(var n,r=Object.keys(e),i=t.toLowerCase().replace(Ll,""),o=-1;++o<r.length;)if((n=r[o]).toLowerCase().replace(Ll,"")===i)return e[n]}var Rl=function(e){var t,n,r,i={},o=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var n=t.split("=");return n.push(!0),e[n[0].toLowerCase()]=n[1],e}),{}),a={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*wl},lat_1:function(e){i.lat1=e*wl},lat_2:function(e){i.lat2=e*wl},lat_ts:function(e){i.lat_ts=e*wl},lon_0:function(e){i.long0=e*wl},lon_1:function(e){i.long1=e*wl},lon_2:function(e){i.long2=e*wl},alpha:function(e){i.alpha=parseFloat(e)*wl},lonc:function(e){i.longc=e*wl},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=Pl(Al,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*wl},pm:function(e){var t=Pl(Cl,e);i.from_greenwich=(t||parseFloat(e))*wl},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){3===e.length&&-1!=="ewnsud".indexOf(e.substr(0,1))&&-1!=="ewnsud".indexOf(e.substr(1,1))&&-1!=="ewnsud".indexOf(e.substr(2,1))&&(i.axis=e)},approx:function(){i.approx=!0}};for(t in o)n=o[t],t in a?"function"==typeof(r=a[t])?r(n):i[r]=n:i[t]=n;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i},Ol=function(e){return new Fl(e).output()},kl=/\s/,Il=/[A-Za-z]/,Dl=/[A-Za-z84]/,Nl=/[,\]]/,jl=/[\d\.E\-\+]/;function Fl(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function Bl(e,t,n){Array.isArray(t)&&(n.unshift(t),t=null);var r=t?{}:e,i=n.reduce((function(e,t){return zl(t,e),e}),r);t&&(e[t]=i)}function zl(e,t){if(Array.isArray(e)){var n=e.shift();if("PARAMETER"===n&&(n=e.shift()),1===e.length)return Array.isArray(e[0])?(t[n]={},void zl(e[0],t[n])):void(t[n]=e[0]);if(e.length)if("TOWGS84"!==n){if("AXIS"===n)return n in t||(t[n]=[]),void t[n].push(e);var r;switch(Array.isArray(n)||(t[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[n]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&zl(e[2],t[n]));case"SPHEROID":case"ELLIPSOID":return t[n]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&zl(e[3],t[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void Bl(t,n,e);default:for(r=-1;++r<e.length;)if(!Array.isArray(e[r]))return zl(e,t[n]);return Bl(t,n,e)}}else t[n]=e;else t[n]=!0}else t[e]=!0}Fl.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;kl.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case 1:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},Fl.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(Nl.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},Fl.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Fl.prototype.number=function(e){if(!jl.test(e)){if(Nl.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},Fl.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},Fl.prototype.keyword=function(e){if(Dl.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=1)}if(!Nl.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},Fl.prototype.neutral=function(e){if(Il.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(jl.test(e))return this.word=e,void(this.state=3);if(!Nl.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},Fl.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Ul(e){return.017453292519943295*e}var Hl=function(e){var t=Ol(e),n=t.shift(),r=t.shift();t.unshift(["name",r]),t.unshift(["type",n]);var i={};return zl(t,i),function(e){if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",n=0,r=e.AXIS.length;n<r;++n){var i=e.AXIS[n][0].toLowerCase();-1!==i.indexOf("north")?t+="n":-1!==i.indexOf("south")?t+="s":-1!==i.indexOf("east")?t+="e":-1!==i.indexOf("west")&&(t+="w")}2===t.length&&(t+="u"),3===t.length&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;function a(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(e.datum_params=o.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ul],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ul],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Ul],["lat0","latitude_of_origin",Ul],["lat0","standard_parallel_1",Ul],["lat1","standard_parallel_1",Ul],["lat2","standard_parallel_2",Ul],["azimuth","Azimuth"],["alpha","azimuth",Ul],["srsCode","name"]].forEach((function(t){return n=e,i=(r=t)[0],o=r[1],void(!(i in n)&&o in n&&(n[i]=n[o],3===r.length&&(n[i]=r[2](n[i]))));var n,r,i,o})),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=Ul(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(i),i};function Gl(e){var t=this;if(2===arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?Gl[e]=Rl(arguments[1]):Gl[e]=Hl(arguments[1]):Gl[e]=n}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){Array.isArray(e)?Gl.apply(t,e):Gl(e)}));if("string"==typeof e){if(e in Gl)return Gl[e]}else"EPSG"in e?Gl["EPSG:"+e.EPSG]=e:"ESRI"in e?Gl["ESRI:"+e.ESRI]=e:"IAU2000"in e?Gl["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(Gl);var Wl=Gl;var Vl=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var ql=["3857","900913","3785","102113"];var Xl=function(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in Wl}(e))return Wl[e];if(function(e){return Vl.some((function(t){return e.indexOf(t)>-1}))}(e)){var t=Hl(e);if(function(e){var t=Pl(e,"authority");if(t){var n=Pl(t,"epsg");return n&&ql.indexOf(n)>-1}}(t))return Wl["EPSG:3857"];var n=function(e){var t=Pl(e,"extension");if(t)return Pl(t,"proj4")}(t);return n?Rl(n):t}return function(e){return"+"===e[0]}(e)?Rl(e):void 0},Yl=function(e,t){var n,r;if(e=e||{},!t)return e;for(r in t)void 0!==(n=t[r])&&(e[r]=n);return e},Zl=function(e,t,n){var r=e*t;return n/Math.sqrt(1-r*r)},Jl=function(e){return e<0?-1:1},Kl=function(e){return Math.abs(e)<=Tl?e:e-Jl(e)*El},Ql=function(e,t,n){var r=e*n,i=.5*e;return r=Math.pow((1-r)/(1+r),i),Math.tan(.5*(xl-t))/r},$l=function(e,t){for(var n,r,i=.5*e,o=xl-2*Math.atan(t),a=0;a<=15;a++)if(n=e*Math.sin(o),o+=r=xl-2*Math.atan(t*Math.pow((1-n)/(1+n),i))-o,Math.abs(r)<=1e-10)return o;return-9999};function ec(e){return e}var tc=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Zl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,n,r=e.x,i=e.y;if(i*Ml>90&&i*Ml<-90&&r*Ml>180&&r*Ml<-180)return null;if(Math.abs(Math.abs(i)-xl)<=1e-10)return null;if(this.sphere)t=this.x0+this.a*this.k0*Kl(r-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(Sl+.5*i));else{var o=Math.sin(i),a=Ql(this.e,i,o);t=this.x0+this.a*this.k0*Kl(r-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return e.x=t,e.y=n,e},inverse:function(e){var t,n,r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)n=xl-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(n=$l(this.e,o)))return null}return t=Kl(this.long0+r/(this.a*this.k0)),e.x=t,e.y=n,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:ec,inverse:ec,names:["longlat","identity"]}],nc={},rc=[];function ic(e,t){var n=rc.length;return e.names?(rc[n]=e,e.names.forEach((function(e){nc[e.toLowerCase()]=n})),this):(console.log(t),!0)}var oc={start:function(){tc.forEach(ic)},add:ic,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==nc[t]&&rc[nc[t]]?rc[nc[t]]:void 0}},ac={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},sc=ac.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ac.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var lc={};lc.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},lc.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},lc.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},lc.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},lc.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},lc.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},lc.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},lc.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},lc.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},lc.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},lc.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},lc.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},lc.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},lc.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},lc.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},lc.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},lc.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var cc=function(e,t,n,r,i,o,a){var s={};return s.datum_type=void 0===e||"none"===e?5:4,t&&(s.datum_params=t.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=1),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=2,s.datum_params[3]*=_l,s.datum_params[4]*=_l,s.datum_params[5]*=_l,s.datum_params[6]=s.datum_params[6]/1e6+1))),a&&(s.datum_type=3,s.grids=a),s.a=n,s.b=r,s.es=i,s.ep2=o,s},uc={};function hc(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:uc[e]||null,isNull:!1}}function dc(e){return e/3600*Math.PI/180}function fc(e,t,n){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,n)))}function pc(e){return e.map((function(e){return[dc(e.longitudeShift),dc(e.latitudeShift)]}))}function mc(e,t,n){return{name:fc(e,t+8,t+16).trim(),parent:fc(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,n),upperLatitude:e.getFloat64(t+88,n),lowerLongitude:e.getFloat64(t+104,n),upperLongitude:e.getFloat64(t+120,n),latitudeInterval:e.getFloat64(t+136,n),longitudeInterval:e.getFloat64(t+152,n),gridNodeCount:e.getInt32(t+168,n)}}function gc(e,t,n,r){for(var i=t+176,o=[],a=0;a<n.gridNodeCount;a++){var s={latitudeShift:e.getFloat32(i+16*a,r),longitudeShift:e.getFloat32(i+16*a+4,r),latitudeAccuracy:e.getFloat32(i+16*a+8,r),longitudeAccuracy:e.getFloat32(i+16*a+12,r)};o.push(s)}return o}function vc(e,t){if(!(this instanceof vc))return new vc(e);t=t||function(e){if(e)throw e};var n=Xl(e);if("object"==typeof n){var r=vc.projections.get(n.projName);if(r){if(n.datumCode&&"none"!==n.datumCode){var i=Pl(lc,n.datumCode);i&&(n.datum_params=i.towgs84?i.towgs84.split(","):null,n.ellps=i.ellipse,n.datumName=i.datumName?i.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84";var o,a,s,l,c,u,h,d=function(e,t,n,r,i){if(!e){var o=Pl(ac,r);o||(o=sc),e=o.a,t=o.b,n=o.rf}return n&&!t&&(t=(1-1/n)*e),(0===n||Math.abs(e-t)<1e-10)&&(i=!0,t=e),{a:e,b:t,rf:n,sphere:i}}(n.a,n.b,n.rf,n.ellps,n.sphere),f=(o=d.a,a=d.b,d.rf,s=n.R_A,u=((l=o*o)-(c=a*a))/l,h=0,s?(l=(o*=1-u*(.16666666666666666+u*(.04722222222222222+.022156084656084655*u)))*o,u=0):h=Math.sqrt(u),{es:u,e:h,ep2:(l-c)/c}),p=function(e){return void 0===e?null:e.split(",").map(hc)}(n.nadgrids),m=n.datum||cc(n.datumCode,n.datum_params,d.a,d.b,f.es,f.ep2,p);Yl(this,n),Yl(this,r),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=m,this.init(),t(null,this)}else t(e)}else t(e)}vc.projections=oc,vc.projections.start();var yc=vc;function bc(e,t,n){var r,i,o,a,s=e.x,l=e.y,c=e.z?e.z:0;if(l<-xl&&l>-1.001*xl)l=-xl;else if(l>xl&&l<1.001*xl)l=xl;else{if(l<-xl)return{x:-1/0,y:-1/0,z:e.z};if(l>xl)return{x:1/0,y:1/0,z:e.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),o=i*i,{x:((r=n/Math.sqrt(1-t*o))+c)*a*Math.cos(s),y:(r+c)*a*Math.sin(s),z:(r*(1-t)+c)*i}}function _c(e,t,n,r){var i,o,a,s,l,c,u,h,d,f,p,m,g,v,y,b=e.x,_=e.y,x=e.z?e.z:0;if(i=Math.sqrt(b*b+_*_),o=Math.sqrt(b*b+_*_+x*x),i/n<1e-12){if(v=0,o/n<1e-12)return xl,y=-r,{x:e.x,y:e.y,z:e.z}}else v=Math.atan2(_,b);a=x/o,h=(s=i/o)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*s*s)),d=a*l,g=0;do{g++,c=t*(u=n/Math.sqrt(1-t*d*d))/(u+(y=i*h+x*d-u*(1-t*d*d))),m=(p=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(f=s*(1-c)*l)*d,h=f,d=p}while(m*m>1e-24&&g<30);return{x:v,y:Math.atan(p/Math.abs(f)),z:y}}function xc(e){return 1===e||2===e}var wc=function(e,t,n){if(function(e,t){return e.datum_type===t.datum_type&&(!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]))}(e,t))return n;if(5===e.datum_type||5===t.datum_type)return n;var r=e.a,i=e.es;if(3===e.datum_type){if(0!==Mc(e,!1,n))return;r=6378137,i=.0066943799901413165}var o=t.a,a=t.b,s=t.es;if(3===t.datum_type&&(o=6378137,a=6356752.314,s=.0066943799901413165),i===s&&r===o&&!xc(e.datum_type)&&!xc(t.datum_type))return n;if((n=bc(n,i,r),xc(e.datum_type)&&(n=function(e,t,n){if(1===t)return{x:e.x+n[0],y:e.y+n[1],z:e.z+n[2]};if(2===t){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6];return{x:c*(e.x-l*e.y+s*e.z)+r,y:c*(l*e.x+e.y-a*e.z)+i,z:c*(-s*e.x+a*e.y+e.z)+o}}}(n,e.datum_type,e.datum_params)),xc(t.datum_type)&&(n=function(e,t,n){if(1===t)return{x:e.x-n[0],y:e.y-n[1],z:e.z-n[2]};if(2===t){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=(e.x-r)/c,h=(e.y-i)/c,d=(e.z-o)/c;return{x:u+l*h-s*d,y:-l*u+h+a*d,z:s*u-a*h+d}}}(n,t.datum_type,t.datum_params)),n=_c(n,s,o,a),3===t.datum_type)&&0!==Mc(t,!0,n))return;return n};function Mc(e,t,n){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;for(var r={x:-n.x,y:n.y},i={x:Number.NaN,y:Number.NaN},o=[],a=0;a<e.grids.length;a++){var s=e.grids[a];if(o.push(s.name),s.isNull){i=r;break}if(s.mandatory,null!==s.grid){var l=s.grid.subgrids[0],c=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,u=l.ll[0]-c,h=l.ll[1]-c,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+c,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+c;if(!(h>r.y||u>r.x||f<r.y||d<r.x||(i=Sc(r,t,l),isNaN(i.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*Ml+" "+r.y*Ml+" tried: '"+o+"'"),-1):(n.x=-i.x,n.y=i.y,0)}function Sc(e,t,n){var r={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return r;var i={x:e.x,y:e.y};i.x-=n.ll[0],i.y-=n.ll[1],i.x=Kl(i.x-Math.PI)+Math.PI;var o=Ec(i,n);if(t){if(isNaN(o.x))return r;o.x=i.x-o.x,o.y=i.y-o.y;var a,s,l=9;do{if(s=Ec(o,n),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:i.x-(s.x+o.x),y:i.y-(s.y+o.y)},o.x+=a.x,o.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=Kl(o.x+n.ll[0]),r.y=o.y+n.ll[1]}else isNaN(o.x)||(r.x=e.x+o.x,r.y=e.y+o.y);return r}function Ec(e,t){var n,r={x:e.x/t.del[0],y:e.y/t.del[1]},i=Math.floor(r.x),o=Math.floor(r.y),a=r.x-1*i,s=r.y-1*o,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=t.lim[0])return l;if(o<0||o>=t.lim[1])return l;n=o*t.lim[0]+i;var c=t.cvs[n][0],u=t.cvs[n][1];n++;var h=t.cvs[n][0],d=t.cvs[n][1];n+=t.lim[0];var f=t.cvs[n][0],p=t.cvs[n][1];n--;var m=t.cvs[n][0],g=t.cvs[n][1],v=a*s,y=a*(1-s),b=(1-a)*(1-s),_=(1-a)*s;return l.x=b*c+y*h+_*m+v*f,l.y=b*u+y*d+_*g+v*p,l}var Tc=function(e,t,n){var r,i,o,a=n.x,s=n.y,l=n.z||0,c={};for(o=0;o<3;o++)if(!t||2!==o||void 0!==n.z)switch(0===o?(r=a,i=-1!=="ew".indexOf(e.axis[o])?"x":"y"):1===o?(r=s,i=-1!=="ns".indexOf(e.axis[o])?"y":"x"):(r=l,i="z"),e.axis[o]){case"e":c[i]=r;break;case"w":c[i]=-r;break;case"n":c[i]=r;break;case"s":c[i]=-r;break;case"u":void 0!==n[i]&&(c.z=r);break;case"d":void 0!==n[i]&&(c.z=-r);break;default:return null}return c},Cc=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t};function Ac(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Lc(e,t,n){var r;if(Array.isArray(n)&&(n=Cc(n)),function(e){Ac(e.x),Ac(e.y)}(n),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(n=Lc(e,r=new yc("WGS84"),n),e=r),"enu"!==e.axis&&(n=Tc(e,!1,n)),"longlat"===e.projName)n={x:n.x*wl,y:n.y*wl,z:n.z||0};else if(e.to_meter&&(n={x:n.x*e.to_meter,y:n.y*e.to_meter,z:n.z||0}),!(n=e.inverse(n)))return;if(e.from_greenwich&&(n.x+=e.from_greenwich),n=wc(e.datum,t.datum,n))return t.from_greenwich&&(n={x:n.x-t.from_greenwich,y:n.y,z:n.z||0}),"longlat"===t.projName?n={x:n.x*Ml,y:n.y*Ml,z:n.z||0}:(n=t.forward(n),t.to_meter&&(n={x:n.x/t.to_meter,y:n.y/t.to_meter,z:n.z||0})),"enu"!==t.axis?Tc(t,!0,n):n}var Pc=yc("WGS84");function Rc(e,t,n){var r,i,o;return Array.isArray(n)?(r=Lc(e,t,n)||{x:NaN,y:NaN},n.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(i=Lc(e,t,n),2===(o=Object.keys(n)).length||o.forEach((function(r){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===r||"y"===r||"z"===r)return}else if("x"===r||"y"===r)return;i[r]=n[r]})),i)}function Oc(e){return e instanceof yc?e:e.oProj?e.oProj:yc(e)}var kc=function(e,t,n){e=Oc(e);var r,i=!1;return void 0===t?(t=e,e=Pc,i=!0):(void 0!==t.x||Array.isArray(t))&&(n=t,t=e,e=Pc,i=!0),t=Oc(t),n?Rc(e,t,n):(r={forward:function(n){return Rc(e,t,n)},inverse:function(n){return Rc(t,e,n)}},i&&(r.oProj=t),r)},Ic=73,Dc=79,Nc={forward:jc,inverse:function(e){var t=Uc(Wc(e.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:Fc};function jc(e,t){return t=t||5,function(e,t){var n="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(f=e.easting,p=e.northing,m=e.zoneNumber,g=Gc(m),v=Math.floor(f/1e5),y=Math.floor(p/1e5)%20,i=v,o=y,a=g,s=a-1,l="AJSAJS".charCodeAt(s),c="AFAFAF".charCodeAt(s),u=l+i-1,h=c+o,d=!1,u>90&&(u=u-90+65-1,d=!0),(u===Ic||l<Ic&&u>Ic||(u>Ic||l<Ic)&&d)&&u++,(u===Dc||l<Dc&&u>Dc||(u>Dc||l<Dc)&&d)&&++u===Ic&&u++,u>90&&(u=u-90+65-1),h>86?(h=h-86+65-1,d=!0):d=!1,(h===Ic||c<Ic&&h>Ic||(h>Ic||c<Ic)&&d)&&h++,(h===Dc||c<Dc&&h>Dc||(h>Dc||c<Dc)&&d)&&++h===Ic&&h++,h>86&&(h=h-86+65-1),String.fromCharCode(u)+String.fromCharCode(h))+n.substr(n.length-5,t)+r.substr(r.length-5,t);var i,o,a,s,l,c,u,h,d;var f,p,m,g,v,y}(function(e){var t,n,r,i,o,a,s,l=e.lat,c=e.lon,u=6378137,h=Bc(l),d=Bc(c);s=Math.floor((c+180)/6)+1,180===c&&(s=60);l>=56&&l<64&&c>=3&&c<12&&(s=32);l>=72&&l<84&&(c>=0&&c<9?s=31:c>=9&&c<21?s=33:c>=21&&c<33?s=35:c>=33&&c<42&&(s=37));a=Bc(6*(s-1)-180+3),.006739496752268451,t=u/Math.sqrt(1-.00669438*Math.sin(h)*Math.sin(h)),n=Math.tan(h)*Math.tan(h),r=.006739496752268451*Math.cos(h)*Math.cos(h),i=Math.cos(h)*(d-a),o=u*(.9983242984503243*h-.002514607064228144*Math.sin(2*h)+2639046602129982e-21*Math.sin(4*h)-3.418046101696858e-9*Math.sin(6*h));var f=.9996*t*(i+(1-n+r)*i*i*i/6+(5-18*n+n*n+72*r-.39089081163157013)*i*i*i*i*i/120)+5e5,p=.9996*(o+t*Math.tan(h)*(i*i/2+(5-n+9*r+4*r*r)*i*i*i*i/24+(61-58*n+n*n+600*r-2.2240339282485886)*i*i*i*i*i*i/720));l<0&&(p+=1e7);return{northing:Math.round(p),easting:Math.round(f),zoneNumber:s,zoneLetter:Hc(l)}}({lat:e[1],lon:e[0]}),t)}function Fc(e){var t=Uc(Wc(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Bc(e){return e*(Math.PI/180)}function zc(e){return e/Math.PI*180}function Uc(e){var t=e.northing,n=e.easting,r=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,h,d,f=6378137,p=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=n-5e5,g=t;r<"N"&&(g-=1e7),u=6*(i-1)-180+3,d=(h=g/.9996/6367449.145945056)+(3*p/2-27*p*p*p/32)*Math.sin(2*h)+(21*p*p/16-55*p*p*p*p/32)*Math.sin(4*h)+151*p*p*p/96*Math.sin(6*h),o=f/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),s=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*f/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),c=m/(.9996*o);var v=d-o*Math.tan(d)/l*(c*c/2-(5+3*a+10*s-4*s*s-.06065547077041606)*c*c*c*c/24+(61+90*a+298*s+45*a*a-1.6983531815716497-3*s*s)*c*c*c*c*c*c/720);v=zc(v);var y,b=(c-(1+2*a+s)*c*c*c/6+(5-2*s+28*a-3*s*s+.05391597401814761+24*a*a)*c*c*c*c*c/120)/Math.cos(d);if(b=u+zc(b),e.accuracy){var _=Uc({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});y={top:_.lat,right:_.lon,bottom:v,left:b}}else y={lat:v,lon:b};return y}function Hc(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function Gc(e){var t=e%6;return 0===t&&(t=6),t}function Wc(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,n=e.length,r=null,i="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,o++}var a=parseInt(i,10);if(0===o||o+3>n)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;r=e.substring(o,o+=2);for(var l=Gc(a),c=function(e,t){var n="AJSAJS".charCodeAt(t-1),r=1e5,i=!1;for(;n!==e.charCodeAt(0);){if(++n===Ic&&n++,n===Dc&&n++,n>90){if(i)throw"Bad character: "+e;n=65,i=!0}r+=1e5}return r}(r.charAt(0),l),u=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;var n="AFAFAF".charCodeAt(t-1),r=0,i=!1;for(;n!==e.charCodeAt(0);){if(++n===Ic&&n++,n===Dc&&n++,n>86){if(i)throw"Bad character: "+e;n=65,i=!0}r+=1e5}return r}(r.charAt(1),l);u<Vc(s);)u+=2e6;var h=n-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,f,p,m=h/2,g=0,v=0;return m>0&&(d=1e5/Math.pow(10,m),f=e.substring(o,o+m),g=parseFloat(f)*d,p=e.substring(o+m),v=parseFloat(p)*d),{easting:g+c,northing:v+u,zoneLetter:s,zoneNumber:a,accuracy:d}}function Vc(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function qc(e,t,n){if(!(this instanceof qc))return new qc(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}qc.fromMGRS=function(e){return new qc(Fc(e))},qc.prototype.toMGRS=function(e){return jc([this.x,this.y],e)};var Xc=qc,Yc=.01068115234375,Zc=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+e*Yc))),t[1]=e*(.75-e*(.046875+e*(.01953125+e*Yc)));var n=e*e;return t[2]=n*(.46875-e*(.013020833333333334+.007120768229166667*e)),n*=e,t[3]=n*(.3645833333333333-.005696614583333333*e),t[4]=n*e*.3076171875,t},Jc=function(e,t,n,r){return n*=t,t*=t,r[0]*e-n*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))},Kc=function(e,t,n){for(var r=1/(1-t),i=e,o=20;o;--o){var a=Math.sin(i),s=1-t*a*a;if(i-=s=(Jc(i,a,Math.cos(i),n)-e)*(s*Math.sqrt(s))*r,Math.abs(s)<1e-10)return i}return i};var Qc={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Zc(this.es),this.ml0=Jc(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,n,r,i=e.x,o=e.y,a=Kl(i-this.long0),s=Math.sin(o),l=Math.cos(o);if(this.es){var c=l*a,u=Math.pow(c,2),h=this.ep2*Math.pow(l,2),d=Math.pow(h,2),f=Math.abs(l)>1e-10?Math.tan(o):0,p=Math.pow(f,2),m=Math.pow(p,2);t=1-this.es*Math.pow(s,2),c/=Math.sqrt(t);var g=Jc(o,s,l,this.en);n=this.a*(this.k0*c*(1+u/6*(1-p+h+u/20*(5-18*p+m+14*h-58*p*h+u/42*(61+179*m-m*p-479*p)))))+this.x0,r=this.a*(this.k0*(g-this.ml0+s*a*c/2*(1+u/12*(5-p+9*h+4*d+u/30*(61+m-58*p+270*h-330*p*h+u/56*(1385+543*m-m*p-3111*p))))))+this.y0}else{var v=l*Math.sin(a);if(Math.abs(Math.abs(v)-1)<1e-10)return 93;if(n=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,r=l*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(r))>=1){if(v-1>1e-10)return 93;r=0}else r=Math.acos(r);o<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return e.x=n,e.y=r,e},inverse:function(e){var t,n,r,i,o=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,n=Kc(t,this.es,this.en),Math.abs(n)<xl){var s=Math.sin(n),l=Math.cos(n),c=Math.abs(l)>1e-10?Math.tan(n):0,u=this.ep2*Math.pow(l,2),h=Math.pow(u,2),d=Math.pow(c,2),f=Math.pow(d,2);t=1-this.es*Math.pow(s,2);var p=o*Math.sqrt(t)/this.k0,m=Math.pow(p,2);r=n-(t*=c)*m/(1-this.es)*.5*(1-m/12*(5+3*d-9*u*d+u-4*h-m/30*(61+90*d-252*u*d+45*f+46*u-m/56*(1385+3633*d+4095*f+1574*f*d)))),i=Kl(this.long0+p*(1-m/6*(1+2*d+u-m/20*(5+28*d+24*f+8*u*d+6*u-m/42*(61+662*d+1320*f+720*f*d))))/l)}else r=xl*Jl(a),i=0;else{var g=Math.exp(o/this.k0),v=.5*(g-1/g),y=this.lat0+a/this.k0,b=Math.cos(y);t=Math.sqrt((1-Math.pow(b,2))/(1+Math.pow(v,2))),r=Math.asin(t),a<0&&(r=-r),i=0===v&&0===b?0:Kl(Math.atan2(v,b)+this.long0)}return e.x=i,e.y=r,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},$c=function(e){var t=Math.exp(e);return t=(t-1/t)/2},eu=function(e,t){e=Math.abs(e),t=Math.abs(t);var n=Math.max(e,t),r=Math.min(e,t)/(n||1);return n*Math.sqrt(1+Math.pow(r,2))},tu=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,n=t-1;return 0===n?e:e*Math.log(t)/n}(t*(1+t/(eu(1,t)+1))),e<0?-t:t},nu=function(e,t){for(var n,r=2*Math.cos(2*t),i=e.length-1,o=e[i],a=0;--i>=0;)n=r*o-a+e[i],a=o,o=n;return t+n*Math.sin(2*t)},ru=function(e,t,n){for(var r,i,o=Math.sin(t),a=Math.cos(t),s=$c(n),l=function(e){var t=Math.exp(e);return t=(t+1/t)/2}(n),c=2*a*l,u=-2*o*s,h=e.length-1,d=e[h],f=0,p=0,m=0;--h>=0;)r=p,i=f,d=c*(p=d)-r-u*(f=m)+e[h],m=u*p-i+c*f;return[(c=o*l)*d-(u=a*s)*m,c*m+u*d]};var iu={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Qc.init.apply(this),this.forward=Qc.forward,this.inverse=Qc.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),n=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),n*=t,this.cgb[1]=n*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=n*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),n*=t,this.cgb[2]=n*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=n*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),n*=t,this.cgb[3]=n*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=n*(1237/630+t*(t*(-24832/14175)-2.4)),n*=t,this.cgb[4]=n*(4174/315+t*(-144838/6237)),this.cbg[4]=n*(-734/315+t*(109598/31185)),n*=t,this.cgb[5]=n*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=n*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=n*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),n*=t,this.utg[2]=n*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=n*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),n*=t,this.utg[3]=n*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=n*(49561/161280+t*(-179/168+t*(6601661/7257600))),n*=t,this.utg[4]=n*(-4583/161280+t*(108847/3991680)),this.gtu[4]=n*(34729/80640+t*(-3418889/1995840)),n*=t,this.utg[5]=n*(-20648693/638668800),this.gtu[5]=.6650675310896665*n;var r=nu(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(e,t){for(var n,r=2*Math.cos(t),i=e.length-1,o=e[i],a=0;--i>=0;)n=r*o-a+e[i],a=o,o=n;return Math.sin(t)*n}(this.gtu,2*r))},forward:function(e){var t=Kl(e.x-this.long0),n=e.y;n=nu(this.cbg,n);var r=Math.sin(n),i=Math.cos(n),o=Math.sin(t),a=Math.cos(t);n=Math.atan2(r,a*i),t=Math.atan2(o*i,eu(r,i*a)),t=tu(Math.tan(t));var s,l,c=ru(this.gtu,2*n,2*t);return n+=c[0],t+=c[1],Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*n+this.Zb)+this.y0):(s=1/0,l=1/0),e.x=s,e.y=l,e},inverse:function(e){var t,n,r=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var o=ru(this.utg,2*i,2*r);i+=o[0],r+=o[1],r=Math.atan($c(r));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r);i=Math.atan2(a*c,eu(l,c*s)),r=Math.atan2(l,c*s),t=Kl(r+this.long0),n=nu(this.cgb,i)}else t=1/0,n=1/0;return e.x=t,e.y=n,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};var ou={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(Kl(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*wl,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,iu.init.apply(this),this.forward=iu.forward,this.inverse=iu.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},au=function(e,t){return Math.pow((1-e)/(1+e),t)};var su={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Sl)/(Math.pow(Math.tan(.5*this.lat0+Sl),this.C)*au(this.e*e,this.ratexp))},forward:function(e){var t=e.x,n=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+Sl),this.C)*au(this.e*Math.sin(n),this.ratexp))-xl,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,n=e.y,r=Math.pow(Math.tan(.5*n+Sl)/this.K,1/this.C),i=20;i>0&&(n=2*Math.atan(r*au(this.e*Math.sin(e.y),-.5*this.e))-xl,!(Math.abs(n-e.y)<1e-14));--i)e.y=n;return i?(e.x=t,e.y=n,e):null},names:["gauss"]};var lu={init:function(){su.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,n,r,i;return e.x=Kl(e.x-this.long0),su.forward.apply(this,[e]),t=Math.sin(e.y),n=Math.cos(e.y),r=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*r),e.x=i*n*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*n*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,n,r,i,o;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,o=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(o,this.R2);t=Math.sin(a),n=Math.cos(a),i=Math.asin(n*this.sinc0+e.y*t*this.cosc0/o),r=Math.atan2(e.x*t,o*this.cosc0*n-e.y*this.sinc0*t)}else i=this.phic0,r=0;return e.x=r,e.y=i,su.inverse.apply(this,[e]),e.x=Kl(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var cu={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*(1+Jl(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=1e-10&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*this.cons*Zl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ql(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Zl(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-xl,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,n,r,i,o,a,s=e.x,l=e.y,c=Math.sin(l),u=Math.cos(l),h=Kl(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=1e-10&&Math.abs(l+this.lat0)<=1e-10?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(h)),e.x=this.a*t*u*Math.sin(h)+this.x0,e.y=this.a*t*(this.coslat0*c-this.sinlat0*u*Math.cos(h))+this.y0,e):(n=2*Math.atan(this.ssfn_(l,c,this.e))-xl,i=Math.cos(n),r=Math.sin(n),Math.abs(this.coslat0)<=1e-10?(o=Ql(this.e,l*this.con,this.con*c),a=2*this.a*this.k0*o/this.cons,e.x=this.x0+a*Math.sin(s-this.long0),e.y=this.y0-this.con*a*Math.cos(s-this.long0),e):(Math.abs(this.sinlat0)<1e-10?(t=2*this.a*this.k0/(1+i*Math.cos(h)),e.y=t*r):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*i*Math.cos(h))),e.y=t*(this.cosX0*r-this.sinX0*i*Math.cos(h))+this.y0),e.x=t*i*Math.sin(h)+this.x0,e))},inverse:function(e){var t,n,r,i,o;e.x-=this.x0,e.y-=this.y0;var a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var s=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,n=this.lat0,a<=1e-10?(e.x=t,e.y=n,e):(n=Math.asin(Math.cos(s)*this.sinlat0+e.y*Math.sin(s)*this.coslat0/a),t=Math.abs(this.coslat0)<1e-10?this.lat0>0?Kl(this.long0+Math.atan2(e.x,-1*e.y)):Kl(this.long0+Math.atan2(e.x,e.y)):Kl(this.long0+Math.atan2(e.x*Math.sin(s),a*this.coslat0*Math.cos(s)-e.y*this.sinlat0*Math.sin(s))),e.x=t,e.y=n,e)}if(Math.abs(this.coslat0)<=1e-10){if(a<=1e-10)return n=this.lat0,t=this.long0,e.x=t,e.y=n,e;e.x*=this.con,e.y*=this.con,r=a*this.cons/(2*this.a*this.k0),n=this.con*$l(this.e,r),t=this.con*Kl(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=1e-10?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/a),t=Kl(this.long0+Math.atan2(e.x*Math.sin(i),a*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),n=-1*$l(this.e,Math.tan(.5*(xl+o)));return e.x=t,e.y=n,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,n){return t*=n,Math.tan(.5*(xl+e))*Math.pow((1-t)/(1+t),.5*n)}};var uu={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,r=1/this.rf,i=2*r-Math.pow(r,2),o=this.e=Math.sqrt(i);this.R=this.k0*n*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+n)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),o=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,n=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=c,e},names:["somerc"]};var hu={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),n=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-n*n);var r,i,o=Ql(this.e,this.lat0,e),a=this.bl/t*Math.sqrt((1-this.es)/(1-n*n));if(a*a<1&&(a=1),isNaN(this.longc)){var s=Ql(this.e,this.lat1,Math.sin(this.lat1)),l=Ql(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var c=Math.pow(s,this.bl),u=Math.pow(l,this.bl);i=.5*((r=this.el/c)-1/r);var h=(this.el*this.el-u*c)/(this.el*this.el+u*c),d=(u-c)/(u+c),f=Kl(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(h*Math.tan(.5*this.bl*f)/d)/this.bl,this.long0=Kl(this.long0);var p=Kl(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*p)/i),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else r=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=r*Math.pow(o,this.bl),i=.5*(r-1/r),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},forward:function(e){var t,n,r,i=e.x,o=e.y,a=Kl(i-this.long0);if(Math.abs(Math.abs(o)-xl)<=1e-10)r=o>0?-1:1,n=this.al/this.bl*Math.log(Math.tan(Sl+r*this.gamma0*.5)),t=-1*r*xl*this.al/this.bl;else{var s=Ql(this.e,o,Math.sin(o)),l=this.el/Math.pow(s,this.bl),c=.5*(l-1/l),u=.5*(l+1/l),h=Math.sin(this.bl*a),d=(c*Math.sin(this.gamma0)-h*Math.cos(this.gamma0))/u;n=Math.abs(Math.abs(d)-1)<=1e-10?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-d)/(1+d))/this.bl,t=Math.abs(Math.cos(this.bl*a))<=1e-10?this.al*this.bl*a:this.al*Math.atan2(c*Math.cos(this.gamma0)+h*Math.sin(this.gamma0),Math.cos(this.bl*a))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+n):(t-=this.uc,e.x=this.x0+n*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-n*Math.sin(this.alpha)),e},inverse:function(e){var t,n;this.no_rot?(n=e.y-this.y0,t=e.x-this.x0):(n=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var r=Math.exp(-1*this.bl*n/this.al),i=.5*(r-1/r),o=.5*(r+1/r),a=Math.sin(this.bl*t/this.al),s=(a*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/o,l=Math.pow(this.el/Math.sqrt((1+s)/(1-s)),1/this.bl);return Math.abs(s-1)<1e-10?(e.x=this.long0,e.y=xl):Math.abs(s+1)<1e-10?(e.x=this.long0,e.y=-1*xl):(e.y=$l(this.e,l),e.x=Kl(this.long0-Math.atan2(i*Math.cos(this.gamma0)-a*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var du={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<1e-10)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),r=Zl(this.e,t,n),i=Ql(this.e,this.lat1,t),o=Math.sin(this.lat2),a=Math.cos(this.lat2),s=Zl(this.e,o,a),l=Ql(this.e,this.lat2,o),c=Ql(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>1e-10?this.ns=Math.log(r/s)/Math.log(i/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,n=e.y;Math.abs(2*Math.abs(n)-Math.PI)<=1e-10&&(n=Jl(n)*(xl-2e-10));var r,i,o=Math.abs(Math.abs(n)-xl);if(o>1e-10)r=Ql(this.e,n,Math.sin(n)),i=this.a*this.f0*Math.pow(r,this.ns);else{if((o=n*this.ns)<=0)return null;i=0}var a=this.ns*Kl(t-this.long0);return e.x=this.k0*(i*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,e},inverse:function(e){var t,n,r,i,o,a=(e.x-this.x0)/this.k0,s=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+s*s),n=1):(t=-Math.sqrt(a*a+s*s),n=-1);var l=0;if(0!==t&&(l=Math.atan2(n*a,n*s)),0!==t||this.ns>0){if(n=1/this.ns,r=Math.pow(t/(this.a*this.f0),n),-9999===(i=$l(this.e,r)))return null}else i=-xl;return o=Kl(l/this.ns+this.long0),e.x=o,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var fu={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,n,r,i,o,a,s,l=e.x,c=e.y,u=Kl(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),r=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),o=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=s*Math.cos(a)/1,e.x=s*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,n,r,i,o,a,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t)),e.x=this.long0-n/this.alfa,a=t,s=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(s=1),a=e.y,c+=1}while(0===s&&c<15);return c>=15?null:e},names:["Krovak","krovak"]},pu=function(e,t,n,r,i){return e*i-t*Math.sin(2*i)+n*Math.sin(4*i)-r*Math.sin(6*i)},mu=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},gu=function(e){return.375*e*(1+.25*e*(1+.46875*e))},vu=function(e){return.05859375*e*e*(1+.75*e)},yu=function(e){return e*e*e*(35/3072)},bu=function(e,t,n){var r=t*n;return e/Math.sqrt(1-r*r)},_u=function(e){return Math.abs(e)<xl?e:e-Jl(e)*Math.PI},xu=function(e,t,n,r,i){var o,a;o=e/t;for(var s=0;s<15;s++)if(o+=a=(e-(t*o-n*Math.sin(2*o)+r*Math.sin(4*o)-i*Math.sin(6*o)))/(t-2*n*Math.cos(2*o)+4*r*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN};var wu={init:function(){this.sphere||(this.e0=mu(this.es),this.e1=gu(this.es),this.e2=vu(this.es),this.e3=yu(this.es),this.ml0=this.a*pu(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,n,r=e.x,i=e.y;if(r=Kl(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(r)),n=this.a*(Math.atan2(Math.tan(i),Math.cos(r))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=bu(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),c=r*Math.cos(i),u=c*c,h=this.es*a*a/(1-this.es);t=s*c*(1-u*l*(1/6-(8-l+8*h)*u/120)),n=this.a*pu(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*u*(.5+(5-l+6*h)*u/24)}return e.x=t+this.x0,e.y=n+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,n,r=e.x/this.a,i=e.y/this.a;if(this.sphere){var o=i+this.lat0;t=Math.asin(Math.sin(o)*Math.cos(r)),n=Math.atan2(Math.tan(r),Math.cos(o))}else{var a=this.ml0/this.a+i,s=xu(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-xl)<=1e-10)return e.x=this.long0,e.y=xl,i<0&&(e.y*=-1),e;var l=bu(this.a,this.e,Math.sin(s)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),h=r*this.a/l,d=h*h;t=s-l*Math.tan(s)/c*h*h*(.5-(1+3*u)*h*h/24),n=h*(1-d*(u/3+(1+3*u)*u*d/15))/Math.cos(s)}return e.x=Kl(n+this.long0),e.y=_u(t),e},names:["Cassini","Cassini_Soldner","cass"]},Mu=function(e,t){var n;return e>1e-7?(1-e*e)*(t/(1-(n=e*t)*n)-.5/e*Math.log((1-n)/(1+n))):2*t};var Su={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-xl)<1e-10?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<1e-10?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Mu(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,n=[];return n[0]=.3333333333333333*e,t=e*e,n[0]+=.17222222222222222*t,n[1]=.06388888888888888*t,t*=e,n[0]+=.10257936507936508*t,n[1]+=.0664021164021164*t,n[2]=.016415012942191543*t,n}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Mu(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,n,r,i,o,a,s,l,c,u,h=e.x,d=e.y;if(h=Kl(h-this.long0),this.sphere){if(o=Math.sin(d),u=Math.cos(d),r=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+u*r:1+this.sinph0*o+this.cosph0*u*r)<=1e-10)return null;t=(n=Math.sqrt(2/n))*u*Math.sin(h),n*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*u*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(d+this.lat0)<1e-10)return null;n=Sl-.5*d,t=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(h),n*=r}}else{switch(s=0,l=0,c=0,r=Math.cos(h),i=Math.sin(h),o=Math.sin(d),a=Mu(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:c=1+this.sinb1*s+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=xl+d,a=this.qp-a;break;case this.S_POLE:c=d-xl,a=this.qp+a}if(Math.abs(c)<1e-10)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),n=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*s-this.sinb1*l*r):(c=Math.sqrt(2/(1+l*r)))*s*this.ymf,t=this.xmf*c*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(c=Math.sqrt(a))*i,n=r*(this.mode===this.S_POLE?c:-c)):t=n=0}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,n,r,i,o,a,s,l,c,u,h=e.x/this.a,d=e.y/this.a;if(this.sphere){var f,p=0,m=0;if((n=.5*(f=Math.sqrt(h*h+d*d)))>1)return null;switch(n=2*Math.asin(n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(n),p=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(f)<=1e-10?0:Math.asin(d*m/f),h*=m,d=p*f;break;case this.OBLIQ:n=Math.abs(f)<=1e-10?this.lat0:Math.asin(p*this.sinph0+d*m*this.cosph0/f),h*=m*this.cosph0,d=(p-Math.sin(n)*this.sinph0)*f;break;case this.N_POLE:d=-d,n=xl-n;break;case this.S_POLE:n-=xl}t=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,d):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,d*=this.dd,(a=Math.sqrt(h*h+d*d))<1e-10)return e.x=this.long0,e.y=this.lat0,e;i=2*Math.asin(.5*a/this.rq),r=Math.cos(i),h*=i=Math.sin(i),this.mode===this.OBLIQ?(s=r*this.sinb1+d*i*this.cosb1/a,o=this.qp*s,d=a*this.cosb1*r-d*this.sinb1*i):(s=d*i/a,o=this.qp*s,d=a*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(o=h*h+d*d))return e.x=this.long0,e.y=this.lat0,e;s=1-o/this.qp,this.mode===this.S_POLE&&(s=-s)}t=Math.atan2(h,d),l=Math.asin(s),c=this.apa,u=l+l,n=l+c[0]*Math.sin(u)+c[1]*Math.sin(u+u)+c[2]*Math.sin(u+u+u)}return e.x=Kl(this.long0+t),e.y=n,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Eu=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)};var Tu={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Zl(this.e3,this.sin_po,this.cos_po),this.qs1=Mu(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Zl(this.e3,this.sin_po,this.cos_po),this.qs2=Mu(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Mu(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>1e-10?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var r=Mu(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,o=this.ns0*Kl(t-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return e.x=a,e.y=s,e},inverse:function(e){var t,n,r,i,o,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),i=0,0!==t&&(i=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(n=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,n)),o=Kl(i/this.ns0+this.long0),e.x=o,e.y=a,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var n,r,i,o,a=Eu(.5*t);if(e<1e-10)return a;for(var s=e*e,l=1;l<=25;l++)if(a+=o=.5*(i=1-(r=e*(n=Math.sin(a)))*r)*i/Math.cos(a)*(t/(1-s)-n/i+.5/e*Math.log((1-r)/(1+r))),Math.abs(o)<=1e-7)return a;return null}};var Cu={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,n,r,i,o,a,s,l=e.x,c=e.y;return r=Kl(l-this.long0),t=Math.sin(c),n=Math.cos(c),i=Math.cos(r),1,(o=this.sin_p14*t+this.cos_p14*n*i)>0||Math.abs(o)<=1e-10?(a=this.x0+1*this.a*n*Math.sin(r)/o,s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*i)/o):(a=this.x0+this.infinity_dist*n*Math.sin(r),s=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*i)),e.x=a,e.y=s,e},inverse:function(e){var t,n,r,i,o,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),n=Math.sin(i),r=Math.cos(i),a=Eu(r*this.sin_p14+e.y*n*this.cos_p14/t),o=Math.atan2(e.x*n,t*this.cos_p14*r-e.y*this.sin_p14*n),o=Kl(this.long0+o)):(a=this.phic0,o=0),e.x=o,e.y=a,e},names:["gnom"]};var Au={init:function(){this.sphere||(this.k0=Zl(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,n,r=e.x,i=e.y,o=Kl(r-this.long0);if(this.sphere)t=this.x0+this.a*o*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=Mu(this.e,Math.sin(i));t=this.x0+this.a*this.k0*o,n=this.y0+this.a*a*.5/this.k0}return e.x=t,e.y=n,e},inverse:function(e){var t,n;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=Kl(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(n=function(e,t){var n=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-n)<1e-6)return t<0?-1*xl:xl;for(var r,i,o,a,s=Math.asin(.5*t),l=0;l<30;l++)if(i=Math.sin(s),o=Math.cos(s),a=e*i,s+=r=Math.pow(1-a*a,2)/(2*o)*(t/(1-e*e)-i/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),Math.abs(r)<=1e-10)return s;return NaN}(this.e,2*e.y*this.k0/this.a),t=Kl(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=n,e},names:["cea"]};var Lu={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,n=e.y,r=Kl(t-this.long0),i=_u(n-this.lat0);return e.x=this.x0+this.a*r*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,n=e.y;return e.x=Kl(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=_u(this.lat0+(n-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var Pu={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=mu(this.es),this.e1=gu(this.es),this.e2=vu(this.es),this.e3=yu(this.es),this.ml0=this.a*pu(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,r,i=e.x,o=e.y,a=Kl(i-this.long0);if(r=a*Math.sin(o),this.sphere)Math.abs(o)<=1e-10?(t=this.a*a,n=-1*this.a*this.lat0):(t=this.a*Math.sin(r)/Math.tan(o),n=this.a*(_u(o-this.lat0)+(1-Math.cos(r))/Math.tan(o)));else if(Math.abs(o)<=1e-10)t=this.a*a,n=-1*this.ml0;else{var s=bu(this.a,this.e,Math.sin(o))/Math.tan(o);t=s*Math.sin(r),n=this.a*pu(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+s*(1-Math.cos(r))}return e.x=t+this.x0,e.y=n+this.y0,e},inverse:function(e){var t,n,r,i,o,a,s,l,c;if(r=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=1e-10)t=Kl(r/this.a+this.long0),n=0;else{var u;for(a=this.lat0+i/this.a,s=r*r/this.a/this.a+a*a,l=a,o=20;o;--o)if(l+=c=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+s)*u)/((l-a)/u-1),Math.abs(c)<=1e-10){n=l;break}t=Kl(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(n))}else if(Math.abs(i+this.ml0)<=1e-10)n=0,t=Kl(this.long0+r/this.a);else{var h,d,f,p,m;for(a=(this.ml0+i)/this.a,s=r*r/this.a/this.a+a*a,l=a,o=20;o;--o)if(m=this.e*Math.sin(l),h=Math.sqrt(1-m*m)*Math.tan(l),d=this.a*pu(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(a*(h*(p=d/this.a)+1)-p-.5*h*(p*p+s))/(this.es*Math.sin(2*l)*(p*p+s-2*a*p)/(4*h)+(a-p)*(h*f-2/Math.sin(2*l))-f),Math.abs(c)<=1e-10){n=l;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),t=Kl(this.long0+Math.asin(r*h/this.a)/Math.sin(n))}return e.x=t,e.y=n,e},names:["Polyconic","poly"]};var Ru={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,n=e.x,r=e.y-this.lat0,i=n-this.long0,o=r/_l*1e-5,a=i,s=1,l=0;for(t=1;t<=10;t++)s*=o,l+=this.A[t]*s;var c,u=l,h=a,d=1,f=0,p=0,m=0;for(t=1;t<=6;t++)c=f*u+d*h,d=d*u-f*h,f=c,p=p+this.B_re[t]*d-this.B_im[t]*f,m=m+this.B_im[t]*d+this.B_re[t]*f;return e.x=m*this.a+this.x0,e.y=p*this.a+this.y0,e},inverse:function(e){var t,n,r=e.x,i=e.y,o=r-this.x0,a=(i-this.y0)/this.a,s=o/this.a,l=1,c=0,u=0,h=0;for(t=1;t<=6;t++)n=c*a+l*s,l=l*a-c*s,c=n,u=u+this.C_re[t]*l-this.C_im[t]*c,h=h+this.C_im[t]*l+this.C_re[t]*c;for(var d=0;d<this.iterations;d++){var f,p=u,m=h,g=a,v=s;for(t=2;t<=6;t++)f=m*u+p*h,p=p*u-m*h,m=f,g+=(t-1)*(this.B_re[t]*p-this.B_im[t]*m),v+=(t-1)*(this.B_im[t]*p+this.B_re[t]*m);p=1,m=0;var y=this.B_re[1],b=this.B_im[1];for(t=2;t<=6;t++)f=m*u+p*h,p=p*u-m*h,m=f,y+=t*(this.B_re[t]*p-this.B_im[t]*m),b+=t*(this.B_im[t]*p+this.B_re[t]*m);var _=y*y+b*b;u=(g*y+v*b)/_,h=(v*y-g*b)/_}var x=u,w=h,M=1,S=0;for(t=1;t<=9;t++)M*=x,S+=this.D[t]*M;var E=this.lat0+S*_l*1e5,T=this.long0+w;return e.x=T,e.y=E,e},names:["New_Zealand_Map_Grid","nzmg"]};var Ou={init:function(){},forward:function(e){var t=e.x,n=e.y,r=Kl(t-this.long0),i=this.x0+this.a*r,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return e.x=i,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Kl(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=n,e},names:["Miller_Cylindrical","mill"]};var ku={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Zc(this.es)},forward:function(e){var t,n,r=e.x,i=e.y;if(r=Kl(r-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=20;a;--a){var s=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<1e-10)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*r*(this.m+Math.cos(i)),n=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);n=this.a*Jc(i,l,c,this.en),t=this.a*r*c/Math.sqrt(1-this.es*l*l)}return e.x=t,e.y=n,e},inverse:function(e){var t,n,r,i;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=Eu((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=Eu(Math.sin(t)/this.n)),r=Kl(r+this.long0),t=_u(t)):(t=Kc(e.y/this.a,this.es,this.en),(i=Math.abs(t))<xl?(i=Math.sin(t),n=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),r=Kl(n)):i-1e-10<xl&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]};var Iu={init:function(){},forward:function(e){for(var t=e.x,n=e.y,r=Kl(t-this.long0),i=n,o=Math.PI*Math.sin(n);;){var a=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=a,Math.abs(a)<1e-10)break}i/=2,Math.PI/2-Math.abs(n)<1e-10&&(r=0);var s=.900316316158*this.a*r*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=s,e.y=l,e},inverse:function(e){var t,n;e.x-=this.x0,e.y-=this.y0,n=e.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),t=Math.asin(n);var r=Kl(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),n=(2*t+Math.sin(2*t))/Math.PI,Math.abs(n)>1&&(n=1);var i=Math.asin(n);return e.x=r,e.y=i,e},names:["Mollweide","moll"]};var Du={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=mu(this.es),this.e1=gu(this.es),this.e2=vu(this.es),this.e3=yu(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Zl(this.e,this.sinphi,this.cosphi),this.ml1=pu(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<1e-10?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Zl(this.e,this.sinphi,this.cosphi),this.ml2=pu(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=pu(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,n=e.x,r=e.y;if(this.sphere)t=this.a*(this.g-r);else{var i=pu(this.e0,this.e1,this.e2,this.e3,r);t=this.a*(this.g-i)}var o=this.ns*Kl(n-this.long0),a=this.x0+t*Math.sin(o),s=this.y0+this.rh-t*Math.cos(o);return e.x=a,e.y=s,e},inverse:function(e){var t,n,r,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(n=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(n=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var o=0;if(0!==n&&(o=Math.atan2(t*e.x,t*e.y)),this.sphere)return i=Kl(this.long0+o/this.ns),r=_u(this.g-n/this.a),e.x=i,e.y=r,e;var a=this.g-n/this.a;return r=xu(a,this.e0,this.e1,this.e2,this.e3),i=Kl(this.long0+o/this.ns),e.x=i,e.y=r,e},names:["Equidistant_Conic","eqdc"]};var Nu={init:function(){this.R=this.a},forward:function(e){var t,n,r=e.x,i=e.y,o=Kl(r-this.long0);Math.abs(i)<=1e-10&&(t=this.x0+this.R*o,n=this.y0);var a=Eu(2*Math.abs(i/Math.PI));(Math.abs(o)<=1e-10||Math.abs(Math.abs(i)-xl)<=1e-10)&&(t=this.x0,n=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var s=.5*Math.abs(Math.PI/o-o/Math.PI),l=s*s,c=Math.sin(a),u=Math.cos(a),h=u/(c+u-1),d=h*h,f=h*(2/c-1),p=f*f,m=Math.PI*this.R*(s*(h-p)+Math.sqrt(l*(h-p)*(h-p)-(p+l)*(d-p)))/(p+l);o<0&&(m=-m),t=this.x0+m;var g=l+h;return m=Math.PI*this.R*(f*g-s*Math.sqrt((p+l)*(l+1)-g*g))/(p+l),n=i>=0?this.y0+m:this.y0-m,e.x=t,e.y=n,e},inverse:function(e){var t,n,r,i,o,a,s,l,c,u,h,d;return e.x-=this.x0,e.y-=this.y0,h=Math.PI*this.R,o=(r=e.x/h)*r+(i=e.y/h)*i,h=3*(i*i/(l=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(s=a-2*i*i+r*r)*s*s/l/l/l-9*a*s/l/l)/27)/(c=(a-s*s/3/l)/l)/(u=2*Math.sqrt(-c/3)),Math.abs(h)>1&&(h=h>=0?1:-1),d=Math.acos(h)/3,n=e.y>=0?(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI:-(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI,t=Math.abs(r)<1e-10?this.long0:Kl(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(r*r-i*i)+o*o))/2/r),e.x=t,e.y=n,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var ju={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,n,r,i,o,a,s,l,c,u,h,d,f,p,m,g,v,y,b,_,x,w,M=e.x,S=e.y,E=Math.sin(e.y),T=Math.cos(e.y),C=Kl(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=1e-10?(e.x=this.x0+this.a*(xl-S)*Math.sin(C),e.y=this.y0-this.a*(xl-S)*Math.cos(C),e):Math.abs(this.sin_p12+1)<=1e-10?(e.x=this.x0+this.a*(xl+S)*Math.sin(C),e.y=this.y0+this.a*(xl+S)*Math.cos(C),e):(y=this.sin_p12*E+this.cos_p12*T*Math.cos(C),v=(g=Math.acos(y))?g/Math.sin(g):1,e.x=this.x0+this.a*v*T*Math.sin(C),e.y=this.y0+this.a*v*(this.cos_p12*E-this.sin_p12*T*Math.cos(C)),e):(t=mu(this.es),n=gu(this.es),r=vu(this.es),i=yu(this.es),Math.abs(this.sin_p12-1)<=1e-10?(o=this.a*pu(t,n,r,i,xl),a=this.a*pu(t,n,r,i,S),e.x=this.x0+(o-a)*Math.sin(C),e.y=this.y0-(o-a)*Math.cos(C),e):Math.abs(this.sin_p12+1)<=1e-10?(o=this.a*pu(t,n,r,i,xl),a=this.a*pu(t,n,r,i,S),e.x=this.x0+(o+a)*Math.sin(C),e.y=this.y0+(o+a)*Math.cos(C),e):(s=E/T,l=bu(this.a,this.e,this.sin_p12),c=bu(this.a,this.e,E),u=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(c*T)),b=0===(h=Math.atan2(Math.sin(C),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(C)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(h)-Math.PI)<=1e-10?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(C)*Math.cos(u)/Math.sin(h)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),g=l*b*(1-(_=b*b)*(m=(f=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*f)*(1-m)/6+(x=_*b)/8*(p=d*f)*(1-2*m)+(w=x*b)/120*(m*(4-7*m)-3*d*d*(1-7*m))-w*b/48*p),e.x=this.x0+g*Math.sin(h),e.y=this.y0+g*Math.cos(h),e))},inverse:function(e){var t,n,r,i,o,a,s,l,c,u,h,d,f,p,m,g,v,y,b,_,x,w,M;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*xl*this.a)return;return n=t/this.a,r=Math.sin(n),i=Math.cos(n),o=this.long0,Math.abs(t)<=1e-10?a=this.lat0:(a=Eu(i*this.sin_p12+e.y*r*this.cos_p12/t),s=Math.abs(this.lat0)-xl,o=Math.abs(s)<=1e-10?this.lat0>=0?Kl(this.long0+Math.atan2(e.x,-e.y)):Kl(this.long0-Math.atan2(-e.x,e.y)):Kl(this.long0+Math.atan2(e.x*r,t*this.cos_p12*i-e.y*this.sin_p12*r))),e.x=o,e.y=a,e}return l=mu(this.es),c=gu(this.es),u=vu(this.es),h=yu(this.es),Math.abs(this.sin_p12-1)<=1e-10?(d=this.a*pu(l,c,u,h,xl),t=Math.sqrt(e.x*e.x+e.y*e.y),a=xu((d-t)/this.a,l,c,u,h),o=Kl(this.long0+Math.atan2(e.x,-1*e.y)),e.x=o,e.y=a,e):Math.abs(this.sin_p12+1)<=1e-10?(d=this.a*pu(l,c,u,h,xl),t=Math.sqrt(e.x*e.x+e.y*e.y),a=xu((t-d)/this.a,l,c,u,h),o=Kl(this.long0+Math.atan2(e.x,e.y)),e.x=o,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),m=Math.atan2(e.x,e.y),f=bu(this.a,this.e,this.sin_p12),g=Math.cos(m),y=-(v=this.e*this.cos_p12*g)*v/(1-this.es),b=3*this.es*(1-y)*this.sin_p12*this.cos_p12*g/(1-this.es),w=1-y*(x=(_=t/f)-y*(1+y)*Math.pow(_,3)/6-b*(1+3*y)*Math.pow(_,4)/24)*x/2-_*x*x*x/6,p=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*g),o=Kl(this.long0+Math.asin(Math.sin(m)*Math.sin(x)/Math.cos(p))),M=Math.sin(p),a=Math.atan2((M-this.es*w*this.sin_p12)*Math.tan(p),M*(1-this.es)),e.x=o,e.y=a,e)},names:["Azimuthal_Equidistant","aeqd"]};var Fu={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,n,r,i,o,a,s,l=e.x,c=e.y;return r=Kl(l-this.long0),t=Math.sin(c),n=Math.cos(c),i=Math.cos(r),1,((o=this.sin_p14*t+this.cos_p14*n*i)>0||Math.abs(o)<=1e-10)&&(a=1*this.a*n*Math.sin(r),s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*i)),e.x=a,e.y=s,e},inverse:function(e){var t,n,r,i,o,a,s;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),n=Eu(t/this.a),r=Math.sin(n),i=Math.cos(n),a=this.long0,Math.abs(t)<=1e-10?(s=this.lat0,e.x=a,e.y=s,e):(s=Eu(i*this.sin_p14+e.y*r*this.cos_p14/t),o=Math.abs(this.lat0)-xl,Math.abs(o)<=1e-10?(a=this.lat0>=0?Kl(this.long0+Math.atan2(e.x,-e.y)):Kl(this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=s,e):(a=Kl(this.long0+Math.atan2(e.x*r,t*this.cos_p14*i-e.y*this.sin_p14*r)),e.x=a,e.y=s,e))},names:["ortho"]},Bu=1,zu=2,Uu=3,Hu=4,Gu=5,Wu=6,Vu=1,qu=2,Xu=3,Yu=4;function Zu(e,t,n,r){var i;return e<1e-10?(r.value=Vu,i=0):(i=Math.atan2(t,n),Math.abs(i)<=Sl?r.value=Vu:i>Sl&&i<=xl+Sl?(r.value=qu,i-=xl):i>xl+Sl||i<=-(xl+Sl)?(r.value=Xu,i=i>=0?i-Tl:i+Tl):(r.value=Yu,i+=xl)),i}function Ju(e,t){var n=e+t;return n<-Tl?n+=El:n>+Tl&&(n-=El),n}var Ku={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=xl-Sl/2?this.face=Gu:this.lat0<=-(xl-Sl/2)?this.face=Wu:Math.abs(this.long0)<=Sl?this.face=Bu:Math.abs(this.long0)<=xl+Sl?this.face=this.long0>0?zu:Hu:this.face=Uu,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,n,r,i,o,a,s={x:0,y:0},l={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,n=e.x,this.face===Gu)i=xl-t,n>=Sl&&n<=xl+Sl?(l.value=Vu,r=n-xl):n>xl+Sl||n<=-(xl+Sl)?(l.value=qu,r=n>0?n-Tl:n+Tl):n>-(xl+Sl)&&n<=-Sl?(l.value=Xu,r=n+xl):(l.value=Yu,r=n);else if(this.face===Wu)i=xl+t,n>=Sl&&n<=xl+Sl?(l.value=Vu,r=-n+xl):n<Sl&&n>=-Sl?(l.value=qu,r=-n):n<-Sl&&n>=-(xl+Sl)?(l.value=Xu,r=-n-xl):(l.value=Yu,r=n>0?-n+Tl:-n-Tl);else{var c,u,h,d,f,p;this.face===zu?n=Ju(n,+xl):this.face===Uu?n=Ju(n,+Tl):this.face===Hu&&(n=Ju(n,-xl)),d=Math.sin(t),f=Math.cos(t),p=Math.sin(n),c=f*Math.cos(n),u=f*p,h=d,this.face===Bu?r=Zu(i=Math.acos(c),h,u,l):this.face===zu?r=Zu(i=Math.acos(u),h,-c,l):this.face===Uu?r=Zu(i=Math.acos(-c),h,-u,l):this.face===Hu?r=Zu(i=Math.acos(-u),h,c,l):(i=r=0,l.value=Vu)}return a=Math.atan(12/Tl*(r+Math.acos(Math.sin(r)*Math.cos(Sl))-xl)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===qu?a+=xl:l.value===Xu?a+=Tl:l.value===Yu&&(a+=1.5*Tl),s.x=o*Math.cos(a),s.y=o*Math.sin(a),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,e.x=s.x,e.y=s.y,e},inverse:function(e){var t,n,r,i,o,a,s,l,c,u,h,d,f={lam:0,phi:0},p={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,n=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?p.value=Vu:e.y>=0&&e.y>=Math.abs(e.x)?(p.value=qu,t-=xl):e.x<0&&-e.x>=Math.abs(e.y)?(p.value=Xu,t=t<0?t+Tl:t-Tl):(p.value=Yu,t+=xl),c=Tl/12*Math.tan(t),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),(s=1-(r=Math.cos(t))*r*(i=Math.tan(n))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?s=-1:s>1&&(s=1),this.face===Gu)l=Math.acos(s),f.phi=xl-l,p.value===Vu?f.lam=a+xl:p.value===qu?f.lam=a<0?a+Tl:a-Tl:p.value===Xu?f.lam=a-xl:f.lam=a;else if(this.face===Wu)l=Math.acos(s),f.phi=l-xl,p.value===Vu?f.lam=-a+xl:p.value===qu?f.lam=-a:p.value===Xu?f.lam=-a-xl:f.lam=a<0?-a-Tl:-a+Tl;else{var m,g,v;c=(m=s)*m,g=(c+=(v=c>=1?0:Math.sqrt(1-c)*Math.sin(a))*v)>=1?0:Math.sqrt(1-c),p.value===qu?(c=g,g=-v,v=c):p.value===Xu?(g=-g,v=-v):p.value===Yu&&(c=g,g=v,v=-c),this.face===zu?(c=m,m=-g,g=c):this.face===Uu?(m=-m,g=-g):this.face===Hu&&(c=m,m=g,g=-c),f.phi=Math.acos(-v)-xl,f.lam=Math.atan2(g,m),this.face===zu?f.lam=Ju(f.lam,-xl):this.face===Uu?f.lam=Ju(f.lam,-Tl):this.face===Hu&&(f.lam=Ju(f.lam,+xl))}return 0!==this.es&&(u=f.phi<0?1:0,h=Math.tan(f.phi),d=this.b/Math.sqrt(h*h+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),u&&(f.phi=-f.phi)),f.lam+=this.long0,e.x=f.lam,e.y=f.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Qu=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],$u=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],eh=Ml/5,th=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};var nh={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=Kl(e.x-this.long0),n=Math.abs(e.y),r=Math.floor(n*eh);r<0?r=0:r>=18&&(r=17);var i={x:th(Qu[r],n=Ml*(n-.08726646259971647*r))*t,y:th($u[r],n)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*.8487+this.x0,i.y=i.y*this.a*1.3523+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(.8487*this.a),y:Math.abs(e.y-this.y0)/(1.3523*this.a)};if(t.y>=1)t.x/=Qu[18][0],t.y=e.y<0?-xl:xl;else{var n=Math.floor(18*t.y);for(n<0?n=0:n>=18&&(n=17);;)if($u[n][0]>t.y)--n;else{if(!($u[n+1][0]<=t.y))break;++n}var r=$u[n],i=5*(t.y-r[0])/($u[n+1][0]-r[0]);i=function(e,t,n,r){for(var i=t;r;--r){var o=e(i);if(i-=o,Math.abs(o)<n)break}return i}((function(e){return(th(r,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(r,e)}),i,1e-10,100),t.x/=th(Qu[n],i),t.y=(5*n+i)*wl,e.y<0&&(t.y=-t.y)}return t.x=Kl(t.x+this.long0),t},names:["Robinson","robin"]};var rh={init:function(){this.name="geocent"},forward:function(e){return bc(e,this.es,this.a)},inverse:function(e){return _c(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},ih=0,oh=1,ah=2,sh=3,lh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var ch,uh={init:function(){if(Object.keys(lh).forEach(function(e){if(void 0===this[e])this[e]=lh[e].def;else{if(lh[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);lh[e].num&&(this[e]=parseFloat(this[e]))}lh[e].degrees&&(this[e]=this[e]*wl)}.bind(this)),Math.abs(Math.abs(this.lat0)-xl)<1e-10?this.mode=this.lat0<0?oh:ih:Math.abs(this.lat0)<1e-10?this.mode=ah:(this.mode=sh,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,n,r,i,o=Math.sin(e.y),a=Math.cos(e.y),s=Math.cos(e.x);switch(this.mode){case sh:n=this.sinph0*o+this.cosph0*a*s;break;case ah:n=a*s;break;case oh:n=-o;break;case ih:n=o}switch(t=(n=this.pn1/(this.p-n))*a*Math.sin(e.x),this.mode){case sh:n*=this.cosph0*o-this.sinph0*a*s;break;case ah:n*=o;break;case ih:n*=-a*s;break;case oh:n*=a*s}return i=1/((r=n*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-n*this.sg)*this.cw*i,n=r*i,e.x=t*this.a,e.y=n*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,n,r,i={x:e.x,y:e.y};r=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*r,n=this.pn1*e.y*this.cw*r,e.x=t*this.cg+n*this.sg,e.y=n*this.cg-t*this.sg;var o=eu(e.x,e.y);if(Math.abs(o)<1e-10)i.x=0,i.y=e.y;else{var a,s;switch(s=1-o*o*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/o+o/this.pn1),a=Math.sqrt(1-s*s),this.mode){case sh:i.y=Math.asin(a*this.sinph0+e.y*s*this.cosph0/o),e.y=(a-this.sinph0*Math.sin(i.y))*o,e.x*=s*this.cosph0;break;case ah:i.y=Math.asin(e.y*s/o),e.y=a*o,e.x*=s;break;case ih:i.y=Math.asin(a),e.y=-e.y;break;case oh:i.y=-Math.asin(a)}i.x=Math.atan2(e.x,e.y)}return e.x=i.x+this.long0,e.y=i.y,e},names:["Tilted_Perspective","tpers"]};kc.defaultDatum="WGS84",kc.Proj=yc,kc.WGS84=new kc.Proj("WGS84"),kc.Point=Xc,kc.toPoint=Cc,kc.defs=Wl,kc.nadgrid=function(e,t){var n=new DataView(t),r=function(e){var t=e.getInt32(8,!1);if(11===t)return!1;11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(n),i=function(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:fc(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(n,r);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var o={header:i,subgrids:function(e,t,n){for(var r=[],i=0;i<t.nSubgrids;i++){var o=mc(e,176,n),a=gc(e,176,o,n),s=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),l=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[dc(o.lowerLongitude),dc(o.lowerLatitude)],del:[dc(o.longitudeInterval),dc(o.latitudeInterval)],lim:[s,l],count:o.gridNodeCount,cvs:pc(a)})}return r}(n,i,r)};return uc[e]=o,o},kc.transform=Lc,kc.mgrs=Nc,kc.version="__VERSION__",(ch=kc).Proj.projections.add(Qc),ch.Proj.projections.add(iu),ch.Proj.projections.add(ou),ch.Proj.projections.add(lu),ch.Proj.projections.add(cu),ch.Proj.projections.add(uu),ch.Proj.projections.add(hu),ch.Proj.projections.add(du),ch.Proj.projections.add(fu),ch.Proj.projections.add(wu),ch.Proj.projections.add(Su),ch.Proj.projections.add(Tu),ch.Proj.projections.add(Cu),ch.Proj.projections.add(Au),ch.Proj.projections.add(Lu),ch.Proj.projections.add(Pu),ch.Proj.projections.add(Ru),ch.Proj.projections.add(Ou),ch.Proj.projections.add(ku),ch.Proj.projections.add(Iu),ch.Proj.projections.add(Du),ch.Proj.projections.add(Nu),ch.Proj.projections.add(ju),ch.Proj.projections.add(Fu),ch.Proj.projections.add(Ku),ch.Proj.projections.add(nh),ch.Proj.projections.add(rh),ch.Proj.projections.add(uh);var hh,dh=kc,fh=function(){function e(e,t,n,r){var i,o;if(this.options=n||{},this.options.bounds=n.bounds||[],this.options.transformation=new mh(1,0,-1,0),this.options.origin&&(this.transformation=new mh(1,-this.options.origin[0],-1,this.options.origin[1])),this.projection=new ph(e,t,(i=n.bounds[0],o=n.bounds[1],{min:{x:i[0],y:i[1]},max:{x:o[0],y:o[1]}})),this.R=r,this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var a=this.options.resolutions.length-1;a>=0;a--)this.options.resolutions[a]&&(this._scales[a]=1/this.options.resolutions[a])}}return e.prototype.project=function(e,t,n){return this.projection.project(e)},e.prototype.unproject=function(e,t,n){return this.projection.unproject(e)},e.prototype.latLngToPoint=function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},e.prototype.pointToLatLng=function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},e.prototype.scale=function(e){var t,n=Math.floor(e);return e===n?this._scales[e]:(t=this._scales[n])+(this._scales[n+1]-t)*(e-n)},e}(),ph=function(){function e(e,t,n){var r,i=void 0!==(r=e).inverse&&void 0!==r.forward;this._proj=i?e:this._projFromCodeDef(e,t),this.bounds=i?t:n}return e.prototype.project=function(e){var t=this._proj.forward([e.lng,e.lat]);return{x:t[0],y:t[1]}},e.prototype.unproject=function(e){var t=this._proj.inverse([e.x,e.y]);return{lat:t[1],lng:t[0]}},e.prototype._projFromCodeDef=function(e,t){if(t)dh.defs(e,t);else if(void 0===dh.defs[e]){var n=e.split(":");if(n.length>3&&(e=n[n.length-3]+":"+n[n.length-1]),void 0===dh.defs[e])throw"No projection definition for code "+e}return dh(e)},e}(),mh=function(){function e(e,t,n,r){if(yl.isArray(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=r}return e.prototype.transform=function(e,t){return this._transform({x:e.x,y:e.y},t)},e.prototype._transform=function(e,t){return t=null!=t?t:1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},e.prototype.untransform=function(e,t){return t=null!=t?t:1,{x:(e.x/t-this._b)/this._a,y:(e.y/t-this._d)/this._c}},e}();!function(e){e.Major="major",e.Minor="minor"}(hh||(hh={}));var gh=function(){function e(e,t,n,r){var i=this;if(this.setRadius=function(e,t){void 0===t&&(t=hh.Major),"major"==t.toLowerCase()?i.radii.major=e||i.baseRadius:"minor"==t.toLowerCase()&&(i.radii.minor=e||i.radii.major||i.baseRadius)},this.invertY=function(e,t){var n=i.crs.projection.bounds;if("EPSG:4326"===i.tileMapResource.crsCode)return Math.pow(2,t)-1-e;var r=i.crs.scale(t),o=i.crs.transformation.transform(n.min,r);return Math.ceil(o.y/256)-1-e},this.toBounds=function(e,t){var n={min:{x:null,y:null},max:{x:null,y:null}};return n.min.x=Math.min(e.x,t.x),n.max.x=Math.max(e.x,t.x),n.min.y=Math.min(e.y,t.y),n.max.y=Math.max(e.y,t.y),n},this.tileXYZ2NwSe=function(e,t,n,r){if(null==i.tileMapResource.proj)return null;var o=((r=Math.max(r||1,1))-1)*t,a={x:e.x*t-o,y:e.y*t-o},s={x:a.x+t+2*o,y:a.y+t+2*o},l=i.crs.pointToLatLng(a,e.z),c=i.crs.pointToLatLng(s,e.z);return n?i.toBounds(i.crs.project(l),i.crs.project(c)):{nw:l,se:c}},this.tileXYZ2LatLng=function(e,t,n,r){if(null==i.tileMapResource.proj){var o=e/Math.pow(2,n)*360-180,a=Math.PI-2*Math.PI*t/Math.pow(2,n);return{lat:180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a))),lng:o}}t=-t;var s=i.trueTileResolution*e*i.res[n]+i.tileMapResource.origin[0],l=i.trueTileResolution*t*i.res[n]+i.tileMapResource.origin[1];return i.crs.unproject({x:s,y:l})},this.latLngZ2TileXYZ=function(e,t,n,r){if(null==i.tileMapResource.proj){var o=(t+180)/360*Math.pow(2,n),a=(1-Math.log(Math.tan(e*(Math.PI/180))+1/Math.cos(e*(Math.PI/180)))/Math.PI)/2*Math.pow(2,n);return null==r&&(o=Math.floor(o),a=Math.floor(a)),{x:o,y:a,z:n}}var s=i.crs.project({lng:t,lat:e}),l=s.x,c=s.y;return{x:o=(l-i.tileMapResource.origin[0])/(i.trueTileResolution*i.res[n]),y:a=-(a=(c-i.tileMapResource.origin[1])/(i.trueTileResolution*i.res[n])),z:n}},this.vector3ToLatLng=function(e){var t=e.y,n=e.z;e.y=-n,e.z=-t;var r=i.radii.major/i.radiusScale,o=i.radii.minor/i.radiusScale,a=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),s=Math.pow(r,2)-Math.pow(o,2),l=54*Math.pow(r,2)*Math.pow(e.z,2),c=Math.pow(a,2)+(1-Math.pow(i.e,2))*Math.pow(e.z,2)-Math.pow(i.e,2)*s,u=Math.pow(i.e,4)*l*Math.pow(a,2)/Math.pow(c,3),h=Math.cbrt(1+u+Math.sqrt(Math.pow(u,2)+2*u)),d=l/(3*Math.pow(h+1/h+1,2)*Math.pow(c,2)),f=Math.sqrt(1+2*Math.pow(i.e,4)*d),p=-d*Math.pow(i.e,2)*a/(1+f)+Math.sqrt(.5*Math.pow(r,2)*(1+1/f)-d*(1-Math.pow(i.e,2))*Math.pow(e.z,2)/(f*(1+f))-.5*d*Math.pow(a,2)),m=Math.sqrt(a-Math.pow(i.e,2)*p+Math.pow(e.z,2)),g=Math.sqrt(Math.pow(a-Math.pow(i.e,2)*p,2)+(1-Math.pow(i.e,2))*Math.pow(e.z,2)),v=Math.pow(o,2)*e.z/(r*g),y=m*(1-Math.pow(o,2)/(r*g)),b=Math.atan((e.z+Math.pow(i.ep,2)*v)/a)*(180/Math.PI),_=-Math.atan2(e.y,e.x)*(180/Math.PI)-90;return _<-180&&(_+=360),{lat:b,lng:_,height:y}},this.lonLatToVector3=function(e,t,n){var r=t*(Math.PI/180),o=(e-180)*(Math.PI/180);return{x:(i.radii.major+n)/i.radiusScale*Math.cos(r)*Math.sin(o),y:-(i.radii.major+n)/i.radiusScale*Math.sin(r),z:-(i.radii.major+n)/i.radiusScale*Math.cos(r)*Math.cos(o)}},this.rotatePoint3D=function(e,t,n){null==n&&(n={x:0,y:0,z:0});var r=e.x-n.x,i=e.y-n.y,o=e.z-n.z,a=Math.sin(t.x),s=Math.cos(t.x),l=Math.sin(t.y),c=Math.cos(t.y),u=Math.sin(t.z),h=Math.cos(t.z);return{x:n.x+r*(c*h)+i*(-c*u)+o*l,y:n.y+r*(s*u+a*l*h)+i*(s*h-a*l*u)+o*(-a*c),z:n.z+r*(a*u-s*l*h)+i*(a*h+s*l*u)+o*(s*c)}},this.lngLatDistBetween=function(e,t,n,r){var o=i.radii.major/i.radiusScale,a=t*(Math.PI/180),s=r*(Math.PI/180),l=(r-t)*(Math.PI/180),c=(n-e)*(Math.PI/180),u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(s)*Math.sin(c/2)*Math.sin(c/2);return o*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))},this._reset(),this.setRadius(e,hh.Major),this.setRadius(t,hh.Minor),this.tileMapResource=n||{bounds:null,origin:null,crsCode:null,epsg:null,proj:null,resunitsperpixel:null,reszoomlevel:null},this.tileMapResource.crsCode=this.tileMapResource.crsCode||"EPSG:4326",this.trueTileResolution=r||256,null!=this.tileMapResource.resunitsperpixel&&null!=this.tileMapResource.reszoomlevel){for(var o=this.tileMapResource.resunitsperpixel*Math.pow(2,this.tileMapResource.reszoomlevel),a=[],s=0;s<32;s++)a.push(o/Math.pow(2,s));this.res=a}var l=this.tileMapResource;this.crs=new fh(Number.isFinite(parseInt(l.crsCode[0]))?"EPSG:"+l.epsg:l.crsCode,l.proj,{origin:[parseFloat(l.origin[0]),parseFloat(l.origin[1])],resolutions:this.res,bounds:[[parseFloat(l.bounds[0]),parseFloat(l.bounds[1])],[parseFloat(l.bounds[2]),parseFloat(l.bounds[3])]]},parseFloat(this.radii.major))}return e.prototype._reset=function(){this.baseRadius=6371e3,this.radiusScale=1,this.radii={major:this.baseRadius,minor:this.baseRadius},this.tileMapResource={bounds:null,origin:null,crsCode:"EPSG:4326",proj:null,resunitsperpixel:null,reszoomlevel:null},this.e=0,this.ep=0,this.flatteningFactor=0},e}();var vh={simplePoint:function(){return new Bt({uniforms:{},vertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main() {\ngl_PointSize = 50.\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.)\n}",fragmentShader:"void main() {\ngl_FragColor = vec4(0.0, 1.0, 1.0, 0.0)\n}",transparent:!0})},multiTexture:function(e,t){for(var n=e.length,r=["float Lum(in vec3 RGB) {\n","return 0.3f * RGB.r + 0.59f * RGB.g + 0.11f * RGB.b;\n","}\n","vec3 ClipColor(in vec3 RGB) {\n","float L =Lum(RGB);\n","float x = max(max(RGB.r, RGB.g), RGB.b);\n","float n = min(min(RGB.r, RGB.g), RGB.b);\n","if (n < 0.0f) {\n","RGB.r = L + (((RGB.r - L) * L) / (L - n));\n","RGB.g = L + (((RGB.g - L) * L) / (L - n));\n","RGB.b = L + (((RGB.b - L) * L) / (L - n));\n","}\n","if (x > 1.0f) {\n","RGB.r = L + (((RGB.r - L) * (1.0f - L)) / (x - L));\n","RGB.g = L + (((RGB.g - L) * (1.0f - L)) / (x - L));\n","RGB.b = L + (((RGB.b - L) * (1.0f - L)) / (x - L));\n","}\n","return RGB;\n","}\n","vec3 SetLum(in vec3 RGB, in float l) {\n","float d = l - Lum(RGB);\n","RGB.r = RGB.r + d;\n","RGB.g = RGB.g + d;\n","RGB.b = RGB.b + d;\n","return ClipColor(RGB);\n","}\n","float Screen(in float RGBs, in float RGBb) {\n","return RGBb + RGBs - (RGBb * RGBs);\n","}\n"].join("\n")+"\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n",i=0;i<n;i++)r+="uniform sampler2D t"+i+";\nuniform float tA"+i+";\nuniform float fbrightness"+i+";\nuniform float fcontrast"+i+";\nuniform float fsaturation"+i+";\nuniform float fblendCode"+i+";\n";r+="varying vec2 vUv;\nfloat sat;\nfloat x;\nfloat y;\nvec4 Csat;\nvec3 backdropHSL;\nvec3 currentHSL;\nvoid main(void) {\nvec4 C = vec4(0,0,0,0);\n";var o=0;for(i=0;i<n;i++)r+="vec4 C"+i+" = texture2D(t"+i+", vUv);\n"+(0===e[i].isVAT?"sat = fsaturation"+i+" - 1.0f;\nx = sat * (2.0f / 3.0f) + 1.0f;\ny = (x - 1.0f) * -0.5f;\nCsat = C"+i+";\nC"+i+".r = Csat.r * x + Csat.g * y + Csat.b * y;\nC"+i+".g = Csat.r * y + Csat.g * x + Csat.b * y;\nC"+i+".b = Csat.r * y + Csat.g * y + Csat.b * x;\nC"+i+".rgb *= fbrightness"+i+";\nC"+i+".rgb = ((C"+i+".rgb - 0.5f) * max(fcontrast"+i+", 0.0f)) + 0.5f;\n"+(i>0?"if (fblendCode"+i+" == 1.0f) {\nif (C"+i+".r <= 0.5f) {\nC"+i+".r = 2.0f * C"+i+".r * C.r;\n} else {\nC"+i+".r = Screen(C.r, (2.0f * C"+i+".r) - 1.0f);\n}\nif (C"+i+".g <= 0.5f) {\nC"+i+".g = 2.0f * C"+i+".g * C.g;\n} else {\nC"+i+".g = Screen(C.g, (2.0f * C"+i+".g) - 1.0f);\n}\nif (C"+i+".b <= 0.5f) {\nC"+i+".b = 2.0f * C"+i+".b * C.b;\n} else {\nC"+i+".b = Screen(C.b, (2.0f * C"+i+".b) - 1.0f);\n}\n}\nif (fblendCode"+i+" == 2.0f) {\nC"+i+".rgb = SetLum(C"+i+".rgb, Lum(C.rgb));\n}\n":""):"")+"C = vec4( C"+i+".rgb * (C"+i+".a * tA"+i+") + C.rgb * C.a * (1.0 - (C"+i+".a * tA"+i+")), 1);\n",0===e[i].isVat&&e[i].opacity>o&&(o=e[i].opacity);0===o&&(o=1),r+="if (";for(i=0;i<n;i++)r+=" C"+i+".a == 0.0",i!=n-1&&(r+=" && ");r+="){\ndiscard;\n}\nC.a = "+o.toFixed(1)+"f;\ngl_FragColor = C;\n}";var a={};for(i=0;i<n;i++)a["t"+i]={value:e[i].texture},a["tA"+i]={value:t?0:e[i].opacity},a["fbrightness"+i]={value:e[i].filters.brightness},a["fcontrast"+i]={value:e[i].filters.contrast},a["fsaturation"+i]={value:e[i].filters.saturation},a["fblendCode"+i]={value:e[i].filters.blendCode};return new Bt({uniforms:a,vertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = viewMatrix * modelMatrix * vec4(position, 1.0);\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:r,transparent:!1})},atmosphere:function(e){var t=["varying vec3\tvVertexWorldPosition;","varying vec3\tvVertexNormal;","void main(){","\tvVertexNormal = normalize(normalMatrix * normal);","\tvVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","\t// set gl_Position","\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),n=["#ifdef GL_ES","precision highp float;","#endif","uniform vec3 glowColor;","uniform float coefficient;","uniform float opacity;","uniform float power;","varying vec3 vVertexNormal;","varying vec3 vVertexWorldPosition;","void main(){","\tvec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;","\tvec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;","\tviewCameraToVertex = normalize(viewCameraToVertex);","\tfloat intensity = pow(coefficient + dot(vVertexNormal, viewCameraToVertex), power);","\tgl_FragColor = vec4(glowColor * intensity * opacity, 1.0);"," if (intensity > 0.4) { gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0); }","}"].join("\n");return new Bt({uniforms:{coefficient:{value:.1},power:{value:6},opacity:{value:.5},glowColor:{value:new Ue(e||"#FFFFFF")}},vertexShader:t,fragmentShader:n,blending:2,transparent:!0,depthWrite:!1})}},yh=n(5);function bh(e,t,n,r,i){return new Promise((function(n,i){fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){Object(yh.fromArrayBuffer)(e).then((function(e){e.readRasters().then((function(e){var i=e[0];if(t&&t.demFormatOptions&&!0===t.demFormatOptions.correctSeams){for(var o=--r+2,a=[],s=0;s<r+1;s++)for(var l=0;l<r+1;l++)a.push((i[s*o+l]+i[s*o+l+1]+i[(s+1)*o+l]+i[(s+1)*o+l+1])/4);i=a}n(i)})).catch((function(){i()}))}))})).catch((function(){i()}))}))}var _h=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,n=t?t.byteLength:0;if(e<n)return t;for(var r=512;r<e;)r<<=1;for(var i=new Uint8Array(r),o=0;o<n;++o)i[o]=t[o];return this.buffer=i},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){this.ensureBuffer(t+e);for(var n=t+e;!this.eof&&this.bufferLength<n;)this.readBlock();var r=this.bufferLength;n>r&&(n=r)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}return this.pos=n,this.buffer.subarray(t,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,n){for(var r=e+t;this.bufferLength<=r&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,n)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),xh=function(){var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),n=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),r=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],i=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function o(e){throw new Error(e)}function a(e){var t=0,n=e[t++],r=e[t++];-1!=n&&-1!=r||o("Invalid header in flate stream"),8!=(15&n)&&o("Unknown compression method in flate stream"),((n<<8)+r)%31!=0&&o("Bad FCHECK in flate stream"),32&r&&o("FDICT bit set in flate stream"),this.bytes=e,this.bytesPos=2,this.codeSize=0,this.codeBuf=0,_h.call(this)}return a.prototype=Object.create(_h.prototype),a.prototype.getBits=function(e){for(var t,n=this.codeSize,r=this.codeBuf,i=this.bytes,a=this.bytesPos;n<e;)void 0===(t=i[a++])&&o("Bad encoding in flate stream"),r|=t<<n,n+=8;return t=r&(1<<e)-1,this.codeBuf=r>>e,this.codeSize=n-=e,this.bytesPos=a,t},a.prototype.getCode=function(e){for(var t=e[0],n=e[1],r=this.codeSize,i=this.codeBuf,a=this.bytes,s=this.bytesPos;r<n;){var l;void 0===(l=a[s++])&&o("Bad encoding in flate stream"),i|=l<<r,r+=8}var c=t[i&(1<<n)-1],u=c>>16,h=65535&c;return(0==r||r<u||0==u)&&o("Bad encoding in flate stream"),this.codeBuf=i>>u,this.codeSize=r-u,this.bytesPos=s,h},a.prototype.generateHuffmanTable=function(e){for(var t=e.length,n=0,r=0;r<t;++r)e[r]>n&&(n=e[r]);for(var i=1<<n,o=new Uint32Array(i),a=1,s=0,l=2;a<=n;++a,s<<=1,l<<=1)for(var c=0;c<t;++c)if(e[c]==a){var u=0,h=s;for(r=0;r<a;++r)u=u<<1|1&h,h>>=1;for(r=u;r<i;r+=l)o[r]=a<<16|c;++s}return[o,n]},a.prototype.readBlock=function(){function a(e,t,n,r,i){for(var o=e.getBits(n)+r;o-- >0;)t[p++]=i}var s=this.getBits(3);if(1&s&&(this.eof=!0),0!=(s>>=1)){var l,c;if(1==s)l=r,c=i;else if(2==s){for(var u=this.getBits(5)+257,h=this.getBits(5)+1,d=this.getBits(4)+4,f=Array(e.length),p=0;p<d;)f[e[p++]]=this.getBits(3);for(var m=this.generateHuffmanTable(f),g=0,v=(p=0,u+h),y=new Array(v);p<v;){var b=this.getCode(m);16==b?a(this,y,2,3,g):17==b?a(this,y,3,3,g=0):18==b?a(this,y,7,11,g=0):y[p++]=g=b}l=this.generateHuffmanTable(y.slice(0,u)),c=this.generateHuffmanTable(y.slice(u,v))}else o("Unknown block type in flate stream");for(var _=(O=this.buffer)?O.length:0,x=this.bufferLength;;){var w=this.getCode(l);if(w<256)x+1>=_&&(_=(O=this.ensureBuffer(x+1)).length),O[x++]=w;else{if(256==w)return void(this.bufferLength=x);var M=(w=t[w-=257])>>16;M>0&&(M=this.getBits(M));g=(65535&w)+M;w=this.getCode(c),(M=(w=n[w])>>16)>0&&(M=this.getBits(M));var S=(65535&w)+M;x+g>=_&&(_=(O=this.ensureBuffer(x+g)).length);for(var E=0;E<g;++E,++x)O[x]=O[x-S]}}}else{var T,C=this.bytes,A=this.bytesPos;void 0===(T=C[A++])&&o("Bad block header in flate stream");var L=T;void 0===(T=C[A++])&&o("Bad block header in flate stream"),L|=T<<8,void 0===(T=C[A++])&&o("Bad block header in flate stream");var P=T;void 0===(T=C[A++])&&o("Bad block header in flate stream"),(P|=T<<8)!=(65535&~L)&&o("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var R=this.bufferLength,O=this.ensureBuffer(R+L),k=R+L;this.bufferLength=k;for(var I=R;I<k;++I){if(void 0===(T=C[A++])){this.eof=!0;break}O[I]=T}this.bytesPos=A}},a}(),wh=document.createElement("canvas"),Mh=wh.getContext("2d"),Sh=function(e){Mh.width=e.width,Mh.height=e.height,Mh.clearRect(0,0,e.width,e.height),Mh.putImageData(e,0,0);var t=new Image;return t.src=wh.toDataURL(),t},Eh=function(){function e(e){var t;this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={};for(var n=null;;){var r,i=this.readUInt32(),o="";for(t=0;t<4;t++)o+=String.fromCharCode(this.data[this.pos++]);switch(o){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(i);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var a=this.readUInt16(),s=this.readUInt16()||100;n.delay=1e3*a/s,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===o&&(this.pos+=4,i-=4),r=n&&n.data||this.imgData,t=0;t<i;t++)r.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(i);var l=255-this.transparency.indexed.length;if(l>0)for(t=0;t<l;t++)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(i)[0];break;case 2:this.transparency.rgb=this.read(i)}break;case"tEXt":var c=this.read(i),u=c.indexOf(0),h=String.fromCharCode.apply(String,c.slice(0,u));this.text[h]=String.fromCharCode.apply(String,c.slice(u+1));break;case"IEND":switch(n&&this.animation.frames.push(n),this.colorType){case 0:case 3:case 4:this.colors=1;break;case 2:case 6:this.colors=3}this.hasAlphaChannel=[4,6].includes(this.colorType);var d=this.colors+(this.hasAlphaChannel?1:0);switch(this.pixelBitlength=this.bits*d,this.colors){case 1:this.colorSpace="DeviceGray";break;case 3:this.colorSpace="DeviceRGB"}return void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=i}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return e.load=function(t,n,r,i){var o=new XMLHttpRequest;return o.open("GET",t,!0),o.responseType="arraybuffer",o.withCredentials=n.withCredentials,o.onload=function(){var t=new Uint8Array(o.response||o.mozResponseArrayBuffer);if(404!==o.status){var n=new e(t);return"function"==typeof r?r(n):void 0}"function"==typeof i&&i(o.status)},o.send()},e.prototype.read=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.data[this.pos++];return t},e.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.prototype.decodePixels=function(e){if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);e=(e=new xh(e)).getBytes();var t=this.width,n=this.height,r=this.pixelBitlength/8,i=new Uint8Array(t*n*r),o=e.length,a=0;function s(s,l,c,u,h){void 0===h&&(h=!1);for(var d=Math.ceil((t-s)/c),f=Math.ceil((n-l)/u),p=r*d,m=h?i:new Uint8Array(p*f),g=0,v=0;g<f&&a<o;){var y,b,_,x,w;switch(e[a++]){case 0:for(_=0;_<p;_++)m[v++]=e[a++];break;case 1:for(_=0;_<p;_++)y=e[a++],x=_<r?0:m[v-r],m[v++]=(y+x)%256;break;case 2:for(_=0;_<p;_++)y=e[a++],b=(_-_%r)/r,w=g&&m[(g-1)*p+b*r+_%r],m[v++]=(w+y)%256;break;case 3:for(_=0;_<p;_++)y=e[a++],b=(_-_%r)/r,x=_<r?0:m[v-r],w=g&&m[(g-1)*p+b*r+_%r],m[v++]=(y+Math.floor((x+w)/2))%256;break;case 4:for(_=0;_<p;_++){var M,S;y=e[a++],b=(_-_%r)/r,x=_<r?0:m[v-r],0===g?w=S=0:(w=m[(g-1)*p+b*r+_%r],S=b&&m[(g-1)*p+(b-1)*r+_%r]);var E=x+w-S,T=Math.abs(E-x),C=Math.abs(E-w),A=Math.abs(E-S);M=T<=C&&T<=A?x:C<=A?w:S,m[v++]=(y+M)%256}break;default:throw new Error("Invalid filter algorithm: "+e[a-1])}if(!h){var L=((l+g*u)*t+s)*r,P=g*p;for(_=0;_<d;_++){for(var R=0;R<r;R++)i[L++]=m[P++];L+=(c-1)*r}}g++}}return 1===this.interlaceMethod?(s(0,0,8,8),s(4,0,8,8),s(0,4,4,8),s(2,0,4,4),s(0,2,2,4),s(1,0,2,2),s(0,1,1,2)):s(0,0,1,1,!0),i},e.prototype.decodePalette=function(){for(var e=this.palette,t=e.length,n=this.transparency.indexed||[],r=new Uint8Array((n.length||0)+t),i=0,o=0,a=0;a<t;a+=3){var s;r[i++]=e[a],r[i++]=e[a+1],r[i++]=e[a+2],r[i++]=null!=(s=n[o++])?s:255}return r},e.prototype.copyToImageData=function(e,t){var n,r,i=this.colors,o=null,a=this.hasAlphaChannel;this.palette.length&&(o=this._decodedPalette||(this._decodedPalette=this.decodePalette()),i=4,a=!0);var s=e.data||e,l=s.length,c=o||t,u=n=0;if(1===i)for(;u<l;){r=o?4*t[u/4]:n;var h=c[r++];s[u++]=h,s[u++]=h,s[u++]=h,s[u++]=a?c[r++]:255,n=r}else for(;u<l;)r=o?4*t[u/4]:n,s[u++]=c[r++],s[u++]=c[r++],s[u++]=c[r++],s[u++]=a?c[r++]:255,n=r},e.prototype.decode=function(){var e=new Uint8Array(this.width*this.height*4);return this.copyToImageData(e,this.decodePixels()),e},e.prototype.decodeFrames=function(e){if(this.animation)for(var t=0;t<this.animation.frames.length;t++){var n=this.animation.frames[t],r=e.createImageData(n.width,n.height),i=this.decodePixels(new Uint8Array(n.data));this.copyToImageData(r,i),n.imageData=r,n.image=Sh(r)}},e.prototype.renderFrame=function(e,t){var n=this.animation.frames,r=n[t],i=n[t-1];return 0===t&&e.clearRect(0,0,this.width,this.height),1===(i&&i.disposeOp)?e.clearRect(i.xOffset,i.yOffset,i.width,i.height):2===(i&&i.disposeOp)&&e.putImageData(i.imageData,i.xOffset,i.yOffset),0===r.blendOp&&e.clearRect(r.xOffset,r.yOffset,r.width,r.height),e.drawImage(r.image,r.xOffset,r.yOffset)},e.prototype.animate=function(e){var t=this,n=0,r=this.animation,i=r.numFrames,o=r.frames,a=r.numPlays,s=function(){var r=n++%i,l=o[r];t.renderFrame(e,r),i>1&&n/i<a&&(t.animation._timeout=setTimeout(s,l.delay))};s()},e.prototype.stopAnimation=function(){return clearTimeout(this.animation&&this.animation._timeout)},e.prototype.render=function(e){e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height;var t=e.getContext("2d");if(this.animation)return this.decodeFrames(t),this.animate(t);var n=t.createImageData(this.width,this.height);return this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0)},e}();function Th(e,t,n,r,i){return new Promise((function(t,n){Eh.load(e,{withCredentials:!1},(function(e){if(0!=e){for(var r,i=e.decode(),o=[],a=0;a<i.length;a+=4)o.push(function(e){e.length<32&&(e=("00000000000000000000000000000000"+e).substr(e.length));var t="1"==e.charAt(0)?-1:1,n=parseInt(e.substr(1,8),2)-127,r=e.substr(9),i="1"+r,o=0,a=1,s=0;if(-127==n){if(-1==r.indexOf("1"))return 0;n=-126,i="0"+r}for(;o<i.length;)s+=a*parseInt(i.charAt(o)),a/=2,o++;return t*s*Math.pow(2,n)}(Ch((r={r:i[a],g:i[a+1],b:i[a+2],a:i[a+3]}).r.toString(2))+Ch(r.g.toString(2))+Ch(r.b.toString(2))+Ch(r.a.toString(2))));t(o)}else n()}),(function(e){n(e)}))}))}function Ch(e){for(var t=e;t.length<8;)t="0"+t;return t}var Ah=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Lh=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};function Ph(e,t,n,r,i,o,a){return Ah(this,void 0,void 0,(function(){return Lh(this,(function(s){return[2,new Promise((function(s,l){var c=null,u=a||n.parser;if(null!=u&&e.hasOwnProperty(u))c=e[u];else if(null!=u&&["tif","rgba"].includes(u))switch(u.toLowerCase()){case"tif":c=bh;break;case"rgba":default:c=Th}else{switch(yl.getExtension(t).toLowerCase().toLowerCase()){case"tif":c=bh;break;case"png":default:c=Th}}c(t,n,r,i,o).then((function(e){s(e)})).catch((function(){l("failed")}))}))]}))}))}var Rh=function(){return(Rh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Oh={buildPath:function(e,t,n,r,i,o,a,s){var l;e=e||"tms";var c={x:n.x,y:n.y,z:n.z};switch(e){case"wmts":l=(l=(l=(l=t).replace("{z}",c.z)).replace("{x}",c.x)).replace("{y}",c.y);break;case"wms":l=Oh.wmsExtension.buildPath(t,c,r,i,o,a);break;default:l=(l=(l=t).replace("{z}",c.z)).replace("{x}",c.x),c.y=r.invertY(c.y,c.z),l=l.replace("{y}",c.y)}return s?{path:l,xyz:c}:l},wmsExtension:{defaultWmsParams:{SERVICE:"WMS",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0,VERSION:"1.1.1",WIDTH:null,HEIGHT:null},extensionOptions:{crsCode:"EPSG:4326",uppercase:!0},buildPath:function(e,t,n,r,i,o){var a=Rh({},Oh.wmsExtension.defaultWmsParams);if((o=o||{}).wmsParams)for(var s in o.wmsParams)s in Oh.wmsExtension.extensionOptions||(a[s]=o.wmsParams[s]);a.VERSION=o.wmsVersion||a.VERSION,!0===o.correctSeams?(r--,a.WIDTH=a.HEIGHT=r+2):a.WIDTH=a.HEIGHT=r;var l=n.tileMapResource.crsCode||Oh.wmsExtension.extensionOptions.crsCode;a[parseFloat(a.VERSION)>=1.3?"CRS":"SRS"]=l;var c=n.tileXYZ2NwSe(t,i,!0,!0===o.correctSeams?(r+1)/r:null),u=(parseFloat(a.VERSION)>=1.3&&"EPSG:4326"===l?[c.min.y,c.min.x,c.max.y,c.max.x]:[c.min.x,c.min.y,c.max.x,c.max.y]).join(",");return e+yl.getParamString(a,e,Oh.wmsExtension.extensionOptions.uppercase)+(Oh.wmsExtension.extensionOptions.uppercase?"&BBOX=":"&bbox=")+u}}},kh=Oh,Ih=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Dh=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Nh=function(){function e(e){this.p=e,this._reset()}return e.prototype._reset=function(){this._={loader:new Aa,tileDimension:6},this.tilesDrawn=[],this.tilesWanted=[],this.tilesToBeDrawn=[],this.tilesBeingDrawn=[]},e.prototype.refreshTiles=function(){var e=this;this.updateDesiredTiles(),this.tilesToBeDrawn=[];for(var t=0;t<this.tilesWanted.length;t++){for(var n=!1,r=0;r<this.tilesDrawn.length;r++)if(this.tilesWanted[t].x==this.tilesDrawn[r].x&&this.tilesWanted[t].y==this.tilesDrawn[r].y&&this.tilesWanted[t].z==this.tilesDrawn[r].z&&this.tilesWanted[t].isLODTile==this.tilesDrawn[r].isLODTile&&this.tilesWanted[t].LODLevel==this.tilesDrawn[r].LODLevel&&1!=this.tilesDrawn[r].outdated){n=!0;break}for(r=0;r<this.tilesToBeDrawn.length;r++)if(this.tilesWanted[t].x==this.tilesToBeDrawn[r].x&&this.tilesWanted[t].y==this.tilesToBeDrawn[r].y&&this.tilesWanted[t].z==this.tilesToBeDrawn[r].z&&this.tilesWanted[t].isLODTile==this.tilesToBeDrawn[r].isLODTile&&this.tilesWanted[t].LODLevel==this.tilesToBeDrawn[r].LODLevel){n=!0;break}n||this.tilesToBeDrawn.push(this.tilesWanted[t])}if(this.tilesToBeDrawn.length>0){var i=function(){e.tilesToBeDrawn.length>0&&e.addTile(e.tilesToBeDrawn.pop(),i).catch((function(){i()}))};this.addTile(this.tilesToBeDrawn.pop(),i).catch((function(){i()}))}if(0==this.tilesToBeDrawn.length&&0==this.tilesBeingDrawn.length){for(t=0;t<this.tilesDrawn.length;t++){for(n=!1,r=0;r<this.tilesWanted.length;r++)if(this.tilesDrawn[t].x==this.tilesWanted[r].x&&this.tilesDrawn[t].y==this.tilesWanted[r].y&&this.tilesDrawn[t].z==this.tilesWanted[r].z&&this.tilesDrawn[t].isLODTile==this.tilesWanted[r].isLODTile&&this.tilesDrawn[t].LODLevel==this.tilesWanted[r].LODLevel){n=!0;break}n||this.removeTile(t,!0)}this.removeAllOutdatedTiles()}0==this.tilesToBeDrawn.length&&(this.p._.firstLoad||this.p._onFirstLoad());var o=document.getElementById(this.p.options.loadingSpinnerId),a=document.getElementById(this.p.options.loadingPercentId);0==this.tilesToBeDrawn.length?o&&(o.style.opacity="0"):o&&"0"==o.style.opacity&&(o.style.opacity="1"),a&&(a.innerHTML=this.tilesToBeDrawn.length),this.filterEffects(),this.fadeInTiles(),this.fadeOutTiles()},e.prototype.updateDesiredTiles=function(){this.tilesWanted=[];for(var e,t=this.p.getCenter(),n=this.p.projection.latLngZ2TileXYZ(t.lat,t.lng,this.p.zoom),r=n.x,i=n.y,o=this.p.options.radiusOfTiles,a=r-o+1;a<r+o;a++)for(var s=i-o+1;s<i+o;s++)(e=Math.pow(a-r,2)+Math.pow(s-i,2))<=o*o&&this.tilesWanted.push({x:this.p.projection.tileMapResource.proj?parseInt(a):yl.mod(a,Math.pow(2,this.p.zoom)),y:this.p.projection.tileMapResource.proj?parseInt(s):yl.mod(s,Math.pow(2,this.p.zoom)),z:this.p.zoom,d:e,make:!0,isLODTile:!1});var l=null;if(this.p.options.useLOD)for(var c=0;c<this.p.options.LOD.length;c++){var u=this.p.options.LOD[c].radiusOfTiles,h=Math.max(this.p._.minNativeZoom,this.p.zoom-this.p.options.LOD[c].zoomsUp);if(h==l)break;if(l=h,!(Math.abs(h-this.p.zoom)<=1)){r=(n=this.p.projection.latLngZ2TileXYZ(t.lat,t.lng,h)).x,i=n.y;for(a=r-u+1;a<r+u;a++)for(s=i-u+1;s<i+u;s++)(e=Math.pow(a-r,2)+Math.pow(s-i,2))<=u*u&&this.tilesWanted.push({x:this.p.projection.tileMapResource.proj?parseInt(a):yl.mod(a,Math.pow(2,h)),y:this.p.projection.tileMapResource.proj?parseInt(s):yl.mod(s,Math.pow(2,h)),z:h,d:e,make:!0,isLODTile:!0,LODLevel:c})}}this.tilesWanted.sort((function(e,t){return t.d-e.d})),this.tilesWanted.sort((function(e,t){var n=e.isLODTile?e.LODLevel:-1;return(t.isLODTile?t.LODLevel:-1)-n}))},e.prototype.addTile=function(e,t){return Ih(this,void 0,void 0,(function(){var n,r,i,o,a,s,l,c,u,h,d,f=this;return Dh(this,(function(p){switch(p.label){case 0:if(void 0===e)return[2];for(n={raster:!1,data:!1},r=new kt(new Kt(this._.tileDimension,this._.tileDimension,this.p.options.tileResolution-1,this.p.options.tileResolution-1),new Ve({visible:!1})),this.tilesBeingDrawn.push({x:e.x,y:e.y,z:e.z,isLODTile:e.isLODTile,LODLevel:e.LODLevel,make:e.make}),this.tilesDrawn.push({x:e.x,y:e.y,z:e.z,isLODTile:e.isLODTile,LODLevel:e.LODLevel,t:r,contents:[],from:{dems:[],rasters:[],data:[]}}),i=function(i){if(i&&(r.geometry.dispose(),r.material.dispose(),"function"==typeof t&&t()),n.data){var o=[];if(f.p._.events._.lastZoomDelta<=2)for(var a=f.tilesDrawn.length-1;a>=0;a--)if(e.isLODTile==f.tilesDrawn[a].isLODTile&&e.LODLevel==f.tilesDrawn[a].LODLevel){var s=[f.tilesDrawn[a].x,f.tilesDrawn[a].y,f.tilesDrawn[a].z],l=[e.x,e.y,e.z];e.z<f.tilesDrawn[a].z?yl.tileIsContained(l,s,!0)&&o.push(a):e.z>f.tilesDrawn[a].z&&yl.tileIsContained(s,l)&&(f.tilesDrawn[a].contents.push(l),f.tilesDrawn[a].contents.length>=yl.tileContains(s,e.z).length&&o.push(a))}for(a=f.tilesBeingDrawn.length-1;a>=0;a--)if(f.tilesBeingDrawn[a].x==e.x&&f.tilesBeingDrawn[a].y==e.y&&f.tilesBeingDrawn[a].z==e.z&&f.tilesBeingDrawn[a].isLODTile==e.isLODTile&&f.tilesBeingDrawn[a].LODLevel==e.LODLevel){if(f.tilesBeingDrawn[a].make)e.isLODTile?f.p.planetsLOD[e.LODLevel].add(r):f.p.planet.add(r),f.updateRastersForTile(e),o.forEach((function(e){f.removeTile(e,!0)}));else{r.geometry.dispose(),r.material.dispose();for(var c=f.tilesDrawn.length-1;c>=0;c--)f.tilesDrawn[c].x==e.x&&f.tilesDrawn[c].y==e.y&&f.tilesDrawn[c].z==e.z&&f.tilesDrawn[a].isLODTile==e.isLODTile&&f.tilesDrawn[a].LODLevel==e.LODLevel&&f.tilesDrawn.splice(c,1)}return void f.tilesBeingDrawn.splice(a,1)}}},o=function(t){var o=0,a=Math.pow(f.p.options.tileResolution,2),s=new Float32Array(3*a);null==t&&(t=new Array(a).fill(0));for(var l=0,c=Math.floor(t.length/2),u=0;(null==l||l>f.p.projection.radiusOfPlanetMajor||l<-f.p.projection.radiusOfPlanetMajor)&&u<t.length;)l=t[c],u++;var h=3*Math.floor(r.geometry.attributes.position.array.length/6),d=e.x+h/3%f.p.options.tileResolution/(f.p.options.tileResolution-1),p=e.y+Math.floor(h/3/f.p.options.tileResolution)/(f.p.options.tileResolution-1),m=f.p.projection.tileXYZ2LatLng(d,p,e.z),g=m.lat,v=m.lng,y=g,b=f.p.projection.lonLatToVector3(v,g,l*f.p.options.exaggeration);if(r.position.set(b.x,b.y,b.z),r.geometry.attributes.position.array.length/3==a){for(var _=0,x=void 0,w=0;w<r.geometry.attributes.position.array.length;w+=3){_=t[o]||0,s[w]=0,s[w+1]=0,s[w+2]=0,_=Math.min(_,1e5),_=Math.max(_,-1e5);var M=e.x+w/3%f.p.options.tileResolution/(f.p.options.tileResolution-1),S=e.y+Math.floor(w/3/f.p.options.tileResolution)/(f.p.options.tileResolution-1),E=f.p.projection.tileXYZ2LatLng(M,S,e.z,e),T=E.lat,C=E.lng;f.p.zoom<=f.p._.zCutOff&&(y>75&&T<-88?T=90:y<-75&&T>88&&(T=-90)),x=f.p.projection.lonLatToVector3(C,T,_*f.p.options.exaggeration),r.geometry.attributes.position.array[w]=x.x-b.x,r.geometry.attributes.position.array[w+1]=x.y-b.y,r.geometry.attributes.position.array[w+2]=x.z-b.z,o+=1}r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeVertexNormals(),r.geometry.computeBoundingSphere(),r.geometry.setAttribute("customColor",new Ye(s,3)),n.data=!0,i()}},a=!1,s=null,l=this.p.layers.tile.length-1;l>=0;l--)if(this.p.layers.tile[l].on&&(e.z>=this.p.layers.tile[l].minZoom&&e.z<=this.p.layers.tile[l].maxZoom&&yl.isInExtent(e,this.p.layers.tile[l].boundingBox,this.p.projection)&&yl.isInExtentEN(e,this.p.layers.tile[l].boundingBoxEN,this.p.projection)||"_vectorsastile_"==this.p.layers.tile[l].path)&&(s=l,null!=this.p.layers.tile[l].demPath)){a=!0;break}return c=null,a&&null!=s?(u=kh.buildPath(this.p.layers.tile[s].format,this.p.layers.tile[s].demPath,e,this.p.projection,this.p.options.tileResolution,this.p.options.trueTileResolution,this.p.layers.tile[s].demFormatOptions,!0))?(h=!1,[4,Ph(this.p.options.customParsers,u.path,this.p.layers.tile[s],u.xyz,this.p.options.tileResolution,Math.pow(this.p.options.tileResolution,2)).catch((function(){h=!0}))]):[3,3]:[3,4];case 1:return c=p.sent(),h&&null!=this.p.options.demFallback?(d=kh.buildPath(this.p.options.demFallback.format,this.p.options.demFallback.demPath,e,this.p.projection,this.p.options.tileResolution,this.p.options.trueTileResolution,this.p.layers.tile[s].demFormatOptions,!0))?[4,Ph(this.p.options.customParsers,d.path,this.p.layers.tile[s],d.xyz,this.p.options.tileResolution,Math.pow(this.p.options.tileResolution,2),this.p.options.demFallback.parserType).catch((function(){}))]:[3,3]:[3,3];case 2:c=p.sent(),p.label=3;case 3:return o(c||null),[3,7];case 4:return null==this.p.options.demFallback?[3,6]:(d=kh.buildPath(this.p.options.demFallback.format,this.p.options.demFallback.demPath,e,this.p.projection,this.p.options.tileResolution,this.p.options.trueTileResolution,this.p.layers.tile[s].demFormatOptions,!0))?[4,Ph(this.p.options.customParsers,d.path,this.p.layers.tile[s],d.xyz,this.p.options.tileResolution,Math.pow(this.p.options.tileResolution,2),this.p.options.demFallback.parserType).catch((function(){}))]:[3,6];case 5:c=p.sent(),p.label=6;case 6:o(),p.label=7;case 7:return[2]}}))}))},e.prototype.findTileDrawnBasedOnUUID=function(e){var t=null;return this.tilesDrawn.forEach((function(n){n.t.uuid!==e||(t=n)})),t},e.prototype.findTileDrawnBasedOnXYZLOD=function(e){var t=null;return this.tilesDrawn.forEach((function(n){n.x!==e.x||n.y!==e.y||n.z!==e.z||n.isLODTile!==e.isLODTile||n.LODLevel!=e.LODLevel||(t=n)})),t},e.prototype.updateRastersForTile=function(e){var t=this,n=this.findTileDrawnBasedOnXYZLOD(e);if(null!=n){for(var r=[],i=new Array(this.p.layers.tile.length).fill(!1),o=new Array(this.p.layers.clamped.length).fill(!1),a=function(){if(i.every(Boolean)&&(e.isLODTile||o.every(Boolean))){if(0==r.length)return void(n.t.visible=!1);r.sort((function(e,t){return e.i-t.i})),n.from.rasters=[];for(var a=0,s=0;s<r.length;s++)"tile"==r[s].type&&(n.from.rasters.push({name:r[s].name,type:r[s].type,texture:r[s].texture,opacity:r[s].opacity,isVAT:0,filters:{brightness:1,contrast:1,saturation:1,blendCode:0,blend:0},i:a}),a++);for(s=0;s<r.length;s++)"clamped"==r[s].type&&(n.from.rasters.push({name:r[s].name,type:r[s].type,texture:r[s].texture,opacity:r[s].opacity,isVAT:1,filters:{brightness:1,contrast:1,saturation:1,blendCode:0,blend:0},i:a}),a++);n.t.material=vh.multiTexture(n.from.rasters),t.p.options.wireframeMode&&(n.t.material=new Ve({color:16777215,wireframe:!0})),n.t.material.needsUpdate=!0}},s=function(e){if(l.p.layers.tile[e].on&&n.z>=l.p.layers.tile[e].minZoom&&n.z<=l.p.layers.tile[e].maxZoom&&yl.isInExtent({x:n.x,y:n.y,z:n.z},l.p.layers.tile[e].boundingBox,l.p.projection)){var o=kh.buildPath(l.p.layers.tile[e].format,l.p.layers.tile[e].path,n,l.p.projection,l.p.options.trueTileResolution,l.p.options.trueTileResolution,l.p.layers.tile[e].formatOptions);o?function(e){t._.loader.load(o,(function(n){n.magFilter=1003,n.minFilter=1003,t.p.layers.tile[e]&&r.push({name:t.p.layers.tile[e].name,type:"tile",texture:n,opacity:t.p.layers.tile[e].opacity,i:e}),i[e]=!0,a()}),(function(){console.log("")}),(function(){i[e]=!0,a()}))}(e):(i[e]=!0,a())}else i[e]=!0,a()},l=this,c=0;c<this.p.layers.tile.length;c++)s(c);if(!e.isLODTile)for(c=0;c<this.p.layers.clamped.length;c++)if(this.p.layers.clamped[c].on&&(null==this.p.layers.clamped[c].minZoom||n.z>=this.p.layers.clamped[c].minZoom)&&(null==this.p.layers.clamped[c].maxZoom||n.z<=this.p.layers.clamped[c].maxZoom)&&(null==this.p.layers.clamped[c].boundingBox||yl.isInExtent({x:n.x,y:n.y,z:n.z},this.p.layers.clamped[c].boundingBox,this.p.projection))){var u=this.p.layers._.layerers.clamped.getClampedTexture(c,{x:n.x,y:n.y,z:n.z});n.contains=n.contains||{},n.contains[this.p.layers.clamped[c].name]=u.features;var h=new lo(u.canvas);h.magFilter=1003,h.minFilter=1003,this.p.layers.clamped[c]&&r.push({name:this.p.layers.clamped[c].name,type:"clamped",texture:h,opacity:this.p.layers.clamped[c].opacity,i:c}),o[c]=!0,a()}else o[c]=!0,a()}},e.prototype.updateClampedRasterForTile=function(e,t){if(!this.p.options.wireframeMode&&!e.isLODTile){for(var n=null,r=0;r<this.p.layers.clamped.length;r++)if(this.p.layers.clamped[r].name===t){n=r;break}var i=null!=n?this.p.layers.clamped[n]:null;if(i&&i.on&&(null==i.minZoom||e.z>=i.minZoom)&&(null==i.maxZoom||e.z<=i.maxZoom)&&(null==i.boundingBox||yl.isInExtent({x:e.x,y:e.y,z:e.z},i.boundingBox,this.p.projection))){var o=this.p.layers._.layerers.clamped.getClampedTexture(n,{x:e.x,y:e.y,z:e.z});e.contains=e.contains||{},e.contains[this.p.layers.clamped[n].name]=o.features;var a=new lo(o.canvas);a.magFilter=1003,a.minFilter=1003;for(r=0;r<e.from.rasters.length;r++)if(e.from.rasters[r].name===t){e.from.rasters[r].texture=a;break}e.t.material=vh.multiTexture(e.from.rasters),e.t.material.needsUpdate=!0}}},e.prototype.updateAllRasters=function(){this.killDrawingTiles();for(var e=this.tilesDrawn.length,t=0;t<e;t++){var n=this.tilesDrawn[t];this.updateRastersForTile({x:n.x,y:n.y,z:n.z,isLODTile:n.isLODTile,LODLevel:n.LODLevel})}},e.prototype.removeTile=function(e,t){this.tilesDrawn[e]&&(this.tilesDrawn[e].t.geometry.dispose(),this.tilesDrawn[e].t.material.dispose(),this.tilesDrawn[e].isLODTile?this.p.planetsLOD[this.tilesDrawn[e].LODLevel].remove(this.tilesDrawn[e].t):this.p.planet.remove(this.tilesDrawn[e].t),this.tilesDrawn.splice(e,1))},e.prototype.removeAllTiles=function(){this.killDrawingTiles();for(var e=0;e<this.tilesDrawn.length;e++)this.removeTile(0)},e.prototype.outdateAllTiles=function(){this.killDrawingTiles(),this.tilesDrawn.forEach((function(e){e.outdated=!0}))},e.prototype.removeAllOutdatedTiles=function(){var e=this,t=[];this.tilesDrawn.forEach((function(e,n){e.outdated&&t.push(n)})),(t=t.sort().reverse()).forEach((function(t){e.removeTile(t)}))},e.prototype.removeTileXYZ=function(e){for(var t in this.tilesDrawn)this.tilesDrawn[t].x==e.x&&this.tilesDrawn[t].y==e.y&&this.tilesDrawn[t].z==e.z&&(this.tilesDrawn[t].t.geometry.dispose(),this.tilesDrawn[t].t.material.dispose(),this.tilesDrawn[t].isLODTile?this.p.planetsLOD[this.tilesDrawn[t].LODLevel].remove(this.tilesDrawn[t].t):this.p.planet.remove(this.tilesDrawn[t].t),this.tilesDrawn.splice(t,1))},e.prototype.killDrawingTiles=function(){for(var e in this.tilesToBeDrawn)this.tilesToBeDrawn[e].make=!1;for(var e in this.tilesBeingDrawn)this.tilesBeingDrawn[e].make=!1},e.prototype.filterEffects=function(){var e=this,t=["brightness","contrast","saturation","blendCode"],n=function(n){var i=function(i){if(r.tilesDrawn[n]&&r.tilesDrawn[n].t&&r.tilesDrawn[n].t.material.hasOwnProperty("uniforms")){var o=r.p.layers.getLayerByName(r.tilesDrawn[n].from.rasters[i].name);o&&o.filters&&t.forEach((function(t){var r=o.filters[t];if(null!=r){var a=e.tilesDrawn[n].t.material.uniforms["f"+t+i].value;e.tilesDrawn[n].t.material.uniforms["f"+t+i].value="blendCode"==t?r:r>a?Math.min(e.tilesDrawn[n].t.material.uniforms["f"+t+i].value+.1,r):Math.max(e.tilesDrawn[n].t.material.uniforms["f"+t+i].value-.1,r)}}))}};for(var o in r.tilesDrawn[n].from.rasters)i(o)},r=this;for(var i in this.tilesDrawn)n(i)},e.prototype.fadeInTiles=function(){for(var e in this.tilesDrawn)if(!this.tilesDrawn[e].fadeOutAndRemove)for(var t in this.tilesDrawn[e].from.rasters)if(this.tilesDrawn[e]&&this.tilesDrawn[e].t&&this.tilesDrawn[e].t.material.hasOwnProperty("uniforms")){var n=this.p.layers.getLayerByName(this.tilesDrawn[e].from.rasters[t].name);if(n){var r=n.opacity,i=this.tilesDrawn[e].t.material.uniforms["tA"+t].value;this.tilesDrawn[e].t.material.uniforms["tA"+t].value=r>i?Math.min(this.tilesDrawn[e].t.material.uniforms["tA"+t].value+.1,r):Math.max(this.tilesDrawn[e].t.material.uniforms["tA"+t].value-.1,r)}}},e.prototype.fadeOutTiles=function(){for(var e=this.tilesDrawn.length-1;e>=0;e--)if(this.tilesDrawn[e].fadeOutAndRemove)for(var t=0;this.tilesDrawn[e]&&t<this.tilesDrawn[e].from.rasters.length;t++)if(this.tilesDrawn[e]&&this.tilesDrawn[e].t&&this.tilesDrawn[e].t.material.hasOwnProperty("uniforms")&&null!=this.tilesDrawn[e].t.material.uniforms["tA"+t]){var n=Math.max(this.tilesDrawn[e].t.material.uniforms["tA"+t].value-.1,0);n<=0?this.removeTile(e):this.tilesDrawn[e].t.material.uniforms["tA"+t].value=n}else this.removeTile(e)},e}(),jh=n(0);function Fh(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Bh(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zh(e){return"Feature"===e.type?e.geometry:e}function Uh(e,t,n,r){void 0===r&&(r={});var i=Fh(e),o=Object(jh.degreesToRadians)(i[0]),a=Object(jh.degreesToRadians)(i[1]),s=Object(jh.degreesToRadians)(n),l=Object(jh.lengthToRadians)(t,r.units),c=Math.asin(Math.sin(a)*Math.cos(l)+Math.cos(a)*Math.sin(l)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(l)*Math.cos(a),Math.cos(l)-Math.sin(a)*Math.sin(c)),h=Object(jh.radiansToDegrees)(u),d=Object(jh.radiansToDegrees)(c);return Object(jh.point)([h,d],r.properties)}var Hh=function(e,t,n){void 0===n&&(n={});for(var r=n.steps||64,i=n.properties?n.properties:!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{},o=[],a=0;a<r;a++)o.push(Uh(e,t,-360*a/r,n).geometry.coordinates);return o.push(o[0]),Object(jh.polygon)([o],i)};function Gh(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=Fh(e),i=zh(t),o=i.type,a=t.bbox,s=i.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,a))return!1;"Polygon"===o&&(s=[s]);for(var l=!1,c=0;c<s.length&&!l;c++)if(Wh(r,s[c][0],n.ignoreBoundary)){for(var u=!1,h=1;h<s[c].length&&!u;)Wh(r,s[c][h],!n.ignoreBoundary)&&(u=!0),h++;u||(l=!0)}return l}function Wh(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,o=t.length-1;i<t.length;o=i++){var a=t[i][0],s=t[i][1],l=t[o][0],c=t[o][1];if(e[1]*(a-l)+s*(l-e[0])+c*(e[0]-a)==0&&(a-e[0])*(l-e[0])<=0&&(s-e[1])*(c-e[1])<=0)return!n;s>e[1]!=c>e[1]&&e[0]<(l-a)*(e[1]-s)/(c-s)+a&&(r=!r)}return r}var Vh=n(1);var qh=function(e){if(!e)throw new Error("geojson is required");var t=[];return Object(Vh.flattenEach)(e,(function(e){!function(e,t){var n=[],r=e.geometry;if(null!==r){switch(r.type){case"Polygon":n=Bh(r);break;case"LineString":n=[Bh(r)]}n.forEach((function(n){(function(e,t){var n=[];return e.reduce((function(e,r){var i,o,a,s,l,c,u=Object(jh.lineString)([e,r],t);return u.bbox=(o=r,a=(i=e)[0],s=i[1],l=o[0],c=o[1],[a<l?a:l,s<c?s:c,a>l?a:l,s>c?s:c]),n.push(u),r})),n})(n,e.properties).forEach((function(e){e.id=t.length,t.push(e)}))}))}}(e,t)})),Object(jh.featureCollection)(t)},Xh=n(6),Yh=n.n(Xh);function Zh(e,t){var n=Bh(e),r=Bh(t);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],l=r[0][0],c=r[0][1],u=r[1][0],h=r[1][1],d=(h-c)*(a-i)-(u-l)*(s-o),f=(u-l)*(o-c)-(h-c)*(i-l),p=(a-i)*(o-c)-(s-o)*(i-l);if(0===d)return null;var m=f/d,g=p/d;if(m>=0&&m<=1&&g>=0&&g<=1){var v=i+m*(a-i),y=o+m*(s-o);return Object(jh.point)([v,y])}return null}var Jh=function(e,t){var n={},r=[];if("LineString"===e.type&&(e=Object(jh.feature)(e)),"LineString"===t.type&&(t=Object(jh.feature)(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var i=Zh(e,t);return i&&r.push(i),Object(jh.featureCollection)(r)}var o=Yh()();return o.load(qh(t)),Object(Vh.featureEach)(qh(e),(function(e){Object(Vh.featureEach)(o.search(e),(function(t){var i=Zh(e,t);if(i){var o=Bh(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),Object(jh.featureCollection)(r)},Kh=function(e,t){void 0===t&&(t={});var n=zh(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e,t){void 0===t&&(t={});var n=zh(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{};return Qh(n,r)}(n,t);case"MultiPolygon":return function(e,t){void 0===t&&(t={});var n=zh(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{},i=[];return n.forEach((function(e){i.push(Qh(e,r))})),Object(jh.featureCollection)(i)}(n,t);default:throw new Error("invalid poly")}};function Qh(e,t){return e.length>1?Object(jh.multiLineString)(e,t):Object(jh.lineString)(e[0],t)}function $h(e,t){for(var n=0;n<e.coordinates.length-1;n++)if(td(e.coordinates[n],e.coordinates[n+1],t.coordinates))return!0;return!1}function ed(e,t){for(var n=0,r=t.coordinates;n<r.length;n++){if(Gh(r[n],e))return!0}return Jh(t,Kh(e)).features.length>0}function td(e,t,n){var r=n[0]-e[0],i=n[1]-e[1],o=t[0]-e[0],a=t[1]-e[1];return 0==r*a-i*o&&(Math.abs(o)>=Math.abs(a)?o>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:a>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1])}var nd=function(e,t){var n=!0;return Object(Vh.flattenEach)(e,(function(e){Object(Vh.flattenEach)(t,(function(t){if(!1===n)return!1;n=function(e,t){switch(e.type){case"Point":switch(t.type){case"Point":return n=e.coordinates,r=t.coordinates,!(n[0]===r[0]&&n[1]===r[1]);case"LineString":return!$h(t,e);case"Polygon":return!Gh(e,t)}break;case"LineString":switch(t.type){case"Point":return!$h(e,t);case"LineString":return!function(e,t){if(Jh(e,t).features.length>0)return!0;return!1}(e,t);case"Polygon":return!ed(t,e)}break;case"Polygon":switch(t.type){case"Point":return!Gh(t,e);case"LineString":return!ed(e,t);case"Polygon":return!function(e,t){for(var n=0,r=e.coordinates[0];n<r.length;n++){if(Gh(r[n],t))return!0}for(var i=0,o=t.coordinates[0];i<o.length;i++){if(Gh(o[i],e))return!0}if(Jh(Kh(e),Kh(t)).features.length>0)return!0;return!1}(t,e)}}var n,r;return!1}(e.geometry,t.geometry)}))})),n};function rd(e,t){var n=!1;return Object(Vh.flattenEach)(e,(function(e){Object(Vh.flattenEach)(t,(function(t){if(!0===n)return!0;n=!nd(e.geometry,t.geometry)}))})),n}var id=function(){function e(e){var t=this;this._rotateGlobe=function(e,n){if(n&&(t._.prevMouseXY.x=n.x,t._.prevMouseXY.y=n.y),e){!e.pageX&&e.touches&&(e.pageX=yl.arrayAverage(e.touches,"pageX")),!e.pageY&&e.touches&&(e.pageY=yl.arrayAverage(e.touches,"pageY")),e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&t.p._.cameras.isFirstPerson&&(t._.prevMouseXY.x=0,t._.prevMouseXY.y=0,e.pageX=e.x,e.pageY=e.y);var r=.5*yl.getRadiansPerPixel(t.p.trueZoom)*(t.p._.marsRadius/t.p.projection.radii.major),i=0,o=new _(t.p._.cameras.orbit.camera.position.x,0,t.p._.cameras.orbit.camera.position.z);o.applyAxisAngle(new _(0,1,0),Math.PI/2);var a=new _(t.p._.cameras.orbit.camera.position.x,0,t.p._.cameras.orbit.camera.position.z);if(e.pageY<t._.prevMouseXY.y?(i=Math.abs(e.pageY-t._.prevMouseXY.y),t._rotateAroundArbAxis(o,r*i)):e.pageY>t._.prevMouseXY.y&&(i=Math.abs(e.pageY-t._.prevMouseXY.y),t._rotateAroundArbAxis(o,-r*i)),e.pageX>t._.prevMouseXY.x?(i=Math.abs(e.pageX-t._.prevMouseXY.x),t._rotateAroundArbAxis(a,-r*i)):e.pageX<t._.prevMouseXY.x&&(i=Math.abs(e.pageX-t._.prevMouseXY.x),t._rotateAroundArbAxis(a,r*i)),t._.prevMouseXY.x=e.pageX,t._.prevMouseXY.y=e.pageY,t.p.zoom<=t.p._.zCutOff)t.p._.cameras.orbit.controls.target.x=0,t.p._.cameras.orbit.controls.target.y=-t.p.planetCenter.y,t.p._.cameras.orbit.controls.target.z=0,t.p._.cameras.orbit.controls.update();else{var s=t.p.getCenterElevationRaw();if(null!=s){var l=-(s+t.p.planetCenter.y);0!=l&&-1e4!=l&&(t.p._.cameras.orbit.controls.target.y=l-t.p.options.targetYOffset)}var c=t.p.getCenter();t.p.controls._onMove(c.lng,c.lat,c.height)}}},this._rotateGlobe_MouseDown=function(e){1===e.which||0===e.button?(t._.prevMouseXY.x=e.pageX,t._.prevMouseXY.y=e.pageY,t.p._.sceneContainer.addEventListener("mousemove",t._rotateGlobe,!1),t.p._.sceneContainer.addEventListener("mouseup",t._rotateGlobe_MouseUp,!1),t.p._.sceneContainer.addEventListener("mouseleave",t._rotateGlobe_MouseUp,!1)):e.touches&&e.touches.length>2&&(t._.prevMouseXY.x=yl.arrayAverage(e.touches,"pageX"),t._.prevMouseXY.y=yl.arrayAverage(e.touches,"pageY"),t.p._.sceneContainer.addEventListener("touchmove",t._rotateGlobe,!1),t.p._.sceneContainer.addEventListener("touchend",t._rotateGlobe_MouseUp,!1))},this._rotateGlobe_MouseUp=function(e){t.p._.sceneContainer.removeEventListener("mousemove",t._rotateGlobe),t.p._.sceneContainer.removeEventListener("mouseup",t._rotateGlobe_MouseUp),t.p._.sceneContainer.removeEventListener("mouseleave",t._rotateGlobe_MouseUp),t.p._.sceneContainer.removeEventListener("touchmove",t._rotateGlobe),t.p._.sceneContainer.removeEventListener("touchend",t._rotateGlobe_MouseUp)},this._onZoom=function(e){t._.zoomedSince=0;var n=t.p._.cameras.orbit.camera.position.distanceTo(t.p._.cameras.orbit.controls.target),r=8-(t.p.projection.radiusScale.toString().length-1),i=Math.ceil((r*Math.log(2)-Math.log(n/Math.pow(5,r-1)))/Math.log(2))+1;t._.desiredZoom=i,t._attenuate()},this._onTouchZoom=function(e){e.touches&&1==e.touches.length&&t._onZoom(e)},this._onClick=function(e){if(t.hoveredFeature&&t.hoverInfo){var n=t.p.layers.getLayerByName(t.hoveredFeature.layerName);n&&(t.setActiveFeature({layerName:t.hoveredFeature.layerName,type:t.hoveredFeature.type,obj:t.hoveredFeature.obj,feature:t.hoveredFeature.feature||t.hoveredFeature.obj.feature,lnglat:{lng:t.hoveredFeature.lnglat.lng,lat:t.hoveredFeature.lnglat.lat}}),"function"==typeof n.onClick&&n.onClick(JSON.parse(JSON.stringify(t.hoveredFeature.feature)),JSON.parse(JSON.stringify(t.hoveredFeature.lnglat)),n))}},this._onKeyDown=function(e){if(!t.p._.cameras.isFirstPerson){var n=e.shiftKey?20:8;switch(e.key){case"w":case"ArrowUp":t._rotateGlobe({pageX:0,pageY:n},{x:0,y:0});break;case"a":case"ArrowLeft":t._rotateGlobe({pageX:n,pageY:0},{x:0,y:0});break;case"s":case"ArrowDown":t._rotateGlobe({pageX:0,pageY:-n},{x:0,y:0});break;case"d":case"ArrowRight":t._rotateGlobe({pageX:-n,pageY:0},{x:0,y:0});break;case"g":case"PageDown":var r=(new _).lerpVectors(t.p._.cameras.orbit.camera.position,t.p._.cameras.orbit.controls.target,e.shiftKey?-.035:-.02);t.p._.cameras.orbit.camera.position.set(r.x,r.y,r.z),t._onZoom();break;case"t":case"PageUp":var i=(new _).lerpVectors(t.p._.cameras.orbit.camera.position,t.p._.cameras.orbit.controls.target,e.shiftKey?.035:.02);t.p._.cameras.orbit.camera.position.set(i.x,i.y,i.z),t._onZoom();break;case"q":t.p._.cameras.orbit.controls.rotateLeft(Math.PI/64);break;case"e":t.p._.cameras.orbit.controls.rotateLeft(-Math.PI/64);break;case"r":t.p._.cameras.orbit.controls.rotateUp(Math.PI/64);break;case"f":t.p._.cameras.orbit.controls.rotateUp(-Math.PI/64)}}},this._onMouseMove=function(e){t.p._.mouseIsInScene=!0,t.p._.cameras.isFirstPerson?(t._.mouseXY.x=0,t._.mouseXY.y=0):(t._.mouseXY.x=(e.clientX-t.p._.renderer.domElement.getBoundingClientRect().left)/t.p._.renderer.domElement.clientWidth*2-1,t._.mouseXY.y=-(e.clientY-t.p._.renderer.domElement.getBoundingClientRect().top)/t.p._.renderer.domElement.clientHeight*2+1),t._.containerXY={x:e?e.offsetX:null,y:e?e.offsetY:null},t.updateHoverInfoPosition(),t.p._.raycaster.setFromCamera(t._.mouseXY,t.p._.cameras.camera);for(var n=[],r=0;r<t.p._.tiledWorld.tilesDrawn.length;r++)t.p._.tiledWorld.tilesDrawn[r].isLODTile||n.push(t.p._.tiledWorld.tilesDrawn[r].t);for(r=0;r<t.p.layers.vector.length;r++)if(t.p.layers.vector[r].meshes&&t.p.layers.vector[r].meshes.children)for(var i=0;i<t.p.layers.vector[r].meshes.children.length;i++)n.push(t.p.layers.vector[r].meshes.children[i]);for(r=0;r<t.p.layers.curtain.length;r++)if(t.p.layers.curtain[r].curtain&&t.p.layers.curtain[r].curtain.children)for(i=0;i<t.p.layers.curtain[r].curtain.children.length;i++)n.push(t.p.layers.curtain[r].curtain.children[i]);var o=t.p._.raycaster.intersectObjects(n);if(o.length>0){var a=o[0].object.type,s=null;switch(a){case"Sprite":case"Line2":s=o[0].object;break;case"Mesh":null==(s=t.p._.tiledWorld.findTileDrawnBasedOnUUID(o[0].object.uuid))&&(s=o[0].object);break;default:return}var l=o[0].point;o[0].point.y+=t.p.planetCenter.y,o[0].point=t.p.projection.rotatePoint3D(o[0].point,{x:-t.p.planet.rotation.x,y:0,z:0}),o[0].point=t.p.projection.rotatePoint3D(o[0].point,{x:0,y:-t.p.planet.rotation.y,z:0}),o[0].point=t.p.projection.rotatePoint3D(o[0].point,{x:0,y:0,z:-t.p.planet.rotation.z});var c=t.p.projection.vector3ToLatLng(o[0].point);c.height=l.length()*t.p.projection.radiusScale-t.p.projection.radii.major,t._updateMouseCoords(c.lng,c.lat,c.height),clearTimeout(t._.highlightTimeout),t._.highlightTimeout=setTimeout((function(){t._highlightFeature(c.lng,c.lat,a,s,o[0],l)}),10),t.p.layers._onMouseMove(c,e,s,o[0],l),t.p.controls._onMouseMove(c.lng,c.lat,c.height,e)}else t._updateMouseCoords(null,null,null),t._unhighlightHoveredFeature(),t.p.controls._onMouseMove(null,null,null,e)},this.p=e,this.activeFeature=null,this.hoveredFeature=null,this.hoverInfo=null,this._={mouseXY:{x:null,y:null},prevMouseXY:{x:null,y:null},containerXY:{x:null,y:null},lastZoomDelta:1,desiredZoom:null,zoomedSince:0,zoomWait:30,highlightTimeout:null},this._init()}return e.prototype._init=function(){var e=this;this._matchPlanetsLODToPlanet(),this.p._.sceneContainer.addEventListener("mousewheel",this._onZoom,!1),this.p._.sceneContainer.addEventListener("DOMMouseScroll",this._onZoom,!1),this.p._.sceneContainer.addEventListener("wheel",this._onZoom,!1),this.p._.sceneContainer.addEventListener("mouseleave",this.p.controls._onMouseOut,!1),this.p._.sceneContainer.addEventListener("touchend",this._onTouchZoom),this.p._.sceneContainer.addEventListener("mousedown",this._rotateGlobe_MouseDown,!1),this.p._.sceneContainer.addEventListener("mousemove",this._onMouseMove,!1),this.p._.sceneContainer.addEventListener("click",this._onClick,!1),this.p._.sceneContainer.addEventListener("mouseenter",(function(){e.p._.mouseIsInScene=!0}),!1),this.p._.sceneContainer.addEventListener("mouseleave",(function(){e.p._.mouseIsInScene=!1}),!1),window.addEventListener("keydown",this._onKeyDown,!1)},e.prototype._rotateAroundArbAxis=function(e,t,n){var r=new Y;r.makeRotationAxis(e.normalize(),t),!0!==n&&r.multiply(this.p.planet.matrix),this.p.planet.matrix=r,this.p.planet.rotation.setFromRotationMatrix(this.p.planet.matrix),this._matchPlanetsLODToPlanet(),this._refreshFrontGroupRotation()},e.prototype._checkDesiredZoom=function(){this._.zoomedSince++,null!=this._.desiredZoom&&(this.p._.cameras.setNearFarPlane(this._.desiredZoom<14),this._.zoomedSince>this._.zoomWait&&(this._.desiredZoom>=this.p._.minNativeZoom&&this._setZoom(this._.desiredZoom),this._.desiredZoom=null))},e.prototype._setZoom=function(e){var t=this.p.zoom;this.p.zoom=e,this.p.trueZoom=Math.max(0,e),this.p.zoom<0&&(this.p.zoom=0),this.p.zoom<this.p._.minNativeZoom&&(this.p.zoom=this.p._.minNativeZoom),this.p.zoom>this.p._.maxZoom&&(this.p.zoom=this.p._.maxZoom),this._.lastZoomDelta=Math.abs(this.p.zoom-t)},e.prototype._matchPlanetsLODToPlanet=function(){for(var e=0;e<this.p.planetsLOD.length;e++)this.p.planetsLOD[e].matrix=this.p.planet.matrix,this.p.planetsLOD[e].position.set(this.p.planet.position.x,this.p.planet.position.y,this.p.planet.position.z),this.p.planetsLOD[e].rotation.set(this.p.planet.rotation.x,this.p.planet.rotation.y,this.p.planet.rotation.z);this.p.atmosphere&&(this.p.atmosphere.matrix=this.p.planet.matrix,this.p.atmosphere.position.set(this.p.planet.position.x,this.p.planet.position.y,this.p.planet.position.z),this.p.atmosphere.rotation.set(this.p.planet.rotation.x,this.p.planet.rotation.y,this.p.planet.rotation.z))},e.prototype._refreshFrontGroupRotation=function(){this.p.frontGroup.rotation.set(this.p.planet.rotation.x,this.p.planet.rotation.y,this.p.planet.rotation.z)},e.prototype._updateMouseCoords=function(e,t,n){this.p.mouse.lng=e,this.p.mouse.lat=t,this.p.mouse.elev=n},e.prototype.updateHoverInfoPosition=function(){this.hoverInfo&&(this.hoverInfo.style.left=this._.containerXY.x+14+"px",this.hoverInfo.style.top=this._.containerXY.y+14+"px")},e.prototype._highlightFeature=function(e,t,n,r,i,o){var a={type:"Point",coordinates:[e,t]},s=!1;switch(n){case"Sprite":case"Line2":if(s=!0,1==r.feature._highlighted)return;this._unhighlightHoveredFeature(),r.feature._highlighted=!0,r.restyle(),this.setHoveredFeature({layerName:r.layerName,type:n,obj:r,feature:r.feature,lnglat:{lng:e,lat:t}});break;case"Mesh":if("curtain"===r.layerType);else if("model"===r.layerType);else if(r.contains)for(var l=0,c=Object.keys(r.contains).reverse();l<c.length;l++){for(var u=c[l],h=0,d=r.contains[u].reverse();h<d.length;h++){var f=d[h],p=Object.assign({},f);if("point"===p.geometry.type.toLowerCase()&&(p=Hh(p.geometry.coordinates,p._radiusInMeters||1,{steps:12,units:"meters",properties:p.properties})),rd(p,a)){if(s=!0,1==f._highlighted)return;this._unhighlightHoveredFeature(),f._highlighted=!0,this.setHoveredFeature({layerName:u,type:n,obj:r,feature:f,lnglat:{lng:e,lat:t}}),this.p._.tiledWorld.updateClampedRasterForTile(r,u);break}}if(s)return}}s||this._unhighlightHoveredFeature()},e.prototype._unhighlightHoveredFeature=function(){if(this.hoveredFeature){switch(this.hoveredFeature.feature._highlighted=!1,this.hoveredFeature.type){case"Sprite":case"Line2":this.hoveredFeature.obj.restyle();break;case"Mesh":this.p._.tiledWorld.updateClampedRasterForTile(this.hoveredFeature.obj,this.hoveredFeature.layerName)}this.clearHoveredFeature()}},e.prototype.setHoveredFeature=function(e){this.hoveredFeature=e,this.hoverInfo&&(this.p._.container.removeChild(this.hoverInfo),this.hoverInfo=null),this.hoverInfo=document.createElement("div"),this.hoverInfo.id="_lithosphere_hover_info";var t=this.p.layers.getLayerByName(this.hoveredFeature.layerName);if(t&&t.useKeyAsHoverName){var n=yl.getIn(this.hoveredFeature.feature.properties,t.useKeyAsHoverName.split("."));null!=n&&(this.hoverInfo.innerHTML=yl.capitalizeFirstLetter(t.useKeyAsHoverName+": "+n),this.hoverInfo.style.position="absolute",this.hoverInfo.style.background="black",this.hoverInfo.style.color="white",this.hoverInfo.style.fontSize="16px",this.hoverInfo.style.fontFamily="sans-serif",this.hoverInfo.style.fontWeight="bold",this.hoverInfo.style.padding="4px 8px",this.updateHoverInfoPosition())}this.p._.container.appendChild(this.hoverInfo),this.p._.container.style.cursor="pointer"},e.prototype.clearHoveredFeature=function(){this.hoveredFeature=null,this.hoverInfo&&(this.p._.container.removeChild(this.hoverInfo),this.hoverInfo=null,this.p._.container.style.cursor="default")},e.prototype.setActiveFeature=function(e){switch(this.clearActiveFeature(),this.activeFeature=e,this.activeFeature.feature._active=!0,this.activeFeature.type){case"Sprite":case"Line2":this.activeFeature.obj.restyle();break;case"Mesh":this.p._.tiledWorld.updateClampedRasterForTile(this.activeFeature.obj,this.activeFeature.layerName)}},e.prototype.clearActiveFeature=function(){if(this.activeFeature)switch(this.activeFeature.feature._active=!1,this.activeFeature.type){case"Sprite":case"Line2":this.activeFeature.obj.restyle();break;case"Mesh":this.p._.tiledWorld.updateClampedRasterForTile(this.activeFeature.obj,this.activeFeature.layerName)}this.activeFeature=null},e.prototype._attenuate=function(){var e=this.p._.cameras.camera.position.distanceTo(this.p._.cameras.controls.target)/256;this.p.layers.vector&&this.p.layers.vector.forEach((function(t){t.meshes&&t.meshes.children&&t.meshes.children.forEach((function(t){t instanceof wi&&t.scale.set(e*t.style.radius,e*t.style.radius,e*t.style.radius)}))})),this.p.frontGroup.children&&this.p.frontGroup.children.forEach((function(t){t.children&&t.children.length>0?t.children.forEach((function(t){t instanceof wi&&t.scale.set(e*t.style.radius,e*t.style.radius,e*t.style.radius)})):t instanceof wi&&t.scale.set(e*mesh.style.radius,e*mesh.style.radius,e*mesh.style.radius)}))},e}(),od=n(2),ad=n.n(od);class sd{constructor(){this.maxSize=800,this.minSize=600,this.unloadPercent=.05,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadPriorityCallback=null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize}add(e,t){const n=this.itemSet;if(n.has(e))return!1;if(this.isFull())return!1;const r=this.usedSet,i=this.itemList,o=this.callbacks;return i.push(e),r.add(e),n.set(e,Date.now()),o.set(e,t),!0}remove(e){const t=this.usedSet,n=this.itemSet,r=this.itemList,i=this.callbacks;if(n.has(e)){i.get(e)(e);const o=r.indexOf(e);return r.splice(o,1),t.delete(e),n.delete(e),i.delete(e),!0}return!1}markUsed(e){const t=this.itemSet,n=this.usedSet;t.has(e)&&!n.has(e)&&(t.set(e,Date.now()),n.add(e))}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const e=this.unloadPercent,t=this.minSize,n=this.itemList,r=this.itemSet,i=this.usedSet,o=this.callbacks,a=n.length-i.size,s=n.length-t,l=this.unloadPriorityCallback||this.defaultPriorityCallback;if(s>0&&a>0){n.sort((e,t)=>{const n=i.has(e),r=i.has(t);return n&&r?0:n||r?n?1:-1:l(t)-l(e)});const c=Math.min(s,a),u=Math.max(t*e,c*e);let h=Math.min(u,a);h=Math.ceil(h);const d=n.splice(0,h);for(let e=0,t=d.length;e<t;e++){const t=d[e];o.get(t)(t),r.delete(t),o.delete(t)}}}scheduleUnload(e=!0){var t;this.scheduled||(this.scheduled=!0,t=()=>{this.scheduled=!1,this.unloadUnusedContent(),e&&this.markAllUnused()},Promise.resolve().then(t))}}class ld{constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")}}sort(){const e=this.priorityCallback;this.items.sort((t,n)=>e(t)-e(n))}add(e,t){return new Promise((n,r)=>{const i=this.items,o=this.callbacks;i.push(e),o.set(e,(...e)=>t(...e).then(n).catch(r)),this.autoUpdate&&this.scheduleJobRun()})}remove(e){const t=this.items,n=this.callbacks,r=t.indexOf(e);-1!==r&&(t.splice(r,1),n.delete(e))}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,n=this.maxJobs;let r=this.currJobs;for(;n>r&&e.length>0;){r++;const n=e.pop(),i=t.get(n);t.delete(n),i(n).then(()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()}).catch(()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()})}this.currJobs=r}scheduleJobRun(){this.scheduled||(requestAnimationFrame(()=>{this.tryRunJobs(),this.scheduled=!1}),this.scheduled=!0)}}function cd(e){return 3===e||4===e}function ud(e,t){return e.__lastFrameVisited===t&&e.__used}function hd(e,t){e.__lastFrameVisited!==t&&(e.__lastFrameVisited=t,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1)}function dd(e,t,n){if(hd(e,t),e.__used=!0,n.markUsed(e),e.__contentEmpty){const r=e.children;for(let e=0,i=r.length;e<i;e++)dd(r[e],t,n)}}function fd(e,t,n){if(e.__contentEmpty&&(!e.__externalTileSet||cd(e.__loadingState))){const r=e.children;for(let e=0,i=r.length;e<i;e++){const i=r[e];i.__depthFromRenderedParent=t,fd(i,t,n)}}else n.requestTileContents(e)}function pd(e,t=null,n=null,r=null,i=0){if(t&&t(e,r,i))return void(n&&n(e,r,i));const o=e.children;for(let r=0,a=o.length;r<a;r++)pd(o[r],t,n,e,i+1);n&&n(e,r,i)}const md=e=>1/(e.__depthFromRenderedParent+1);function gd(e){let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return t}class vd{constructor(e,t,n,r){this.buffer=e,this.binOffset=t+n,this.binLength=r;let i=null;if(0!==n){const r=new Uint8Array(e,t,n);i=JSON.parse(gd(r))}else i={};this.header=i}getKeys(){return Object.keys(this.header)}getData(e,t,n=null,r=null){const i=this.header;if(!(e in i))return null;const o=i[e];if(o instanceof Object){if(Array.isArray(o))return o;{const{buffer:i,binOffset:a,binLength:s}=this,l=o.byteOffset||0,c=o.type||r,u=o.componentType||n;if("type"in o&&r&&o.type!==r)throw new Error("FeatureTable: Specified type does not match expected type.");let h,d;switch(c){case"SCALAR":h=1;break;case"VEC2":h=2;break;case"VEC3":h=3;break;case"VEC4":h=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${e}".`)}const f=a+l,p=t*h;switch(u){case"BYTE":d=new Int8Array(i,f,p);break;case"UNSIGNED_BYTE":d=new Uint8Array(i,f,p);break;case"SHORT":d=new Int16Array(i,f,p);break;case"UNSIGNED_SHORT":d=new Uint16Array(i,f,p);break;case"INT":d=new Int32Array(i,f,p);break;case"UNSIGNED_INT":d=new Uint32Array(i,f,p);break;case"FLOAT":d=new Float32Array(i,f,p);break;case"DOUBLE":d=new Float64Array(i,f,p);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${e}".`)}if(f+p*d.BYTES_PER_ELEMENT>a+s)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return o}}class yd extends vd{constructor(e,t,n,r,i){super(e,n,r,i),this.batchSize=t}getData(e,t=null,n=null){return super.getData(e,this.batchSize,n,t)}}var bd=function(){function e(e){_a.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new a(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new d(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(_a.prototype),{constructor:e,load:function(e,t,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ps(e),this.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new wa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{o.parse(n,i,(function(n){t(n),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,a){var s,l={},c={};if("string"==typeof e)s=e;else if(fs(new Uint8Array(e,0,4))===f){try{l[n.KHR_BINARY_GLTF]=new g(e)}catch(e){return void(a&&a(e))}s=l[n.KHR_BINARY_GLTF].content}else s=fs(new Uint8Array(e));var u=JSON.parse(s);if(void 0===u.asset||u.asset.version[0]<2)a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var h=new Z(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(var d=0;d<this.pluginCallbacks.length;d++){var p=this.pluginCallbacks[d](h);c[p.name]=p,l[p.name]=!0}if(u.extensionsUsed)for(d=0;d<u.extensionsUsed.length;++d){var m=u.extensionsUsed[d],b=u.extensionsRequired||[];switch(m){case n.KHR_MATERIALS_UNLIT:l[m]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[m]=new x;break;case n.KHR_DRACO_MESH_COMPRESSION:l[m]=new v(u,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:l[m]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:l[m]=new y;break;case n.KHR_MESH_QUANTIZATION:l[m]=new w;break;default:b.indexOf(m)>=0&&void 0===c[m]&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}h.setExtensions(l),h.setPlugins(c),h.parse(i,a)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=n.KHR_MATERIALS_UNLIT}function a(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function s(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function l(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function h(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function d(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}i.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},i.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],s=new Ue(16777215);void 0!==a.color&&s.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":(i=new ss(s)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new is(s)).distance=l;break;case"spot":(i=new ns(s)).distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,i.angle=a.spot.outerConeAngle,i.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return i.position.set(0,0,0),i.decay=2,void 0!==a.intensity&&(i.intensity=a.intensity),i.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r},i.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))},o.prototype.getMaterialType=function(){return Ve},o.prototype.extendParams=function(e,t,n){var r=[];e.color=new Ue(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)},a.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Yo:null},a.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new u(a,-a)}return Promise.all(i)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Yo:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)},l.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)},h.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],a=r.images[o.source],s=a.uri?n.options.manager.getHandler(a.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,a,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},h.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},d.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,a=r.byteStride,s=new ArrayBuffer(i*a),l=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(s),i,a,l,r.mode,r.filter),s}))}return null};var f="glTF",p=1313821514,m=5130562;function g(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:fs(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-12,i=new DataView(e,12),o=0;o<r;){var a=i.getUint32(o,!0);o+=4;var s=i.getUint32(o,!0);if(o+=4,s===p){var l=new Uint8Array(e,12+o,a);this.content=fs(l)}else if(s===m){var c=12+o;this.body=e.slice(c,c+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function v(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function y(){this.name=n.KHR_TEXTURE_TRANSFORM}function b(e){Xo.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new Ue).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(var s in a)e.uniforms[s]=a[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function x(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return b},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new Ue(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new Ue(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new Ue(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",a)),i.push(n.assignTexture(e,"specularMap",a))}return Promise.all(i)},createMaterial:function(e){var t=new b(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function w(){this.name=n.KHR_MESH_QUANTIZATION}function S(e,t,n,r){ra.call(this,e,t,n,r)}v.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o){var u=N[c]||c.toLowerCase();a[u]=o[c]}for(c in e.attributes){u=N[c]||c.toLowerCase();if(void 0!==o[c]){var h=n.accessors[e.attributes[c]],d=O[h.componentType];l[u]=d,s[u]=!0===h.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),a,l)}))}))},y.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},b.prototype=Object.create(Xo.prototype),b.prototype.constructor=b,b.prototype.copy=function(e){return Xo.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},S.prototype=Object.create(ra.prototype),S.prototype.constructor=S,S.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t},S.prototype.beforeStart_=S.prototype.copySampleValue_,S.prototype.afterEnd_=S.prototype.copySampleValue_,S.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-t,u=(n-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u,b=0;b!==a;b++){var _=o[p+b+a],x=o[p+b+s]*c,w=o[f+b+a],M=o[f+b]*c;i[b]=v*_+y*x+m*w+g*M}return i};var E=0,T=1,C=2,A=3,L=4,P=5,R=6,O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},k={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},I={33071:1001,33648:1002,10497:1e3},D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},N={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},j={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},F={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},z="OPAQUE",U="MASK",H="BLEND";function G(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function W(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function V(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function q(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function X(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function Z(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ys(this.options.manager):this.textureLoader=new Aa(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new wa(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function J(e,t,n){var r=t.attributes,i=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var s=N[a]||a.toLowerCase();s in e.attributes||i.push(o(r[a],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(l)}return V(e,t),function(e,t,n){var r=t.attributes,i=new M;if(void 0!==r.POSITION){var o=(f=n.json.accessors[r.POSITION]).min,a=f.max;if(void 0!==o&&void 0!==a){i.set(new _(o[0],o[1],o[2]),new _(a[0],a[1],a[2]));var s=t.targets;if(void 0!==s){for(var l=new _,c=new _,u=0,h=s.length;u<h;u++){var d=s[u];if(void 0!==d.POSITION){var f;o=(f=n.json.accessors[d.POSITION]).min,a=f.max;void 0!==o&&void 0!==a?(c.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),c.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),c.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}e.boundingBox=i;var p=new B;i.getCenter(p.center),p.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=p}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(r=!0),void 0!==c.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var c=t[o];if(r){var u=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;s.push(u)}if(i){u=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;l.push(u)}}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function K(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var a=n.count-2,s=[];if(2===t)for(o=1;o<=a;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}return Z.prototype.setExtensions=function(e){this.extensions=e},Z.prototype.setPlugins=function(e){this.plugins=e},Z.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};W(i,o,r),V(o,r),e(o)})).catch(t)},Z.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var o=t[r].joints,a=0,s=o.length;a<s;a++)e[o[a]].isBone=!0;for(var l=0,c=e.length;l<c;l++){var u=e[l];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},Z.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},Z.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},Z.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},Z.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},Z.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},Z.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},Z.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,n){r.load(G(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},Z.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},Z.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,o=e[0],a=D[r.type],s=O[r.componentType],l=s.BYTES_PER_ELEMENT,c=l*a,u=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(h&&h!==c){var f=Math.floor(u/h),p="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+f+":"+r.count,m=t.cache.get(p);m||(m=new oi(new s(o,f*h,r.count*h/l),h/l),t.cache.add(p,m)),i=new si(m,a,u%h/l,d)}else i=new Ye(null===o?new s(r.count*a):new s(o,u,r.count*a),a,d);if(void 0!==r.sparse){var g=D.SCALAR,v=O[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,_=new v(e[1],y,r.sparse.count*g),x=new s(e[2],b,r.sparse.count*a);null!==o&&(i=new Ye(i.array.slice(),i.itemSize,i.normalized));for(var w=0,M=_.length;w<M;w++){var S=_[w];if(i.setX(S,x[w*a]),a>=2&&i.setY(S,x[w*a+1]),a>=3&&i.setZ(S,x[w*a+2]),a>=4&&i.setW(S,x[w*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},Z.prototype.loadTexture=function(e){var t,r,i=this.json,o=this.options,a=i.textures[e],s=a.extensions||{};return(t=s[n.MSFT_TEXTURE_DDS]?i.images[s[n.MSFT_TEXTURE_DDS].source]:i.images[a.source]).uri&&(r=o.manager.getHandler(t.uri)),r||(r=s[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,r)},Z.prototype.loadTextureImage=function(e,t,n){var r=this,i=this.json,o=this.options,a=i.textures[e],s=self.URL||self.webkitURL,l=t.uri,c=!1,u=!0;return"image/jpeg"===t.mimeType&&(u=!1),void 0!==t.bufferView&&(l=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);u=6===n||4===n||3===n}c=!0;var r=new Blob([e],{type:t.mimeType});return l=s.createObjectURL(r)}))),Promise.resolve(l).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new lo(e))}),n.load(G(e,o.path),i,void 0,r)}))})).then((function(t){!0===c&&s.revokeObjectURL(l),t.flipY=!1,a.name&&(t.name=a.name),u||(t.format=1022);var n=(i.samplers||{})[a.sampler]||{};return t.magFilter=k[n.magFilter]||1006,t.minFilter=k[n.minFilter]||1008,t.wrapS=I[n.wrapS]||1e3,t.wrapT=I[n.wrapT]||1e3,r.associations.set(t,{type:"textures",index:e}),t}))},Z.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then((function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var s=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,s)}}e[t]=o}))},Z.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,s=Object.keys(t.morphAttributes).length>0,l=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new $i,We.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var h=this.cache.get(c);h||(h=new Hi,We.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(c,h)),n=h}if(r||i||o||a||s){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),a&&(c+="skinning:"),r&&(c+="vertex-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:"),s&&(c+="morph-targets:"),l&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=n.clone(),a&&(d.skinning=!0),i&&(d.vertexColors=!0),o&&(d.flatShading=!0),s&&(d.morphTargets=!0),l&&(d.morphNormals=!0),r&&(d.vertexTangents=!0,d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(c,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},Z.prototype.getMaterialType=function(){return Xo},Z.prototype.loadMaterial=function(e){var t,r=this,i=this.json,o=this.extensions,a=i.materials[e],s={},l=a.extensions||{},c=[];if(l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(s,a,r))}else if(l[n.KHR_MATERIALS_UNLIT]){var d=o[n.KHR_MATERIALS_UNLIT];t=d.getMaterialType(),c.push(d.extendParams(s,a,r))}else{var f=a.pbrMetallicRoughness||{};if(s.color=new Ue(1,1,1),s.opacity=1,Array.isArray(f.baseColorFactor)){var p=f.baseColorFactor;s.color.fromArray(p),s.opacity=p[3]}void 0!==f.baseColorTexture&&c.push(r.assignTexture(s,"map",f.baseColorTexture)),s.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,s.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(c.push(r.assignTexture(s,"metalnessMap",f.metallicRoughnessTexture)),c.push(r.assignTexture(s,"roughnessMap",f.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===a.doubleSided&&(s.side=2);var m=a.alphaMode||z;return m===H?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,m===U&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==Ve&&(c.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new u(1,-1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==Ve&&(c.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==Ve&&(s.emissive=(new Ue).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==Ve&&c.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(c).then((function(){var i;return i=t===b?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),a.name&&(i.name=a.name),i.map&&(i.map.encoding=3001),i.emissiveMap&&(i.emissiveMap.encoding=3001),V(i,a),r.associations.set(i,{type:"materials",index:e}),a.extensions&&W(o,i,a),i}))},Z.prototype.createUniqueName=function(e){for(var t=Us.sanitizeNodeName(e||""),n=t,r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n},Z.prototype.loadGeometries=function(e){var t=this,r=this.extensions,i=this.primitiveCache;function o(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return J(n,e,t)}))}for(var a,s,l=[],c=0,u=e.length;c<u;c++){var h,d=e[c],f=(s=void 0,(s=(a=d).extensions&&a.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+X(s.attributes):a.indices+":"+X(a.attributes)+":"+a.mode),p=i[f];if(p)l.push(p.promise);else h=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(d):J(new mt,d,t),i[f]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},Z.prototype.loadMesh=function(e){for(var t,n=this,r=this.json,i=this.extensions,o=r.meshes[e],a=o.primitives,s=[],l=0,c=a.length;l<c;l++){var u=void 0===a[l].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new Xo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial):this.getDependency("material",a[l].material);s.push(u)}return s.push(n.loadGeometries(a)),Promise.all(s).then((function(t){for(var r=t.slice(0,t.length-1),s=t[t.length-1],l=[],c=0,u=s.length;c<u;c++){var h,d=s[c],f=a[c],p=r[c];if(f.mode===L||f.mode===P||f.mode===R||void 0===f.mode)h=!0===o.isSkinnedMesh?new Oi(d,p):new kt(d,p),!0===p.isMeshStandardMaterial&&2===p.side&&null!==d.getIndex()&&!0===d.hasAttribute("position")&&!0===d.hasAttribute("normal")&&!0===d.hasAttribute("uv")&&!1===d.hasAttribute("tangent")&&(d.computeTangents(),p.vertexTangents=!0),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),f.mode===P?h.geometry=K(h.geometry,1):f.mode===R&&(h.geometry=K(h.geometry,2));else if(f.mode===T)h=new Ki(d,p);else if(f.mode===A)h=new Yi(d,p);else if(f.mode===C)h=new Qi(d,p);else{if(f.mode!==E)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);h=new io(d,p)}Object.keys(h.geometry.morphAttributes).length>0&&q(h,o),h.name=n.createUniqueName(o.name||"mesh_"+e),V(h,o),f.extensions&&W(i,h,f),n.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new Qr;for(c=0,u=l.length;c<u;c++)m.add(l[c]);return m}))},Z.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new Ut(c.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new os(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),V(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},Z.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},Z.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],u=t.samplers[c.sampler],h=c.target,d=void 0!==h.node?h.node:h.id,f=void 0!==t.parameters?t.parameters[u.input]:u.input,p=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",p)),o.push(u),a.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=[],c=0,u=r.length;c<u;c++){var h=r[c],d=i[c],f=o[c],p=a[c],m=s[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,j[m.path]){case j.weights:g=ua;break;case j.rotation:g=da;break;case j.position:case j.scale:default:g=pa}var v=h.name?h.name:h.uuid,y=void 0!==p.interpolation?F[p.interpolation]:2301,b=[];j[m.path]===j.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(v);var _=f.array;if(f.normalized){var x;if(_.constructor===Int8Array)x=1/127;else if(_.constructor===Uint8Array)x=1/255;else if(_.constructor==Int16Array)x=1/32767;else{if(_.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var w=new Float32Array(_.length),M=0,E=_.length;M<E;M++)w[M]=_[M]*x;_=w}for(M=0,E=b.length;M<E;M++){var T=new g(b[M]+"."+j[m.path],d.array,_,y);"CUBICSPLINE"===p.interpolation&&(T.createInterpolant=function(e){return new S(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(T)}}}return new ma(t.name?t.name:"animation_"+e,void 0,l)}))},Z.prototype.loadNode=function(e){var t,n=this.json,r=this.extensions,i=this,o=n.nodes[e],a=o.name?i.createUniqueName(o.name):"";return(t=[],void 0!==o.mesh&&t.push(i.getDependency("mesh",o.mesh).then((function(e){var t=i._getNodeRef(i.meshCache,o.mesh,e);return void 0!==o.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=o.weights.length;t<n;t++)e.morphTargetInfluences[t]=o.weights[t]})),t}))),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===o.isBone?new ki:t.length>1?new Qr:1===t.length?t[0]:new be)!==t[0])for(var s=0,l=t.length;s<l;s++)n.add(t[s]);if(o.name&&(n.userData.name=o.name,n.name=a),V(n,o),o.extensions&&W(r,n,o),void 0!==o.matrix){var c=new Y;c.fromArray(o.matrix),n.applyMatrix4(c)}else void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale);return i.associations.set(n,{type:"nodes",index:e}),n}))},Z.prototype.loadScene=function(){function e(t,n,r,i){var o=r.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===o.skin?e:i.getDependency("skin",o.skin).then((function(e){for(var n=[],r=0,o=(t=e).joints.length;r<o;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){r.push(s);var l=new Y;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),i.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new Ni(r,i),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,r,i))}return Promise.all(a)}))}return function(t){var n=this.json,r=this.extensions,i=this.json.scenes[t],o=new Qr;i.name&&(o.name=this.createUniqueName(i.name)),V(o,i),i.extensions&&W(r,o,i);for(var a=i.nodes||[],s=[],l=0,c=a.length;l<c;l++)s.push(e(a[l],o,n,this));return Promise.all(s).then((function(){return o}))}}(),e}();class _d extends class{constructor(){this.fetchOptions={}}load(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(e=>this.parse(e))}parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("b3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),s=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+o+a),u=new vd(c,0,o,a),h=28+o+a,d=e.slice(h,h+s+l),f=new yd(d,u.getData("BATCH_LENGTH"),0,s,l),p=h+s+l;return{version:r,featureTable:u,batchTable:f,glbBytes:new Uint8Array(e,p,i-p)}}}{constructor(e=ba){super(),this.manager=e}parse(e){const t=super.parse(e),n=t.glbBytes.slice().buffer;return new Promise((e,r)=>{const i=this.manager;(i.getHandler("path.gltf")||new bd(i)).parse(n,null,n=>{const{batchTable:r,featureTable:i}=t,{scene:o}=n,a=i.getData("RTC_CENTER");a&&(o.position.x+=a[0],o.position.y+=a[1],o.position.z+=a[2]),n.batchTable=r,n.featureTable=i,o.batchTable=r,o.featureTable=i,e(n)},r)})}}class xd extends class{constructor(){this.fetchOptions={}}load(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(e=>this.parse(e))}parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("pnts"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),s=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+o+a),u=new vd(c,0,o,a),h=28+o+a,d=e.slice(h,h+s+l),f=new yd(d,u.getData("BATCH_LENGTH")||u.getData("POINTS_LENGTH"),0,s,l);return{version:r,featureTable:u,batchTable:f}}}{constructor(e=ba){super(),this.manager=e}parse(e){const t=super.parse(e),{featureTable:n}=t,r=n.getData("POINTS_LENGTH"),i=n.getData("POSITION",r,"FLOAT","VEC3"),o=n.getData("RGB",r,"UNSIGNED_BYTE","VEC3");if(null===i)throw new Error("PNTSLoader : POSITION_QUANTIZED feature type is not supported.");const a=new mt;a.setAttribute("position",new Ye(i,3,!1));const s=new $i;s.size=2,s.sizeAttenuation=!1,null!==o&&(a.setAttribute("color",new Ye(o,3,!0)),s.vertexColors=!0);const l=new io(a,s);return t.scene=l,t.scene.featureTable=n,t}}const wd=new _,Md=new b,Sd=new _,Ed=new Y;class Td extends class{constructor(){this.fetchOptions={},this.workingPath=""}resolveExternalURL(e){return this.workingPath+"/"+e}load(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(t=>{if(""===this.workingPath){const t=e.split(/\\\//g);t.pop(),this.workingPath=t.join("/")}return this.parse(t)})}parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("i3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),s=t.getUint32(20,!0),l=t.getUint32(24,!0),c=t.getUint32(28,!0),u=e.slice(32,32+o+a),h=new vd(u,0,o,a),d=32+o+a,f=e.slice(d,d+s+l),p=new yd(f,h.getData("INSTANCES_LENGTH"),0,s,l),m=d+s+l,g=new Uint8Array(e,m,i-m);let v=null,y=null;if(c)v=g,y=Promise.resolve();else{const e=this.resolveExternalURL(gd(g));y=fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(e=>{v=new Uint8Array(e)})}return y.then(()=>({version:r,featureTable:h,batchTable:p,glbBytes:v}))}}{constructor(e=ba){super(),this.manager=e}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then(e=>{const{featureTable:t,batchTable:n}=e,r=e.glbBytes.slice().buffer;return new Promise((e,i)=>{const o=this.manager;(o.getHandler("path.gltf")||new bd(o)).parse(r,null,r=>{const i=t.getData("INSTANCES_LENGTH"),o=t.getData("POSITION",i,"FLOAT","VEC3"),a=new Map,s=[];r.scene.traverse(e=>{if(e.isMesh){const{geometry:t,material:n}=e,r=new Ui(t,n,i);s.push(r),a.set(e,r)}});const l=new _;for(let e=0;e<i;e++)l.x+=o[3*e+0]/i,l.y+=o[3*e+1]/i,l.z+=o[3*e+2]/i;a.forEach((e,t)=>{const n=t.parent;n&&(n.remove(t),n.add(e),e.position.copy(l))});for(let e=0;e<i;e++){wd.set(o[3*e+0]-l.x,o[3*e+1]-l.y,o[3*e+2]-l.z),Md.set(0,0,0,1),Sd.set(1,1,1),Ed.compose(wd,Md,Sd);for(let t=0,n=s.length;t<n;t++){s[t].setMatrixAt(e,Ed)}}r.batchTable=n,r.featureTable=t,r.scene.batchTable=n,r.scene.featureTable=t,e(r)},i)})})}}class Cd extends class{constructor(){this.fetchOptions={},this.workingPath=""}load(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(t=>{if(""===this.workingPath){const t=e.split(/\\\//g);t.pop(),this.workingPath=t.join("/")}return this.parse(t)})}parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("cmpt"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const o=t.getUint32(12,!0),a=[];let s=16;for(let t=0;t<o;t++){const t=new DataView(e,s,12),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3)),r=t.getUint32(4,!0),i=t.getUint32(8,!0),o=new Uint8Array(e,s,i);a.push({type:n,buffer:o,version:r}),s+=i}return{version:r,tiles:a}}}{constructor(e=ba){super(),this.manager=e}parse(e){const t=super.parse(e),n=this.manager,r=new Qr,i=[],o=[];for(const e in t.tiles){const{type:a,buffer:s}=t.tiles[e];switch(a){case"b3dm":{const e=s.slice(),t=new _d(n).parse(e.buffer).then(e=>{i.push(e),r.add(e.scene)});o.push(t);break}case"pnts":{const e=s.slice(),t=new xd(n).parse(e.buffer);i.push(t),r.add(t.scene);break}case"i3dm":{const e=s.slice(),t=new Td(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const a=t.parse(e.buffer).then(e=>{i.push(e),r.add(e.scene)});o.push(a);break}}}return Promise.all(o).then(()=>({tiles:i,scene:r}))}}const Ad=new Y;class Ld extends Qr{constructor(e){super(),this.tilesRenderer=e}raycast(e,t){this.tilesRenderer.raycast(e,t)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?Ad.copy(this.matrix):Ad.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=Ad.elements,t=this.matrixWorld.elements;let n=!1;for(let r=0;r<16;r++){const i=e[r],o=t[r];if(Math.abs(i-o)>Number.EPSILON){n=!0;break}}if(n){this.matrixWorld.copy(Ad);const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateMatrixWorld()}}}}const Pd=new B,Rd=new Y,Od=new _,kd=new _,Id=new X,Dd=[];function Nd(e,t){return e.distance-t.distance}function jd(e,t,n){e.traverse(e=>{Object.getPrototypeOf(e).raycast.call(e,t,n)})}const Fd=Symbol("INITIAL_FRUSTUM_CULLED"),Bd=c.DEG2RAD,zd=new Y,Ud=new Y,Hd=new _,Gd=new _,Wd=new _,Vd=new _,qd=new _(1,0,0),Xd=new _(0,1,0);function Yd(){}function Zd(e,t){e.traverse(e=>{e.frustumCulled=e[Fd]&&t})}class Jd extends class{get rootTileSet(){const e=this.tileSets[this.rootURL];return!e||e instanceof Promise?null:e}get root(){const e=this.rootTileSet;return e?e.root:null}constructor(e){this.tileSets={},this.rootURL=e,this.fetchOptions={},this.preprocessURL=null;const t=new sd;t.unloadPriorityCallback=md;const n=new ld;n.maxJobs=4,n.priorityCallback=md;const r=new ld;r.maxJobs=1,r.priorityCallback=md,this.lruCache=t,this.downloadQueue=n,this.parseQueue=r,this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this.errorThreshold=1/0,this.loadSiblings=!0,this.displayActiveTiles=!1,this.maxDepth=1/0,this.stopAtEmptyTiles=!0}traverse(e,t){const n=this.tileSets[this.rootURL];n&&n.root&&pd(n.root,e,t)}update(){const e=this.stats,t=this.lruCache,n=this.tileSets,r=n[this.rootURL];if(!(this.rootURL in n))return void this.loadRootTileSet(this.rootURL);if(!r||!r.root)return;const i=r.root;e.inFrustum=0,e.used=0,e.active=0,e.visible=0,this.frameCount++,function e(t,n){const r=n.stats,i=n.frameCount,o=n.errorTarget,a=n.maxDepth,s=n.loadSiblings,l=n.lruCache,c=n.stopAtEmptyTiles;if(hd(t,i),!1===n.tileInView(t))return!1;if(t.__used=!0,l.markUsed(t),t.__inFrustum=!0,r.inFrustum++,(c||!t.__contentEmpty)&&!t.__externalTileSet){const e=n.calculateError(t);if(t.__error=e,e<=o)return!0;if(n.maxDepth>0&&t.__depth+1>=a)return!0}let u=!1;const h=t.children;for(let t=0,r=h.length;t<r;t++){const r=e(h[t],n);u=u||r}if(u&&s)for(let e=0,t=h.length;e<t;e++){dd(h[e],i,l)}return!0}(i,this),function e(t,n){const r=n.stats,i=n.frameCount;if(!ud(t,i))return;r.used++;const o=t.children;let a=!1;for(let e=0,t=o.length;e<t;e++){const t=o[e];a=a||ud(t,i)}if(a){let r=!1,a=!0;for(let t=0,s=o.length;t<s;t++){const s=o[t];if(e(s,n),r=r||s.__wasSetVisible||s.__childrenWereVisible,ud(s,i)){const e=s.__allChildrenLoaded||!s.__contentEmpty&&cd(s.__loadingState)||s.__externalTileSet&&4===s.__loadingState;a=a&&e}}t.__childrenWereVisible=r,t.__allChildrenLoaded=a}else t.__isLeaf=!0}(i,this),function e(t,n){const r=n.stats,i=n.frameCount;if(!ud(t,i))return;const o=t.parent,a=o?o.__depthFromRenderedParent:-1;t.__depthFromRenderedParent=a;const s=n.lruCache;if(t.__isLeaf)return t.__depthFromRenderedParent++,void(3===t.__loadingState?(t.__inFrustum&&(t.__visible=!0,r.visible++),t.__active=!0,r.active++):s.isFull()||t.__contentEmpty&&!t.__externalTileSet||n.requestTileContents(t));const l=(n.errorTarget+1)*n.errorThreshold,c=t.__error<=l,u=c||"ADD"===t.refine,h=!t.__contentEmpty,d=h||t.__externalTileSet,f=cd(t.__loadingState)&&d,p=t.__childrenWereVisible,m=t.children;let g=t.__allChildrenLoaded;if(u&&h&&t.__depthFromRenderedParent++,u&&!f&&!s.isFull()&&d&&n.requestTileContents(t),(c&&!g&&!p&&f||"ADD"===t.refine&&f)&&(t.__inFrustum&&(t.__visible=!0,r.visible++),t.__active=!0,r.active++),"ADD"!==t.refine&&c&&!g&&f)for(let e=0,r=m.length;e<r;e++){const r=m[e];ud(r,i)&&!s.isFull()&&(r.__depthFromRenderedParent=t.__depthFromRenderedParent+1,fd(r,r.__depthFromRenderedParent,n))}else for(let t=0,r=m.length;t<r;t++){const r=m[t];ud(r,i)&&e(r,n)}}(i,this),function e(t,n){const r=ud(t,n.frameCount);if(r||t.__usedLastFrame){let i=!1,o=!1;r&&(i=t.__active,o=n.displayActiveTiles&&t.__active||t.__visible),t.__contentEmpty||3!==t.__loadingState||(t.__wasSetActive!==i&&n.setTileActive(t,i),t.__wasSetVisible!==o&&n.setTileVisible(t,o)),t.__wasSetActive=i,t.__wasSetVisible=o,t.__usedLastFrame=r;const a=t.children;for(let t=0,r=a.length;t<r;t++){e(a[t],n)}}}(i,this),t.scheduleUnload()}parseTile(e,t,n){return null}disposeTile(e){}preprocessNode(e,t,n){e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.uri&&(e.content.uri=function(...e){const t=/^[a-zA-Z]+:\/\//;let n=-1;for(let r=0,i=e.length;r<i;r++)t.test(e[r])&&(n=r);if(-1===n)return ad.a.join(...e).replace(/\\/g,"/");{const r=n<=0?e:e.slice(n),i=r[0].match(t)[0];return r[0]=r[0].substring(i.length),(i+ad.a.join(...r)).replace(/\\/g,"/")}}(n,e.content.uri)),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=t,e.children=e.children||[];if(e.content&&e.content.uri){const t=/\.json$/i.test(e.content.uri);e.__externalTileSet=t,e.__contentEmpty=t}else e.__externalTileSet=!1,e.__contentEmpty=!0;e.__error=0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,e.__loadIndex=0,e.__loadAbort=null,e.__depthFromRenderedParent=-1,null===t?(e.__depth=0,e.refine=e.refine||"REPLACE"):(e.__depth=t.__depth+1,e.refine=e.refine||t.refine)}setTileActive(e,t){}setTileVisible(e,t){}calculateError(e){return 0}tileInView(e){return!0}fetchTileSet(e,t,n=null){return fetch(e,t).then(t=>{if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)}).then(t=>{const r=t.asset.version;console.assert("1.0"===r||"0.0"===r,'asset.version is expected to be a string of "1.0" or "0.0"');const i=ad.a.dirname(e);return pd(t.root,(e,t)=>this.preprocessNode(e,t,i),null,n,n?n.__depth:0),t})}loadRootTileSet(e){const t=this.tileSets;if(e in t)return t[e]instanceof Error?Promise.reject(t[e]):Promise.resolve(t[e]);{const n=this.fetchTileSet(e,this.fetchOptions).then(n=>{t[e]=n});return n.catch(n=>{console.error(n),t[e]=n}),t[e]=n,n}}requestTileContents(e){if(0!==e.__loadingState)return;const t=this.stats,n=this.lruCache,r=this.downloadQueue,i=this.parseQueue,o=e.__externalTileSet;n.add(e,e=>{1===e.__loadingState?(e.__loadAbort.abort(),e.__loadAbort=null):o?e.children.length=0:this.disposeTile(e),1===e.__loadingState?t.downloading--:2===e.__loadingState&&t.parsing--,e.__loadingState=0,e.__loadIndex++,i.remove(e),r.remove(e)}),e.__loadIndex++;const a=e.__loadIndex,s=new AbortController,l=s.signal;t.downloading++,e.__loadAbort=s,e.__loadingState=1;const c=o=>{e.__loadIndex===a&&("AbortError"!==o.name?(i.remove(e),r.remove(e),2===e.__loadingState?t.parsing--:1===e.__loadingState&&t.downloading--,t.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(o),e.__loadingState=4):n.remove(e))};o?r.add(e,e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return this.fetchTileSet(t,Object.assign({signal:l},this.fetchOptions),e)}).then(n=>{e.__loadIndex===a&&(t.downloading--,e.__loadAbort=null,e.__loadingState=3,e.children.push(n.root))}).catch(c):r.add(e,e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return fetch(t,Object.assign({signal:l},this.fetchOptions))}).then(t=>{if(e.__loadIndex===a){if(t.ok)return t.arrayBuffer();throw new Error("Failed to load model with error code "+t.status)}}).then(n=>{if(e.__loadIndex===a)return t.downloading--,t.parsing++,e.__loadAbort=null,e.__loadingState=2,i.add(e,e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=e.content.uri.split(/\./g).pop();return this.parseTile(n,e,t)})}).then(()=>{e.__loadIndex===a&&(t.parsing--,e.__loadingState=3,e.__wasSetVisible&&this.setTileVisible(e,!0),e.__wasSetActive&&this.setTileActive(e,!0))}).catch(c)}dispose(){const e=this.lruCache;this.traverse(t=>{e.remove(t)})}}{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.traverse(t=>{t.scene&&Zd(t.scene,e)}))}constructor(...e){super(...e),this.group=new Ld(this),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this.activeTiles=new Set,this.visibleTiles=new Set,this._autoDisableRendererCulling=!0,this.onLoadTileSet=null,this.onLoadModel=null,this.onDisposeModel=null;const t=new ya;t.setURLModifier(e=>this.preprocessURL?this.preprocessURL(e):e),this.manager=t}getBounds(e){if(!this.root)return!1;const t=this.root.cached,n=t.box,r=t.boxTransform;return!!n&&(e.copy(n),e.applyMatrix4(r),!0)}getOrientedBounds(e,t){if(!this.root)return!1;const n=this.root.cached,r=n.box,i=n.boxTransform;return!!e&&(e.copy(r),t.copy(i),!0)}forEachLoadedModel(e){this.traverse(t=>{const n=t.cached.scene;n&&e(n,t)})}raycast(e,t){if(this.root)if(e.firstHitOnly){const n=function e(t,n,r,i){if(r.has(t)){if(jd(t.cached.scene,i,Dd),Dd.length>0){Dd.length>1&&Dd.sort(Nd);const e=Dd[0];return Dd.length=0,e}return null}const o=[],a=t.children;for(let e=0,t=a.length;e<t;e++){const t=a[e],r=t.cached,s=n.matrixWorld;Rd.copy(s);const l=r.sphere;if(l&&(Pd.copy(l),Pd.applyMatrix4(Rd),!i.ray.intersectsSphere(Pd)))continue;const c=r.box,u=r.boxTransform;if(c){if(Rd.multiply(u).invert(),Id.copy(i.ray),Id.applyMatrix4(Rd),!Id.intersectBox(c,Od))continue;{let e;kd.setFromMatrixScale(Rd),e=kd.x,Math.abs(Math.max(kd.x-kd.y,kd.x-kd.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when raycasting.");let n={distance:1/0,tile:null};o.push(n),n.distance=Od.distanceToSquared(Id.origin)*e*e,n.tile=t}}}o.sort(Nd);let s=1/0,l=null;for(let t=0,a=o.length;t<a;t++){const a=o[t];if(a.distance>s)break;{const t=a.tile,o=t.cached.scene;let c=null;if(r.has(t)?(jd(o,i,Dd),Dd.length>0&&(Dd.length>1&&Dd.sort(Nd),c=Dd[0])):c=e(t,n,r,i),c){const e=c.distance*c.distance;e<s&&(s=e,l=c),Dd.length=0}}}return l}(this.root,this.group,this.activeTiles,e);n&&t.push(n)}else!function e(t,n,r,i,o){const a=t.cached,s=n.matrixWorld;Rd.copy(s);const l=a.sphere;if(l&&(Pd.copy(l),Pd.applyMatrix4(Rd),!i.ray.intersectsSphere(Pd)))return;const c=a.box,u=a.boxTransform;if(c&&(Rd.multiply(u).invert(),Id.copy(i.ray).applyMatrix4(Rd),!Id.intersectsBox(c)))return;const h=a.scene;if(r.has(t))return void jd(h,i,o);const d=t.children;for(let t=0,a=d.length;t<a;t++)e(d[t],n,r,i,o)}(this.root,this.group,this.activeTiles,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,n=this.cameraMap;return!n.has(e)&&(n.set(e,new u),t.push(e),!0)}setResolution(e,t,n){const r=this.cameraMap;return!!r.has(e)&&(t instanceof u?r.get(e).copy(t):r.get(e).set(t,n),!0)}setResolutionFromRenderer(e,t){const n=this.cameraMap;if(!n.has(e))return!1;const r=n.get(e);return t.getSize(r),r.multiplyScalar(t.getPixelRatio()),!0}deleteCamera(e){const t=this.cameras,n=this.cameraMap;if(n.has(e)){const r=t.indexOf(e);return t.splice(r,1),n.delete(e),!0}return!1}fetchTileSet(e,...t){const n=super.fetchTileSet(e,...t);return n.then(t=>{this.onLoadTileSet&&Promise.resolve().then(()=>{this.onLoadTileSet(t,e)})}),n}update(){const e=this.group,t=this.cameras,n=this.cameraMap,r=this.cameraInfo;if(0===t.length)return void console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.");for(;r.length>t.length;)r.pop();for(;r.length<t.length;)r.push({frustum:new Yt,sseDenominator:-1,position:new _,invScale:-1,pixelSize:0});let i;Ud.copy(e.matrixWorld).invert(),Hd.setFromMatrixScale(Ud),i=Hd.x,Math.abs(Math.max(Hd.x-Hd.y,Hd.x-Hd.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let o=0,a=r.length;o<a;o++){const a=t[o],s=r[o],l=s.frustum,c=s.position,u=n.get(a);if(0!==u.width&&0!==u.height||console.warn("TilesRenderer: resolution for camera error calculation is not set."),a.isPerspectiveCamera&&(s.sseDenominator=2*Math.tan(.5*a.fov*Bd)/u.height),a.isOrthographicCamera){const e=a.right-a.left,t=a.top-a.bottom;s.pixelSize=Math.max(t/u.height,e/u.width)}s.invScale=i,zd.copy(e.matrixWorld),zd.premultiply(a.matrixWorldInverse),zd.premultiply(a.projectionMatrix),l.setFromProjectionMatrix(zd),c.set(0,0,0),c.applyMatrix4(a.matrixWorld),c.applyMatrix4(Ud)}super.update()}preprocessNode(e,t,n){super.preprocessNode(e,t,n);const r=new Y;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)r.elements[e]=t[e]}else r.identity();t&&r.premultiply(t.cached.transform);let i=null,o=null,a=null;if("box"in e.boundingVolume){const t=e.boundingVolume.box;i=new M,o=new Y,a=new Y,Gd.set(t[3],t[4],t[5]),Wd.set(t[6],t[7],t[8]),Vd.set(t[9],t[10],t[11]);const n=Gd.length(),s=Wd.length(),l=Vd.length();Gd.normalize(),Wd.normalize(),Vd.normalize(),o.set(Gd.x,Wd.x,Vd.x,t[0],Gd.y,Wd.y,Vd.y,t[1],Gd.z,Wd.z,Vd.z,t[2],0,0,0,1),o.premultiply(r),a.copy(o).invert(),i.min.set(-n,-s,-l),i.max.set(n,s,l)}let s=null;if("sphere"in e.boundingVolume){const t=e.boundingVolume.sphere;s=new B,s.center.set(t[0],t[1],t[2]),s.radius=t[3],s.applyMatrix4(r)}else if("box"in e.boundingVolume){const t=e.boundingVolume.box;s=new B,i.getBoundingSphere(s),s.center.set(t[0],t[1],t[2]),s.applyMatrix4(r)}"region"in e.boundingVolume&&console.warn("ThreeTilesRenderer: region bounding volume not supported."),e.cached={loadIndex:0,transform:r,active:!1,inFrustum:[],box:i,boxTransform:o,boxTransformInverse:a,sphere:s,region:null,scene:null,geometry:null,material:null,distance:1/0}}parseTile(e,t,n){t._loadIndex=t._loadIndex||0,t._loadIndex++;const r=t.content.uri.split(/[\\\/]/g);r.pop();const i=r.join("/"),o=this.fetchOptions,a=this.manager,s=t._loadIndex;let l=null;switch(n){case"b3dm":l=new _d(a).parse(e).then(e=>e.scene);break;case"pnts":l=Promise.resolve(new xd(a).parse(e).scene);break;case"i3dm":{const t=new Td(a);t.workingPath=i,t.fetchOptions=o,l=t.parse(e).then(e=>e.scene);break}case"cmpt":{const t=new Cd(a);t.workingPath=i,t.fetchOptions=o,l=t.parse(e).then(e=>e.scene);break}default:console.warn(`TilesRenderer: Content type "${n}" not supported.`),l=Promise.resolve(null)}return l.then(e=>{if(t._loadIndex!==s)return;const n=this.rootTileSet.asset&&this.rootTileSet.asset.gltfUpAxis||"y",r=t.cached,i=r.transform;switch(n.toLowerCase()){case"x":e.matrix.makeRotationAxis(Xd,-Math.PI/2);break;case"y":e.matrix.makeRotationAxis(qd,Math.PI/2)}e.matrix.premultiply(i),e.matrix.decompose(e.position,e.quaternion,e.scale),e.traverse(e=>{e[Fd]=e.frustumCulled}),Zd(e,this.autoDisableRendererCulling),r.scene=e,e.traverse(e=>{e.raycast=Yd});const o=[],a=[],l=[];e.traverse(e=>{if(e.geometry&&a.push(e.geometry),e.material){const t=e.material;o.push(e.material);for(const e in t){const n=t[e];n&&n.isTexture&&l.push(n)}}}),r.materials=o,r.geometry=a,r.textures=l,this.onLoadModel&&this.onLoadModel(e,t)})}disposeTile(e){const t=e.cached;if(t.scene){const n=t.materials,r=t.geometry,i=t.textures;for(let e=0,t=r.length;e<t;e++)r[e].dispose();for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=i.length;e<t;e++){i[e].dispose()}this.onDisposeModel&&this.onDisposeModel(t.scene,e),t.scene=null,t.materials=null,t.textures=null,t.geometry=null}e._loadIndex++}setTileVisible(e,t){const n=e.cached.scene,r=this.visibleTiles,i=this.group;t?(i.add(n),r.add(e),n.updateMatrixWorld(!0)):(i.remove(n),r.delete(e))}setTileActive(e,t){const n=this.activeTiles;t?n.add(e):n.delete(e)}calculateError(e){if(0===e.geometricError)return 0;const t=e.cached,n=t.inFrustum,r=this.cameras,i=this.cameraInfo,o=e.boundingVolume;if("box"in o){const o=t.box,a=t.boxTransformInverse;let s=-1/0,l=1/0;for(let t=0,c=r.length;t<c;t++){if(!n[t])continue;const c=r[t],u=i[t],h=u.invScale;let d;if(Hd.copy(u.position),Hd.applyMatrix4(a),c.isOrthographicCamera){const t=u.pixelSize;d=e.geometricError/(t*h)}else{const t=o.distanceToPoint(Hd)*h,n=u.sseDenominator;d=e.geometricError/(t*n),l=Math.min(l,t)}s=Math.max(s,d)}return e.cached.distance=l,s}return"sphere"in o?console.warn("ThreeTilesRenderer : Sphere bounds not supported."):"region"in o&&console.warn("ThreeTilesRenderer : Region bounds not supported."),1/0}tileInView(e){const t=e.cached,n=t.sphere,r=t.inFrustum;if(n){const e=this.cameraInfo;let t=!1;for(let i=0,o=e.length;i<o;i++){e[i].frustum.intersectsSphere(n)?(t=!0,r[i]=!0):r[i]=!1}return t}return!0}}new _;Symbol("ORIGINAL_MATERIAL"),Symbol("HAS_RANDOM_COLOR");var Kd,Qd,$d=function(e){var t=this;this.add=function(e){if(t.p.p._.wasInitialized)if(e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&e.hasOwnProperty("path")&&e.hasOwnProperty("opacity")&&e.hasOwnProperty("minZoom")&&e.hasOwnProperty("maxZoom")){for(var n=!1,r=0;r<t.p.tile3d.length;r++)if(t.p.tile3d[r].hasOwnProperty("name")&&t.p.tile3d[r].name==e.name){t.p.tile3d[r]=e,n=!0;break}if(!n){var i=t.generateTile3ds(e),o=new be;o.material=new Ve({transparent:!0,opacity:.5,color:11184810}),t.p.p.planet.add(o);var a=t.localizeTile3ds(e,i);o.add(a),e.meshes=a,e.renderer=i,e.tile3dLayer=o,t.p.tile3d.push(e),t.p.tile3d.sort((function(e,t){return t.order-e.order}))}}else console.warn("Attempted to add an invalid tile3d layer: "+e.name)},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=0;r<t.p.tile3d.length;r++){var i=t.p.tile3d[r];if(e===i.name)return i.on=null!=n?n:!i.on,i.meshes.visible=i.on,!0}return!1},this.setOpacity=function(e,n){return!!t.p.p._.wasInitialized&&(n=Math.max(Math.min(n,1),0),t.p.tile3d.forEach((function(t){if(e===t.name)return t.opacity=Math.max(Math.min(n,1),0),t.meshes.children.forEach((function(e){e.material.opacity=t.opacity})),!0})),!1)},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.tile3d.length;n++)if(t.p.tile3d[n].name===e)return t.p.p.planet.remove(t.p.tile3d[n].tile3dLayer),t.p.tile3d.splice(n,1),!0;return!1},this.generateTile3ds=function(e){var n=new Jd(e.path);return n.setCamera(t.p.p._.cameras.camera),n.setResolutionFromRenderer(t.p.p._.cameras.camera,t.p.p._.renderer),n},this.localizeTile3ds=function(e,n){var r=new be,i=e.position.longitude||e.position.lng||0,o=e.position.latitude||e.position.lat||0,a=(e.position.elevation||e.position.elev||0)*t.p.p.options.exaggeration,s=t.p.p.projection.lonLatToVector3(i,o,a);n.group.position.set(s.x,s.y,s.z);var l=new b;if(l.setFromUnitVectors(new _(0,1,0),new _(s.x,s.y,s.z).normalize()),n.group.applyQuaternion(l),n.group.rotateY(-i*(Math.PI/180)),e.rotation){var c=e.rotation.order||"YXZ";3!=c.length&&(console.warn('Lithosphere: Warning - Model Layer "'+e.name+"\" has an invalid rotation.order. Defaulting back to 'YXZ'"),c="YXZ"),n.group.rotation.order=c,c.split("").forEach((function(t){switch(t){case"X":n.group.rotateX(e.rotation.x||0);break;case"Y":n.group.rotateY(e.rotation.y||0);break;case"Z":n.group.rotateZ(e.rotation.z||0);break;default:console.warn('Lithosphere: Warning - Model Layer "'+e.name+'" has an invalid rotation.order axis: '+t+". Must be one of X, Y, Z")}}))}if(null!=e.scale){var u=e.scale;n.group.scale.set(u||1,u||1,u||1)}return 0==e.on&&(n.group.visible=!1),r.add(n.group),r},this.p=e},ef=function(e){var t=this;this.add=function(e){if(t.p.p._.wasInitialized){t.p.p._.tiledWorld.killDrawingTiles();var n=!1;if(e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&e.hasOwnProperty("path")&&e.hasOwnProperty("opacity")&&e.hasOwnProperty("minZoom")&&e.hasOwnProperty("maxZoom")){for(var r=0;r<t.p.tile.length;r++)if(t.p.tile[r].hasOwnProperty("name")&&t.p.tile[r].name==e.name){t.p.tile[r]=e,n=!0;break}n||(t.p.tile.push(e),t.p.tile.sort((function(e,t){return e.order-t.order}))),t.p.p.zoom>=e.minZoom&&t.p.p.zoom<=e.maxZoom&&t.p.p._.tiledWorld.removeAllTiles(),t.p.p._.maxZoom=t.p.findHighestMaxZoom(),t.p.p._.minNativeZoom=t.p.findLowestMinZoom()}else console.warn("Attempted to add an invalid tile layer.")}},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;var r=!1;return t.p.tile.forEach((function(t){e===t.name&&(t.on=null!=n?n:!t.on,r=!0)})),!!r&&(t.p.p._.tiledWorld.outdateAllTiles(),t.p.p._.maxZoom=t.p.findHighestMaxZoom(),t.p.p._.minNativeZoom=t.p.findLowestMinZoom(),!0)},this.setOpacity=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=0;r<t.p.tile.length;r++)if(t.p.tile[r].hasOwnProperty("name")&&t.p.tile[r].name==e)return t.p.tile[r].opacity=n,!0;return!1},this.setFilterEffect=function(e,n,r){if(!t.p.p._.wasInitialized)return!1;for(var i=0;i<t.p.tile.length;i++)if(t.p.tile[i].hasOwnProperty("name")&&(t.p.tile[i].filters=t.p.tile[i].filters||{},t.p.tile[i].name==e))return t.p.tile[i].filters[n]=r,!0;return!1},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.tile.length;n++)if(t.p.tile[n].hasOwnProperty("name")&&t.p.tile[n].name==e){if(t.p.p._.tiledWorld.killDrawingTiles(),t.p.p.zoom>=t.p.tile[n].minZoom&&t.p.p.zoom<=t.p.tile[n].maxZoom)for(var r=t.p.p._.tiledWorld.tilesDrawn.length,i=0;i<r;i++)t.p.p._.tiledWorld.removeTile(0);return t.p.tile.splice(n,1),t.p.p._.maxZoom=t.p.findHighestMaxZoom(),t.p.p._.minNativeZoom=t.p.findLowestMinZoom(),!0}return!1},this.p=e},tf=null,nf=function(e){var t=this;this.add=function(e,n){if(t.p.p._.wasInitialized){var r=!1,i=function(){for(var i=0;i<t.p.clamped.length;i++)if(t.p.clamped[i].hasOwnProperty("name")&&t.p.clamped[i].name==e.name){t.p.clamped[i]=e,r=!0;break}r||(t.p.clamped.push(e),t.p.clamped.sort((function(e,t){return e.order-t.order}))),t.p.p.zoom>=e.minZoom&&t.p.p.zoom<=e.maxZoom&&t.p.p._.tiledWorld.updateAllRasters(),"function"==typeof n&&n()};if(t.p.p._.tiledWorld.killDrawingTiles(),e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&(!0===e.preDrawn&&e.hasOwnProperty("data")||(e.hasOwnProperty("geojsonPath")||e.hasOwnProperty("geojson"))&&e.hasOwnProperty("minZoom")&&e.hasOwnProperty("maxZoom")))if(e.hasOwnProperty("geojsonPath")&&!e.hasOwnProperty("geojson")){e.hasOwnProperty("opacity")||(e.opacity=1);var o=new XMLHttpRequest;o.open("GET",e.geojsonPath,!0),o.responseType="json",o.withCredentials=!0===e.withCredentials||!1,o.onload=function(){404!==o.status&&o.response?(e.geojson=o.response,i()):console.warn("Failed to fetch geojson data for clamped layer: "+e.name)},o.send()}else i();else console.warn("Attempted to add an invalid clamped layer: "+e.name)}},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;var r=!1;return t.p.clamped.forEach((function(t){e===t.name&&(t.on=null!=n?n:!t.on,r=!0)})),!!r&&(t.p.p._.tiledWorld.updateAllRasters(),!0)},this.setOpacity=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=function(r){var i=t.p.clamped[r];if(e===i.name)return clearTimeout(tf),tf=setTimeout((function(){i.opacity=Math.max(Math.min(n,1),0),t.p.p.zoom>=i.minZoom&&t.p.p.zoom<=i.maxZoom&&(t.p.p._.tiledWorld.killDrawingTiles(),t.p.p._.tiledWorld.updateAllRasters())}),250),{value:!0}},i=0;i<t.p.clamped.length;i++){var o=r(i);if("object"==typeof o)return o.value}return!1},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.clamped.length;n++)if(t.p.clamped[n].hasOwnProperty("name")&&t.p.clamped[n].name==e){var r=t.p.clamped[n].minZoom,i=t.p.clamped[n].maxZoom;return t.p.clamped.splice(n,1),t.p.p.zoom>=r&&t.p.p.zoom<=i&&(t.p.p._.tiledWorld.killDrawingTiles(),t.p.p._.tiledWorld.updateAllRasters()),!0}return!1},this.getClampedTexture=function(e,n){var r,i=.5,o=t.p.clamped[e],a=document.createElement("canvas");a.id="vectorsastile",a.width=256/i,i*=Math.pow(2,t.p.p.zoom-n.z),a.height=a.width;var s,l=a.getContext("2d"),c=[];if(i<128)if(o.preDrawn)l.imageSmoothingEnabled=!1,o.data&&o.data[n.z]&&o.data[n.z][n.x]&&null!=o.data[n.z][n.x][n.y]&&l.drawImage(o.data[n.z][n.x][n.y],0,0,a.width,a.height);else for(var u=0,h=o.geojson.features;u<h.length;u++){var d=h[u],f=t.p.getFeatureStyle(o,d),p=!1;if("rgb"!=f.fillColor.substring(0,3).toLowerCase()){var m=yl.hexToRGB(f.fillColor);m&&(f.fillColor="rgba("+m.r+","+m.g+","+m.b+","+f.fillOpacity+")")}else{var g=f.fillColor.substring(4,f.fillColor.length-1).replace(/ /g,"").split(",");f.fillColor="rgba("+g[0]+","+g[1]+","+g[2]+","+f.fillOpacity+")"}if(l.fillStyle=f.fillColor,l.strokeStyle=f.color,l.lineWidth=f.weight*(1/i*1),l.globalAlpha=o.opacity,l.lineCap="round",f.radius*=1/i*1||10,"Polygon"!=d.geometry.type&&"MultiPolygon"!=d.geometry.type||!d.geometry.coordinates[0]){if("LineString"==d.geometry.type||"MultiLineString"==d.geometry.type){if("number"==typeof d.geometry.coordinates[0][0]){for(E=0;E<d.geometry.coordinates.length;E++)s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[E][1],d.geometry.coordinates[E][0],n.z,!0),C=parseInt((s.x-n.x)*a.width),A=parseInt((s.y-n.y)*a.height),0==E?(l.beginPath(),l.moveTo(C,A)):l.lineTo(C,A),C>=0&&C<a.width&&A>=0&&A<a.height&&(p=!0);l.stroke()}else if("number"==typeof d.geometry.coordinates[0][0][0])for(E=0;E<d.geometry.coordinates.length;E++){for(var v=0;v<d.geometry.coordinates[E].length;v++)s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[E][v][1],d.geometry.coordinates[E][v][0],n.z,!0),C=parseInt((s.x-n.x)*a.width),A=parseInt((s.y-n.y)*a.height),0==v?(l.beginPath(),l.moveTo(C,A)):l.lineTo(C,A),C>=0&&C<a.width&&A>=0&&A<a.height&&(p=!0);l.stroke()}}else if("point"===d.geometry.type.toLowerCase()){var y=void 0;"number"==typeof d.geometry.coordinates[0]?(s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[1],d.geometry.coordinates[0],n.z,!0),y={lng:d.geometry.coordinates[0],lat:d.geometry.coordinates[1]}):(s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[0][1],d.geometry.coordinates[0][0],n.z,!0),y={lng:d.geometry.coordinates[0][0],lat:d.geometry.coordinates[0][1]});var b=t.p.p.projection.tileXYZ2LatLng(s.x+(f.radius+l.lineWidth)/a.width,s.y,t.p.p.zoom);if(d._radiusInMeters=t.p.p.projection.lngLatDistBetween(y.lng,y.lat,b.lng,b.lat),C=parseInt((s.x-n.x)*a.width),A=parseInt((s.y-n.y)*a.height),null===(r=o.style)||void 0===r?void 0:r.bearing){var _=o.style.bearing.angleUnit||"deg",x=o.style.bearing.angleProp||!1,w=0;!1!==x&&(w=parseFloat(yl.getIn(d.properties,x,0)),"deg"===_&&(w*=Math.PI/180)),w+=Math.PI;var M=yl.rotatePoint({x:C,y:A+f.radius+l.lineWidth-2},[C,A],w-Math.PI/180*45),S=[yl.rotatePoint({x:C,y:A+2*f.radius},[C,A],w),yl.rotatePoint({x:C,y:A+f.radius+l.lineWidth-2},[C,A],w+Math.PI/180*45),M];l.fillStyle=o.style.bearing.color||"red",l.lineWidth=1/i*1,l.beginPath(),l.moveTo(M.x,M.y),S.forEach((function(e){l.lineTo(e.x,e.y)})),l.closePath(),l.fill(),l.stroke(),l.fillStyle=f.fillColor,l.lineWidth=f.weight*(1/i*1)}l.beginPath(),l.arc(C,A,f.radius,0,2*Math.PI,!1),l.fill(),l.stroke(),C>=0&&C<a.width&&A>=0&&A<a.height&&(p=!0)}}else for(var E=0;E<d.geometry.coordinates.length;E++){if("number"==typeof d.geometry.coordinates[E][0][0])for(var T=0;T<d.geometry.coordinates[E].length;T++){s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[E][T][1],d.geometry.coordinates[E][T][0],n.z,!0);var C=parseInt((s.x-n.x)*a.width),A=parseInt((s.y-n.y)*a.height);0==T?(l.beginPath(),l.moveTo(C,A)):l.lineTo(C,A),C>=0&&C<a.width&&A>=0&&A<a.height&&(p=!0)}else if("number"==typeof d.geometry.coordinates[E][0][0][0])for(var L=0;L<d.geometry.coordinates[E].length;L++)for(var P=0;P<d.geometry.coordinates[E][L].length;P++){s=t.p.p.projection.latLngZ2TileXYZ(d.geometry.coordinates[E][L][P][1],d.geometry.coordinates[E][L][P][0],n.z,!0);var C=parseInt((s.x-n.x)*a.width),A=parseInt((s.y-n.y)*a.height);0==P?(l.beginPath(),l.moveTo(C,A)):l.lineTo(C,A),C>=0&&C<a.width&&A>=0&&A<a.height&&(p=!0)}l.stroke(),l.closePath(),l.fill()}p&&(d._highlighted=d._highlighted||!1,c.push(d))}return{canvas:a,features:c}},this.p=e},rf=function(){ms.call(this),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new rt([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new rt([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};rf.prototype=Object.assign(Object.create(ms.prototype),{constructor:rf,isLineSegmentsGeometry:!0,applyMatrix4:function(e){var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new Vs(t,6,1);return this.setAttribute("instanceStart",new si(n,3,0)),this.setAttribute("instanceEnd",new si(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new Vs(t,6,1);return this.setAttribute("instanceColorStart",new si(n,3,0)),this.setAttribute("instanceColorEnd",new si(n,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new Wo(e.geometry)),this},fromLineSegments:function(e){var t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")},computeBoundingBox:(Qd=new M,function(){null===this.boundingBox&&(this.boundingBox=new M);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Qd.setFromBufferAttribute(t),this.boundingBox.union(Qd))}),computeBoundingSphere:(Kd=new _,function(){null===this.boundingSphere&&(this.boundingSphere=new B),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var r=0,i=0,o=e.count;i<o;i++)Kd.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Kd)),Kd.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(Kd));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}),toJSON:function(){},applyMatrix:function(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}});var of=function(){rf.call(this),this.type="LineGeometry"};of.prototype=Object.assign(Object.create(rf.prototype),{constructor:of,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return rf.prototype.setPositions.call(this,n),this},setColors:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return rf.prototype.setColors.call(this,n),this},fromLine:function(e){var t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")},copy:function(){return this}}),$t.line={linewidth:{value:1},resolution:{value:new u(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},en.line={uniforms:Ft.merge([$t.common,$t.fog,$t.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var af=function(e){Bt.call(this,{type:"LineMaterial",uniforms:Ft.clone(en.line.uniforms),vertexShader:en.line.vertexShader,fragmentShader:en.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};(af.prototype=Object.create(Bt.prototype)).constructor=af,af.prototype.isLineMaterial=!0;var sf,lf,cf=function(e,t){void 0===e&&(e=new rf),void 0===t&&(t=new af({color:16777215*Math.random()})),kt.call(this,e,t),this.type="LineSegments2"};cf.prototype=Object.assign(Object.create(kt.prototype),{constructor:cf,isLineSegments2:!0,computeLineDistances:(sf=new _,lf=new _,function(){for(var e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.data.count),i=0,o=0,a=t.data.count;i<a;i++,o+=2)sf.fromBufferAttribute(t,i),lf.fromBufferAttribute(n,i),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+sf.distanceTo(lf);var s=new Vs(r,2,1);return e.setAttribute("instanceDistanceStart",new si(s,1,0)),e.setAttribute("instanceDistanceEnd",new si(s,1,1)),this}),raycast:function(){var e=new v,t=new v,n=new v,r=new _,i=new Y,o=new el,a=new _;return function(s,l){null===s.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=void 0!==s.params.Line2&&s.params.Line2.threshold||0,h=s.ray,d=s.camera,f=d.projectionMatrix,p=this.geometry,m=this.material,g=m.resolution,v=m.linewidth+u,y=p.attributes.instanceStart,b=p.attributes.instanceEnd,x=-d.near;h.at(1,n),n.w=1,n.applyMatrix4(d.matrixWorldInverse),n.applyMatrix4(f),n.multiplyScalar(1/n.w),n.x*=g.x/2,n.y*=g.y/2,n.z=0,r.copy(n);var w=this.matrixWorld;i.multiplyMatrices(d.matrixWorldInverse,w);for(var M=0,S=y.count;M<S;M++){if(e.fromBufferAttribute(y,M),t.fromBufferAttribute(b,M),e.w=1,t.w=1,e.applyMatrix4(i),t.applyMatrix4(i),!(e.z>x&&t.z>x)){if(e.z>x){const n=e.z-t.z,r=(e.z-x)/n;e.lerp(t,r)}else if(t.z>x){const n=t.z-e.z,r=(t.z-x)/n;t.lerp(e,r)}e.applyMatrix4(f),t.applyMatrix4(f),e.multiplyScalar(1/e.w),t.multiplyScalar(1/t.w),e.x*=g.x/2,e.y*=g.y/2,t.x*=g.x/2,t.y*=g.y/2,o.start.copy(e),o.start.z=0,o.end.copy(t),o.end.z=0;var E=o.closestPointToPointParameter(r,!0);o.at(E,a);var T=c.lerp(e.z,t.z,E),C=T>=-1&&T<=1,A=r.distanceTo(a)<.5*v;if(C&&A){o.start.fromBufferAttribute(y,M),o.end.fromBufferAttribute(b,M),o.start.applyMatrix4(w),o.end.applyMatrix4(w);var L=new _,P=new _;h.distanceSqToSegment(o.start,o.end,P,L),l.push({point:P,pointOnLine:L,distance:h.origin.distanceTo(P),object:this,face:null,faceIndex:M,uv:null,uv2:null})}}}}}()});var uf=function(e,t){void 0===e&&(e=new of),void 0===t&&(t=new af({color:16777215*Math.random()})),cf.call(this,e,t),this.type="Line2"};uf.prototype=Object.assign(Object.create(cf.prototype),{constructor:uf,isLine2:!0});var hf={spriteMaterials:{},makeMarkerSprite:function(e,t,n){var r=new wi(hf.makeMarkerMaterial(e,t,n));return r.style=r.style||{},r.style.radius=e.hasOwnProperty("radius")?e.radius:32,r},makeMarkerMaterial:function(e,t,n){if(void 0===e&&(e={}),t&&this.spriteMaterials.hasOwnProperty(t+"_"+JSON.stringify(e))&&!0!==n)return this.spriteMaterials[t+"_"+JSON.stringify(e)];var r=e.hasOwnProperty("radius")?e.radius:64;r=Math.max(r,64);var i=e.hasOwnProperty("fillColor")?e.fillColor:{r:255,g:255,b:255,a:null!=e.fillOpacity?e.fillOpacity:1},o=e.hasOwnProperty("weight")?e.weight:4,a=e.hasOwnProperty("color")?e.color:{r:0,g:0,b:0,a:1},s=document.createElement("canvas"),l=s.getContext("2d"),c=2*r,u=2*r;s.width=c,s.height=u,l.beginPath(),l.arc(s.width/2,s.height/2,r-o*(r/12),0,2*Math.PI,!1),l.fillStyle="object"==typeof i?"rgba("+i.r+","+i.g+","+i.b+","+i.a+")":i,l.fill(),l.lineWidth=o*Math.ceil(r/8),l.strokeStyle="object"==typeof a?"rgba("+a.r+","+a.g+","+a.b+","+a.a+")":a,l.stroke();var h=new m(s);h.needsUpdate=!0,h.anisotropy=0,h.magFilter=1003,h.minFilter=1003,h.wrapT=1001;var d=new li({map:h,transparent:!0,alphaTest:.01});return t&&!0!==n&&(this.spriteMaterials[t+"_"+JSON.stringify(e)]=d),d},makeTextSprite:function(e,t){void 0===t&&(t={});var n=t.hasOwnProperty("fontface")?t.fontface:"Arial",r=t.hasOwnProperty("fontsize")?t.fontsize:18,i=t.hasOwnProperty("strokeWeight")?t.strokeWeight:4,o=t.hasOwnProperty("strokeColor")?t.strokeColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("fontColor")?t.fontColor:{r:255,g:255,b:255,a:1},s=document.createElement("canvas"),l=s.getContext("2d");s.width=1024,s.height=64,l.font="Bold "+r+"px "+n,l.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",l.lineWidth=i,l.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",l.textAlign="left",l.strokeText(e,512+r,64-r/1.8),l.fillText(e,512+r,64-r/1.8);var c=new m(s);c.needsUpdate=!0;var u=new wi(new li({map:c}));return u.scale.set(64,4,1),u}},df=hf,ff=function(e){var t=this;this.add=function(e,n){if(t.p.p._.wasInitialized){var r=!1,i=function(){for(var i=0;i<t.p.vector.length;i++)if(t.p.vector[i].hasOwnProperty("name")&&t.p.vector[i].name==e.name){t.p.vector[i]=e,r=!0;break}if(!r){var o=t.generateVectors(e);t.p.p.planet.add(o),e.meshes=o,t.p.vector.push(e),t.p.vector.sort((function(e,t){return t.order-e.order}))}t.p.p._.events._attenuate(),"function"==typeof n&&n()};if(e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&(e.hasOwnProperty("geojsonPath")||e.hasOwnProperty("geojson"))&&e.hasOwnProperty("opacity"))if(e.hasOwnProperty("geojsonPath")&&!e.hasOwnProperty("geojson")){var o=new XMLHttpRequest;o.open("GET",e.geojsonPath,!0),o.responseType="json",o.withCredentials=!0===e.withCredentials||!1,o.onload=function(){404!==o.status&&o.response?(e.geojson=o.response,i()):console.warn("Failed to fetch geojson data for vector layer: "+e.name)},o.send()}else i();else console.warn("Attempted to add an invalid vector layer: "+e.name)}},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=0;r<t.p.vector.length;r++){var i=t.p.vector[r];if(e===i.name)return i.on=null!=n?n:!i.on,i.meshes.visible=i.on,console.log(i),t.p.p._.events._attenuate(),!0}return!1},this.setOpacity=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=function(r){var i=t.p.vector[r];if(e===i.name)return i.opacity=Math.max(Math.min(n,1),0),i.meshes.children.forEach((function(e){e.material.opacity=i.opacity})),{value:!0}},i=0;i<t.p.vector.length;i++){var o=r(i);if("object"==typeof o)return o.value}return!1},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.vector.length;n++)if(t.p.vector[n].name===e)return t.p.p.planet.remove(t.p.vector[n].meshes),t.p.vector.splice(n,1),!0;return!1},this.generateVectors=function(e){var n=new be;if(null!=e.geojson){var r=e.geojson.features;if(null!=r){for(var i=e.style?e.style.pointType:"",o=e.style?e.style.lineType:"",a=0,s=r;a<s.length;a++){var l=s[a],c=l.geometry.type,u=null;switch(c.toLowerCase()){case"point":switch(i){case"sphere":break;default:u=t.geomTo.sprite(e,l)}break;case"linestring":switch(o){case"thin":u=t.geomTo.line(e,l);break;default:u=t.geomTo.thickLine(e,l)}break;case"polygon":break;default:console.warn("Vector layer: "+e.name+" has an unsupported geojson geometry type: "+c+".")}u.feature=l,n.add(u)}return 0==e.on&&(n.visible=!1),n}console.warn("Vector layer: "+e.name+" has invalid geojson.")}else console.warn("Vector layer: "+e.name+" has no geojson.")},this.geomTo={sprite:function(e,n,r){var i=n.geometry.coordinates,o=t.p.getFeatureStyle(e,n),a=df.makeMarkerSprite(o,e.name,r),s=0,l=1;e.swapLL&&(s=1,l=0),"number"==typeof i[0]&&(i=[i]);var c=t.p.p.projection.lonLatToVector3(i[0][s],i[0][l],(i[0][2]||0)*t.p.p.options.exaggeration);return a.position.set(c.x,c.y,c.z),a.renderOrder=e.index,0==e.on&&(a.visible=!1),a.layerName=e.name,a.useKeyAsHoverName=e.useKeyAsHoverName,a.name=e.name,a.style=o,a.restyle=function(){var n=t.geomTo.sprite(e,a.feature,a.feature._highlighted||a.feature._active);a.style=n.style,a.material.dispose(),a.material=n.material,a.material.map.needsUpdate=!0,a.material.needsUpdate=!0},a},line:function(e,n){var r=n.geometry.coordinates,i=0,o=1;e.swapLL&&(i=1,o=0);for(var a=[],s=0;s<r.length;s++){isNaN(r[s][i])&&(r=r[0]);var l=t.p.p.projection.lonLatToVector3(r[s][i],r[s][o],(r[s][2]||0)*t.p.p.options.exaggeration);a.push(new _(l.x,l.y,l.z))}var c=t.p.getFeatureStyle(e,n,!0),u=new Yi((new mt).setFromPoints(a),new Hi({transparent:!0,color:c.color}));return u.layerName=e.name,u.strokeColor=c.color,u},thickLine:function(e,n){var r,i=n.geometry.coordinates,o=[],a=0,s=1;e.swapLL&&(a=1,s=0);for(var l=0;l<i.length;l++){isNaN(i[l][a])&&(i=i[0]);var c=t.p.p.projection.lonLatToVector3(i[l][a],i[l][s],(i[l][2]||0)*t.p.p.options.exaggeration);0==l&&(r=new _(c.x,c.y,c.z)),o.push(new _(c.x-r.x,c.y-r.y,c.z-r.z)),0==l&&l==i.length-1||o.push(o[o.length-1])}for(var u=t.p.getFeatureStyle(e,n,!0),h=[],d=new ja(o),f=(l=0,Math.round(1*o.length));l<f;l++){var p=d.getPoint(l/f);h.push(p.x,p.y,p.z)}var m=new of;m.setPositions(h);var g=new af({color:u.color,linewidth:5e-4*(u.weight||1)}),v=new uf(m,g);return v.computeLineDistances(),v.position.set(r.x,r.y,r.z),v.scale.set(1,1,1),v.layerName=e.name,v.strokeColor=u.color,v.restyle=function(){var n=t.p.getFeatureStyle(e,v.feature,!0);v.material=new af({color:n.color,linewidth:5e-4*(n.weight||1)}),v.strokeColor=n.color},v}},this.p=e,this.baseStyle={fillColor:"rgb(255,255,255)",fillOpacity:.4,color:"rgb(0,0,0)",weight:2,radius:6}},pf=function(){return(pf=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},mf=new Aa,gf=function(e){var t=this;this.add=function(e,n){if(t.p.p._.wasInitialized){var r=!1;if(e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&(e.hasOwnProperty("geojson")||e.hasOwnProperty("lineGeometry"))){for(var i=0;i<t.p.curtain.length;i++)if(t.p.curtain[i].hasOwnProperty("name")&&t.p.curtain[i].name==e.name){t.p.curtain[i]=e,r=!0;break}r?"function"==typeof n&&n():t.generateCurtain(e,(function(r){r&&(e.curtain=r,t.p.p.planet.add(e.curtain),t.p.curtain.push(e),t.p.curtain.sort((function(e,t){return t.order-e.order})),t.setOpacity(e.name,e.opacity)),"function"==typeof n&&n()}))}else console.warn("Attempted to add an invalid model layer: "+e.name+". Required props: name, on, geojson | lineGeometry")}},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=0;r<t.p.curtain.length;r++){var i=t.p.curtain[r];if(e===i.name)return i.on=null!=n?n:!i.on,i.curtain.visible=i.on,!0}return!1},this.setOpacity=function(e,n){if(!t.p.p._.wasInitialized)return!1;null==n&&(n=1);for(var r=0;r<t.p.curtain.length;r++){var i=t.p.curtain[r];if(e===i.name)return i.opacity=Math.max(Math.min(n,1),0),yl.setAllMaterialOpacity(i.curtain,i.opacity),!0}return!1},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.curtain.length;n++)if(t.p.curtain[n].name===e)return t.p.p.planet.remove(t.p.curtain[n].curtain),t.p.curtain.splice(n,1),!0;return!1},this.setLayerSpecificOptions=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=function(r){if(t.p.curtain[r].name===e)return t.p.curtain[r].options=pf(pf({},t.p.curtain[r].options||{}),n||{}),t.p.p.planet.remove(t.p.curtain[r].curtain),t.generateCurtain(t.p.curtain[r],(function(e){t.p.curtain[r].curtain=e,t.p.p.planet.add(t.p.curtain[r].curtain)})),{value:!0}},i=0;i<t.p.curtain.length;i++){var o=r(i);if("object"==typeof o)return o.value}return!1},this.generateCurtain=function(e,n){var r=new be,i=[];if(e.geojson?e.geojson.features.forEach((function(e){["LineString","MultiLineString","Polygon"].includes(e.geometry.type)&&i.push(e.geometry)})):i.push(e.lineGeometry),null!=e._material)i.forEach((function(n){r.add(t.getCurtainMesh(e,n))})),n(r);else if(e.imagePath)mf.load(e.imagePath,(function(o){o.magFilter=1003,o.minFilter=1003;var a=new Ve({map:o,transparent:!0,side:2});e._material=a,i.forEach((function(n){r.add(t.getCurtainMesh(e,n))})),n(r)}));else if(Array.isArray(e.imageColor)){var o=document.createElement("canvas");o.width=128,o.height=128;var a=o.getContext("2d");a.rect(0,0,128,128);var s=a.createLinearGradient(0,0,0,128);e.imageColor.forEach((function(t,n){s.addColorStop(n/(e.imageColor.length-1),t||"#FFFFFF")})),a.fillStyle=s,a.fill();var l=new Ve({map:new lo(o),transparent:!0,side:2});e._material=l,i.forEach((function(n){r.add(t.getCurtainMesh(e,n))})),n(r)}else l=new Zo({color:e.imageColor||"#FFFFFF",transparent:!0,side:2}),e._material=l,i.forEach((function(n){r.add(t.getCurtainMesh(e,n))})),n(r)},this.getCurtainMesh=function(e,n){var r;switch(n.type){case"LineString":r=n.coordinates;break;case"MultiLineString":case"Polygon":r=n.coordinates[0];break;default:return void console.warn('Invalid Curtain layer "lineGeometry" type: '+n.type+". Must be one of: ['LineString', 'MultiLineString']")}var i=new mt,o=t.getCurtainVertices(r,e);i.setAttribute("position",new Ye(new Float32Array(o.positions),3)),i.setAttribute("uv",new Ye(new Float32Array(o.uvs),2));var a=new kt(i,e._material);return a.geometry.computeVertexNormals(),a.position.set(o.firstPos.x,o.firstPos.y,o.firstPos.z),0==e.on&&(a.visible=!1),a.layerType="curtain",a},this.getCurtainVertices=function(e,n){var r,i,o,a,s,l,c,h,d,f,p,m,g=n.options||{};g.verticalExaggeration=null!=g.verticalExaggeration?g.verticalExaggeration:1,g.verticalOffset=null!=g.verticalOffset?g.verticalOffset:0;for(var v=[0],y=0,b=0;b<e.length;b++){var x=0,w=1;if(n.swapLL&&(x=1,w=0),b>0){var M=t.p.p.projection.lngLatDistBetween(e[b-1][x],e[b-1][w],e[b][x],e[b][w]);v.push(M),y+=M}}var S=n.depth||100,E={positions:[],uvs:[],firstPos:null},T=0;for(b=1;b<e.length;b++){x=0,w=1,n.swapLL&&(x=1,w=0);var C=t.p.p.projection.lonLatToVector3(e[b][x],e[b][w],e[b][2]+g.verticalOffset),A=t.p.p.projection.lonLatToVector3(e[b][x],e[b][w],e[b][2]-S*g.verticalExaggeration+g.verticalOffset),L=t.p.p.projection.lonLatToVector3(e[b-1][x],e[b-1][w],e[b-1][2]+g.verticalOffset),P=t.p.p.projection.lonLatToVector3(e[b-1][x],e[b-1][w],e[b-1][2]-S*g.verticalExaggeration+g.verticalOffset);1==b&&(E.firstPos=new _(L.x,L.y,L.z));var R=void 0;(r=E.positions).push.apply(r,[L.x-E.firstPos.x,L.y-E.firstPos.y,L.z-E.firstPos.z]),R=new u(T/y,1),(i=E.uvs).push.apply(i,[R.x,R.y]),(o=E.positions).push.apply(o,[P.x-E.firstPos.x,P.y-E.firstPos.y,P.z-E.firstPos.z]),R=new u(T/y,0),(a=E.uvs).push.apply(a,[R.x,R.y]),(s=E.positions).push.apply(s,[C.x-E.firstPos.x,C.y-E.firstPos.y,C.z-E.firstPos.z]),R=new u((T+v[b])/y,1),(l=E.uvs).push.apply(l,[R.x,R.y]),(c=E.positions).push.apply(c,[A.x-E.firstPos.x,A.y-E.firstPos.y,A.z-E.firstPos.z]),R=new u((T+v[b])/y,0),(h=E.uvs).push.apply(h,[R.x,R.y]),(d=E.positions).push.apply(d,[C.x-E.firstPos.x,C.y-E.firstPos.y,C.z-E.firstPos.z]),R=new u((T+v[b])/y,1),(f=E.uvs).push.apply(f,[R.x,R.y]),(p=E.positions).push.apply(p,[P.x-E.firstPos.x,P.y-E.firstPos.y,P.z-E.firstPos.z]),R=new u(T/y,0),(m=E.uvs).push.apply(m,[R.x,R.y]),T+=v[b]}return E},this.p=e},vf=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,r=/^usemap /,i=new _,o=new _,a=new _,s=new _,l=new _;function c(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){var r=this.vertices,c=this.object.geometry.normals;i.fromArray(r,e),o.fromArray(r,t),a.fromArray(r,n),l.subVectors(a,o),s.subVectors(i,o),l.cross(s),l.normalize(),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z)},addColor:function(e,t,n){var r=this.colors,i=this.object.geometry.colors;void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==a&&""!==a){var f=this.normals.length;u=this.parseNormalIndex(a,f),h=this.parseNormalIndex(s,f),d=this.parseNormalIndex(l,f),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==r&&""!==r){var p=this.uvs.length;u=this.parseUVIndex(r,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(o,p),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++){var i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function u(e){_a.call(this,e),this.materials=null}return u.prototype=Object.assign(Object.create(_a.prototype),{constructor:u,load:function(e,t,n,r){var i=this,o=new wa(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(i){var o=new c;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var a=i.split("\n"),s="",l="",u=[],h="function"==typeof"".trimLeft,d=0,f=a.length;d<f;d++)if(s=a[d],0!==(s=h?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var p=s.split(/\s+/);switch(p[0]){case"v":o.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7?o.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":o.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var m=s.substr(1).trim().split(/\s+/),g=[],v=0,y=m.length;v<y;v++){var b=m[v];if(b.length>0){var _=b.split("/");g.push(_)}}var x=g[0];for(v=1,y=g.length-1;v<y;v++){var w=g[v],M=g[v+1];o.addFace(x[0],w[0],M[0],x[1],w[1],M[1],x[2],w[2],M[2])}}else if("l"===l){var S=s.substring(1).trim().split(" "),E=[],T=[];if(-1===s.indexOf("/"))E=S;else for(var C=0,A=S.length;C<A;C++){var L=S[C].split("/");""!==L[0]&&E.push(L[0]),""!==L[1]&&T.push(L[1])}o.addLineGeometry(E,T)}else if("p"===l){var P=s.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(u=e.exec(s))){var R=(" "+u[0].substr(1).trim()).substr(1);o.startObject(R)}else if(n.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else if(r.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===l){if((u=s.split(" ")).length>1){var O=u[1].trim().toLowerCase();o.object.smooth="0"!==O&&"off"!==O}else o.object.smooth=!0;(V=o.object.currentMaterial())&&(V.smooth=o.object.smooth)}else{if("\0"===s)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}o.finalize();var k=new Qr;if(k.materialLibraries=[].concat(o.materialLibraries),!0===!(1===o.objects.length&&0===o.objects[0].geometry.vertices.length))for(d=0,f=o.objects.length;d<f;d++){var I=o.objects[d],D=I.geometry,N=I.materials,j="Line"===D.type,F="Points"===D.type,B=!1;if(0!==D.vertices.length){(Z=new mt).setAttribute("position",new rt(D.vertices,3)),D.normals.length>0&&Z.setAttribute("normal",new rt(D.normals,3)),D.colors.length>0&&(B=!0,Z.setAttribute("color",new rt(D.colors,3))),!0===D.hasUVIndices&&Z.setAttribute("uv",new rt(D.uvs,2));for(var z,U=[],H=0,G=N.length;H<G;H++){var W=(Y=N[H]).name+"_"+Y.smooth+"_"+B,V=o.materials[W];if(null!==this.materials)if(V=this.materials.create(Y.name),!j||!V||V instanceof Hi){if(F&&V&&!(V instanceof $i)){var q=new $i({size:10,sizeAttenuation:!1});We.prototype.copy.call(q,V),q.color.copy(V.color),q.map=V.map,V=q}}else{var X=new Hi;We.prototype.copy.call(X,V),X.color.copy(V.color),V=X}void 0===V&&((V=j?new Hi:F?new $i({size:1,sizeAttenuation:!1}):new Zo).name=Y.name,V.flatShading=!Y.smooth,V.vertexColors=B,o.materials[W]=V),U.push(V)}if(U.length>1){for(H=0,G=N.length;H<G;H++){var Y=N[H];Z.addGroup(Y.groupStart,Y.groupCount,H)}z=j?new Ki(Z,U):F?new io(Z,U):new kt(Z,U)}else z=j?new Ki(Z,U[0]):F?new io(Z,U[0]):new kt(Z,U[0]);z.name=I.name,k.add(z)}}else if(o.vertices.length>0){var Z;V=new $i({size:1,sizeAttenuation:!1});(Z=new mt).setAttribute("position",new rt(o.vertices,3)),o.colors.length>0&&void 0!==o.colors[0]&&(Z.setAttribute("color",new rt(o.colors,3)),V.vertexColors=!0);var J=new io(Z,V);k.add(J)}return k}}),u}(),yf=function(e){_a.call(this,e)};yf.prototype=Object.assign(Object.create(_a.prototype),{constructor:yf,load:function(e,t,n,r){var i=this,o=""===this.path?ps(e):this.path,a=new wa(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(n,o))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var n=e.split("\n"),r={},i=/\s+/,o={},a=0;a<n.length;a++){var s=n[a];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),c=l>=0?s.substring(0,l):s;c=c.toLowerCase();var u=l>=0?s.substring(l+1):"";if(u=u.trim(),"newmtl"===c)r={name:u},o[u]=r;else if("ka"===c||"kd"===c||"ks"===c||"ke"===c){var h=u.split(i,3);r[c]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else r[c]=u}}var d=new yf.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}}),(yf.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:0,this.wrap=this.options&&this.options.wrap?this.options.wrap:1e3}).prototype={constructor:yf.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var n in e){var r=e[n],i={};for(var o in t[n]=i,r){var a=!0,s=r[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,n=this.materialsInfo[e],r={name:e,side:this.side};function i(e,n){if(!r[e]){var i,o,a=t.getTextureParams(n,r),s=t.loadTexture((i=t.baseUrl,"string"!=typeof(o=a.url)||""===o?"":/^https?:\/\//i.test(o)?o:i+o));s.repeat.copy(a.scale),s.offset.copy(a.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,r[e]=s}}for(var o in n){var a,s=n[o];if(""!==s)switch(o.toLowerCase()){case"kd":r.color=(new Ue).fromArray(s);break;case"ks":r.specular=(new Ue).fromArray(s);break;case"ke":r.emissive=(new Ue).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),r.transparent=!0;break;case"ns":r.shininess=parseFloat(s);break;case"d":(a=parseFloat(s))<1&&(r.opacity=a,r.transparent=!0);break;case"tr":a=parseFloat(s),this.options&&this.options.invertTrProperty&&(a=1-a),a>0&&(r.opacity=1-a,r.transparent=!0)}}return this.materials[e]=new Zo(r),this.materials[e]},getTextureParams:function(e,t){var n,r={scale:new u(1,1),offset:new u(0,0)},i=e.split(/\s+/);return(n=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[n+1]),i.splice(n,2)),(n=i.indexOf("-s"))>=0&&(r.scale.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),(n=i.indexOf("-o"))>=0&&(r.offset.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),r.url=i.join(" ").trim(),r},loadTexture:function(e,t,n,r,i){var o,a=void 0!==this.manager?this.manager:ba,s=a.getHandler(e);return null===s&&(s=new Aa(a)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(e,n,r,i),void 0!==t&&(o.mapping=t),o}};var bf=function(e){_a.call(this,e)};bf.prototype=Object.assign(Object.create(_a.prototype),{constructor:bf,load:function(e,t,n,r){var i=this,o=new m,a=new wa(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){o.image=i.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)}),n,r),o},parse:function(e){var t=0,n=1,r=2,i=3,o=9,a=10,s=11,l=48,c=4,u=0,h=1,d=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var p=new Uint8Array(e),m=0,g={id_length:p[m++],colormap_type:p[m++],image_type:p[m++],colormap_index:p[m++]|p[m++]<<8,colormap_length:p[m++]|p[m++]<<8,colormap_size:p[m++],origin:[p[m++]|p[m++]<<8,p[m++]|p[m++]<<8],width:p[m++]|p[m++]<<8,height:p[m++]|p[m++]<<8,pixel_size:p[m++],flags:p[m++]};!function(e){switch(e.image_type){case n:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case i:case a:case s:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(g),g.id_length+m>e.length&&console.error("THREE.TGALoader: No data."),m+=g.id_length;var v=!1,y=!1,b=!1;switch(g.image_type){case o:v=!0,y=!0;break;case n:y=!0;break;case a:v=!0;break;case r:break;case s:v=!0,b=!0;break;case i:b=!0}var _="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(g.width,g.height):document.createElement("canvas");_.width=g.width,_.height=g.height;var x=_.getContext("2d"),w=x.createImageData(g.width,g.height),M=function(e,t,n,r,i){var o,a,s,l;if(a=n.pixel_size>>3,s=n.width*n.height*a,t&&(l=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){var c,u,h;o=new Uint8Array(s);for(var d=0,f=new Uint8Array(a);d<s;)if(u=1+(127&(c=i[r++])),128&c){for(h=0;h<a;++h)f[h]=i[r++];for(h=0;h<u;++h)o.set(f,d+h*a);d+=a*u}else{for(u*=a,h=0;h<u;++h)o[d+h]=i[r++];d+=u}}else o=i.subarray(r,r+=t?n.width*n.height:s);return{pixel_data:o,palettes:l}}(v,y,g,m,p);return function(e,t,n,r,i){var o,a,s,p,m,v;switch((g.flags&l)>>c){default:case d:o=0,s=1,m=t,a=0,p=1,v=n;break;case u:o=0,s=1,m=t,a=n-1,p=-1,v=-1;break;case f:o=t-1,s=-1,m=-1,a=0,p=1,v=n;break;case h:o=t-1,s=-1,m=-1,a=n-1,p=-1,v=-1}if(b)switch(g.pixel_size){case 8:!function(e,t,n,r,i,o,a,s){var l,c,u,h=0,d=g.width;for(u=t;u!==r;u+=n)for(c=i;c!==a;c+=o,h++)l=s[h],e[4*(c+d*u)+0]=l,e[4*(c+d*u)+1]=l,e[4*(c+d*u)+2]=l,e[4*(c+d*u)+3]=255}(e,a,p,v,o,s,m,r);break;case 16:!function(e,t,n,r,i,o,a,s){var l,c,u=0,h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==a;l+=o,u+=2)e[4*(l+h*c)+0]=s[u+0],e[4*(l+h*c)+1]=s[u+0],e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+3]=s[u+1]}(e,a,p,v,o,s,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(e,t,n,r,i,o,a,s,l){var c,u,h,d=l,f=0,p=g.width;for(h=t;h!==r;h+=n)for(u=i;u!==a;u+=o,f++)c=s[f],e[4*(u+p*h)+3]=255,e[4*(u+p*h)+2]=d[3*c+0],e[4*(u+p*h)+1]=d[3*c+1],e[4*(u+p*h)+0]=d[3*c+2]}(e,a,p,v,o,s,m,r,i);break;case 16:!function(e,t,n,r,i,o,a,s){var l,c,u,h=0,d=g.width;for(u=t;u!==r;u+=n)for(c=i;c!==a;c+=o,h+=2)l=s[h+0]+(s[h+1]<<8),e[4*(c+d*u)+0]=(31744&l)>>7,e[4*(c+d*u)+1]=(992&l)>>2,e[4*(c+d*u)+2]=(31&l)>>3,e[4*(c+d*u)+3]=32768&l?0:255}(e,a,p,v,o,s,m,r);break;case 24:!function(e,t,n,r,i,o,a,s){var l,c,u=0,h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==a;l+=o,u+=3)e[4*(l+h*c)+3]=255,e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2]}(e,a,p,v,o,s,m,r);break;case 32:!function(e,t,n,r,i,o,a,s){var l,c,u=0,h=g.width;for(c=t;c!==r;c+=n)for(l=i;l!==a;l+=o,u+=4)e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2],e[4*(l+h*c)+3]=s[u+3]}(e,a,p,v,o,s,m,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w.data,g.width,g.height,M.pixel_data,M.palettes),x.putImageData(w,0,0),_}});var _f=function(e){_a.call(this,e)};_f.prototype=Object.assign(Object.create(_a.prototype),{constructor:_f,load:function(e,t,n,r){var i=this,o=""===i.path?ps(e):i.path,a=new wa(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n,o))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function n(e,t){for(var n=[],r=e.childNodes,i=0,o=r.length;i<o;i++){var a=r[i];a.nodeName===t&&n.push(a)}return n}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=t[r];return n}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseFloat(t[r]);return n}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseInt(t[r]);return n}function a(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,i){var o=n(e,t)[0];if(void 0!==o)for(var a=n(o,r),s=0;s<a.length;s++)i(a[s])}function d(e,t){for(var n in e){e[n].build=t(e[n])}}function f(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=a(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=o}}return t}function m(e){var t={},n=e.getAttribute("target").split("/"),r=n.shift(),i=n.shift(),o=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)n=i.split("."),i=n.shift(),t.member=n.shift();else if(o){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=r,t.sid=i,t.arraySyntax=o,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function g(e){var t=[],n=e.channels,r=e.samplers,i=e.sources;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=r[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;S(y(a,i[l],i[c]),t)}return t}function v(e){return f(it.animations[e],g)}function y(e,t,n){var r,i,o,a,s,l,c=it.nodes[e.id],u=ze(c.id),h=c.transforms[e.sid],d=c.matrix.clone().transpose(),f={};switch(h){case"matrix":for(o=0,a=t.array.length;o<a;o++)if(r=t.array[o],i=o*n.stride,void 0===f[r]&&(f[r]={}),!0===e.arraySyntax){var p=n.array[i],m=e.indices[0]+4*e.indices[1];f[r][m]=p}else for(s=0,l=n.stride;s<l;s++)f[r][s]=n.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(e,t){var n=[];for(var r in e)n.push({time:parseFloat(r),value:e[r]});n.sort((function(e,t){return e.time-t.time}));for(var i=0;i<16;i++)E(n,i,t.elements[i]);return n}(f,d);return{name:u.uuid,keyframes:g}}var x=new _,w=new _,M=new b;function S(e,t){for(var n=e.keyframes,r=e.name,i=[],o=[],a=[],s=[],l=0,c=n.length;l<c;l++){var u=n[l],h=u.time,d=u.value;Le.fromArray(d).transpose(),Le.decompose(x,M,w),i.push(h),o.push(x.x,x.y,x.z),a.push(M.x,M.y,M.z,M.w),s.push(w.x,w.y,w.z)}return o.length>0&&t.push(new pa(r+".position",i,o)),a.length>0&&t.push(new da(r+".quaternion",i,a)),s.length>0&&t.push(new pa(r+".scale",i,s)),t}function E(e,t,n){var r,i,o,a=!0;for(i=0,o=e.length;i<o;i++)void 0===(r=e[i]).value[t]?r.value[t]=null:a=!1;if(!0===a)for(i=0,o=e.length;i<o;i++)(r=e[i]).value[t]=n;else!function(e,t){for(var n,r,i=0,o=e.length;i<o;i++){var a=e[i];if(null===a.value[t]){if(n=T(e,i,t),r=C(e,i,t),null===n){a.value[t]=r.value[t];continue}if(null===r){a.value[t]=n.value[t];continue}A(a,n,r,t)}}}(e,t)}function T(e,t,n){for(;t>=0;){var r=e[t];if(null!==r.value[n])return r;t--}return null}function C(e,t,n){for(;t<e.length;){var r=e[t];if(null!==r.value[n])return r;t++}return null}function A(e,t,n,r){n.time-t.time!=0?e.value[r]=(e.time-t.time)*(n.value[r]-t.value[r])/(n.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function L(e){for(var t=[],n=e.name,r=e.end-e.start||-1,i=e.animations,o=0,a=i.length;o<a;o++)for(var s=v(i[o]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new ma(n,r,t)}function P(e){return f(it.clips[e],L)}function R(e){for(var t={sources:{}},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(o.textContent);break;case"source":var a=o.getAttribute("id");t.sources[a]=ce(o);break;case"joints":t.joints=O(o);break;case"vertex_weights":t.vertexWeights=k(o)}}return t}function O(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),s=a(i.getAttribute("source"));t.inputs[o]=s}}return t}function k(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=a(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=o(i.textContent);break;case"v":t.v=o(i.textContent)}}return t}function I(e){var t={id:e.id},n=it.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,n,r,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,a=e.vertexWeights,s=a.vcount,l=a.v,c=a.inputs.JOINT.offset,u=a.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=o[a.inputs.WEIGHT.id].array,p=0;for(t=0,r=s.length;t<r;t++){var m=s[t],g=[];for(n=0;n<m;n++){var v=l[p+c],y=l[p+u],b=f[y];g.push({index:v,weight:b}),p+=2}for(g.sort(M),n=0;n<4;n++){var _=g[n];void 0!==_?(i.indices.array.push(_.index),i.weights.array.push(_.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new Y).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new Y).identity();for(t=0,r=h.array.length;t<r;t++){var x=h.array[t],w=(new Y).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:x,boneInverse:w})}return i;function M(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function D(e){return void 0!==e.build?e.build:e.init_from}function N(e){var t=it.images[e];return void 0!==t?f(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function j(e){for(var t={surfaces:{},samplers:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":F(i,t);break;case"technique":t.technique=U(i);break;case"extra":t.extra=X(i)}}return t}function F(e,t){for(var n=e.getAttribute("sid"),r=0,i=e.childNodes.length;r<i;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[n]=B(o);break;case"sampler2D":t.samplers[n]=z(o)}}}function B(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function z(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function U(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=H(i)}}return t}function H(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=G(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:G(i)}}}return t}function G(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=i(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:W(o)}}}return t}function W(e){for(var t={technique:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"extra":V(i,t)}}return t}function V(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":q(i,t)}}}function q(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function X(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=Z(i)}}return t}function Z(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function J(e){return e}function K(e){var t,n,r=(t=e.url,f(it.effects[t],J)),i=r.profile.technique,o=r.profile.extra;switch(i.type){case"phong":case"blinn":n=new Zo;break;case"lambert":n=new Qo;break;default:n=new Ve}function a(e){var t=r.profile.samplers[e.id],n=null;void 0!==t?n=N(r.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),n=N(e.id));if(null!==n){var i=function(e){var t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase()){case"tga":t=Ke;break;default:t=$e}return t}(n);if(void 0!==i){var o=i.load(n),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===s(a.technique)){var l=a.technique;o.wrapS=l.wrapU?1e3:1001,o.wrapT=l.wrapV?1e3:1001,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=1e3,o.wrapT=1e3;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",n),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}n.name=e.name||"";var l=i.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&n.color.fromArray(u.color),u.texture&&(n.map=a(u.texture));break;case"specular":u.color&&n.specular&&n.specular.fromArray(u.color),u.texture&&(n.specularMap=a(u.texture));break;case"bump":u.texture&&(n.normalMap=a(u.texture));break;case"ambient":u.texture&&(n.lightMap=a(u.texture));break;case"shininess":u.float&&n.shininess&&(n.shininess=u.float);break;case"emission":u.color&&n.emissive&&n.emissive.fromArray(u.color),u.texture&&(n.emissiveMap=a(u.texture))}}var h=l.transparent,d=l.transparency;if(void 0===d&&h&&(d={float:1}),void 0===h&&d&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&d)if(h.data.texture)n.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":n.opacity=p[3]*d.float;break;case"RGB_ZERO":n.opacity=1-p[0]*d.float;break;case"A_ZERO":n.opacity=1-p[3]*d.float;break;case"RGB_ONE":n.opacity=p[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}n.opacity<1&&(n.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(n.side=2),n}function Q(e){return f(it.materials[e],K)}function $(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"technique_common":return ee(n)}}return{}}function ee(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=te(r)}}return t}function te(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function re(e){var t;switch(e.optics.technique){case"perspective":t=new Ut(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var n=e.optics.parameters.ymag,r=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,t=new os(-(r*=.5),r,n*=.5,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new Ut}return t.name=e.name||"",t}function ie(e){var t=it.cameras[e];return void 0!==t?f(t,re):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function oe(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ae(i)}}return t}function ae(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":var a=i(o.textContent);t.color=(new Ue).fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function se(e){var t;switch(e.technique){case"directional":t=new ss;break;case"point":t=new is;break;case"spot":t=new ns;break;case"ambient":t=new ls}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function le(e){var t=it.lights[e];return void 0!==t?f(t,se):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ce(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=i(a.textContent);break;case"Name_array":t.array=r(a.textContent);break;case"technique_common":var s=n(a,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ue(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&(t[r.getAttribute("semantic")]=a(r.getAttribute("source")))}return t}function he(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=a(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?l+u:l;t.inputs[h]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(i.textContent);break;case"p":t.p=o(i.textContent)}}return t}function de(e){for(var t=0,n=0,r=e.length;n<r;n++){!0===e[n].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function fe(e){var t={},n=e.sources,r=e.vertices,i=e.primitives;if(0===i.length)return{};var o=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(i);for(var a in o){var s=o[a];de(s),t[a]=pe(s,n,r)}return t}function pe(e,t,n){for(var r={},i={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,h=[],d=4,f=new mt,p=[],m=0,g=0;g<e.length;g++){var v=e[g],y=v.inputs,b=0;switch(v.type){case"lines":case"linestrips":b=2*v.count;break;case"triangles":b=3*v.count;break;case"polylist":for(var _=0;_<v.count;_++){var x=v.vcount[_];switch(x){case 3:b+=3;break;case 4:b+=6;break;default:b+=3*(x-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",v.type)}for(var w in f.addGroup(m,b,g),m+=b,v.material&&p.push(v.material),y){var M=y[w];switch(w){case"VERTEX":for(var S in n){var E=n[S];switch(S){case"POSITION":var T=i.array.length;if(me(v,t[E],M.offset,i.array),i.stride=t[E].stride,t.skinWeights&&t.skinIndices&&(me(v,t.skinIndices,M.offset,c),me(v,t.skinWeights,M.offset,h)),!1===v.hasUV&&!0===e.uvsNeedsFix){b=(i.array.length-T)/i.stride;for(var C=0;C<b;C++)a.array.push(0,0)}break;case"NORMAL":me(v,t[E],M.offset,o.array),o.stride=t[E].stride;break;case"COLOR":me(v,t[E],M.offset,l.array),l.stride=t[E].stride;break;case"TEXCOORD":me(v,t[E],M.offset,a.array),a.stride=t[E].stride;break;case"TEXCOORD1":me(v,t[E],M.offset,s.array),a.stride=t[E].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',S)}}break;case"NORMAL":me(v,t[M.id],M.offset,o.array),o.stride=t[M.id].stride;break;case"COLOR":me(v,t[M.id],M.offset,l.array),l.stride=t[M.id].stride;break;case"TEXCOORD":me(v,t[M.id],M.offset,a.array),a.stride=t[M.id].stride;break;case"TEXCOORD1":me(v,t[M.id],M.offset,s.array),s.stride=t[M.id].stride}}}return i.array.length>0&&f.setAttribute("position",new rt(i.array,i.stride)),o.array.length>0&&f.setAttribute("normal",new rt(o.array,o.stride)),l.array.length>0&&f.setAttribute("color",new rt(l.array,l.stride)),a.array.length>0&&f.setAttribute("uv",new rt(a.array,a.stride)),s.array.length>0&&f.setAttribute("uv2",new rt(s.array,s.stride)),c.length>0&&f.setAttribute("skinIndex",new rt(c,u)),h.length>0&&f.setAttribute("skinWeight",new rt(h,d)),r.data=f,r.type=e[0].type,r.materialKeys=p,r}function me(e,t,n,r){var i=e.p,o=e.stride,a=e.vcount;function s(e){for(var t=i[e+n]*c,o=t+c;t<o;t++)r.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,h=0,d=a.length;h<d;h++){var f=a[h];if(4===f){var p=u+1*o,m=u+2*o,g=u+3*o;s(u+0*o),s(p),s(g),s(p),s(m),s(g)}else if(3===f){p=u+1*o,m=u+2*o;s(u+0*o),s(p),s(m)}else if(f>4)for(var v=1,y=f-2;v<=y;v++){p=u+o*v,m=u+o*(v+1);s(u+0*o),s(p),s(m)}u+=o*f}else for(h=0,d=i.length;h<d;h+=o)s(h)}function ge(e){return f(it.geometries[e],fe)}function ve(e){return void 0!==e.build?e.build:e}function ye(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=be(r);break;case"link":t.links.push(xe(r))}}}function be(e){for(var t,n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=_e(r)}}return t}function _e(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new _,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=i(r.textContent);t.axis.fromArray(o);break;case"limits":var a=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function xe(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(we(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(Me(r))}}return t}function we(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(xe(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(Me(r))}}return t}function Me(e){var t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new Y,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new _,t.obj.fromArray(n);break;case"rotate":t.obj=new _,t.obj.fromArray(n),t.angle=c.degToRad(n[3])}return t}function Se(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":Ee(r,t)}}}function Ee(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=i(r.textContent);break;case"mass":t.mass=i(r.textContent)[0]}}}function Te(e){for(var t={target:e.getAttribute("target").split("/").pop()},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=r.getElementsByTagName("param")[0];t.axis=i.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function Ce(e){return void 0!==e.build?e.build:e}function Ae(e){for(var t=[],n=qe.querySelector('[id="'+e.id+'"]'),r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var a=i(o.textContent),s=(new Y).fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":a=i(o.textContent);var l=(new _).fromArray(a);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":a=i(o.textContent),l=(new _).fromArray(a);var u=c.degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:u})}}return t}var Le=new Y,Pe=new _;function Re(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Y,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Re(r);break;case"instance_camera":t.instanceCameras.push(a(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Oe(r));break;case"instance_light":t.instanceLights.push(a(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Oe(r));break;case"instance_node":t.instanceNodes.push(a(r.getAttribute("url")));break;case"matrix":var o=i(r.textContent);t.matrix.multiply(Le.fromArray(o).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=i(r.textContent);Pe.fromArray(o),t.matrix.multiply(Le.makeTranslation(Pe.x,Pe.y,Pe.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=i(r.textContent);var s=c.degToRad(o[3]);t.matrix.multiply(Le.makeRotationAxis(Pe.fromArray(o),s)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=i(r.textContent);t.matrix.scale(Pe.fromArray(o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Be(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):it.nodes[t.id]=t,t}function Oe(e){for(var t={id:a(e.getAttribute("url")),materials:{},skeletons:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var s=i[o],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=a(c)}break;case"skeleton":t.skeletons.push(a(r.textContent))}}return t}function ke(e,t){var n,r,i,o=[],a=[];for(n=0;n<e.length;n++){var s=e[n];if(Be(s))Ie(ze(s),t,o);else if(i=s,void 0!==it.visualScenes[i])for(var l=it.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];if("JOINT"===u.type)Ie(ze(u.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(n=0;n<t.length;n++)for(c=0;c<o.length;c++)if((r=o[c]).bone.name===t[n].name){a[n]=r,r.processed=!0;break}for(n=0;n<o.length;n++)!1===(r=o[n]).processed&&(a.push(r),r.processed=!0);var h=[],d=[];for(n=0;n<a.length;n++)r=a[n],h.push(r.bone),d.push(r.boneInverse);return new Ni(h,d)}function Ie(e,t,n){e.traverse((function(e){if(!0===e.isBone){for(var r,i=0;i<t.length;i++){var o=t[i];if(o.name===e.name){r=o.boneInverse;break}}void 0===r&&(r=new Y),n.push({bone:e,boneInverse:r,processed:!1})}}))}function De(e){for(var t,n=[],r=e.matrix,i=e.nodes,o=e.type,a=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,h=0,d=i.length;h<d;h++)n.push(ze(i[h]));for(h=0,d=a.length;h<d;h++){var p=ie(a[h]);null!==p&&n.push(p.clone())}for(h=0,d=s.length;h<d;h++)for(var m=s[h],g=(t=m.id,f(it.controllers[t],I)),v=Fe(ge(g.id),m.materials),y=ke(m.skeletons,g.skin.joints),b=0,_=v.length;b<_;b++){var x;(x=v[b]).isSkinnedMesh&&(x.bind(y,g.skin.bindMatrix),x.normalizeSkinWeights()),n.push(x)}for(h=0,d=l.length;h<d;h++){var w=le(l[h]);null!==w&&n.push(w.clone())}for(h=0,d=c.length;h<d;h++)for(b=0,_=(v=Fe(ge((m=c[h]).id),m.materials)).length;b<_;b++)n.push(v[b]);for(h=0,d=u.length;h<d;h++)n.push(ze(u[h]).clone());if(0===i.length&&1===n.length)x=n[0];else{x="JOINT"===o?new ki:new Qr;for(h=0;h<n.length;h++)x.add(n[h])}return x.name="JOINT"===o?e.sid:e.name,x.matrix.copy(r),x.matrix.decompose(x.position,x.quaternion,x.scale),x}var Ne=new Ve({color:16711935});function je(e,t){for(var n=[],r=0,i=e.length;r<i;r++){var o=t[e[r]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(Ne)):n.push(Q(o))}return n}function Fe(e,t){var n=[];for(var r in e){var i=e[r],o=je(i.materialKeys,t);0===o.length&&("lines"===r||"linestrips"===r?o.push(new Hi):o.push(new Zo));var a=void 0!==i.data.attributes.skinIndex;if(a)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var c,u=1===o.length?o[0]:o;switch(r){case"lines":c=new Ki(i.data,u);break;case"linestrips":c=new Yi(i.data,u);break;case"triangles":case"polylist":c=a?new Oi(i.data,u):new kt(i.data,u)}n.push(c)}return n}function Be(e){return void 0!==it.nodes[e]}function ze(e){return f(it.nodes[e],De)}function He(e){var t=new Qr;t.name=e.name;for(var n=e.children,r=0;r<n.length;r++){var i=n[r];t.add(ze(i.id))}return t}function Ge(e){return f(it.visualScenes[e],He)}if(0===e.length)return{scene:new ii};var We=(new DOMParser).parseFromString(e,"application/xml"),qe=n(We,"COLLADA")[0],Xe=We.getElementsByTagName("parsererror")[0];if(void 0!==Xe){var Ye,Ze=n(Xe,"div")[0];return Ye=Ze?Ze.textContent:function(e){for(var t="",n=[e];n.length;){var r=n.shift();r.nodeType===Node.TEXT_NODE?t+=r.textContent:(t+="\n",n.push.apply(n,r.childNodes))}return t.trim()}(Xe),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Ye),null}var Je=qe.getAttribute("version");console.log("THREE.ColladaLoader: File version",Je);var Ke,Qe=function(e){return{unit:l(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(qe,"asset")[0]),$e=new Aa(this.manager);$e.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),bf&&(Ke=new bf(this.manager)).setPath(this.resourcePath||t);var et=[],tt={},nt=0,it={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(qe,"library_animations","animation",(function e(t){for(var n={sources:{},samplers:{},channels:{}},r=!1,i=0,o=t.childNodes.length;i<o;i++){var a,s=t.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"source":a=s.getAttribute("id"),n.sources[a]=ce(s);break;case"sampler":a=s.getAttribute("id"),n.samplers[a]=p(s);break;case"channel":a=s.getAttribute("target"),n.channels[a]=m(s);break;case"animation":e(s),r=!0;break;default:console.log(s)}}!1===r&&(it.animations[t.getAttribute("id")||c.generateUUID()]=n)})),h(qe,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(a(i.getAttribute("url")))}}it.clips[e.getAttribute("id")]=t})),h(qe,"library_controllers","controller",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=a(i.getAttribute("source")),t.skin=R(i);break;case"morph":t.id=a(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}it.controllers[e.getAttribute("id")]=t})),h(qe,"library_images","image",(function(e){var t={init_from:n(e,"init_from")[0].textContent};it.images[e.getAttribute("id")]=t})),h(qe,"library_effects","effect",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=j(i)}}it.effects[e.getAttribute("id")]=t})),h(qe,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=a(i.getAttribute("url"))}}it.materials[e.getAttribute("id")]=t})),h(qe,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=$(i)}}it.cameras[e.getAttribute("id")]=t})),h(qe,"library_lights","light",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=oe(i)}}it.lights[e.getAttribute("id")]=t})),h(qe,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[a]=ce(o);break;case"vertices":t.vertices=ue(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(he(o));break;default:console.log(o)}}}it.geometries[e.getAttribute("id")]=t}})),h(qe,"library_nodes","node",Re),h(qe,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),n=0;n<t.length;n++){var r=t[n];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+nt++)}}(e);for(var r=n(e,"node"),i=0;i<r.length;i++)t.children.push(Re(r[i]));it.visualScenes[e.getAttribute("id")]=t})),h(qe,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":ye(r,t)}}it.kinematicsModels[e.getAttribute("id")]=t})),h(qe,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":t.rigidBodies[r.getAttribute("name")]={},Se(r,t.rigidBodies[r.getAttribute("name")])}}it.physicsModels[e.getAttribute("id")]=t})),h(qe,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Te(r))}}it.kinematicsScenes[a(e.getAttribute("url"))]=t})),d(it.animations,g),d(it.clips,L),d(it.controllers,I),d(it.images,D),d(it.effects,J),d(it.materials,K),d(it.cameras,re),d(it.lights,se),d(it.geometries,fe),d(it.visualScenes,He),function(){var e=it.clips;if(!0===s(e)){if(!1===s(it.animations)){var t=[];for(var n in it.animations)for(var r=v(n),i=0,o=r.length;i<o;i++)t.push(r[i]);et.push(new ma("default",-1,t))}}else for(var n in e)et.push(P(n))}(),function(){var e=Object.keys(it.kinematicsModels)[0],t=Object.keys(it.kinematicsScenes)[0],n=Object.keys(it.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r,i=(r=e,f(it.kinematicsModels[r],ve)),o=function(e){return f(it.kinematicsScenes[e],Ce)}(t),a=Ge(n),s=o.bindJointAxis,l={},u=0,h=s.length;u<h;u++){var d=s[u],p=qe.querySelector('[sid="'+d.target+'"]');if(p){var m=p.parentElement;v(d.jointIndex,m)}}var g=new Y;tt={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var n=l[e];if(n){var r=n.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=n.object,o=r.axis,a=n.transforms;Le.identity();for(var s=0;s<a.length;s++){var u=a[s];if(u.sid&&-1!==u.sid.indexOf(e))switch(r.type){case"revolute":Le.multiply(g.makeRotationAxis(o,c.degToRad(t)));break;case"prismatic":Le.multiply(g.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(u.type){case"matrix":Le.multiply(u.obj);break;case"translate":Le.multiply(g.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Le.scale(u.obj);break;case"rotate":Le.multiply(g.makeRotationAxis(u.obj,u.angle))}}i.matrix.copy(Le),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var n=t.getAttribute("name"),r=i.joints[e];a.traverse((function(i){i.name===n&&(l[e]={object:i,transforms:Ae(t),joint:r,position:r.zeroPosition})}))}}();var ot=function(e){return Ge(a(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(qe,"scene")[0]);return ot.animations=et,"Z_UP"===Qe.upAxis&&ot.quaternion.setFromEuler(new ne(-Math.PI/2,0,0)),ot.scale.multiplyScalar(Qe.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),et},kinematics:tt,library:it,scene:ot}}});var xf=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},wf=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Mf=new vf,Sf=new yf,Ef=new _f,Tf=new bd,Cf=function(e){var t=this;this.add=function(e,n){if(t.p.p._.wasInitialized){var r=!1;if(e.hasOwnProperty("name")&&e.hasOwnProperty("on")&&e.hasOwnProperty("path")){for(var i=0;i<t.p.model.length;i++)if(t.p.model[i].hasOwnProperty("name")&&t.p.model[i].name==e.name){t.p.model[i]=e,r=!0;break}r?"function"==typeof n&&n():t.generateModel(e,(function(r){r&&(r=t.localizeModel(e,r),t.p.p.planet.add(r),e.model=r,t.p.model.push(e),t.p.model.sort((function(e,t){return t.order-e.order})),e.opacity<1&&t.setOpacity(e.name,e.opacity)),"function"==typeof n&&n()}))}else console.warn("Attempted to add an invalid model layer: "+e.name+". Required props: name, on, path")}},this.toggle=function(e,n){if(!t.p.p._.wasInitialized)return!1;for(var r=0;r<t.p.model.length;r++){var i=t.p.model[r];if(e===i.name)return i.on=null!=n?n:!i.on,i.model.visible=i.on,!0}return!1},this.setOpacity=function(e,n){if(!t.p.p._.wasInitialized)return!1;null==n&&(n=1);for(var r=0;r<t.p.model.length;r++){var i=t.p.model[r];if(e===i.name)return i.opacity=Math.max(Math.min(n,1),0),yl.setAllMaterialOpacity(i.model,i.opacity),!0}return!1},this.remove=function(e){if(!t.p.p._.wasInitialized)return!1;for(var n=0;n<t.p.model.length;n++)if(t.p.model[n].name===e)return t.p.p.planet.remove(t.p.model[n].model),t.p.model.splice(n,1),!0;return!1},this.generateModel=function(e,n){var r=yl.getExtension(e.path).toLowerCase();if(t.modelCache[e.path])n(t.modelCache[e.path].clone());else{var i=function(r){r&&!1!==e.cache&&(t.modelCache[e.path]=r.clone()),n(r)};switch(r){case"obj":t.objToModel(e,i);break;case"dae":t.daeToModel(e,i);break;case"glb":case"gltf":t.gltfToModel(e,i);break;default:console.warn("WARNING - Unsupported model file type: "+r+" in layer "+e.name+". Must be one of: obj, dae, glb"),n(!1)}}},this.objToModel=function(e,n){return xf(t,void 0,void 0,(function(){return wf(this,(function(t){return e.mtlPath?Sf.load(e.mtlPath,(function(t){var r=new vf;r.setMaterials(t),t.preload(),r.load(e.path,(function(e){n(e)}),(function(e){}),(function(t){console.warn("Failed to load .obj at: "+e.path),n(!1)}))})):Mf.load(e.path,(function(e){n(e)}),(function(e){}),(function(t){console.warn("Failed to load .obj at: "+e.path),n(!1)})),[2]}))}))},this.daeToModel=function(e,t){Ef.load(e.path,(function(e){t(e.scene)}),(function(e){}),(function(n){console.warn("Failed to load .dae at: "+e.path),t(!1)}))},this.gltfToModel=function(e,n){return xf(t,void 0,void 0,(function(){return wf(this,(function(t){return Tf.load(e.path,(function(e){n(e.scene)}),(function(e){}),(function(t){console.warn("Failed to load gltf at: "+e.path),n(!1)})),[2]}))}))},this.localizeModel=function(e,n){var r=new be;if(e.isArrayed)for(var i=function(i){var o=n.clone(),a=e.position[i].longitude||e.position[i].lng||0,s=e.position[i].latitude||e.position[i].lat||0,l=(e.position[i].elevation||e.position[i].elev||0)*t.p.p.options.exaggeration,c=t.p.p.projection.lonLatToVector3(a,s,l);o.position.set(c.x,c.y,c.z);var u=new b;if(u.setFromUnitVectors(new _(0,1,0),new _(c.x,c.y,c.z).normalize()),o.applyQuaternion(u),o.rotateY(-a*(Math.PI/180)),e.rotation){var h=null!=e.rotation.length?e.rotation.length>i?e.rotation[i]:e.rotation[e.rotation.length-1]:e.rotation,d=h.order||"YXZ";3!=d.length&&(console.warn('Lithosphere: Warning - Model Layer "'+e.name+"\" has an invalid rotation.order. Defaulting back to 'YXZ'"),d="YXZ"),o.rotation.order=d,d.split("").forEach((function(t){switch(t){case"X":o.rotateX(h.x||0);break;case"Y":o.rotateY(-h.y||0);break;case"Z":o.rotateZ(h.z||0);break;default:console.warn('Lithosphere: Warning - Model Layer "'+e.name+'" has an invalid rotation.order axis: '+t+". Must be one of X, Y, Z")}}))}if(null!=e.scale){var f=e.scale[i]||e.scale||1;o.scale.set(f||1,f||1,f||1)}r.add(o)},o=0;o<e.position.length;o++)i(o);else{var a=e.position.longitude||e.position.lng||0,s=e.position.latitude||e.position.lat||0,l=(e.position.elevation||e.position.elev||0)*t.p.p.options.exaggeration,c=t.p.p.projection.lonLatToVector3(a,s,l);n.position.set(c.x,c.y,c.z);var u=new b;if(u.setFromUnitVectors(new _(0,1,0),new _(c.x,c.y,c.z).normalize()),n.applyQuaternion(u),n.rotateY(-a*(Math.PI/180)),e.rotation){var h=e.rotation.order||"YXZ";3!=h.length&&(console.warn('Lithosphere: Warning - Model Layer "'+e.name+"\" has an invalid rotation.order. Defaulting back to 'YXZ'"),h="YXZ"),n.rotation.order=h,h.split("").forEach((function(t){switch(t){case"X":n.rotateX(e.rotation.x||0);break;case"Y":n.rotateY(-e.rotation.y||0);break;case"Z":n.rotateZ(e.rotation.z||0);break;default:console.warn('Lithosphere: Warning - Model Layer "'+e.name+'" has an invalid rotation.order axis: '+t+". Must be one of X, Y, Z")}}))}if(null!=e.scale){var d=e.scale;n.scale.set(d||1,d||1,d||1)}r.add(n)}return 0==e.on&&(r.visible=!1),r.layerType="model",r},this.p=e,this.modelCache={}},Af=function(){function e(e){var t=this;this.addLayer=function(e,n,r,i){1==n.on?n.on=!0:0==n.on&&(n.on=!1),n._type=e,t._.layerers[e]?t._.layerers[e].add(n,r):console.warn("Cannot add unknown layer type "+e+".")},this.removeLayer=function(e){var n=!1;for(var r in t._.layerers){t._.layerers[r].remove(e)&&(n=!0)}return!!n},this.toggleLayer=function(e,n){var r=!1;for(var i in t._.layerers){t._.layerers[i].toggle(e,n)&&(r=!0)}return!!r},this.setLayerOpacity=function(e,n){var r=!1;for(var i in t._.layerers){t._.layerers[i].setOpacity(e,parseFloat(n))&&(r=!0)}return!!r},this.setLayerFilterEffect=function(e,n,r){var i=["brightness","contrast","saturation","blendCode"];return i.includes(n)?!!t._.layerers.tile.setFilterEffect(e,n,parseFloat(r)):(console.warn("Filter "+n+" must be one of: "+i.toString()+"."),!1)},this.setLayerSpecificOptions=function(e,n){var r=!1;for(var i in t._.layerers){if("function"==typeof t._.layerers[i].setLayerSpecificOptions)t._.layerers[i].setLayerSpecificOptions(e,n)&&(r=!0)}return!!r},this.findHighestMaxZoom=function(){var e=0;for(var n in t.tile)t.tile[n].on&&t.tile[n].maxZoom>e&&(e=t.tile[n].maxZoom);return e},this.findLowestMinZoom=function(){var e=1/0;for(var n in t.tile)t.tile[n].on&&t.tile[n].minZoom<e&&(e=t.tile[n].minZoom);return e},this.getFeatureStyleProp=function(e,t){if(null!=e&&"string"==typeof e&&e.includes("=")){var n=e.split("=");return yl.getIn(t.properties,n[1].split("."))}return e},this.getLayerByName=function(e){for(var n in t.all)for(var r=0;r<t.all[n].length;r++)if(t.all[n][r].name===e)return t.all[n][r];return null},this.hasLayer=function(e){return null!=t.getLayerByName(e)},this.getFeatureStyle=function(e,n,r){var i,o,a=JSON.parse(JSON.stringify(t.baseStyle));if(e.style){var s=n.geometry.type.toLowerCase();for(var l in a){if(e.style.default&&null!=e.style.default[l]){var c=t.getFeatureStyleProp(e.style.default[l],n);a[l]=null!=c?c:a[l]}if("point"===s&&e.style.point){var u=t.getFeatureStyleProp(e.style.point[l],n);a[l]=null!=u?u:a[l]}else if("linestring"===s&&e.style.line){var h=t.getFeatureStyleProp(e.style.line[l],n);a[l]=null!=h?h:a[l]}else if("polygon"===s&&e.style.polygon){var d=t.getFeatureStyleProp(e.style.polygon[l],n);a[l]=null!=d?d:a[l]}if(e.style.byProp)for(var f in e.style.byProp){var p=f.split(":")[0].split("=")[1],m=f.split(":")[1];if(yl.getIn(n.properties,p.split("."))==m){var g=t.getFeatureStyleProp(e.style.byProp[f][l],n);a[l]=null!=g?g:a[l]}}if(!0===e.style.letPropertiesStyleOverride){var v=yl.getIn(null===(i=n.properties)||void 0===i?void 0:i.style,l);a[l]=null!=v?v:a[l]}}}"none"===a.fillColor&&(a.fillColor="rgba(0,0,0,0)");var y=(null===(o=n.geometry)||void 0===o?void 0:o.type)?n.geometry.type.toLowerCase():"";return n._active?!1!==t.p.options.canBecomeActive&&!1!==e.canBecomeActive&&(null==e.style[y]||e.style[y]&&!1!==e.style[y].canBecomeActive)&&(a.fillColor=t.p.options.activeColor||"red"):n._highlighted&&!1!==t.p.options.canBecomeHighlighted&&!1!==e.canBecomeHighlighted&&(null==e.style[y]||e.style[y]&&!1!==e.style[y].canBecomeHighlighted)&&(a.fillColor=t.p.options.highlightColor||"yellow"),!0===r&&(a.color=a.fillColor),a},this._onMouseMove=function(e,n,r,i,o){var a;if(r.layerType&&t[r.layerType]){var s=t[r.layerType];for(var l in s)(null===(a=r.parent)||void 0===a?void 0:a.uuid)===s[l].curtain.uuid&&"function"==typeof s[l].onMouseMove&&s[l].onMouseMove(n,s[l],r,i,e,o)}},this.p=e,this.baseStyle={fillColor:"rgb(0,0,0)",fillOpacity:.4,color:"rgb(255,255,255)",weight:2,radius:6},this._={layerers:{tile3d:new $d(this),tile:new ef(this),clamped:new nf(this),vector:new ff(this),curtain:new gf(this),model:new Cf(this)}},this._reset()}return e.prototype._reset=function(){this.tile3d=[],this.tile=[],this.clamped=[],this.vector=[],this.curtain=[],this.model=[],this.all={tile3d:this.tile3d,tile:this.tile,clamped:this.clamped,vector:this.vector,curtain:this.curtain,model:this.model}},e}(),Lf=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='_lithosphere_control_compass_root' style='width: 40px; height: 40px; position: relative;'>","<div style='position: absolute; left: 16px; bottom: 40px;font-family: sans-serif; font-size: 10px'>N</div>","<svg width='40' height='40'>","<circle cx='20' cy='20' r='20' stroke-width='0' fill='rgba(0,0,0,1)' />","<path id='_lithosphere_control_compass_arc' fill='#fff' stroke='#fff' stroke-width='0'></path>","<line x1='20' y1='0' x2='20' y2='20' style='stroke:rgb(255,255,255);stroke-width:1;mix-blend-mode:difference;' />","<line x1='40' y1='20' x2='35' y2='20' style='stroke:rgb(255,255,255);stroke-width:1;mix-blend-mode:difference;' />","<line x1='20' y1='40' x2='20' y2='35' style='stroke:rgb(255,255,255);stroke-width:1;mix-blend-mode:difference;' />","<line x1='0' y1='20' x2='5' y2='20' style='stroke:rgb(255,255,255);stroke-width:1;mix-blend-mode:difference;' />","</svg>","<div id='_lithosphere_control_compass_azimuth' style='position: absolute; left: 0px; bottom: 0px; width: 40px; height: 40px; line-height: 40px; opacity: 0; font-size: 11px; transition: opacity 0.1s ease-out; font-weight: bold; text-align: center; background: black; border-radius: 50%;'></div>","</div>"].join("")},this.attachEvents=function(){document.getElementById("_lithosphere_control_compass_azimuth").addEventListener("mouseenter",(function(e){e.target.style.opacity="1"})),document.getElementById("_lithosphere_control_compass_azimuth").addEventListener("mouseleave",(function(e){e.target.style.opacity="0"}))},this.onUpdate=function(){n.setDirection()},this.setDirection=function(){var e,t,r,i=n.p._.cameras.isFirstPerson?n.p._.cameras.firstPerson:n.p._.cameras.orbit;if(null!=i){if(n.p._.cameras.isFirstPerson)t=-(i.controls.getObject().rotation.y%(2*Math.PI)+Math.PI)*(180/Math.PI);else{var o=i.camera.position.x,a=i.camera.position.z;t=Math.atan2(o,a)*(180/Math.PI)}r=i.camera.fov}e=function(e,t,n,r,i){var o=Pf(e,t,n,i),a=Pf(e,t,n,r),s=i-r<=180?"0":"1";return["M",o.x,o.y,"A",n,n,0,s,0,a.x,a.y,"L",e,t].join(" ")}(20,20,20,t-r/2,t+r/2),document.getElementById("_lithosphere_control_compass_arc").setAttribute("d",e),t<0&&(t+=360),document.getElementById("_lithosphere_control_compass_azimuth").innerHTML=parseInt(t)+" &deg;"},this.p=e,this.name=t,this._={},this.corner="BottomLeft"};function Pf(e,t,n,r){var i=(r-90)*Math.PI/180;return{x:e+n*Math.cos(i),y:t+n*Math.sin(i)}}n(12);var Rf=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='_lithosphere_control_navigation_root'>","<div id='_lithosphere_control_navigation_spin_root'>","<div id='_lithosphere_control_navigation_spin' style='padding: 0px 5px 0px 13px; user-select: none; display: flex;'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />',"</svg>","<div style='padding-left: 4px;'>spin</div>","</div>","<div class='_lithosphere_control_navigation_panel'>","<div id='_lithosphere_control_navigation_spin_left'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z" />',"</svg>","</div>","<div id='_lithosphere_control_navigation_spin_right'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" />',"</svg>","</div>","</div>","</div>","<div id='_lithosphere_control_navigation_dolly_root'>","<div id='_lithosphere_control_navigation_dolly' style='padding: 0px 5px 0px 16px; user-select: none; display: flex;'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M12 10H9.09C9.43 6.55 10.6 4 12 4S14.57 6.55 14.91 10H16.9C16.44 5.44 14.42 2 12 2S7.56 5.44 7.1 10H4L8 14L12 10M12 20C10.73 20 9.64 17.89 9.21 14.92L8 16.12L7.3 15.42C8 19.26 9.84 22 12 22C14.42 22 16.44 18.56 16.9 14H14.91C14.57 17.45 13.4 20 12 20M22 11H13L11 13H22V11M2 13H5L3 11H2V13" />',"</svg>","<div style='padding-left: 4px;'>tilt</div>","</div>","<div class='_lithosphere_control_navigation_panel'>","<div id='_lithosphere_control_navigation_dolly_up'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z" />',"</svg>","</div>","<div id='_lithosphere_control_navigation_dolly_down'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z" />',"</svg>","</div>","</div>","</div>","<div id='_lithosphere_control_navigation_pan_root'>","<div id='_lithosphere_control_navigation_pan'  style='padding: 0px 5px 0px 15px; user-select: none; display: flex;'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M12,2.5L8,7H16L12,2.5M7,8L2.5,12L7,16V8M17,8V16L21.5,12L17,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M8,17L12,21.5L16,17H8Z" />',"</svg>","<div style='padding-left: 4px;'>pan</div>","</div>","<div class='_lithosphere_control_navigation_panel'>","<div id='_lithosphere_control_navigation_pan_up'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M12,2.5L8,7H16L12,2.5M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10Z" />',"</svg>","</div>","<span style='display: flex;'>","<div id='_lithosphere_control_navigation_pan_left'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M7,8L2.5,12L7,16V8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10Z" />',"</svg>","</div>","<div id='_lithosphere_control_navigation_pan_right'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M17,8V16L21.5,12L17,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10Z" />',"</svg>","</div>","</span>","<div id='_lithosphere_control_navigation_pan_down'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M8,17L12,21.5L16,17H8Z" />',"</svg>","</div>","</div>","</div>","<div id='_lithosphere_control_navigation_zoom_root'>","<div id='_lithosphere_control_navigation_zoom' style='padding: 0px 5px 0px 9px; user-select: none; display: flex;'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />',"</svg>","<div style='padding-left: 4px;'>zoom</div>","</div>","<div class='_lithosphere_control_navigation_panel'>","<div id='_lithosphere_control_navigation_zoom_in'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />',"</svg>","</div>","<div id='_lithosphere_control_navigation_zoom_out'>",'<svg viewBox="0 0 24 24">','<path fill="currentColor" d="M19,13H5V11H19V13Z" />',"</svg>","</div>","</div>","</div>","</div>"].join("\n")},this.attachEvents=function(){document.getElementById("_lithosphere_control_navigation_spin").addEventListener("click",(function(e){document.querySelector("#_lithosphere_control_navigation_spin_root ._lithosphere_control_navigation_panel").classList.toggle("active")})),document.getElementById("_lithosphere_control_navigation_spin_left").addEventListener("click",(function(){n.p._.cameras.controls.rotateLeft(Math.PI/180*3)})),document.getElementById("_lithosphere_control_navigation_spin_right").addEventListener("click",(function(){n.p._.cameras.controls.rotateLeft(Math.PI/180*-3)})),document.getElementById("_lithosphere_control_navigation_dolly").addEventListener("click",(function(e){document.querySelector("#_lithosphere_control_navigation_dolly_root ._lithosphere_control_navigation_panel").classList.toggle("active")})),document.getElementById("_lithosphere_control_navigation_dolly_up").addEventListener("click",(function(){n.p._.cameras.controls.rotateUp(Math.PI/180*1.3)})),document.getElementById("_lithosphere_control_navigation_dolly_down").addEventListener("click",(function(){n.p._.cameras.controls.rotateUp(Math.PI/180*-1.3)})),document.getElementById("_lithosphere_control_navigation_pan").addEventListener("click",(function(e){document.querySelector("#_lithosphere_control_navigation_pan_root ._lithosphere_control_navigation_panel").classList.toggle("active")})),document.getElementById("_lithosphere_control_navigation_pan_up").addEventListener("click",(function(){n.p._.events._rotateGlobe({pageX:0,pageY:0},{x:0,y:-200})})),document.getElementById("_lithosphere_control_navigation_pan_left").addEventListener("click",(function(){n.p._.events._rotateGlobe({pageX:0,pageY:0},{x:-200,y:0})})),document.getElementById("_lithosphere_control_navigation_pan_right").addEventListener("click",(function(){n.p._.events._rotateGlobe({pageX:0,pageY:0},{x:200,y:0})})),document.getElementById("_lithosphere_control_navigation_pan_down").addEventListener("click",(function(){n.p._.events._rotateGlobe({pageX:0,pageY:0},{x:0,y:200})})),document.getElementById("_lithosphere_control_navigation_zoom").addEventListener("click",(function(e){document.querySelector("#_lithosphere_control_navigation_zoom_root ._lithosphere_control_navigation_panel").classList.toggle("active")})),document.getElementById("_lithosphere_control_navigation_zoom_in").addEventListener("click",(function(){n.p._.cameras.controls.handleMouseWheel({deltaY:-200}),n.p._.events._onZoom()})),document.getElementById("_lithosphere_control_navigation_zoom_out").addEventListener("click",(function(){n.p._.cameras.controls.handleMouseWheel({deltaY:200}),n.p._.events._onZoom()}))},this.p=e,this.name=t,this._={},this.corner="TopRight"},Of=function(e,t,n){var r=this;this.getControl=function(){var e=(null!=r.params.existingDivId?"display: none; ":"")+"background: black; padding: 5px; font-size: 14px;";return["<div class='"+r.name+"' id='_lithosphere_control_coordinate_root' title='Longitude, Latitude, Elevation' style='"+e+"'>","</div>"].join("")},this.attachEvents=function(){},this.onUpdate=function(){(r.p._.mouseIsInScene||r.p._.cameras.isFirstPerson)&&r.updateMouseCoords()},this.updateMouseCoords=function(){var e="Outer Space";null!=r.p.mouse.lat&&null!=r.p.mouse.lng&&(e=r.p.mouse.lng.toFixed(8)+"&deg;, "+r.p.mouse.lat.toFixed(8)+"&deg;, "+r.p.mouse.elev.toFixed(3)+"m");var t=document.getElementById("_lithosphere_control_coordinate_root");if(t&&t.innerHTML!=e&&(t.innerHTML=e),null!=r.params.existingDivId){var n=document.getElementById(r.params.existingDivId);n&&n.innerHTML!=e&&(n.innerHTML=e)}},this.p=e,this.name=t,this.params=n||{},this._={},this.corner="BottomRight"},kf=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='_lithosphere_control_home_root' title='Reset View' style='width: 26px; height: 26px; background: black; font-size: 24px; line-height: 26px; text-align: center; cursor: pointer;'>",'<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M9,13H15V19H18V10L12,5.5L6,10V19H9V13M4,21V9L12,3L20,9V21H4Z" />',"</svg>","</div>"].join("")},this.attachEvents=function(){document.getElementById("_lithosphere_control_home_root").addEventListener("click",(function(){n.p.setCenter(n.p.options.initialView,null,!0)}))},this.p=e,this.name=t,this._={},this.corner="TopLeft"},If=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='"+n.id+"' style='position: relative;'>",'<div title="Layers" style="cursor: pointer; width: 26px; height: 26px; background: black; font-size: 24px; line-height: 28px; text-align: center;">',n.getInactiveContent(),"</div>","<span id='"+n.id+"_active' style='pointer-events: none; opacity: 0; transition: opacity 0.2s ease-out;'>",n.getActiveContent(),"</span>","</div>"].join("")},this.attachEvents=function(){document.getElementById(n.id).addEventListener("mouseenter",(function(){document.getElementById(n.id+"_active").innerHTML=n.getActiveContent(),n.attachEventsInternal(),document.getElementById(n.id+"_active").style.pointerEvents="all",document.getElementById(n.id+"_active").style.opacity="1"})),document.getElementById(n.id+"_active").addEventListener("mouseleave",(function(){document.getElementById(n.id+"_active").style.pointerEvents="none",document.getElementById(n.id+"_active").style.opacity="0"}))},this.getInactiveContent=function(){return['<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M12,16L19.36,10.27L21,9L12,2L3,9L4.63,10.27M12,18.54L4.62,12.81L3,14.07L12,21.07L21,14.07L19.37,12.8L12,18.54Z" />',"</svg>"].join("")},this.getActiveContent=function(){var e=[];for(var t in n.p.layers.all)if(n.p.layers.all[t].length>0){for(var r=[],i=0,o=n.p.layers.all[t];i<o.length;i++){var a=o[i];r.push(['<li style="display: flex; justify-content: space-between; height: 22px; font-size: 12px; line-height: 22px;">','<div style="display: flex; justify-content: space-between;">','<input class="'+n.id+'_toggle" layer-type="'+t+'" layer-name="'+a.name+'" type="checkbox" '+(a.on?"checked":"")+' style="margin: 4px 4px 3px 4px;"/>','<span style="text-transform: capitalize; margin-right: 20px;">'+a.name+"</span>","</div>",'<div style="display: flex; justify-content: space-between;">','<input class="'+n.id+'_opacity" layer-type="'+t+'" layer-name="'+a.name+'" type="range" min="0" max="1" step="0.01" value="'+a.opacity+'" style="width: 60px;"/>',"</div>","</li>"].join(""))}e.push(['<div style="border-bottom: 1px solid #222;">','<div style="text-transform: capitalize; padding: 6px; font-size: 12px; color: #888;">'+t+"</div>",'<ul style="margin: 0; padding: 0px 6px 6px 6px;">',r.join(""),"</ul>","</div>"].join(""))}return['<div style="position: absolute; top: 0px; right: 0px; background: #111; border: 1px solid #222; border-bottom: 0px solid #222;">',e.join(""),"</div>"].join("")},this.attachEventsInternal=function(){for(var e=function(e){e.addEventListener("click",(function(t){n.p.toggleLayer(e.getAttribute("layer-name"))}))},t=0,r=document.getElementsByClassName(n.id+"_toggle");t<r.length;t++)e(r[t]);for(var i=function(e){"clamped"===e.getAttribute("layer-type")?e.addEventListener("change",(function(t){n.p.setLayerOpacity(e.getAttribute("layer-name"),e.value)})):e.addEventListener("input",(function(t){n.p.setLayerOpacity(e.getAttribute("layer-name"),e.value)}))},o=0,a=document.getElementsByClassName(n.id+"_opacity");o<a.length;o++)i(a[o])},this.id="_lithosphere_control_layers_root",this.p=e,this.name=t,this._={},this.corner="TopRight"},Df=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='"+n.id+"' style='position: relative;'>",n.getInactiveContent(),"<span id='"+n.id+"_active' style='pointer-events: none; opacity: 0; transition: opacity 0.2s ease-out;'>",n.getActiveContent(),"</span>","</div>"].join("")},this.attachEvents=function(){document.getElementById(n.id).addEventListener("mouseenter",(function(){document.getElementById(n.id+"_active").style.pointerEvents="all",document.getElementById(n.id+"_active").style.opacity="1"})),document.getElementById(n.id+"_active").addEventListener("mouseleave",(function(){document.getElementById(n.id+"_active").style.pointerEvents="none",document.getElementById(n.id+"_active").style.opacity="0"}));for(var e=document.getElementsByClassName(n.id+"_option"),t=function(t){e[t].addEventListener("click",(function(){for(var r=parseFloat(e[t].getAttribute("value")),i=0;i<e.length;i++)e[i].classList.remove("_lithosphere_active"),e[i].style.background="unset",e[i].style.color="unset";e[t].style.background="#FBC02D",e[t].style.color="black",e[t].classList.add("_lithosphere_active"),n.setExaggeration(r)})),parseFloat(e[t].getAttribute("value"))==n.p.options.exaggeration&&(e[t].style.background="#FBC02D",e[t].style.color="black",e[t].classList.add("_lithosphere_active"))},r=0;r<e.length;r++)t(r)},this.getInactiveContent=function(){return['<div title="Exaggerate" style="cursor: pointer; width: 26px; height: 26px; background: black; font-size: 24px; line-height: 28px; text-align: center;">','<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M12,22A2,2 0 0,1 10,20A2,2 0 0,1 12,18A2,2 0 0,1 14,20A2,2 0 0,1 12,22M13,16H11V6L6.5,10.5L5.08,9.08L12,2.16L18.92,9.08L17.5,10.5L13,6V16Z" />',"</svg>","</div>"].join("")},this.getActiveContent=function(){return['<div style="display: flex; position: absolute; top: 0px; left: 0px; height: 26px; line-height: 26px;">',n.getInactiveContent(),'<div style="display: flex; background: #111; font-size: 12px; margin-left: 5px;">','<div class="'+n.id+'_option" value="1" style="padding: 0px 6px; cursor: pointer;">1x</div>','<div class="'+n.id+'_option" value="2" style="padding: 0px 6px; cursor: pointer;">2x</div>','<div class="'+n.id+'_option" value="5" style="padding: 0px 6px; cursor: pointer;">5x</div>',"</div>","</div>"].join("")},this.setExaggeration=function(e){n.p.options.exaggeration=e,n.p._.tiledWorld.removeAllTiles()},this.id="_lithosphere_control_exaggerate_root",this.p=e,this.name=t,this._={},this.corner="TopLeft",this.exaggeration=1},Nf=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='"+n.id+"' style='position: relative;'>",n.getInactiveContent(),"<span id='"+n.id+"_active' style='pointer-events: none; opacity: 0; transition: opacity 0.2s ease-out;'>",n.getActiveContent(),"</span>","</div>"].join("")},this.getInactiveContent=function(){return["<div title='Observe' style='width: 26px; height: 26px; background: black; font-size: 24px; line-height: 27px; text-align: center; cursor: pointer;'>",'<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M13.73,15L9.83,21.76C10.53,21.91 11.25,22 12,22C14.4,22 16.6,21.15 18.32,19.75L14.66,13.4M2.46,15C3.38,17.92 5.61,20.26 8.45,21.34L12.12,15M8.54,12L4.64,5.25C3,7 2,9.39 2,12C2,12.68 2.07,13.35 2.2,14H9.69M21.8,10H14.31L14.6,10.5L19.36,18.75C21,16.97 22,14.6 22,12C22,11.31 21.93,10.64 21.8,10M21.54,9C20.62,6.07 18.39,3.74 15.55,2.66L11.88,9M9.4,10.5L14.17,2.24C13.47,2.09 12.75,2 12,2C9.6,2 7.4,2.84 5.68,4.25L9.34,10.6L9.4,10.5Z" />',"</svg>","</div>"].join("")},this.getActiveContent=function(){var e=n.p.getCenter();return['<div style="display: flex; position: absolute; top: 0px; left: 0px; height: 26px; line-height: 26px;">',n.getInactiveContent(),'<div style="display: flex; background: #111; font-size: 12px; margin-left: 5px;">',"<div id='_lithosphere_WalkSettingsPanel' style='padding: 2px 6px 6px 6px; position: absolute; top: 0px; background: #000; width: 185px;'>","<ul style='list-style-type: none; padding: 0; margin: 0; font-size: 12px;'>","<li id='_lithosphere_WalkSettingsFov' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Field of View</div>","<input id='_lithosphere_WalkSettingsFovValue' type='number' value='60' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","<input id='_lithosphere_WalkSettingsFovValueRaw' type='number' value='60' style='display: none;'>","</li>","<li id='_lithosphere_WalkSettingsVerticalFov' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Vertical FOV</div>","<input id='_lithosphere_WalkSettingsVerticalFovValue' type='number' value='60' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","</li>","<li id='_lithosphere_WalkSettingsFocalLength' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Focal Length</div>","<input id='_lithosphere_WalkSettingsFocalLengthValue' type='number' value='35' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 6px 0px auto;'>","<div style='height: 19px; font-size: 10px; line-height: 5px;'><div style='height: 8px;'>m</div><div style='height: 8px;'>m</div></div>","</li>","<li id='_lithosphere_WalkSettingsAzimuth' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Azimuth</div>","<input id='_lithosphere_WalkSettingsAzimuthValue' type='number' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","</li>","<li id='_lithosphere_WalkSettingsElevation' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Elevation</div>","<input id='_lithosphere_WalkSettingsElevationValue' type='number' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","</li>","<li id='_lithosphere_WalkSettingsHeight' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Height</div>","<input id='_lithosphere_WalkSettingsHeightValue' type='number' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div>m</div>","</li>","<li id='_lithosphere_WalkSettingsLatitude' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Latitude</div>","<input id='_lithosphere_WalkSettingsLatitudeValue' type='number' value='"+e.lat+"' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","</li>","<li id='_lithosphere_WalkSettingsLongitude' style='display: flex; justify-content: space-between; margin-bottom: 3px;'>","<div style='float: left; padding-right: 5px;'>Longitude</div>","<input id='_lithosphere_WalkSettingsLongitudeValue' type='number' value='"+e.lng+"' style='width: 100%; background-color: transparent; color: white; border: none; border-bottom: 1px solid #777; width: 80px; margin: 0px 2px 0px auto;'>","<div style='font-size: 20px; padding-right: 4px;'>&deg;</div>","</li>","</ul>","<div id='_lithosphere_WalkWalkStandButtons' style='padding-top: 6px; display: flex; justify-content: space-between;'>","<div id='_lithosphere_WalkWalkHere' style='display: none; padding: 0px 6px; cursor: pointer;'>Walk Here</div>","<div id='_lithosphere_WalkStand' style='padding: 0px 6px; cursor: pointer; width: 100%; text-align: center; font-size: 12px; text-transform: uppercase; font-weight: bold; background: #FBC02D; color: black;'>Observe</div>","</div>","</div>","</div>","</div>"].join("")},this.attachEvents=function(){document.getElementById(n.id).addEventListener("mouseenter",(function(){document.getElementById(n.id+"_active").style.pointerEvents="all",document.getElementById(n.id+"_active").style.opacity="1"})),document.getElementById(n.id+"_active").addEventListener("mouseleave",(function(){document.getElementById(n.id+"_active").style.pointerEvents="none",document.getElementById(n.id+"_active").style.opacity="0"})),document.getElementById("_lithosphere_WalkStand").addEventListener("click",(function(){n.setCamera(!0),n.toggleFOVOverlay(!0);var e=n.getObserverValues();n.updateFOVOverlayBounds(e.vfieldofview,e.elevation,e.fieldofview,e.azimuth),document.addEventListener("keydown",n.keydownObserverSettings);try{n.p.controls.controlContainer.removeChild(n.helpDiv)}catch(e){}var t=["<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>W</div><div>Up</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>A</div><div>Left</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>S</div><div>Down</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>D</div><div>Right</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>R</div><div>Higher</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>F</div><div>Lower</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>T</div><div>FOV +</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>G</div><div>FOV -</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>Y</div><div>vFOV +</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>H</div><div>vFOV -</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>SHIFT+</div><div>Fast</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>ESC</div><div>Quit</div></div>"].join("\n");n.helpDiv=document.createElement("div"),n.helpDiv.id="_lithosphere_control_walk_help",n.helpDiv.style="position: absolute; bottom: 47px; right: 15px; background: black; font-size: 13px;",n.helpDiv.innerHTML=t,n.p.controls.controlContainer.appendChild(n.helpDiv)}))},this.setCamera=function(e,t){var r=n.getObserverValues();n.p.setCenter({lat:r.latitude,lng:r.longitude,zoom:n.p.zoom},!0),n.p._.cameras.setFirstPersonHeight(r.height),n.p._.cameras.setCameraAzimuthElevation(r.azimuth,r.elevation,!0),n.p._.cameras.setFirstPersonFocalLength(r.focallength),n.p._.cameras.setFirstPersonFOV(Math.max(r.vfieldofview,60)),n.p._.cameras.swap(e,t),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",n.leaveObserver,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",n.leaveObserver,!1)},this.leaveObserver=function(){if(document.pointerLockElement===document.body||document.mozPointerLockElement===document.body);else try{n.p.controls.controlContainer.removeChild(n.helpDiv),n.toggleFOVOverlay(!1),document.removeEventListener("keydown",n.keydownObserverSettings)}catch(e){}},this.getObserverValues=function(){return{fieldofview:parseFloat(document.getElementById("_lithosphere_WalkSettingsFovValue").value)||60,fieldofviewRaw:parseFloat(document.getElementById("_lithosphere_WalkSettingsFovValueRaw").value)||60,vfieldofview:parseFloat(document.getElementById("_lithosphere_WalkSettingsVerticalFovValue").value)||60,focallength:parseFloat(document.getElementById("_lithosphere_WalkSettingsFocalLengthValue").value)||35,azimuth:parseFloat(document.getElementById("_lithosphere_WalkSettingsAzimuthValue").value)||0,elevation:parseFloat(document.getElementById("_lithosphere_WalkSettingsElevationValue").value)||0,height:parseFloat(document.getElementById("_lithosphere_WalkSettingsHeightValue").value)||3,latitude:parseFloat(document.getElementById("_lithosphere_WalkSettingsLatitudeValue").value)||n.p.getCenter().lat||0,longitude:parseFloat(document.getElementById("_lithosphere_WalkSettingsLongitudeValue").value)||n.p.getCenter().lon||0}},this.keydownObserverSettings=function(e){var t=n.getObserverValues();84===e.which?document.getElementById("_lithosphere_WalkSettingsFovValue").value=+(t.fieldofview+(e.shiftKey?1:.2)).toFixed(4):71===e.which?document.getElementById("_lithosphere_WalkSettingsFovValue").value=+(t.fieldofview-(e.shiftKey?1:.2)).toFixed(4):89===e.which?document.getElementById("_lithosphere_WalkSettingsVerticalFovValue").value=+(t.vfieldofview+(e.shiftKey?1:.2)).toFixed(4):72===e.which?document.getElementById("_lithosphere_WalkSettingsVerticalFovValue").value=+(t.vfieldofview-(e.shiftKey?1:.2)).toFixed(4):68===e.which?document.getElementById("_lithosphere_WalkSettingsAzimuthValue").value=+(t.azimuth+(e.shiftKey?1:.2)).toFixed(4):65===e.which?document.getElementById("_lithosphere_WalkSettingsAzimuthValue").value=+(t.azimuth-(e.shiftKey?1:.2)).toFixed(4):87===e.which?document.getElementById("_lithosphere_WalkSettingsElevationValue").value=+(t.elevation+(e.shiftKey?1:.2)).toFixed(4):83===e.which?document.getElementById("_lithosphere_WalkSettingsElevationValue").value=+(t.elevation-(e.shiftKey?1:.2)).toFixed(4):82===e.which?document.getElementById("_lithosphere_WalkSettingsHeightValue").value=+(t.height+(e.shiftKey?1:.2)).toFixed(4):70===e.which&&(document.getElementById("_lithosphere_WalkSettingsHeightValue").value=+(t.height-(e.shiftKey?1:.2)).toFixed(4));var r=n.getObserverValues();n.p._.cameras.setFirstPersonHeight(r.height),n.p._.cameras.setCameraAzimuthElevation(r.azimuth,r.elevation,!0),r.vfieldofview!==t.vfieldofview?(n.p._.cameras.setFirstPersonFOV(Math.max(r.vfieldofview,60)),document.getElementById("_lithosphere_WalkSettingsFocalLengthValue").value=+n.p._.cameras.getFirstPersonFocalLength().toFixed(4)):r.focallength!==t.focallength&&(n.p._.cameras.setFirstPersonFocalLength(r.focallength),document.getElementById("_lithosphere_WalkSettingsFovValue").value=+n.p._.cameras.getFirstPersonFOV().toFixed(4)),n.updateFOVOverlayBounds(r.vfieldofview,r.elevation,r.fieldofview,r.azimuth)},this.toggleFOVOverlay=function(e){var t=document.getElementById("_lithosphere_WalkFOVOverlay");if(e){if(null==t){var r=document.createElement("div");r.id="_lithosphere_WalkFOVOverlay",r.style=["position: absolute","left: 0","top: 0","width: 100%","height: 100%","pointer-events: none"].join(";"),r.innerHTML=["<div id='_lithosphere_Walk_NW' style='position: absolute; background: rgba(0,0,0,0.4);'></div>","<div id='_lithosphere_Walk_N' style='position: absolute; background: rgba(0,0,0,0.4); border-bottom: 1px solid #444;'></div>","<div id='_lithosphere_Walk_NE' style='position: absolute; background: rgba(0,0,0,0.4);'></div>","<div id='_lithosphere_Walk_E' style='position: absolute; background: rgba(0,0,0,0.4); border-left: 1px solid #444;'></div>","<div id='_lithosphere_Walk_SE' style='position: absolute; background: rgba(0,0,0,0.4);'></div>","<div id='_lithosphere_Walk_S' style='position: absolute; background: rgba(0,0,0,0.4); border-top: 1px solid #444;'></div>","<div id='_lithosphere_Walk_SW' style='position: absolute; background: rgba(0,0,0,0.4);'></div>","<div id='_lithosphere_Walk_W' style='position: absolute; background: rgba(0,0,0,0.4); border-right: 1px solid #444;'></div>"].join("\n"),n.p.getContainer().appendChild(r)}}else null!=t&&n.p.getContainer().removeChild(t)},this.updateFOVOverlayBounds=function(e,t,r,i){e=document.getElementById("_lithosphere_WalkSettingsVerticalFovValue").value;var o=n.p._.cameras.getFirstPersonFOV(),a=n.p.getContainer().getBoundingClientRect(),s=a.height*(e/o),l=(a.height/2-s/2)/a.height*100,c=(a.height/2+s/2)/a.height*100,u=a.height/o*r,h=(a.width/2-u/2)/a.width*100,d=(a.width/2+u/2)/a.width*100,f=document.getElementById("_lithosphere_Walk_NW");f.style.top="0%",f.style.height=l+"%",f.style.left="0%",f.style.width=h+"%";var p=document.getElementById("_lithosphere_Walk_N");p.style.top="0%",p.style.height=l+"%",p.style.left=h+"%",p.style.width=d-h+"%";var m=document.getElementById("_lithosphere_Walk_NE");m.style.top="0%",m.style.height=l+"%",m.style.left=d+"%",m.style.width=100-d+"%";var g=document.getElementById("_lithosphere_Walk_E");g.style.top=l+"%",g.style.height=c-l+"%",g.style.left=d+"%",g.style.width=100-d+"%";var v=document.getElementById("_lithosphere_Walk_SE");v.style.top=c+"%",v.style.height=100-c+"%",v.style.left=d+"%",v.style.width=100-d+"%";var y=document.getElementById("_lithosphere_Walk_S");y.style.top=c+"%",y.style.height=100-c+"%",y.style.left=h+"%",y.style.width=d-h+"%";var b=document.getElementById("_lithosphere_Walk_SW");b.style.top=c+"%",b.style.height=100-c+"%",b.style.left="0%",b.style.width=h+"%";var _=document.getElementById("_lithosphere_Walk_W");_.style.top=l+"%",_.style.height=c-l+"%",_.style.left="0%",_.style.width=h+"%"},this.p=e,this.name=t,this.id="_lithosphere_control_observe_root",this._={},this.corner="TopLeft"},jf=function(e,t){var n=this;this.getControl=function(){return["<div class='"+n.name+"' id='_lithosphere_control_walk_root' title='Walk' style='width: 26px; height: 26px; background: black; font-size: 24px; line-height: 27px; text-align: center; cursor: pointer;'>",'<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M14.12,10H19V8.2H15.38L13.38,4.87C13.08,4.37 12.54,4.03 11.92,4.03C11.74,4.03 11.58,4.06 11.42,4.11L6,5.8V11H7.8V7.33L9.91,6.67L6,22H7.8L10.67,13.89L13,17V22H14.8V15.59L12.31,11.05L13.04,8.18M14,3.8C15,3.8 15.8,3 15.8,2C15.8,1 15,0.2 14,0.2C13,0.2 12.2,1 12.2,2C12.2,3 13,3.8 14,3.8Z" />',"</svg>","</div>"].join("")},this.attachEvents=function(){document.getElementById("_lithosphere_control_walk_root").addEventListener("click",(function(){n.setCamera(!1);try{n.p.controls.controlContainer.removeChild(n.helpDiv)}catch(e){}var e=["<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>W</div><div>Forward</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>A</div><div>Left</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>S</div><div>Back</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>D</div><div>Right</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; border-bottom: 1px solid #222; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>SHIFT+</div><div>Fast</div></div>","<div style='display: flex; justify-content: space-between; padding: 2px 6px; white-space: nowrap; text-align: center; color: #fff; line-height: 16px;'><div style='color: #bbb; text-align: center; margin-right: 5px;'>ESC</div><div>Quit</div></div>"].join("\n");n.helpDiv=document.createElement("div"),n.helpDiv.id="_lithosphere_control_walk_help",n.helpDiv.style="position: absolute; bottom: 47px; right: 15px; background: black; font-size: 13px;",n.helpDiv.innerHTML=e,n.p.controls.controlContainer.appendChild(n.helpDiv)}))},this.setCamera=function(e,t){n.p._.cameras.swap(e,t),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",n.leaveWalking,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",n.leaveWalking,!1)},this.leaveWalking=function(){if(document.pointerLockElement===document.body||document.mozPointerLockElement===document.body);else try{n.p.controls.controlContainer.removeChild(n.helpDiv)}catch(e){}},this.p=e,this.name=t,this.helpDiv=null,this._={},this.corner="TopLeft"},Ff=function(e,t,n){var r=this;this.getControl=function(){return["<div class='"+r.name+"' id='_lithosphere_control_link_root' title='Link' style='width: 26px; height: 26px; color: "+(r.return.isLinked?"black":"white")+"; background: "+(r.return.isLinked?"#FBC02D":"black")+"; font-size: 24px; line-height: 27px; text-align: center; cursor: pointer;'>",'<svg style="width:18px; height:18px" viewBox="0 0 24 24">','<path fill="currentColor" d="M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.65L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z" />',"</svg>","</div>"].join("")},this.attachEvents=function(){document.getElementById("_lithosphere_control_link_root").addEventListener("click",(function(){r.return.isLinked=!r.return.isLinked;var e=document.getElementById("_lithosphere_control_link_root");r.return.isLinked?(e.style.background="#FBC02D",e.style.color="black"):(e.style.background="black",e.style.color="white"),"function"==typeof r.params.onToggle&&r.params.onToggle(r.return.isLinked)}))},this.getReturn=function(){return r.return},this.onMove=function(e,t,n){r.return.isLinked&&"function"==typeof r.params.onMove&&(r._.linkPanned=!0,r.params.onMove(e,t,n),clearTimeout(r._.linkPannedTimeout),r._.linkPannedTimeout=setTimeout((function(){r._.linkPanned=!1}),500))},this.onMouseMove=function(e,t,n){r.return.isLinked&&"function"==typeof r.params.onMouseMove&&r.params.onMouseMove(e,t,n)},this.onMouseOut=function(){r.return.isLinked&&"function"==typeof r.params.onMouseOut&&r.params.onMouseOut()},this.onFirstPersonUpdate=function(){"function"==typeof r.params.onFirstPersonUpdate&&r.params.onFirstPersonUpdate()},this.onOrbitalUpdate=function(){"function"==typeof r.params.onOrbitalUpdate&&r.params.onOrbitalUpdate()},this.setLink=function(e,t,n){if(r.p._.wasInitialized&&(null!=r._.targetPoint&&r.p.frontGroup.remove(r._.targetPoint),null!=e)){var i=new mt,o=new Ve({color:65280});r._.targetPoint=new kt(i,o);var a=r.p.getElevationAtLngLat(e.lng,e.lat);if(0!=a){var s=r.p.projection.lonLatToVector3(e.lng,e.lat,(a+.4)*r.p.options.exaggeration);t=t||{radius:8,fillColor:{r:0,g:255,b:0,a:.7},weight:2,color:"rgb(0,255,0)"},null==n&&(n="linkTargetPoint");var l=df.makeMarkerSprite(t,n);l.style=t,r._.targetPoint.attenuate=!0,r._.targetPoint.position.set(s.x,s.y,s.z),r._.targetPoint.add(l),r.p.frontGroup.add(r._.targetPoint),r.p._.events._attenuate(),r.p._.events._refreshFrontGroupRotation()}}},this.linkMove=function(e,t){r.return.isLinked&&!r._.linkPanned&&r.p.setCenter({lat:t,lng:e,z:0},!0)},this.linkMouseMove=function(e,t){r.return.isLinked&&r.setLink({lat:t,lng:e})},this.linkMouseOut=function(){r.setLink()},this.p=e,this.name=t,this.params=n||{},this._={linkPanned:!1,linkPannedTimeout:null},this.corner="TopLeft",this.return={isLinked:this.params.initiallyLinked||!1,linkMove:this.linkMove,linkMouseMove:this.linkMouseMove,linkMouseOut:this.linkMouseOut}},Bf=function(e){var t=this;this.addControl=function(e,n,r,i){if(null==t.activeControls[e]){try{t.activeControls[e]=new n(t.p,e,r)}catch(n){return null!=t.activeControls[e]&&delete t.activeControls[e],void console.warn("Error adding UI Element with name '"+e+"' -",n)}i=i||t.activeControls[e].corner||"TopLeft";var o=document.createElement("div");return o.setAttribute("id","_lithosphere_control_"+e),o.innerHTML=t.activeControls[e].getControl(),o.style.marginRight="5px","TopLeft"!==i&&"TopRight"!==i||(o.style.marginBottom="5px"),t.corners[i].appendChild(o),t.activeControls[e].attachEvents(),t.activeControls[e].getReturn?t.activeControls[e].getReturn():void 0}console.warn("UI Control control with identifying name '"+e+"' already exists. Remove the existing one or pick a different name to add this control.")},this.removeControl=function(e){delete t.activeControls[e],document.getElementById("_lithosphere_control_"+e).remove()},this._onUpdateEvent=function(){Object.values(t.activeControls).forEach((function(e){"function"==typeof e.onUpdate&&e.onUpdate()}))},this._onMove=function(e,n,r){Object.values(t.activeControls).forEach((function(t){"function"==typeof t.onMove&&t.onMove(e,n,r)}))},this._onMouseMove=function(e,n,r){Object.values(t.activeControls).forEach((function(t){"function"==typeof t.onMouseMove&&t.onMouseMove(e,n,r)}))},this._onMouseOut=function(e){Object.values(t.activeControls).forEach((function(t){"function"==typeof t.onMouseOut&&t.onMouseOut(e)}))},this._onFirstPersonUpdate=function(){Object.values(t.activeControls).forEach((function(e){"function"==typeof e.onFirstPersonUpdate&&e.onFirstPersonUpdate()}))},this._onOrbitalUpdate=function(e){Object.values(t.activeControls).forEach((function(t){"function"==typeof t.onOrbitalUpdate&&t.onOrbitalUpdate(e)}))},this.p=e,this.activeControls={},this.controlContainer=document.createElement("div"),this.controlContainer.setAttribute("id","_lithosphere_controls"),this.controlContainer.style.position="absolute",this.controlContainer.style.top="0",this.controlContainer.style.left="0",this.controlContainer.style.width="100%",this.controlContainer.style.height="100%",this.controlContainer.style.pointerEvents="none",this.controlContainer.style.color="white",this.controlContainer.style.fontFamily="sans-serif",this.controlContainer.style.zIndex="1000",this.p._.container.appendChild(this.controlContainer),this.corners={TopLeft:null,TopRight:null,BottomLeft:null,BottomRight:null},this.corners.TopLeft=document.createElement("div"),this.corners.TopLeft.setAttribute("id","_lithosphere_controls_topleft"),this.corners.TopLeft.style.position="absolute",this.corners.TopLeft.style.top="10px",this.corners.TopLeft.style.left="10px",this.corners.TopLeft.style.pointerEvents="all",this.corners.TopLeft.style.display="flex",this.corners.TopLeft.style.flexFlow="column",this.controlContainer.appendChild(this.corners.TopLeft),this.corners.TopRight=document.createElement("div"),this.corners.TopRight.setAttribute("id","_lithosphere_controls_topright"),this.corners.TopRight.style.position="absolute",this.corners.TopRight.style.top="10px",this.corners.TopRight.style.right="10px",this.corners.TopRight.style.pointerEvents="all",this.corners.TopRight.style.display="flex",this.controlContainer.appendChild(this.corners.TopRight),this.corners.BottomLeft=document.createElement("div"),this.corners.BottomLeft.setAttribute("id","_lithosphere_controls_bottomleft"),this.corners.BottomLeft.style.position="absolute",this.corners.BottomLeft.style.bottom="10px",this.corners.BottomLeft.style.left="10px",this.corners.BottomLeft.style.pointerEvents="all",this.corners.BottomLeft.style.display="flex",this.controlContainer.appendChild(this.corners.BottomLeft),this.corners.BottomRight=document.createElement("div"),this.corners.BottomRight.setAttribute("id","_lithosphere_controls_bottomright"),this.corners.BottomRight.style.position="absolute",this.corners.BottomRight.style.bottom="10px",this.corners.BottomRight.style.right="10px",this.corners.BottomRight.style.pointerEvents="all",this.corners.BottomRight.style.display="flex",this.controlContainer.appendChild(this.corners.BottomRight),this.compass=Lf,this.coordinates=Of,this.navigation=Rf,this.home=kf,this.layers=If,this.exaggerate=Df,this.observe=Nf,this.walk=jf,this.link=Ff},zf=(n(14),function(e){var t=this;this.end=function(e){!1!==t.p.options.loadingScreen&&t.loadingContainer&&(t.loadingContainer.style.opacity="0",t.p._.sceneContainer.style.filter="blur(0px) brightness(1)",setTimeout((function(){t.loadingContainer.remove(),t.loadingContainer=null,t.p._.sceneContainer.style.filter=null,t.p._.sceneContainer.style.transition=null}),500))},this.p=e,!1!==this.p.options.loadingScreen&&(this.loadingContainer=document.createElement("div"),this.loadingContainer.setAttribute("id","_lithosphere_loadingscreen"),this.loadingContainer.style.position="absolute",this.loadingContainer.style.top="0",this.loadingContainer.style.left="0",this.loadingContainer.style.width="100%",this.loadingContainer.style.height="100%",this.loadingContainer.style.background="black",this.loadingContainer.style.color="white",this.loadingContainer.style.fontFamily="sans-serif",this.loadingContainer.style.zIndex="9001",this.loadingContainer.style.opacity="1",this.loadingContainer.style.transition="opacity 0.5s ease-in",this.loadingContainer.innerHTML=["<div class='_lithosphere_loadingscreen_loading'>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","</div>"].join("\n"),this.p._.container.appendChild(this.loadingContainer),this.p._.sceneContainer.style.filter="blur(10px) brightness(0.5)",this.p._.sceneContainer.style.transition="filter 0.5s ease-in-out")}),Uf=function(){return(Uf=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Hf=function(){function e(e,t){var n=this;this._animate=function(){window.requestAnimationFrame(n._animate),n._render()},this._onFirstLoad=function(){n._.firstLoad=!0,n._.events._rotateGlobe({pageX:0,pageY:0},{x:1e-4,y:1e-4}),n._.rendererWrapper.updateSize(),setTimeout((function(){n.setCenter(n.options.initialView,!1,!0),n._.events._onZoom(),n._.loadingScreen.end()}),100)},this.setCenter=function(e,t,r){if(!n._.wasInitialized)return!1;var i=(90-(e.lat||0))*(Math.PI/180),o=(e.lng||0)*(Math.PI/180);if(n.planet.rotation.set(i,o,0),n._.events._matchPlanetsLODToPlanet(),null!=e.zoom&&1!=t){n.zoom=e.zoom;var a=n.getCenter(!0);n._.cameras.orbit.camera.position.y=-4e7/n.projection.radiusScale/Math.pow(2,n.zoom),r&&(n._.cameras.orbit.camera.position.y-=a.height),n._.cameras.firstPerson.controls.getObject().position.y=-4e7/n.projection.radiusScale/Math.pow(2,n.zoom),r&&(n._.cameras.firstPerson.controls.getObject().position.y-=a.height)}return n._.events._refreshFrontGroupRotation(),!0},this.getCenterXYZ=function(e){if(e){n._.raycaster.set(new _(0,n.planetCenter.y,0),new _(0,1,0));for(var t=[],r=0;r<n._.tiledWorld.tilesDrawn.length;r++)n._.tiledWorld.tilesDrawn[r].isLODTile||t.push(n._.tiledWorld.tilesDrawn[r].t);var i=n._.raycaster.intersectObjects(t);return i.length>0?(i[0].point.y+=n.planetCenter.y,i[0].point):new _(0,0,0)}var o={x:n.planetCenter.x,y:n.planetCenter.y,z:n.planetCenter.z};return o=n.projection.rotatePoint3D(o,{x:-n.planet.rotation.x,y:0,z:0}),o=n.projection.rotatePoint3D(o,{x:0,y:-n.planet.rotation.y,z:0}),o=n.projection.rotatePoint3D(o,{x:0,y:0,z:-n.planet.rotation.z}),new _(o.x,o.y,o.z)},this.getCenter=function(e){var t=n.getCenterXYZ(e);if(e){var r=JSON.parse(JSON.stringify(t));return r=n.projection.rotatePoint3D(r,{x:-n.planet.rotation.x,y:0,z:0}),r=n.projection.rotatePoint3D(r,{x:0,y:-n.planet.rotation.y,z:0}),r=n.projection.rotatePoint3D(r,{x:0,y:0,z:-n.planet.rotation.z}),(r=n.projection.vector3ToLatLng(r)).height=t.length()*n.projection.radiusScale-n.projection.radii.major,r}return n.projection.vector3ToLatLng(t)},this.getCenterElevation=function(){return n.getCenterXYZ(!0).length()*n.projection.radiusScale-n.projection.radii.major},this.getCenterElevationRaw=function(){var e=n.getCenterXYZ(!0).length();if(!(e<=.1&&e>=-.1))return e},this.getElevationAtLngLat=function(e,t){var r=n.projection.lonLatToVector3(e,t,1e5*n.options.exaggeration),i=new be;i.position.set(0,-n.planetCenter.y,0),i.rotation.set(n.planet.rotation.x,n.planet.rotation.y,n.planet.rotation.z);var o=new kt(new Go(200,32,32),new Ve({color:16776960}));o.position.set(r.x,r.y,r.z),i.add(o),i.updateMatrixWorld();var a=new _;a.setFromMatrixPosition(o.matrixWorld),n._.raycaster.set(a,new _(0,-n.planetCenter.y,0).normalize());for(var s=[],l=0;l<n._.tiledWorld.tilesDrawn.length;l++)n._.tiledWorld.tilesDrawn[l].isLODTile||s.push(n._.tiledWorld.tilesDrawn[l].t);var c=n._.raycaster.intersectObjects(s);return c.length>0?(c[c.length-1].point.y+=n.planetCenter.y,c[c.length-1].point.length()*n.projection.radiusScale-n.projection.radii.major):0},this.getCenterTile=function(){var e=n.getCenter();return n.projection.latLngZ2TileXYZ(e.lat,e.lng,n.zoom)},this.getCameras=function(){return{camera:n._.cameras.camera,isFirstPerson:n._.cameras.isFirstPerson,firstPerson:n._.cameras.firstPerson,orbit:n._.cameras.orbit}},this.getContainer=function(){return n._.container},this.invalidateSize=function(){n._.wasInitialized&&(n._.renderer.setSize(n._.sceneContainer.offsetWidth,n._.sceneContainer.offsetHeight),n._.cameras.updateSize())};var r=document.getElementById(e).appendChild(document.createElement("div"));r.id="_lithosphere_scene",r.style.width="100%",r.style.height="100%",this._={containerId:e,container:document.getElementById(e),sceneContainer:r,wasInitialized:!1,rendererWrapper:null,renderer:null,cameras:null,cameraPositionTarget:null,tiledWorld:null,events:null,maxZoom:0,minNativeZoom:0,loader:new Aa,raycaster:new Xs,updateEveryNthRender:1,counters:{update:0,frame:0},lastCameraWasFirst:!1,firstUpdate:!0,firstLoad:!1,loadingScreen:null,renderOnlyWhenOpen:!0,zCutOff:3,firstViewOverride:null,mouseIsInScene:!1,marsRadius:3396190},this._.container.style.position="relative",this.scene=new ii,this.scenesLOD=[new ii,new ii,new ii],this.sceneBack=new ii,this.sceneFront=new ii,this.planet=new be,this.planetsLOD=[new be,new be,new be],this.frontGroup=new be;t=t||{},this.options=Uf(Uf({},{loadingScreen:!0,tileMapResource:null,customParsers:{},radiusOfTiles:4,useLOD:!0,LOD:[{radiusOfTiles:4,zoomsUp:3},{radiusOfTiles:2,zoomsUp:7},{radiusOfTiles:2,zoomsUp:11}],tileResolution:32,trueTileResolution:256,showAxes:!1,wireframeMode:!1,exaggeration:1,renderOnlyWhenOpen:!0,targetYOffset:0,highlightColor:"yellow",activeColor:"red"}),t),this._init()}return e.prototype._init=function(){if(this._.rendererWrapper=new pl(this._.sceneContainer),this._.renderer=this._.rendererWrapper.renderer,!this._.renderer)return!1;if(this._.wasInitialized=!0,this.projection=new gh(this.options.majorRadius,this.options.minorRadius,this.options.tileMapResource,this.options.trueTileResolution),this._.cameras=new bl(this._.container,this._.sceneContainer,this.scene,this.projection),this.layers=new Af(this),this.addLayer=this.layers.addLayer,this.removeLayer=this.layers.removeLayer,this.toggleLayer=this.layers.toggleLayer,this.setLayerOpacity=this.layers.setLayerOpacity,this.setLayerFilterEffect=this.layers.setLayerFilterEffect,this.setLayerSpecificOptions=this.layers.setLayerSpecificOptions,this.getLayerByName=this.layers.getLayerByName,this.hasLayer=this.layers.hasLayer,this._.tiledWorld=new Nh(this),this.zoom=10,this.trueZoom=this.zoom,this.mouse={lat:null,lng:null,elev:null},this.planetCenter=new _(0,-this.projection.radii.major/this.projection.radiusScale,0),this.planet.position.set(this.planetCenter.x,-this.planetCenter.y,this.planetCenter.z),this.scene.add(this.planet),this.scenesLOD[0].add(this.planetsLOD[0]),this.scenesLOD[1].add(this.planetsLOD[1]),this.scenesLOD[2].add(this.planetsLOD[2]),this.frontGroup.position.set(this.planetCenter.x,-this.planetCenter.y,this.planetCenter.z),this.sceneFront.add(this.frontGroup),this.scene.add(new ls(16711422)),this.options.starsphere){var e=new Go(1e3*this.planetCenter.y,64,64),t=new Ve({color:this.options.starsphere.color||11184810});this.options.starsphere.url&&(t.map=this._.loader.load(this.options.starsphere.url)),t.opacity=1,this.starsphere=new kt(e,t),this.sceneBack.add(this.starsphere)}if(this.options.atmosphere&&(this.atmosphere=new kt(new Go(1.5*this.planetCenter.y,128,128),vh.atmosphere(this.options.atmosphere.color)),this.sceneBack.add(this.atmosphere)),!0===this.options.showAxes){var n=new Hi({color:16711680}),r=new Yi((new mt).setFromPoints([new _(0,0,0),new _(2*this.planetCenter.y,0,0)]),n);this.scene.add(r);var i=new Hi({color:65280}),o=new Yi((new mt).setFromPoints([new _(0,0,0),new _(0,2*this.planetCenter.y,0)]),i);this.scene.add(o);var a=new Hi({color:255}),s=new Yi((new mt).setFromPoints([new _(0,0,0),new _(0,0,2*this.planetCenter.y)]),a);this.scene.add(s)}return this.controls=new Bf(this),this.addControl=this.controls.addControl,this.removeControl=this.controls.removeControl,!1===this.options.renderOnlyWhenOpen&&(this._.renderOnlyWhenOpen=!1),this._.loadingScreen=new zf(this),this._.events=new id(this),this.setCenter(this.options.initialView),this._animate(),!0},e.prototype._render=function(){if(this._.renderer.clear(),this._.renderOnlyWhenOpen){var e=this._.container.getBoundingClientRect();if(e.width<=0||e.height<=0)return}this._.counters.update=(this._.counters.update+1)%this._.updateEveryNthRender,0===this._.counters.update&&this._update(),this._.cameras.isFirstPerson||this._.cameras.orbit.controls.update(),this.layers.tile3d.forEach((function(e){e.renderer.update()})),this._.renderer.render(this.sceneBack,this._.cameras.camera),this._.renderer.clearDepth(),this._.renderer.render(this.scenesLOD[2],this._.cameras.camera),this._.renderer.clearDepth(),this._.renderer.render(this.scenesLOD[1],this._.cameras.camera),this._.renderer.clearDepth(),this._.renderer.render(this.scenesLOD[0],this._.cameras.camera),this._.renderer.clearDepth(),this._.renderer.render(this.scene,this._.cameras.camera),this._.renderer.clearDepth(),this._.renderer.render(this.sceneFront,this._.cameras.camera)},e.prototype._update=function(){if(this._.wasInitialized){if(this._.renderOnlyWhenOpen){var e=this._.container.getBoundingClientRect();if(e.width<=0||e.height<=0)return}if(this._.counters.frame=(this._.counters.frame+1)%4,this.scene.rotation.x=0,this.scene.position.y=0,this._.firstUpdate||this._.tiledWorld.refreshTiles(),this._.events._checkDesiredZoom(),this.controls._onUpdateEvent(),this._.cameras.isFirstPerson){this._.lastCameraWasFirst=!0,this._.cameras.firstPerson.controls.getObject().position.y=this._.cameras.orbit.controls.target.y-this._.cameras.firstPerson.height/this.projection.radiusScale;var t=this._.cameras.update();this._.events._rotateGlobe(t),this._.events._onMouseMove(),this.controls._onFirstPersonUpdate()}else this._.lastCameraWasFirst&&(this._.lastCameraWasFirst=!1,this.controls._onOrbitalUpdate());if(this._.firstUpdate){null!=this._.firstViewOverride?this.setCenter(this._.firstViewOverride):this.setCenter(this.options.initialView,!0);var n=this._.cameras.orbit,r=n.camera,i=n.controls,o=r.position,a=i.target;this._.cameraPositionTarget=[o.x,o.y,o.z,a.x,a.y,a.z],this._.firstUpdate=!1}}},e}();t.default=Hf}])}));